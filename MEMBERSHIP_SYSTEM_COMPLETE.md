# โ ูุธุงู ุงูุนุถููุงุช ูุงูู - ุงูุญู ุงูููุงุฆู

## ๐ ููุฎุต ูุง ุชู ุฅูุฌุงุฒู

### 1. โ ุชุณุฌูู ุงูุนุถููุงุช ูู Database
```
ุฌุฏูู: wp_asmaa_customer_memberships
โ customer_id
โ membership_plan_id  
โ start_date
โ end_date
โ status
โ services_used
```

**ูุซุงู - ูููู ุณุงูู:**
```
ID: 4
ุงูุนูููุฉ: ูููู ุณุงูู (ID: 5)
ุงูุจุงูุฉ: ุงูุฎุทุฉ ุงูุฃุณุงุณูุฉ (ID: 1)
ุงูุจุฏุงูุฉ: 2025-12-15
ุงูุงูุชูุงุก: 2025-12-20 (ุจุนุฏ 5 ุฃูุงู)
ุงูุญุงูุฉ: Active
ุงูุฎุฏูุงุช ุงููุณุชุฎุฏูุฉ: 0 / 5
```

---

### 2. โ ุนุฑุถ ุงูุนููุงุก ูู ุตูุญุฉ Memberships

**Tab "Members"** ูุนุฑุถ:
- โ ุงุณู ุงูุนููู + ุงููุงุชู
- โ ุงุณู ุงูุจุงูุฉ
- โ ุชุงุฑูุฎ ุงูุจุฏุงูุฉ / ุงูุงูุชูุงุก
- โ ุนุฏุฏ ุงูุฎุฏูุงุช ุงููุณุชุฎุฏูุฉ / ุงูุญุฏ ุงูุฃูุตู
- โ ุงูุญุงูุฉ (Active/Expired/Cancelled)
- โ ุฅุฌุฑุงุกุงุช (Renew/Cancel)

**Fix ุงููุทุจู:**
```javascript
// ูุจู: loadMembers() ูุด ููุฌูุฏ
onMounted(async () => {
  await Promise.all([loadPlans(), loadCustomers()]);
});

// ุจุนุฏ: loadMembers() ููุฌูุฏ โ
onMounted(async () => {
  await Promise.all([loadPlans(), loadCustomers(), loadMembers()]);
});
```

---

### 3. โ ูุธุงู ุฅุดุนุงุฑุงุช ุงูุชูุงุก ุงูุนุถููุงุช (ุฌุฐุฑู)

#### ุงูุฅุดุนุงุฑุงุช:

**ุฃ) ูุจู 5 ุฃูุงู ูู ุงูุงูุชูุงุก:**
```
โ๏ธ ุชูุจูู: ุนุถููุฉ ูุงุฑุจุช ุนูู ุงูุงูุชูุงุก

ุนุถููุฉ ุงูุนูููุฉ "ูููู ุณุงูู" (+965 56789012) ูู ุจุงูุฉ 
"ุงูุฎุทุฉ ุงูุฃุณุงุณูุฉ" ุณุชูุชูู ุจุนุฏ 5 ููู (ุชุงุฑูุฎ ุงูุงูุชูุงุก: 2025-12-20)

ููุฐ ูุญุธุงุช
๐ฆ ุงูุชูุงุก ุนุถููุฉ
```

**ุจ) ููู ุงูุงูุชูุงุก:**
```
๐ด ุชูุจูู: ุนุถููุฉ ุงูุชูุช ุงูููู

ุนุถููุฉ ุงูุนูููุฉ "ูููู ุณุงูู" (+965 56789012) ูู ุจุงูุฉ 
"ุงูุฎุทุฉ ุงูุฃุณุงุณูุฉ" ุงูุชูุช ุงูููู (2025-12-20)

ููุฐ ูุญุธุงุช
๐ฆ ุงูุชูุงุก ุนุถููุฉ
```

---

#### ุงูุขููุฉ (WP-Cron):

```
ูู ููู ุงูุณุงุนุฉ 9 ุตุจุงุญุงู:
    โ
MembershipExpiryChecker::check_and_notify()
    โ
Query 1: ุงูุนุถููุงุช ุงููู end_date = ุงูููู + 5 ุฃูุงู
Query 2: ุงูุนุถููุงุช ุงููู end_date = ุงูููู
    โ
ููู ุนุถููุฉ:
    โโ ุชุญูู ูู ุนุฏู ุฅุฑุณุงู notification ูุจู ูุฏู ุงูููุงุฑุฏู
    โโ ุฃุจุนุช notification ูุน ูู ุงูุชูุงุตูู
    โโ Log ูู error_log
    โ
ุฅุฐุง ุงูุนุถููุฉ ุงูุชูุช ุงูููู:
    โโ ุชุญุฏูุซ status โ 'expired'
```

---

## ๐๏ธ ุงููููุงุช ุงููููุดุฃุฉ/ุงูููุนุฏูุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
1. โ `includes/Services/MembershipExpiryChecker.php` - ุงูููุงุณ ุงูุฑุฆูุณู

### ูููุงุช ููุนุฏูุฉ:
1. โ `includes/Services/NotificationDispatcher.php` - ุฅุถุงูุฉ `membership_expiry_alert()`
2. โ `includes/Install/Activator.php` - ุชุณุฌูู WP-Cron
3. โ `includes/Install/Deactivator.php` - ุฅูุบุงุก WP-Cron
4. โ `includes/Plugin.php` - action hook
5. โ `assets/src/views/Memberships/Index.vue` - ุฅุตูุงุญ load
6. โ `assets/src/views/Notifications/Index.vue` - ุฏุนู ุงูููุน ุงูุฌุฏูุฏ
7. โ `assets/src/locales/ar.json` - ุชุฑุฌูุฉ "ุงูุชูุงุก ุนุถููุฉ"
8. โ `assets/src/locales/en.json` - ุชุฑุฌูุฉ "Membership Expiry"

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### ุชู ุงูุฅุนุฏุงุฏ ููุงุฎุชุจุงุฑ:

```sql
โ ุนุถููุฉ ูููู ุณุงูู:
   End Date: 2025-12-20 (ุจุนุฏ 5 ุฃูุงู ูู ุงูููู)
   Status: Active

โ Notification ูููุดุฃ ูุฏููุงู:
   ID: 7
   Type: membership_expiry
   Customer: ูููู ุณุงูู
   Plan: ุงูุฎุทุฉ ุงูุฃุณุงุณูุฉ
```

---

### ุฎุทูุงุช ุงูุชุญูู:

#### 1. ุงูุชุญ ุตูุญุฉ Notifications

```
Admin Panel โ Notifications (๐)
```

**ูุฌุจ ุฃู ุชุฑู:**
```
โ๏ธ ุชูุจูู: ุนุถููุฉ ูุงุฑุจุช ุนูู ุงูุงูุชูุงุก

ุนุถููุฉ ุงูุนูููุฉ "ูููู ุณุงูู" (+965 56789012) ูู ุจุงูุฉ 
"ุงูุฎุทุฉ ุงูุฃุณุงุณูุฉ" ุณุชูุชูู ุจุนุฏ 5 ููู (ุชุงุฑูุฎ ุงูุงูุชูุงุก: 2025-12-20)

ููุฐ ูุญุธุงุช
๐ด ุบูุฑ ููุฑูุก    ๐ฆ ุงูุชูุงุก ุนุถููุฉ
```

---

#### 2. ุงุถุบุท ุนูู ุงูุฅุดุนุงุฑ

**ุงููุชูุฌุฉ:**
- โ ููููู ูุตูุญุฉ Memberships
- โ Tab "Members" ููุชูุญ
- โ Filter ุจูcustomer_id = 5

---

#### 3. ุชุญูู ูู Database

```sql
SELECT * FROM wp_asmaa_notifications 
WHERE type = 'membership_expiry';
```

---

### ุงุฎุชุจุงุฑ WP-Cron (ุชููุงุฆู):

#### ุงูุทุฑููุฉ 1: ุงูุชุธุฑ ุญุชู ุบุฏุงู 9 ุตุจุงุญุงู
```
WP-Cron ูุดุชุบู ุชููุงุฆูุงู โ
ููุญุต ุงูุนุถููุงุช
ูุจุนุช ุฅุดุนุงุฑุงุช
```

---

#### ุงูุทุฑููุฉ 2: Force Run

ุฃุถู ูู `functions.php` (ูุคูุชุงู):

```php
add_action('init', function() {
    if (isset($_GET['run_membership_check']) && current_user_can('manage_options')) {
        \AsmaaSalon\Services\MembershipExpiryChecker::check_and_notify();
        wp_die('Membership check executed! Check Notifications page.');
    }
});
```

ุซู ุงูุชุญ:
```
http://localhost/asmaa-salon-dashboard?run_membership_check=1
```

---

## ๐ Timeline ุงูุฅุดุนุงุฑุงุช ูุนุถููุฉ ูููู ุณุงูู

```
ุงูููู: 15 ุฏูุณูุจุฑ 2025
End Date: 20 ุฏูุณูุจุฑ 2025

15 ุฏูุณูุจุฑ (ุงูููู): ูุง ุดูุก
16 ุฏูุณูุจุฑ: ูุง ุดูุก
17 ุฏูุณูุจุฑ: ูุง ุดูุก
18 ุฏูุณูุจุฑ: ูุง ุดูุก
19 ุฏูุณูุจุฑ: ูุง ุดูุก
20 ุฏูุณูุจุฑ (ุจุนุฏ 5 ุฃูุงู): โ๏ธ ุฅุดุนุงุฑ "ูุงุฑุจุช ุนูู ุงูุงูุชูุงุก" (5 days left)
...
25 ุฏูุณูุจุฑ (ููู ุงูุงูุชูุงุก): ๐ด ุฅุดุนุงุฑ "ุงูุชูุช ุงูููู" + Status โ Expired
```

---

## ๐ฏ ุงููุฑู ุงูุฌููุฑู

### ูุจู:
```
โ ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช
โ ุงูุนุถููุงุช ุชูุชูู ุจุฏูู ุนูู ุงููุฏูุฑ
โ ูุญุชุงุฌ ูุญุต ูุฏูู ุฏุงุฆูุงู
```

### ุจุนุฏ:
```
โ ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ
โ ูุจู 5 ุฃูุงู + ููู ุงูุงูุชูุงุก
โ ุชูุงุตูู ูุงููุฉ (ุงุณูุ ูุงุชูุ ุจุงูุฉุ ุชุงุฑูุฎ)
โ ุชุญุฏูุซ status ุชููุงุฆูุงู
โ ุญู ุฌุฐุฑู ุจูWP-Cron
```

---

## ๐ ุงููุธุงู ุฌุงูุฒ!

### ูุง ุชู ุชุทุจููู:

1. โ **ุชุณุฌูู ุงูุนุถููุงุช** - ูู Database ุตุญ
2. โ **ุนุฑุถ ูู Memberships** - ูุธูุฑ ูู ุงูุนููุงุก
3. โ **ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ** - WP-Cron ูููู
4. โ **ุชูุงุตูู ูุงููุฉ** - ุงุณูุ ูุงุชูุ ุจุงูุฉุ ุชุงุฑูุฎ
5. โ **ุฅุดุนุงุฑุงู** - ูุจู 5 ุฃูุงู + ููู ุงูุงูุชูุงุก
6. โ **ุชุญุฏูุซ ุชููุงุฆู** - Status โ Expired
7. โ **ุญู ุฌุฐุฑู** - ุจุฏูู ูุณุฑ WordPress

---

## ๐ ุงูุชุญูู ุงูุขู:

1. **ุงูุชุญ Notifications** (๐)
2. **ูุฌุจ ุฃู ุชุฑู** ุฅุดุนุงุฑ ุนุถููุฉ ูููู ุณุงูู
3. **ุงุถุบุท ุนููู** โ ููููู ููMemberships
4. **Tab Members** โ ุชุธูุฑ ูููู ุณุงูู ูุน ุจุงูุชูุง

**ูู ุดูุก ูุนูู ุชููุงุฆูุงู ุงูุขู!** ๐
