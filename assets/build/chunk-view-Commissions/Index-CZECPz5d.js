import{f as h,e as O,j as re,c as b,o as m,d as t,b as c,w as n,u as e,a0 as ue,l as de,x as w,P as k,C as d,t as i,$ as me,a2 as V,a4 as P,F as U,g as K,a3 as L,aa as pe,ab as fe,s as F,ac as ve,ad as R,Y as N,n as _e,a as ge,ae as he,a5 as be,a6 as Ce,a7 as ye,a8 as ke,h as Se}from"../chunk-vendor-vue-VAxhpvd9.js";import{u as we,a as D}from"../chunk-component-NotificationsBell-CTLJWkW4.js";import{u as Ve}from"../chunk-view-AppleWallet/Simulator-BwS6bEkK.js";import{P as Ae}from"../chunk-component-PageHeader-CMYNL4hu.js";import{S as T}from"../chunk-component-StatCard-B1HS9GpT.js";import{_ as xe,C as G}from"../chunk-component-Card-DPM96EeB.js";import{E as We}from"../chunk-component-EmptyState-DXFewvrN.js";import{L as Fe}from"../chunk-component-LoadingSpinner-CNyGcK0V.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-pinia-CjQxP09R.js";import"../chunk-vendor-axios-B9ygI19o.js";const De={class:"commissions-page"},Te={class:"stats-grid"},Ie={value:""},Be={value:"pending"},Ee={value:"approved"},Me={value:"paid"},Pe={value:""},Ue=["value"],Ke={key:2,class:"table-wrapper"},Le={class:"table-header-row"},Ne={class:"th-check"},$e={class:"th-staff"},je={class:"th-base"},ze={class:"th-rate"},Oe={class:"th-bonus"},Re={class:"th-final"},Ge={class:"th-status"},He={class:"th-date"},Ye={class:"td-check"},qe={class:"td-staff"},Je={class:"staff-name"},Qe={class:"td-base"},Xe={class:"unified-amount"},Ze={class:"td-rate"},ea={class:"td-bonus"},aa={class:"td-final"},ta={class:"unified-amount"},sa={class:"td-status"},la={class:"td-date"},oa={class:"date-cell"},na={key:0,class:"d-flex justify-content-between align-items-center"},ia={class:"text-muted"},ca={value:""},ra=["value"],ua={__name:"Index",setup(da){const{t:a}=we(),C=Ve(),H=de(),f=h([]),I=h(!1),g=h([]),A=h(!1),x=h([]),B=h(!1),S=h(!1),y=h({staff_id:""}),u=h({status:"",staff_id:"",search:"",start_date:"",end_date:""}),r=h({current_page:1,per_page:20,total:0,total_pages:0}),W=O(()=>{const o=f.value.length,s=f.value.filter(_=>_.status==="pending").length,l=f.value.filter(_=>_.status==="paid").length,v=f.value.reduce((_,ce)=>_+(parseFloat(ce.final_amount)||0),0);return{total:o,pending:s,paid:l,totalAmount:v}}),E=o=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(o||0),Y=o=>{if(!o&&o!==0)return"0 KWD";const s=parseFloat(o);return s>=1e3?`${(s/1e3).toFixed(1)}K KWD`:`${s.toFixed(0)} KWD`},q=o=>o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",J=o=>({pending:a("commissions.pending"),approved:"Approved",paid:a("commissions.paid")})[o]||o,Q=o=>({pending:"cil-clock",approved:"cil-check-circle",paid:"cil-check"})[o]||"cil-info",p=async()=>{var o;I.value=!0;try{const s={page:r.value.current_page,per_page:r.value.per_page,...u.value};Object.keys(s).forEach(_=>{s[_]===""&&delete s[_]});const l=await D.get("/commissions",{params:s,noCache:!0}),v=((o=l.data)==null?void 0:o.data)||l.data||{};f.value=v.items||[],r.value=v.pagination||r.value}catch(s){console.error("Error loading commissions:",s),C.error(a("common.errorLoading")),f.value=[],r.value={current_page:1,per_page:20,total:0,total_pages:0}}finally{I.value=!1}},$=async()=>{var o;try{const s=await D.get("/staff",{params:{per_page:200},noCache:!0}),l=((o=s.data)==null?void 0:o.data)||s.data||{};x.value=l.items||l||[]}catch{x.value=[]}},j=O(()=>x.value||[]),X=o=>{r.value.current_page=o,p()},Z=()=>{u.value={status:"",staff_id:"",search:"",start_date:"",end_date:""},r.value.current_page=1,p()};let z;const ee=()=>{clearTimeout(z),z=setTimeout(()=>{r.value.current_page=1,p()},500)},ae=o=>{const s=g.value.indexOf(o);s>-1?g.value.splice(s,1):g.value.push(o),A.value=g.value.length===f.value.length},te=()=>{A.value?g.value=f.value.map(o=>o.id):g.value=[]},se=async()=>{if(g.value.length===0){C.error(a("commissions.selectToApprove")||"Select commissions to approve");return}try{await D.post("/commissions/approve",{ids:g.value}),g.value=[],A.value=!1,C.success(a("commissions.approvedSuccess")||"Approved successfully"),p()}catch(o){console.error("Error approving commissions:",o),C.error(a("commissions.approveError")||a("common.errorLoading"))}},le=()=>{H.push("/programs/settings")},oe=()=>{B.value=!0,y.value={staff_id:""},x.value.length===0&&$()},M=()=>{B.value=!1,S.value=!1,y.value={staff_id:""}},ne=async()=>{var o,s,l;if(!y.value.staff_id){C.error(a("commissions.selectStaff")||"Select staff");return}S.value=!0;try{const v=await D.post(`/commissions/apple-wallet/${y.value.staff_id}`),_=((o=v.data)==null?void 0:o.data)||v.data||{};_.pass_url?(window.open(_.pass_url,"_blank"),C.success(a("commissions.passCreated")||"تم إنشاء البطاقة بنجاح")):C.error(a("commissions.passError")||"حدث خطأ في إنشاء البطاقة"),M()}catch(v){console.error("Error creating Apple Wallet pass:",v),C.error(((l=(s=v.response)==null?void 0:s.data)==null?void 0:l.message)||a("commissions.passError")||"حدث خطأ في إنشاء البطاقة")}finally{S.value=!1}},ie=o=>{const s=String(o||"");return s==="paid"?"status-paid":s==="approved"?"status-approved":s==="pending"?"status-pending":"status-other"};return re(()=>{p(),$()}),(o,s)=>(m(),b("div",De,[t(Ae,{title:e(a)("commissions.title"),subtitle:e(a)("commissions.subtitle")||e(a)("commissions.title")+" - "+e(a)("dashboard.subtitle")},{icon:n(()=>[t(e(d),{icon:"cil-dollar"})]),actions:n(()=>[t(e(w),{color:"secondary",variant:"outline",class:"me-2 apple-wallet-btn",onClick:oe},{default:n(()=>[t(e(d),{icon:"cil-wallet",class:"me-2"}),k(" "+i(e(a)("commissions.appleWallet")||"Apple Wallet"),1)]),_:1}),t(e(w),{color:"secondary",variant:"outline",class:"me-2 settings-btn",onClick:le},{default:n(()=>[t(e(d),{icon:"cil-settings",class:"me-2"}),k(" "+i(e(a)("nav.programsSettings")),1)]),_:1}),t(e(w),{color:"primary",class:"btn-primary-custom",onClick:se},{default:n(()=>[t(e(d),{icon:"cil-check",class:"me-2"}),k(" "+i(e(a)("commissions.approveSelected")||"Approve Selected"),1)]),_:1})]),_:1},8,["title","subtitle"]),c("div",Te,[t(T,{label:e(a)("commissions.title"),value:W.value.total||f.value.length,"badge-variant":"info",color:"gold",clickable:!0,onClick:s[0]||(s[0]=()=>{u.value.status="",r.value.current_page=1,p()})},{icon:n(()=>[t(e(d),{icon:"cil-dollar"})]),_:1},8,["label","value"]),t(T,{label:e(a)("commissions.pending"),value:W.value.pending,"badge-variant":"warning",color:"gold",clickable:!0,onClick:s[1]||(s[1]=()=>{u.value.status="pending",r.value.current_page=1,p()})},{icon:n(()=>[t(e(d),{icon:"cil-clock"})]),_:1},8,["label","value"]),t(T,{label:e(a)("commissions.paid"),value:W.value.paid,"badge-variant":"success",color:"gold",clickable:!0,onClick:s[2]||(s[2]=()=>{u.value.status="paid",r.value.current_page=1,p()})},{icon:n(()=>[t(e(d),{icon:"cil-check-circle"})]),_:1},8,["label","value"]),t(T,{label:e(a)("commissions.totalAmount")||"Total Amount",value:Y(W.value.totalAmount),"badge-variant":"info",color:"gold"},{icon:n(()=>[t(e(d),{icon:"cil-money"})]),_:1},8,["label","value"])]),t(G,{title:e(a)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:n(()=>[t(e(me),{class:"g-3"},{default:n(()=>[t(e(V),{md:3},{default:n(()=>[t(e(P),{modelValue:u.value.status,"onUpdate:modelValue":s[3]||(s[3]=l=>u.value.status=l),label:e(a)("common.status"),onChange:p,class:"filter-select"},{default:n(()=>[c("option",Ie,i(e(a)("common.status")),1),c("option",Be,i(e(a)("commissions.pending")),1),c("option",Ee,i(e(a)("commissions.approved")||"Approved"),1),c("option",Me,i(e(a)("commissions.paid")),1)]),_:1},8,["modelValue","label"])]),_:1}),t(e(V),{md:3},{default:n(()=>[t(e(P),{modelValue:u.value.staff_id,"onUpdate:modelValue":s[4]||(s[4]=l=>u.value.staff_id=l),label:e(a)("commissions.staff"),onChange:p,class:"filter-select"},{default:n(()=>[c("option",Pe,i(e(a)("commissions.staff")),1),(m(!0),b(U,null,K(j.value,l=>(m(),b("option",{key:l.id,value:String(l.id)},i(l.name),9,Ue))),128))]),_:1},8,["modelValue","label"])]),_:1}),t(e(V),{md:3},{default:n(()=>[t(e(L),{modelValue:u.value.start_date,"onUpdate:modelValue":s[5]||(s[5]=l=>u.value.start_date=l),type:"date",label:e(a)("reports.fromDate"),onChange:p,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),t(e(V),{md:3},{default:n(()=>[t(e(L),{modelValue:u.value.end_date,"onUpdate:modelValue":s[6]||(s[6]=l=>u.value.end_date=l),type:"date",label:e(a)("reports.toDate"),onChange:p,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),t(e(V),{md:12},{default:n(()=>[t(e(pe),{class:"search-input-group"},{default:n(()=>[t(e(fe),{class:"search-icon-wrapper"},{default:n(()=>[t(e(d),{icon:"cil-magnifying-glass"})]),_:1}),t(e(L),{modelValue:u.value.search,"onUpdate:modelValue":s[7]||(s[7]=l=>u.value.search=l),placeholder:e(a)("commissions.searchStaff")||"Search staff...",onInput:ee,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),t(e(V),{md:3},{default:n(()=>[t(e(w),{color:"secondary",variant:"outline",onClick:Z,class:"w-100 reset-btn"},{default:n(()=>[t(e(d),{icon:"cil-reload",class:"me-1"}),k(" "+i(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),t(G,{title:e(a)("commissions.title"),icon:"cil-list"},{footer:n(()=>[r.value.total_pages>1?(m(),b("div",na,[c("div",ia,i(e(a)("common.view"))+" "+i((r.value.current_page-1)*r.value.per_page+1)+" "+i(e(a)("common.to"))+" "+i(Math.min(r.value.current_page*r.value.per_page,r.value.total))+" "+i(e(a)("common.of"))+" "+i(r.value.total),1),t(e(he),{pages:r.value.total_pages,"active-page":r.value.current_page,"onUpdate:activePage":X},null,8,["pages","active-page"])])):ge("",!0)]),default:n(()=>[I.value?(m(),F(Fe,{key:0,text:e(a)("common.loading")},null,8,["text"])):f.value.length===0?(m(),F(We,{key:1,title:e(a)("common.noData"),description:e(a)("commissions.title")+" - "+e(a)("common.noData"),"icon-color":"gray"},null,8,["title","description"])):(m(),b("div",Ke,[t(e(ve),{hover:"",responsive:"",class:"table-modern commissions-table"},{default:n(()=>[c("thead",null,[c("tr",Le,[c("th",Ne,[t(e(R),{modelValue:A.value,"onUpdate:modelValue":s[8]||(s[8]=l=>A.value=l),onChange:te},null,8,["modelValue"])]),c("th",$e,i(e(a)("commissions.staff")),1),c("th",je,i(e(a)("commissions.baseAmount")||"Base Amount"),1),c("th",ze,i(e(a)("commissions.percentage")),1),c("th",Oe,i(e(a)("commissions.ratingBonus")||"Rating Bonus"),1),c("th",Re,i(e(a)("commissions.amount")),1),c("th",Ge,i(e(a)("common.status")),1),c("th",He,i(e(a)("commissions.date")),1)])]),c("tbody",null,[(m(!0),b(U,null,K(f.value,l=>(m(),b("tr",{key:l.id,class:"table-row commission-row"},[c("td",Ye,[t(e(R),{checked:g.value.includes(l.id),onChange:v=>ae(l.id)},null,8,["checked","onChange"])]),c("td",qe,[c("strong",Je,i(l.staff_name||"—"),1)]),c("td",Qe,[c("strong",Xe,i(E(l.base_amount||0)),1)]),c("td",Ze,[t(e(N),{class:"unified-badge badge-rate"},{default:n(()=>[t(e(d),{icon:"cil-percent",class:"badge-icon"}),c("span",null,i(l.commission_rate||0)+"%",1)]),_:2},1024)]),c("td",ea,[t(e(N),{class:"unified-badge badge-bonus"},{default:n(()=>[t(e(d),{icon:"cil-star",class:"badge-icon"}),c("span",null,i(E(l.rating_bonus||0)),1)]),_:2},1024)]),c("td",aa,[c("strong",ta,i(E(l.final_amount||0)),1)]),c("td",sa,[t(e(N),{class:_e(["unified-badge",ie(l.status)])},{default:n(()=>[t(e(d),{icon:Q(l.status),class:"badge-icon"},null,8,["icon"]),c("span",null,i(J(l.status)),1)]),_:2},1032,["class"])]),c("td",la,[c("span",oa,i(q(l.created_at)),1)])]))),128))])]),_:1})]))]),_:1},8,["title"]),t(e(ue),{visible:B.value,onClose:M,size:"lg"},{default:n(()=>[t(e(be),null,{default:n(()=>[t(e(Ce),null,{default:n(()=>[t(e(d),{icon:"cil-wallet",class:"me-2"}),k(" "+i(e(a)("commissions.createAppleWallet")||"Create Apple Wallet Pass"),1)]),_:1})]),_:1}),t(e(ye),null,{default:n(()=>[t(e(P),{modelValue:y.value.staff_id,"onUpdate:modelValue":s[9]||(s[9]=l=>y.value.staff_id=l),label:e(a)("commissions.selectStaff")||"Select Staff",class:"mb-3"},{default:n(()=>[c("option",ca,i(e(a)("commissions.selectStaff")||"Select Staff"),1),(m(!0),b(U,null,K(j.value,l=>(m(),b("option",{key:l.id,value:l.id},i(l.name),9,ra))),128))]),_:1},8,["modelValue","label"])]),_:1}),t(e(ke),null,{default:n(()=>[t(e(w),{color:"secondary",onClick:M},{default:n(()=>[k(i(e(a)("common.cancel")),1)]),_:1}),t(e(w),{color:"primary",onClick:ne,disabled:S.value||!y.value.staff_id},{default:n(()=>[S.value?(m(),F(e(Se),{key:0,size:"sm",class:"me-2"})):(m(),F(e(d),{key:1,icon:"cil-wallet",class:"me-2"})),k(" "+i(S.value?e(a)("common.creating"):e(a)("common.create")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"])]))}},Sa=xe(ua,[["__scopeId","data-v-050a75cc"]]);export{Sa as default};
