import{f as h,g as R,i as re,c as b,o as m,d as t,b as c,p as n,u as e,Z as ue,h as de,x as w,P as k,C as d,t as i,_ as me,$ as V,a0 as P,F as U,k as K,a1 as L,a2 as pe,a3 as fe,s as F,a4 as ve,a5 as j,Y as N,n as _e,a as ge,a6 as he,a7 as be,a8 as Ce,a9 as ye,aa as ke,e as Se}from"../chunk-vendor-vue-Bg1B1rts.js";import{u as we,a as D}from"../chunk-component-NotificationsBell-DEeZs3pc.js";import{a as Ve}from"../chunk-view-Bookings/BookingAppearance-KKyyhntW.js";import{P as Ae}from"../chunk-component-PageHeader-ChZS5WBt.js";import{S as T}from"../chunk-component-StatCard-CJeSjoUF.js";import{_ as xe,C as G}from"../chunk-component-Card-Ft_8dSMe.js";import{E as We}from"../chunk-component-EmptyState-DTl4QHnC.js";import{L as Fe}from"../chunk-component-LoadingSpinner-Bt4P2D5C.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-B7RCkv_6.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-BfIieaUO.js";import"../chunk-view-Bookings/BookingFormPreview-DdV3FhC4.js";const De={class:"commissions-page"},Te={class:"stats-grid"},Ie={value:""},Be={value:"pending"},Ee={value:"approved"},Me={value:"paid"},Pe={value:""},Ue=["value"],Ke={key:2,class:"table-wrapper"},Le={class:"table-header-row"},Ne={class:"th-check"},$e={class:"th-staff"},ze={class:"th-base"},Oe={class:"th-rate"},Re={class:"th-bonus"},je={class:"th-final"},Ge={class:"th-status"},He={class:"th-date"},Ye={class:"td-check"},Ze={class:"td-staff"},qe={class:"staff-name"},Je={class:"td-base"},Qe={class:"unified-amount"},Xe={class:"td-rate"},ea={class:"td-bonus"},aa={class:"td-final"},ta={class:"unified-amount"},sa={class:"td-status"},oa={class:"td-date"},la={class:"date-cell"},na={key:0,class:"d-flex justify-content-between align-items-center"},ia={class:"text-muted"},ca={value:""},ra=["value"],ua={__name:"Index",setup(da){const{t:a}=we(),C=Ve(),H=de(),f=h([]),I=h(!1),g=h([]),A=h(!1),x=h([]),B=h(!1),S=h(!1),y=h({staff_id:""}),u=h({status:"",staff_id:"",search:"",start_date:"",end_date:""}),r=h({current_page:1,per_page:20,total:0,total_pages:0}),W=R(()=>{const l=f.value.length,s=f.value.filter(_=>_.status==="pending").length,o=f.value.filter(_=>_.status==="paid").length,v=f.value.reduce((_,ce)=>_+(parseFloat(ce.final_amount)||0),0);return{total:l,pending:s,paid:o,totalAmount:v}}),E=l=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(l||0),Y=l=>{if(!l&&l!==0)return"0 KWD";const s=parseFloat(l);return s>=1e3?`${(s/1e3).toFixed(1)}K KWD`:`${s.toFixed(0)} KWD`},Z=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",q=l=>({pending:a("commissions.pending"),approved:"Approved",paid:a("commissions.paid")})[l]||l,J=l=>({pending:"cil-clock",approved:"cil-check-circle",paid:"cil-check"})[l]||"cil-info",p=async()=>{var l;I.value=!0;try{const s={page:r.value.current_page,per_page:r.value.per_page,...u.value};Object.keys(s).forEach(_=>{s[_]===""&&delete s[_]});const o=await D.get("/commissions",{params:s,noCache:!0}),v=((l=o.data)==null?void 0:l.data)||o.data||{};f.value=v.items||[],r.value=v.pagination||r.value}catch(s){console.error("Error loading commissions:",s),C.error(a("common.errorLoading")),f.value=[],r.value={current_page:1,per_page:20,total:0,total_pages:0}}finally{I.value=!1}},$=async()=>{var l;try{const s=await D.get("/staff",{params:{per_page:200},noCache:!0}),o=((l=s.data)==null?void 0:l.data)||s.data||{};x.value=o.items||o||[]}catch{x.value=[]}},z=R(()=>x.value||[]),Q=l=>{r.value.current_page=l,p()},X=()=>{u.value={status:"",staff_id:"",search:"",start_date:"",end_date:""},r.value.current_page=1,p()};let O;const ee=()=>{clearTimeout(O),O=setTimeout(()=>{r.value.current_page=1,p()},500)},ae=l=>{const s=g.value.indexOf(l);s>-1?g.value.splice(s,1):g.value.push(l),A.value=g.value.length===f.value.length},te=()=>{A.value?g.value=f.value.map(l=>l.id):g.value=[]},se=async()=>{if(g.value.length===0){C.error(a("commissions.selectToApprove")||"Select commissions to approve");return}try{await D.post("/commissions/approve",{ids:g.value}),g.value=[],A.value=!1,C.success(a("commissions.approvedSuccess")||"Approved successfully"),p()}catch(l){console.error("Error approving commissions:",l),C.error(a("commissions.approveError")||a("common.errorLoading"))}},oe=()=>{H.push("/programs/settings")},le=()=>{B.value=!0,y.value={staff_id:""},x.value.length===0&&$()},M=()=>{B.value=!1,S.value=!1,y.value={staff_id:""}},ne=async()=>{var l,s,o;if(!y.value.staff_id){C.error(a("commissions.selectStaff")||"Select staff");return}S.value=!0;try{const v=await D.post(`/commissions/apple-wallet/${y.value.staff_id}`),_=((l=v.data)==null?void 0:l.data)||v.data||{};_.pass_url?(window.open(_.pass_url,"_blank"),C.success(a("commissions.passCreated")||"تم إنشاء البطاقة بنجاح")):C.error(a("commissions.passError")||"حدث خطأ في إنشاء البطاقة"),M()}catch(v){console.error("Error creating Apple Wallet pass:",v),C.error(((o=(s=v.response)==null?void 0:s.data)==null?void 0:o.message)||a("commissions.passError")||"حدث خطأ في إنشاء البطاقة")}finally{S.value=!1}},ie=l=>{const s=String(l||"");return s==="paid"?"status-paid":s==="approved"?"status-approved":s==="pending"?"status-pending":"status-other"};return re(()=>{p(),$()}),(l,s)=>(m(),b("div",De,[t(Ae,{title:e(a)("commissions.title"),subtitle:e(a)("commissions.subtitle")||e(a)("commissions.title")+" - "+e(a)("dashboard.subtitle")},{icon:n(()=>[t(e(d),{icon:"cil-dollar"})]),actions:n(()=>[t(e(w),{color:"secondary",variant:"outline",class:"me-2 apple-wallet-btn",onClick:le},{default:n(()=>[t(e(d),{icon:"cil-wallet",class:"me-2"}),k(" "+i(e(a)("commissions.appleWallet")||"Apple Wallet"),1)]),_:1}),t(e(w),{color:"secondary",variant:"outline",class:"me-2 settings-btn",onClick:oe},{default:n(()=>[t(e(d),{icon:"cil-settings",class:"me-2"}),k(" "+i(e(a)("nav.programsSettings")),1)]),_:1}),t(e(w),{color:"primary",class:"btn-primary-custom",onClick:se},{default:n(()=>[t(e(d),{icon:"cil-check",class:"me-2"}),k(" "+i(e(a)("commissions.approveSelected")||"Approve Selected"),1)]),_:1})]),_:1},8,["title","subtitle"]),c("div",Te,[t(T,{label:e(a)("commissions.title"),value:W.value.total||f.value.length,"badge-variant":"info",color:"gold",clickable:!0,onClick:s[0]||(s[0]=()=>{u.value.status="",r.value.current_page=1,p()})},{icon:n(()=>[t(e(d),{icon:"cil-dollar"})]),_:1},8,["label","value"]),t(T,{label:e(a)("commissions.pending"),value:W.value.pending,"badge-variant":"warning",color:"gold",clickable:!0,onClick:s[1]||(s[1]=()=>{u.value.status="pending",r.value.current_page=1,p()})},{icon:n(()=>[t(e(d),{icon:"cil-clock"})]),_:1},8,["label","value"]),t(T,{label:e(a)("commissions.paid"),value:W.value.paid,"badge-variant":"success",color:"gold",clickable:!0,onClick:s[2]||(s[2]=()=>{u.value.status="paid",r.value.current_page=1,p()})},{icon:n(()=>[t(e(d),{icon:"cil-check-circle"})]),_:1},8,["label","value"]),t(T,{label:e(a)("commissions.totalAmount")||"Total Amount",value:Y(W.value.totalAmount),"badge-variant":"info",color:"gold"},{icon:n(()=>[t(e(d),{icon:"cil-money"})]),_:1},8,["label","value"])]),t(G,{title:e(a)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:n(()=>[t(e(me),{class:"g-3"},{default:n(()=>[t(e(V),{md:3},{default:n(()=>[t(e(P),{modelValue:u.value.status,"onUpdate:modelValue":s[3]||(s[3]=o=>u.value.status=o),label:e(a)("common.status"),onChange:p,class:"filter-select"},{default:n(()=>[c("option",Ie,i(e(a)("common.status")),1),c("option",Be,i(e(a)("commissions.pending")),1),c("option",Ee,i(e(a)("commissions.approved")||"Approved"),1),c("option",Me,i(e(a)("commissions.paid")),1)]),_:1},8,["modelValue","label"])]),_:1}),t(e(V),{md:3},{default:n(()=>[t(e(P),{modelValue:u.value.staff_id,"onUpdate:modelValue":s[4]||(s[4]=o=>u.value.staff_id=o),label:e(a)("commissions.staff"),onChange:p,class:"filter-select"},{default:n(()=>[c("option",Pe,i(e(a)("commissions.staff")),1),(m(!0),b(U,null,K(z.value,o=>(m(),b("option",{key:o.id,value:String(o.id)},i(o.name),9,Ue))),128))]),_:1},8,["modelValue","label"])]),_:1}),t(e(V),{md:3},{default:n(()=>[t(e(L),{modelValue:u.value.start_date,"onUpdate:modelValue":s[5]||(s[5]=o=>u.value.start_date=o),type:"date",label:e(a)("reports.fromDate"),onChange:p,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),t(e(V),{md:3},{default:n(()=>[t(e(L),{modelValue:u.value.end_date,"onUpdate:modelValue":s[6]||(s[6]=o=>u.value.end_date=o),type:"date",label:e(a)("reports.toDate"),onChange:p,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),t(e(V),{md:12},{default:n(()=>[t(e(pe),{class:"search-input-group"},{default:n(()=>[t(e(fe),{class:"search-icon-wrapper"},{default:n(()=>[t(e(d),{icon:"cil-magnifying-glass"})]),_:1}),t(e(L),{modelValue:u.value.search,"onUpdate:modelValue":s[7]||(s[7]=o=>u.value.search=o),placeholder:e(a)("commissions.searchStaff")||"Search staff...",onInput:ee,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),t(e(V),{md:3},{default:n(()=>[t(e(w),{color:"secondary",variant:"outline",onClick:X,class:"w-100 reset-btn"},{default:n(()=>[t(e(d),{icon:"cil-reload",class:"me-1"}),k(" "+i(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),t(G,{title:e(a)("commissions.title"),icon:"cil-list"},{footer:n(()=>[r.value.total_pages>1?(m(),b("div",na,[c("div",ia,i(e(a)("common.view"))+" "+i((r.value.current_page-1)*r.value.per_page+1)+" "+i(e(a)("common.to"))+" "+i(Math.min(r.value.current_page*r.value.per_page,r.value.total))+" "+i(e(a)("common.of"))+" "+i(r.value.total),1),t(e(he),{pages:r.value.total_pages,"active-page":r.value.current_page,"onUpdate:activePage":Q},null,8,["pages","active-page"])])):ge("",!0)]),default:n(()=>[I.value?(m(),F(Fe,{key:0,text:e(a)("common.loading")},null,8,["text"])):f.value.length===0?(m(),F(We,{key:1,title:e(a)("common.noData"),description:e(a)("commissions.title")+" - "+e(a)("common.noData"),"icon-color":"gray"},null,8,["title","description"])):(m(),b("div",Ke,[t(e(ve),{hover:"",responsive:"",class:"table-modern commissions-table"},{default:n(()=>[c("thead",null,[c("tr",Le,[c("th",Ne,[t(e(j),{modelValue:A.value,"onUpdate:modelValue":s[8]||(s[8]=o=>A.value=o),onChange:te},null,8,["modelValue"])]),c("th",$e,i(e(a)("commissions.staff")),1),c("th",ze,i(e(a)("commissions.baseAmount")||"Base Amount"),1),c("th",Oe,i(e(a)("commissions.percentage")),1),c("th",Re,i(e(a)("commissions.ratingBonus")||"Rating Bonus"),1),c("th",je,i(e(a)("commissions.amount")),1),c("th",Ge,i(e(a)("common.status")),1),c("th",He,i(e(a)("commissions.date")),1)])]),c("tbody",null,[(m(!0),b(U,null,K(f.value,o=>(m(),b("tr",{key:o.id,class:"table-row commission-row"},[c("td",Ye,[t(e(j),{checked:g.value.includes(o.id),onChange:v=>ae(o.id)},null,8,["checked","onChange"])]),c("td",Ze,[c("strong",qe,i(o.staff_name||"—"),1)]),c("td",Je,[c("strong",Qe,i(E(o.base_amount||0)),1)]),c("td",Xe,[t(e(N),{class:"unified-badge badge-rate"},{default:n(()=>[t(e(d),{icon:"cil-percent",class:"badge-icon"}),c("span",null,i(o.commission_rate||0)+"%",1)]),_:2},1024)]),c("td",ea,[t(e(N),{class:"unified-badge badge-bonus"},{default:n(()=>[t(e(d),{icon:"cil-star",class:"badge-icon"}),c("span",null,i(E(o.rating_bonus||0)),1)]),_:2},1024)]),c("td",aa,[c("strong",ta,i(E(o.final_amount||0)),1)]),c("td",sa,[t(e(N),{class:_e(["unified-badge",ie(o.status)])},{default:n(()=>[t(e(d),{icon:J(o.status),class:"badge-icon"},null,8,["icon"]),c("span",null,i(q(o.status)),1)]),_:2},1032,["class"])]),c("td",oa,[c("span",la,i(Z(o.created_at)),1)])]))),128))])]),_:1})]))]),_:1},8,["title"]),t(e(ue),{visible:B.value,onClose:M,size:"lg"},{default:n(()=>[t(e(be),null,{default:n(()=>[t(e(Ce),null,{default:n(()=>[t(e(d),{icon:"cil-wallet",class:"me-2"}),k(" "+i(e(a)("commissions.createAppleWallet")||"Create Apple Wallet Pass"),1)]),_:1})]),_:1}),t(e(ye),null,{default:n(()=>[t(e(P),{modelValue:y.value.staff_id,"onUpdate:modelValue":s[9]||(s[9]=o=>y.value.staff_id=o),label:e(a)("commissions.selectStaff")||"Select Staff",class:"mb-3"},{default:n(()=>[c("option",ca,i(e(a)("commissions.selectStaff")||"Select Staff"),1),(m(!0),b(U,null,K(z.value,o=>(m(),b("option",{key:o.id,value:o.id},i(o.name),9,ra))),128))]),_:1},8,["modelValue","label"])]),_:1}),t(e(ke),null,{default:n(()=>[t(e(w),{color:"secondary",onClick:M},{default:n(()=>[k(i(e(a)("common.cancel")),1)]),_:1}),t(e(w),{color:"primary",onClick:ne,disabled:S.value||!y.value.staff_id},{default:n(()=>[S.value?(m(),F(e(Se),{key:0,size:"sm",class:"me-2"})):(m(),F(e(d),{key:1,icon:"cil-wallet",class:"me-2"})),k(" "+i(S.value?e(a)("common.creating"):e(a)("common.create")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"])]))}},Aa=xe(ua,[["__scopeId","data-v-1994c600"]]);export{Aa as default};
