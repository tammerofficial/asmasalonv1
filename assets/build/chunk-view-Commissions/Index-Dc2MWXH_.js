import{f,g as E,i as se,c as h,o as _,d as s,b as n,p as c,u as e,h as oe,v as D,O as F,C as m,t as i,Y as le,Z as b,_ as K,F as L,k as N,$ as T,a0 as ne,a1 as ie,q as P,a2 as ce,a3 as W,X as I,n as re,a as ue,a4 as de}from"../chunk-vendor-vue-DxcSX1Jd.js";import{u as me,a as B}from"../chunk-component-NotificationsBell-eCwis6PW.js";import{a as pe}from"../chunk-view-Bookings/BookingAppearance-CtCwBfZ1.js";import{P as ve}from"../chunk-component-PageHeader-BsA6C9en.js";import{S as V}from"../chunk-component-StatCard-AHk13FwB.js";import{_ as _e,C as O}from"../chunk-component-Card-BWbCGpFM.js";import{E as ge}from"../chunk-component-EmptyState-B78c8qVh.js";import{L as fe}from"../chunk-component-LoadingSpinner-PYO1Yq7-.js";import"../chunk-vendor-BwxB3d-x.js";import"../chunk-vendor-charts-CNHMDSF7.js";import"../chunk-vendor-pinia-DRDRCEXO.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-DOq58Wm8.js";import"../chunk-view-Bookings/BookingFormPreview-BJuYIHYB.js";const he={class:"commissions-page"},be={class:"stats-grid"},Ce={value:""},ye={value:"pending"},ke={value:"approved"},Se={value:"paid"},Ve={value:""},xe=["value"],we={key:2,class:"table-wrapper"},Ae={class:"table-header-row"},De={class:"th-check"},Fe={class:"th-staff"},Te={class:"th-base"},Ie={class:"th-rate"},Be={class:"th-bonus"},Ue={class:"th-final"},Ee={class:"th-status"},Ke={class:"th-date"},Le={class:"td-check"},Ne={class:"td-staff"},Pe={class:"staff-name"},We={class:"td-base"},Oe={class:"unified-amount"},$e={class:"td-rate"},Re={class:"td-bonus"},je={class:"td-final"},Ge={class:"unified-amount"},Me={class:"td-status"},qe={class:"td-date"},ze={class:"date-cell"},He={key:0,class:"d-flex justify-content-between align-items-center"},Xe={class:"text-muted"},Ye={__name:"Index",setup(Ze){const{t}=me(),k=pe(),$=oe(),p=f([]),x=f(!1),v=f([]),C=f(!1),w=f([]),u=f({status:"",staff_id:"",search:"",start_date:"",end_date:""}),r=f({current_page:1,per_page:20,total:0,total_pages:0}),S=E(()=>{const l=p.value.length,a=p.value.filter(g=>g.status==="pending").length,o=p.value.filter(g=>g.status==="paid").length,y=p.value.reduce((g,ae)=>g+(parseFloat(ae.final_amount)||0),0);return{total:l,pending:a,paid:o,totalAmount:y}}),A=l=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(l||0),R=l=>{if(!l&&l!==0)return"0 KWD";const a=parseFloat(l);return a>=1e3?`${(a/1e3).toFixed(1)}K KWD`:`${a.toFixed(0)} KWD`},j=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",G=l=>({pending:t("commissions.pending"),approved:"Approved",paid:t("commissions.paid")})[l]||l,M=l=>({pending:"cil-clock",approved:"cil-check-circle",paid:"cil-check"})[l]||"cil-info",d=async()=>{var l;x.value=!0;try{const a={page:r.value.current_page,per_page:r.value.per_page,...u.value};Object.keys(a).forEach(g=>{a[g]===""&&delete a[g]});const o=await B.get("/commissions",{params:a,noCache:!0}),y=((l=o.data)==null?void 0:l.data)||o.data||{};p.value=y.items||[],r.value=y.pagination||r.value}catch(a){console.error("Error loading commissions:",a),k.error(t("common.errorLoading")),p.value=[],r.value={current_page:1,per_page:20,total:0,total_pages:0}}finally{x.value=!1}},q=async()=>{var l;try{const a=await B.get("/staff",{params:{per_page:200},noCache:!0}),o=((l=a.data)==null?void 0:l.data)||a.data||{};w.value=o.items||o||[]}catch{w.value=[]}},z=E(()=>w.value||[]),H=l=>{r.value.current_page=l,d()},X=()=>{u.value={status:"",staff_id:"",search:"",start_date:"",end_date:""},r.value.current_page=1,d()};let U;const Y=()=>{clearTimeout(U),U=setTimeout(()=>{r.value.current_page=1,d()},500)},Z=l=>{const a=v.value.indexOf(l);a>-1?v.value.splice(a,1):v.value.push(l),C.value=v.value.length===p.value.length},J=()=>{C.value?v.value=p.value.map(l=>l.id):v.value=[]},Q=async()=>{if(v.value.length===0){k.error(t("commissions.selectToApprove")||"Select commissions to approve");return}try{await B.post("/commissions/approve",{ids:v.value}),v.value=[],C.value=!1,k.success(t("commissions.approvedSuccess")||"Approved successfully"),d()}catch(l){console.error("Error approving commissions:",l),k.error(t("commissions.approveError")||t("common.errorLoading"))}},ee=()=>{$.push("/programs/settings")},te=l=>{const a=String(l||"");return a==="paid"?"status-paid":a==="approved"?"status-approved":a==="pending"?"status-pending":"status-other"};return se(()=>{d(),q()}),(l,a)=>(_(),h("div",he,[s(ve,{title:e(t)("commissions.title"),subtitle:e(t)("commissions.subtitle")||e(t)("commissions.title")+" - "+e(t)("dashboard.subtitle")},{icon:c(()=>[s(e(m),{icon:"cil-dollar"})]),actions:c(()=>[s(e(D),{color:"secondary",variant:"outline",class:"me-2 settings-btn",onClick:ee},{default:c(()=>[s(e(m),{icon:"cil-settings",class:"me-2"}),F(" "+i(e(t)("nav.programsSettings")),1)]),_:1}),s(e(D),{color:"primary",class:"btn-primary-custom",onClick:Q},{default:c(()=>[s(e(m),{icon:"cil-check",class:"me-2"}),F(" "+i(e(t)("commissions.approveSelected")||"Approve Selected"),1)]),_:1})]),_:1},8,["title","subtitle"]),n("div",be,[s(V,{label:e(t)("commissions.title"),value:S.value.total||p.value.length,"badge-variant":"info",color:"gold",clickable:!0,onClick:a[0]||(a[0]=()=>{u.value.status="",r.value.current_page=1,d()})},{icon:c(()=>[s(e(m),{icon:"cil-dollar"})]),_:1},8,["label","value"]),s(V,{label:e(t)("commissions.pending"),value:S.value.pending,"badge-variant":"warning",color:"gold",clickable:!0,onClick:a[1]||(a[1]=()=>{u.value.status="pending",r.value.current_page=1,d()})},{icon:c(()=>[s(e(m),{icon:"cil-clock"})]),_:1},8,["label","value"]),s(V,{label:e(t)("commissions.paid"),value:S.value.paid,"badge-variant":"success",color:"gold",clickable:!0,onClick:a[2]||(a[2]=()=>{u.value.status="paid",r.value.current_page=1,d()})},{icon:c(()=>[s(e(m),{icon:"cil-check-circle"})]),_:1},8,["label","value"]),s(V,{label:e(t)("commissions.totalAmount")||"Total Amount",value:R(S.value.totalAmount),"badge-variant":"info",color:"gold"},{icon:c(()=>[s(e(m),{icon:"cil-money"})]),_:1},8,["label","value"])]),s(O,{title:e(t)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:c(()=>[s(e(le),{class:"g-3"},{default:c(()=>[s(e(b),{md:3},{default:c(()=>[s(e(K),{modelValue:u.value.status,"onUpdate:modelValue":a[3]||(a[3]=o=>u.value.status=o),label:e(t)("common.status"),onChange:d,class:"filter-select"},{default:c(()=>[n("option",Ce,i(e(t)("common.status")),1),n("option",ye,i(e(t)("commissions.pending")),1),n("option",ke,i(e(t)("commissions.approved")||"Approved"),1),n("option",Se,i(e(t)("commissions.paid")),1)]),_:1},8,["modelValue","label"])]),_:1}),s(e(b),{md:3},{default:c(()=>[s(e(K),{modelValue:u.value.staff_id,"onUpdate:modelValue":a[4]||(a[4]=o=>u.value.staff_id=o),label:e(t)("commissions.staff"),onChange:d,class:"filter-select"},{default:c(()=>[n("option",Ve,i(e(t)("commissions.staff")),1),(_(!0),h(L,null,N(z.value,o=>(_(),h("option",{key:o.id,value:String(o.id)},i(o.name),9,xe))),128))]),_:1},8,["modelValue","label"])]),_:1}),s(e(b),{md:3},{default:c(()=>[s(e(T),{modelValue:u.value.start_date,"onUpdate:modelValue":a[5]||(a[5]=o=>u.value.start_date=o),type:"date",label:e(t)("reports.fromDate"),onChange:d,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),s(e(b),{md:3},{default:c(()=>[s(e(T),{modelValue:u.value.end_date,"onUpdate:modelValue":a[6]||(a[6]=o=>u.value.end_date=o),type:"date",label:e(t)("reports.toDate"),onChange:d,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),s(e(b),{md:12},{default:c(()=>[s(e(ne),{class:"search-input-group"},{default:c(()=>[s(e(ie),{class:"search-icon-wrapper"},{default:c(()=>[s(e(m),{icon:"cil-magnifying-glass"})]),_:1}),s(e(T),{modelValue:u.value.search,"onUpdate:modelValue":a[7]||(a[7]=o=>u.value.search=o),placeholder:e(t)("commissions.searchStaff")||"Search staff...",onInput:Y,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),s(e(b),{md:3},{default:c(()=>[s(e(D),{color:"secondary",variant:"outline",onClick:X,class:"w-100 reset-btn"},{default:c(()=>[s(e(m),{icon:"cil-reload",class:"me-1"}),F(" "+i(e(t)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),s(O,{title:e(t)("commissions.title"),icon:"cil-list"},{footer:c(()=>[r.value.total_pages>1?(_(),h("div",He,[n("div",Xe,i(e(t)("common.view"))+" "+i((r.value.current_page-1)*r.value.per_page+1)+" "+i(e(t)("common.to"))+" "+i(Math.min(r.value.current_page*r.value.per_page,r.value.total))+" "+i(e(t)("common.of"))+" "+i(r.value.total),1),s(e(de),{pages:r.value.total_pages,"active-page":r.value.current_page,"onUpdate:activePage":H},null,8,["pages","active-page"])])):ue("",!0)]),default:c(()=>[x.value?(_(),P(fe,{key:0,text:e(t)("common.loading")},null,8,["text"])):p.value.length===0?(_(),P(ge,{key:1,title:e(t)("common.noData"),description:e(t)("commissions.title")+" - "+e(t)("common.noData"),"icon-color":"gray"},null,8,["title","description"])):(_(),h("div",we,[s(e(ce),{hover:"",responsive:"",class:"table-modern commissions-table"},{default:c(()=>[n("thead",null,[n("tr",Ae,[n("th",De,[s(e(W),{modelValue:C.value,"onUpdate:modelValue":a[8]||(a[8]=o=>C.value=o),onChange:J},null,8,["modelValue"])]),n("th",Fe,i(e(t)("commissions.staff")),1),n("th",Te,i(e(t)("commissions.baseAmount")||"Base Amount"),1),n("th",Ie,i(e(t)("commissions.percentage")),1),n("th",Be,i(e(t)("commissions.ratingBonus")||"Rating Bonus"),1),n("th",Ue,i(e(t)("commissions.amount")),1),n("th",Ee,i(e(t)("common.status")),1),n("th",Ke,i(e(t)("commissions.date")),1)])]),n("tbody",null,[(_(!0),h(L,null,N(p.value,o=>(_(),h("tr",{key:o.id,class:"table-row commission-row"},[n("td",Le,[s(e(W),{checked:v.value.includes(o.id),onChange:y=>Z(o.id)},null,8,["checked","onChange"])]),n("td",Ne,[n("strong",Pe,i(o.staff_name||"â€”"),1)]),n("td",We,[n("strong",Oe,i(A(o.base_amount||0)),1)]),n("td",$e,[s(e(I),{class:"unified-badge badge-rate"},{default:c(()=>[s(e(m),{icon:"cil-percent",class:"badge-icon"}),n("span",null,i(o.commission_rate||0)+"%",1)]),_:2},1024)]),n("td",Re,[s(e(I),{class:"unified-badge badge-bonus"},{default:c(()=>[s(e(m),{icon:"cil-star",class:"badge-icon"}),n("span",null,i(A(o.rating_bonus||0)),1)]),_:2},1024)]),n("td",je,[n("strong",Ge,i(A(o.final_amount||0)),1)]),n("td",Me,[s(e(I),{class:re(["unified-badge",te(o.status)])},{default:c(()=>[s(e(m),{icon:M(o.status),class:"badge-icon"},null,8,["icon"]),n("span",null,i(G(o.status)),1)]),_:2},1032,["class"])]),n("td",qe,[n("span",ze,i(j(o.created_at)),1)])]))),128))])]),_:1})]))]),_:1},8,["title"])]))}},mt=_e(Ye,[["__scopeId","data-v-20f0a854"]]);export{mt as default};
