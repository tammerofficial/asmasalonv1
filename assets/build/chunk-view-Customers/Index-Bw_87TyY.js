import{f as h,g as oe,i as ie,l as ne,h as ce,c as p,o as v,d as s,b as t,p as n,u as e,Z as A,x as y,P as d,C as c,t as l,_ as ue,$ as T,a2 as re,a3 as de,a1 as F,a0 as K,s as P,a4 as me,F as _e,k as ve,a as C,Y as U,n as pe,a6 as he,a7 as H,a8 as O,a9 as Q,aa as Y,ab as fe,ac as ge,a5 as be}from"../chunk-vendor-vue-9XB69CcG.js";import{u as ye,a as E}from"../chunk-component-NotificationsBell-Dr2jTnD2.js";import{P as Ce}from"../chunk-component-PageHeader-DOCn2Cgp.js";import{S as I}from"../chunk-component-StatCard-COK6V2Ia.js";import{_ as ke,C as Z}from"../chunk-component-Card-CPZTx4Dn.js";import{E as we}from"../chunk-component-EmptyState-EtsdDTwC.js";import{L as Ve}from"../chunk-component-LoadingSpinner-CoUPkIjP.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-BpPt1UDF.js";import"../chunk-vendor-axios-B9ygI19o.js";const xe={class:"customers-page"},$e={class:"stats-grid"},Fe={value:""},Se={value:"active"},De={value:"inactive"},Me={value:""},Te={value:"male"},Pe={value:"female"},Ue={key:2,class:"table-wrapper"},Ee={class:"table-header-row"},Ie={class:"th-name"},Ne={class:"th-phone"},Be={class:"th-email"},We={class:"th-visits"},Ke={class:"th-spending"},qe={class:"th-points"},ze={class:"th-status"},Le={class:"th-actions"},Ge={class:"td-id"},Re={class:"customer-id-badge"},je={class:"td-name"},Ae={class:"customer-name-cell"},He={class:"d-flex align-items-center gap-2"},Oe={class:"customer-name"},Qe={key:0,class:"customer-location"},Ye={class:"td-phone"},Ze=["href"],Je={class:"td-email"},Xe=["href"],et={key:1,class:"text-muted no-email"},tt={class:"td-visits"},st={class:"td-spending"},at={class:"spending-amount unified-amount"},lt={class:"td-points"},ot={class:"td-status"},it={class:"td-actions"},nt={class:"actions-group"},ct=["onClick","title"],ut=["onClick","title"],rt=["onClick","title"],dt={key:0,class:"d-flex justify-content-between align-items-center"},mt={class:"text-muted"},_t={class:"customer-details-view"},vt={class:"customer-header"},pt={class:"customer-avatar"},ht={class:"customer-header-info"},ft={class:"customer-name-large"},gt={class:"customer-stats-grid"},bt={class:"stat-item"},yt={class:"stat-content"},Ct={class:"stat-label"},kt={class:"stat-value"},wt={class:"stat-item"},Vt={class:"stat-content"},xt={class:"stat-label"},$t={class:"stat-value"},Ft={class:"stat-item"},St={class:"stat-content"},Dt={class:"stat-label"},Mt={class:"stat-value"},Tt={class:"customer-info-grid"},Pt={class:"info-row"},Ut={class:"info-label"},Et={class:"info-value"},It=["href"],Nt={key:0,class:"info-row"},Bt={class:"info-label"},Wt={class:"info-value"},Kt=["href"],qt={key:1,class:"info-row"},zt={class:"info-label"},Lt={class:"info-value"},Gt={key:2,class:"info-row"},Rt={class:"info-label"},jt={class:"info-value"},At={key:3,class:"info-row"},Ht={class:"info-label"},Ot={class:"info-value"},Qt={class:"info-row"},Yt={class:"info-label"},Zt={class:"info-value"},Jt={value:""},Xt={value:"male"},es={value:"female"},ts={__name:"Index",setup(ss){const{t:a}=ye(),q=ne(),z=ce(),f=h([]),N=h(!1),V=h(!1),S=h(!1),L=h(!1),r=h(null),D=h(null),x=oe(()=>{const u=f.value.length,o=f.value.filter(w=>w.is_active).length,i=f.value.reduce((w,$)=>w+($.total_visits||0),0),k=f.value.reduce((w,$)=>w+(parseFloat($.total_spent)||0),0),M=f.value.reduce((w,$)=>w+($.loyalty_points||0),0);return{total:u,active:o,totalVisits:i,totalSpending:k,totalPoints:M}}),g=h({search:"",status:"",gender:""}),_=h({current_page:1,per_page:20,total:0,total_pages:0}),m=h({name:"",phone:"",email:"",gender:"",city:"",notes:"",is_active:!0}),G=u=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(u),J=u=>{if(!u&&u!==0)return"0 KWD";const o=parseFloat(u);return o>=1e3?`${(o/1e3).toFixed(1)}K KWD`:`${o.toFixed(0)} KWD`},b=async()=>{var u;N.value=!0;try{const o={page:_.value.current_page,per_page:_.value.per_page,...g.value};Object.keys(o).forEach(M=>{o[M]===""&&delete o[M]});const i=await E.get("/customers",{params:o}),k=((u=i.data)==null?void 0:u.data)||i.data||{};f.value=k.items||[],_.value=k.pagination||_.value}catch(o){console.error("Error loading customers:",o)}finally{N.value=!1}},X=u=>{_.value.current_page=u,b()},ee=()=>{g.value={search:"",status:"",gender:""},_.value.current_page=1,b()};let R;const te=()=>{clearTimeout(R),R=setTimeout(()=>{_.value.current_page=1,b()},500)},B=()=>{V.value=!1,S.value=!1,D.value=null,m.value={name:"",phone:"",email:"",gender:"",city:"",notes:"",is_active:!0}},j=u=>{D.value=u,m.value={...u},S.value=!0},se=async()=>{try{D.value?await E.put(`/customers/${D.value.id}`,m.value):await E.post("/customers",m.value),B(),b()}catch(u){console.error("Error saving customer:",u),alert(a("customers.saveError"))}},ae=async u=>{if(confirm(`${a("customers.deleteConfirm")} ${u.name}?`))try{await E.delete(`/customers/${u.id}`),b()}catch(o){console.error("Error deleting customer:",o),alert(a("customers.deleteError"))}},le=u=>{z.push({name:"CustomerProfile",params:{id:String(u.id)}})},W=()=>{L.value=!1,r.value=null};return ie(()=>{var u;if(b(),((u=q.query)==null?void 0:u.action)==="create"){V.value=!0;const o={...q.query};delete o.action,z.replace({query:o})}}),(u,o)=>(v(),p("div",xe,[s(Ce,{title:e(a)("customers.title"),subtitle:e(a)("customers.title")+" - "+e(a)("dashboard.subtitle")},{icon:n(()=>[s(e(c),{icon:"cil-people"})]),actions:n(()=>[s(e(y),{color:"primary",class:"btn-primary-custom",onClick:o[0]||(o[0]=i=>V.value=!0)},{default:n(()=>[s(e(c),{icon:"cil-plus",class:"me-2"}),d(" "+l(e(a)("customers.addNew")),1)]),_:1})]),_:1},8,["title","subtitle"]),t("div",$e,[s(I,{label:e(a)("customers.title"),value:x.value.total||f.value.length,badge:x.value.active+" "+e(a)("status.active"),"badge-variant":"success",color:"gold",clickable:!0,onClick:o[1]||(o[1]=i=>{g.value.status="active",b()})},{icon:n(()=>[s(e(c),{icon:"cil-people"})]),_:1},8,["label","value","badge"]),s(I,{label:"Total Visits",value:x.value.totalVisits,"badge-variant":"info",color:"gold"},{icon:n(()=>[s(e(c),{icon:"cil-calendar-check"})]),_:1},8,["value"]),s(I,{label:"Total Spending",value:J(x.value.totalSpending),"badge-variant":"info",color:"gold"},{icon:n(()=>[s(e(c),{icon:"cil-money"})]),_:1},8,["value"]),s(I,{label:"Total Points",value:x.value.totalPoints,"badge-variant":"warning",color:"gold"},{icon:n(()=>[s(e(c),{icon:"cil-star"})]),_:1},8,["value"])]),s(Z,{title:e(a)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:n(()=>[s(e(ue),{class:"g-3"},{default:n(()=>[s(e(T),{md:4},{default:n(()=>[s(e(re),{class:"search-input-group"},{default:n(()=>[s(e(de),{class:"search-icon-wrapper"},{default:n(()=>[s(e(c),{icon:"cil-magnifying-glass"})]),_:1}),s(e(F),{modelValue:g.value.search,"onUpdate:modelValue":o[2]||(o[2]=i=>g.value.search=i),placeholder:e(a)("customers.searchPlaceholder"),onInput:te,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),s(e(T),{md:3},{default:n(()=>[s(e(K),{modelValue:g.value.status,"onUpdate:modelValue":o[3]||(o[3]=i=>g.value.status=i),onChange:b,class:"filter-select"},{default:n(()=>[t("option",Fe,l(e(a)("customers.allStatuses")),1),t("option",Se,l(e(a)("status.active")),1),t("option",De,l(e(a)("status.inactive")),1)]),_:1},8,["modelValue"])]),_:1}),s(e(T),{md:3},{default:n(()=>[s(e(K),{modelValue:g.value.gender,"onUpdate:modelValue":o[4]||(o[4]=i=>g.value.gender=i),onChange:b,class:"filter-select"},{default:n(()=>[t("option",Me,l(e(a)("customers.allGenders")),1),t("option",Te,l(e(a)("customers.male")),1),t("option",Pe,l(e(a)("customers.female")),1)]),_:1},8,["modelValue"])]),_:1}),s(e(T),{md:2},{default:n(()=>[s(e(y),{color:"secondary",variant:"outline",onClick:ee,class:"w-100 reset-btn"},{default:n(()=>[s(e(c),{icon:"cil-reload",class:"me-1"}),d(" "+l(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),s(Z,{title:e(a)("customers.title"),icon:"cil-list"},{footer:n(()=>[_.value.total_pages>1?(v(),p("div",dt,[t("div",mt,l(e(a)("common.view"))+" "+l((_.value.current_page-1)*_.value.per_page+1)+" "+l(e(a)("common.to")||"to")+" "+l(Math.min(_.value.current_page*_.value.per_page,_.value.total))+" "+l(e(a)("common.of")||"of")+" "+l(_.value.total),1),s(e(he),{pages:_.value.total_pages,"active-page":_.value.current_page,"onUpdate:activePage":X},null,8,["pages","active-page"])])):C("",!0)]),default:n(()=>[N.value?(v(),P(Ve,{key:0,text:e(a)("common.loading")},null,8,["text"])):f.value.length===0?(v(),P(we,{key:1,title:e(a)("common.noData"),description:e(a)("customers.title")+" - "+e(a)("common.noData"),"icon-color":"gray"},{action:n(()=>[s(e(y),{color:"primary",onClick:o[5]||(o[5]=i=>V.value=!0)},{default:n(()=>[d(l(e(a)("customers.addNew")),1)]),_:1})]),_:1},8,["title","description"])):(v(),p("div",Ue,[s(e(me),{hover:"",responsive:"",class:"table-modern customers-table"},{default:n(()=>[t("thead",null,[t("tr",Ee,[o[14]||(o[14]=t("th",{class:"th-id"},"#",-1)),t("th",Ie,l(e(a)("customers.name")),1),t("th",Ne,l(e(a)("customers.phone")),1),t("th",Be,l(e(a)("customers.email")),1),t("th",We,l(e(a)("customers.visits")),1),t("th",Ke,l(e(a)("customers.spending")),1),t("th",qe,l(e(a)("customers.points")),1),t("th",ze,l(e(a)("common.status")),1),t("th",Le,l(e(a)("common.actions")),1)])]),t("tbody",null,[(v(!0),p(_e,null,ve(f.value,i=>(v(),p("tr",{key:i.id,class:"table-row customer-row"},[t("td",Ge,[t("span",Re,"#"+l(i.id),1)]),t("td",je,[t("div",Ae,[t("div",He,[t("strong",Oe,l(i.name),1),i.wc_customer_id?(v(),P(e(y),{key:0,color:"success",size:"sm",variant:"outline",href:`/wp-admin/user-edit.php?user_id=${i.wc_customer_id}`,target:"_blank",title:"WooCommerce Customer ID: "+i.wc_customer_id,class:"wc-link-btn"},{default:n(()=>[s(e(c),{icon:"cil-cart",class:"me-1"}),o[15]||(o[15]=d(" WC ",-1))]),_:1},8,["href","title"])):C("",!0)]),i.city?(v(),p("small",Qe,[s(e(c),{icon:"cil-location-pin",class:"location-icon"}),d(" "+l(i.city),1)])):C("",!0)])]),t("td",Ye,[t("a",{href:`tel:${i.phone}`,class:"phone-link"},[s(e(c),{icon:"cil-phone",class:"phone-icon"}),t("span",null,l(i.phone),1)],8,Ze)]),t("td",Je,[i.email?(v(),p("a",{key:0,href:`mailto:${i.email}`,class:"email-link"},[s(e(c),{icon:"cil-envelope",class:"email-icon"}),t("span",null,l(i.email),1)],8,Xe)):(v(),p("span",et,"-"))]),t("td",tt,[s(e(U),{class:"unified-badge visits-badge"},{default:n(()=>[s(e(c),{icon:"cil-calendar-check",class:"badge-icon"}),t("span",null,l(i.total_visits||0),1)]),_:2},1024)]),t("td",st,[t("strong",at,[s(e(c),{icon:"cil-money",class:"money-icon"}),d(" "+l(G(i.total_spent||0)),1)])]),t("td",lt,[s(e(U),{class:"unified-badge points-badge"},{default:n(()=>[s(e(c),{icon:"cil-star",class:"badge-icon"}),t("span",null,l(i.loyalty_points||0),1)]),_:2},1024)]),t("td",ot,[s(e(U),{class:pe(["unified-badge status-badge",i.is_active?"status-active":"status-inactive"])},{default:n(()=>[s(e(c),{icon:i.is_active?"cil-check-circle":"cil-x-circle",class:"badge-icon"},null,8,["icon"]),t("span",null,l(i.is_active?e(a)("status.active"):e(a)("status.inactive")),1)]),_:2},1032,["class"])]),t("td",it,[t("div",nt,[t("button",{class:"action-btn",onClick:k=>le(i),title:e(a)("common.view")},[s(e(c),{icon:"cil-info"})],8,ct),t("button",{class:"action-btn",onClick:k=>j(i),title:e(a)("common.edit")},[s(e(c),{icon:"cil-pencil"})],8,ut),t("button",{class:"action-btn",onClick:k=>ae(i),title:e(a)("common.delete")},[s(e(c),{icon:"cil-trash"})],8,rt)])])]))),128))])]),_:1})]))]),_:1},8,["title"]),s(e(A),{visible:L.value,onClose:W,size:"lg"},{default:n(()=>[s(e(H),null,{default:n(()=>[s(e(O),null,{default:n(()=>[s(e(c),{icon:"cil-user",class:"me-2"}),d(" "+l(e(a)("customers.customerDetails")||"Customer Details"),1)]),_:1})]),_:1}),r.value?(v(),P(e(Q),{key:0},{default:n(()=>[t("div",_t,[t("div",vt,[t("div",pt,[s(e(c),{icon:"cil-user"})]),t("div",ht,[t("h4",ft,l(r.value.name),1),s(e(U),{color:r.value.is_active?"success":"secondary",class:"status-badge-large"},{default:n(()=>[s(e(c),{icon:r.value.is_active?"cil-check-circle":"cil-x-circle",class:"me-1"},null,8,["icon"]),d(" "+l(r.value.is_active?e(a)("status.active"):e(a)("status.inactive")),1)]),_:1},8,["color"])])]),t("div",gt,[t("div",bt,[s(e(c),{icon:"cil-calendar-check",class:"stat-icon"}),t("div",yt,[t("div",Ct,l(e(a)("customers.visits")),1),t("div",kt,l(r.value.total_visits||0),1)])]),t("div",wt,[s(e(c),{icon:"cil-money",class:"stat-icon"}),t("div",Vt,[t("div",xt,l(e(a)("customers.spending")),1),t("div",$t,l(G(r.value.total_spent||0)),1)])]),t("div",Ft,[s(e(c),{icon:"cil-star",class:"stat-icon"}),t("div",St,[t("div",Dt,l(e(a)("customers.points")),1),t("div",Mt,l(r.value.loyalty_points||0),1)])])]),t("div",Tt,[t("div",Pt,[t("div",Ut,[s(e(c),{icon:"cil-phone",class:"me-2"}),d(" "+l(e(a)("customers.phone")),1)]),t("div",Et,[t("a",{href:`tel:${r.value.phone}`,class:"info-link"},l(r.value.phone),9,It)])]),r.value.email?(v(),p("div",Nt,[t("div",Bt,[s(e(c),{icon:"cil-envelope",class:"me-2"}),d(" "+l(e(a)("customers.email")),1)]),t("div",Wt,[t("a",{href:`mailto:${r.value.email}`,class:"info-link"},l(r.value.email),9,Kt)])])):C("",!0),r.value.city?(v(),p("div",qt,[t("div",zt,[s(e(c),{icon:"cil-location-pin",class:"me-2"}),d(" "+l(e(a)("customers.city")),1)]),t("div",Lt,l(r.value.city),1)])):C("",!0),r.value.gender?(v(),p("div",Gt,[t("div",Rt,[s(e(c),{icon:"cil-user",class:"me-2"}),d(" "+l(e(a)("customers.gender")),1)]),t("div",jt,l(r.value.gender==="male"?e(a)("customers.male"):e(a)("customers.female")),1)])):C("",!0),r.value.notes?(v(),p("div",At,[t("div",Ht,[s(e(c),{icon:"cil-notes",class:"me-2"}),d(" "+l(e(a)("customers.notes")),1)]),t("div",Ot,l(r.value.notes),1)])):C("",!0),t("div",Qt,[t("div",Yt,[s(e(c),{icon:"cil-calendar",class:"me-2"}),d(" "+l(e(a)("common.createdAt")||"Created At"),1)]),t("div",Zt,l(r.value.created_at?new Date(r.value.created_at).toLocaleDateString():"-"),1)])])])]),_:1})):C("",!0),s(e(Y),null,{default:n(()=>[s(e(y),{color:"secondary",onClick:W},{default:n(()=>[d(l(e(a)("common.close")||"Close"),1)]),_:1}),s(e(y),{color:"primary",onClick:o[6]||(o[6]=()=>{W(),j(r.value)})},{default:n(()=>[s(e(c),{icon:"cil-pencil",class:"me-2"}),d(" "+l(e(a)("common.edit")),1)]),_:1})]),_:1})]),_:1},8,["visible"]),s(e(A),{visible:V.value||S.value,onClose:B,size:"lg"},{default:n(()=>[s(e(H),null,{default:n(()=>[s(e(O),null,{default:n(()=>[d(l(S.value?e(a)("customers.edit"):e(a)("customers.addNew")),1)]),_:1})]),_:1}),s(e(Q),null,{default:n(()=>[s(e(fe),null,{default:n(()=>[s(e(F),{modelValue:m.value.name,"onUpdate:modelValue":o[7]||(o[7]=i=>m.value.name=i),label:e(a)("customers.name"),required:""},null,8,["modelValue","label"]),s(e(F),{modelValue:m.value.phone,"onUpdate:modelValue":o[8]||(o[8]=i=>m.value.phone=i),label:e(a)("customers.phone"),required:""},null,8,["modelValue","label"]),s(e(F),{modelValue:m.value.email,"onUpdate:modelValue":o[9]||(o[9]=i=>m.value.email=i),type:"email",label:e(a)("customers.email")},null,8,["modelValue","label"]),s(e(K),{modelValue:m.value.gender,"onUpdate:modelValue":o[10]||(o[10]=i=>m.value.gender=i),label:e(a)("customers.gender")},{default:n(()=>[t("option",Jt,l(e(a)("common.select")||"Select..."),1),t("option",Xt,l(e(a)("customers.male")),1),t("option",es,l(e(a)("customers.female")),1)]),_:1},8,["modelValue","label"]),s(e(F),{modelValue:m.value.city,"onUpdate:modelValue":o[11]||(o[11]=i=>m.value.city=i),label:e(a)("customers.city")},null,8,["modelValue","label"]),s(e(ge),{modelValue:m.value.notes,"onUpdate:modelValue":o[12]||(o[12]=i=>m.value.notes=i),label:e(a)("customers.notes"),rows:"3"},null,8,["modelValue","label"]),s(e(be),{modelValue:m.value.is_active,"onUpdate:modelValue":o[13]||(o[13]=i=>m.value.is_active=i),label:e(a)("status.active")},null,8,["modelValue","label"])]),_:1})]),_:1}),s(e(Y),null,{default:n(()=>[s(e(y),{color:"secondary",onClick:B},{default:n(()=>[d(l(e(a)("common.cancel")),1)]),_:1}),s(e(y),{color:"primary",onClick:se},{default:n(()=>[d(l(e(a)("common.save")),1)]),_:1})]),_:1})]),_:1},8,["visible"])]))}},vs=ke(ts,[["__scopeId","data-v-84904f02"]]);export{vs as default};
