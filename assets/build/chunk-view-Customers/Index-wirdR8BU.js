import{f as h,g as oe,i as ie,l as ne,h as ce,c as p,o as _,d as s,b as t,p as n,u as e,a5 as A,v as k,O as m,C as c,t as l,Y as ue,Z as T,a0 as de,a1 as re,$ as F,_ as q,q as K,a2 as me,F as ve,k as _e,a as V,X as U,n as pe,a4 as he,a6 as H,a7 as O,a8 as Q,a9 as X,aa as fe,ab as ge,a3 as be}from"../chunk-vendor-vue-DxcSX1Jd.js";import{u as ye,a as E}from"../chunk-component-NotificationsBell-eCwis6PW.js";import{P as Ce}from"../chunk-component-PageHeader-BsA6C9en.js";import{S as P}from"../chunk-component-StatCard-AHk13FwB.js";import{_ as ke,C as Y}from"../chunk-component-Card-BWbCGpFM.js";import{E as Ve}from"../chunk-component-EmptyState-B78c8qVh.js";import{L as we}from"../chunk-component-LoadingSpinner-PYO1Yq7-.js";import"../chunk-vendor-BwxB3d-x.js";import"../chunk-vendor-charts-CNHMDSF7.js";import"../chunk-vendor-pinia-DRDRCEXO.js";import"../chunk-vendor-axios-B9ygI19o.js";const xe={class:"customers-page"},$e={class:"stats-grid"},Fe={value:""},Se={value:"active"},De={value:"inactive"},Me={value:""},Te={value:"male"},Ue={value:"female"},Ee={key:2,class:"table-wrapper"},Pe={class:"table-header-row"},Ie={class:"th-name"},Ne={class:"th-phone"},Be={class:"th-email"},qe={class:"th-visits"},Ke={class:"th-spending"},We={class:"th-points"},Le={class:"th-status"},ze={class:"th-actions"},Ge={class:"td-id"},Re={class:"customer-id-badge"},je={class:"td-name"},Ae={class:"customer-name-cell"},He={class:"customer-name"},Oe={key:0,class:"customer-location"},Qe={class:"td-phone"},Xe=["href"],Ye={class:"td-email"},Ze=["href"],Je={key:1,class:"text-muted no-email"},et={class:"td-visits"},tt={class:"td-spending"},st={class:"spending-amount unified-amount"},at={class:"td-points"},lt={class:"td-status"},ot={class:"td-actions"},it={class:"actions-group"},nt=["onClick","title"],ct=["onClick","title"],ut=["onClick","title"],dt={key:0,class:"d-flex justify-content-between align-items-center"},rt={class:"text-muted"},mt={class:"customer-details-view"},vt={class:"customer-header"},_t={class:"customer-avatar"},pt={class:"customer-header-info"},ht={class:"customer-name-large"},ft={class:"customer-stats-grid"},gt={class:"stat-item"},bt={class:"stat-content"},yt={class:"stat-label"},Ct={class:"stat-value"},kt={class:"stat-item"},Vt={class:"stat-content"},wt={class:"stat-label"},xt={class:"stat-value"},$t={class:"stat-item"},Ft={class:"stat-content"},St={class:"stat-label"},Dt={class:"stat-value"},Mt={class:"customer-info-grid"},Tt={class:"info-row"},Ut={class:"info-label"},Et={class:"info-value"},Pt=["href"],It={key:0,class:"info-row"},Nt={class:"info-label"},Bt={class:"info-value"},qt=["href"],Kt={key:1,class:"info-row"},Wt={class:"info-label"},Lt={class:"info-value"},zt={key:2,class:"info-row"},Gt={class:"info-label"},Rt={class:"info-value"},jt={key:3,class:"info-row"},At={class:"info-label"},Ht={class:"info-value"},Ot={class:"info-row"},Qt={class:"info-label"},Xt={class:"info-value"},Yt={value:""},Zt={value:"male"},Jt={value:"female"},es={__name:"Index",setup(ts){const{t:a}=ye(),W=ne(),L=ce(),f=h([]),I=h(!1),w=h(!1),S=h(!1),z=h(!1),d=h(null),D=h(null),x=oe(()=>{const u=f.value.length,o=f.value.filter(C=>C.is_active).length,i=f.value.reduce((C,$)=>C+($.total_visits||0),0),y=f.value.reduce((C,$)=>C+(parseFloat($.total_spent)||0),0),M=f.value.reduce((C,$)=>C+($.loyalty_points||0),0);return{total:u,active:o,totalVisits:i,totalSpending:y,totalPoints:M}}),g=h({search:"",status:"",gender:""}),v=h({current_page:1,per_page:20,total:0,total_pages:0}),r=h({name:"",phone:"",email:"",gender:"",city:"",notes:"",is_active:!0}),G=u=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(u),Z=u=>{if(!u&&u!==0)return"0 KWD";const o=parseFloat(u);return o>=1e3?`${(o/1e3).toFixed(1)}K KWD`:`${o.toFixed(0)} KWD`},b=async()=>{var u;I.value=!0;try{const o={page:v.value.current_page,per_page:v.value.per_page,...g.value};Object.keys(o).forEach(M=>{o[M]===""&&delete o[M]});const i=await E.get("/customers",{params:o}),y=((u=i.data)==null?void 0:u.data)||i.data||{};f.value=y.items||[],v.value=y.pagination||v.value}catch(o){console.error("Error loading customers:",o)}finally{I.value=!1}},J=u=>{v.value.current_page=u,b()},ee=()=>{g.value={search:"",status:"",gender:""},v.value.current_page=1,b()};let R;const te=()=>{clearTimeout(R),R=setTimeout(()=>{v.value.current_page=1,b()},500)},N=()=>{w.value=!1,S.value=!1,D.value=null,r.value={name:"",phone:"",email:"",gender:"",city:"",notes:"",is_active:!0}},j=u=>{D.value=u,r.value={...u},S.value=!0},se=async()=>{try{D.value?await E.put(`/customers/${D.value.id}`,r.value):await E.post("/customers",r.value),N(),b()}catch(u){console.error("Error saving customer:",u),alert(a("customers.saveError"))}},ae=async u=>{if(confirm(`${a("customers.deleteConfirm")} ${u.name}?`))try{await E.delete(`/customers/${u.id}`),b()}catch(o){console.error("Error deleting customer:",o),alert(a("customers.deleteError"))}},le=u=>{L.push({name:"CustomerProfile",params:{id:String(u.id)}})},B=()=>{z.value=!1,d.value=null};return ie(()=>{var u;if(b(),((u=W.query)==null?void 0:u.action)==="create"){w.value=!0;const o={...W.query};delete o.action,L.replace({query:o})}}),(u,o)=>(_(),p("div",xe,[s(Ce,{title:e(a)("customers.title"),subtitle:e(a)("customers.title")+" - "+e(a)("dashboard.subtitle")},{icon:n(()=>[s(e(c),{icon:"cil-people"})]),actions:n(()=>[s(e(k),{color:"primary",class:"btn-primary-custom",onClick:o[0]||(o[0]=i=>w.value=!0)},{default:n(()=>[s(e(c),{icon:"cil-plus",class:"me-2"}),m(" "+l(e(a)("customers.addNew")),1)]),_:1})]),_:1},8,["title","subtitle"]),t("div",$e,[s(P,{label:e(a)("customers.title"),value:x.value.total||f.value.length,badge:x.value.active+" "+e(a)("status.active"),"badge-variant":"success",color:"gold",clickable:!0,onClick:o[1]||(o[1]=i=>{g.value.status="active",b()})},{icon:n(()=>[s(e(c),{icon:"cil-people"})]),_:1},8,["label","value","badge"]),s(P,{label:"Total Visits",value:x.value.totalVisits,"badge-variant":"info",color:"gold"},{icon:n(()=>[s(e(c),{icon:"cil-calendar-check"})]),_:1},8,["value"]),s(P,{label:"Total Spending",value:Z(x.value.totalSpending),"badge-variant":"info",color:"gold"},{icon:n(()=>[s(e(c),{icon:"cil-money"})]),_:1},8,["value"]),s(P,{label:"Total Points",value:x.value.totalPoints,"badge-variant":"warning",color:"gold"},{icon:n(()=>[s(e(c),{icon:"cil-star"})]),_:1},8,["value"])]),s(Y,{title:e(a)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:n(()=>[s(e(ue),{class:"g-3"},{default:n(()=>[s(e(T),{md:4},{default:n(()=>[s(e(de),{class:"search-input-group"},{default:n(()=>[s(e(re),{class:"search-icon-wrapper"},{default:n(()=>[s(e(c),{icon:"cil-magnifying-glass"})]),_:1}),s(e(F),{modelValue:g.value.search,"onUpdate:modelValue":o[2]||(o[2]=i=>g.value.search=i),placeholder:e(a)("customers.searchPlaceholder"),onInput:te,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),s(e(T),{md:3},{default:n(()=>[s(e(q),{modelValue:g.value.status,"onUpdate:modelValue":o[3]||(o[3]=i=>g.value.status=i),onChange:b,class:"filter-select"},{default:n(()=>[t("option",Fe,l(e(a)("customers.allStatuses")),1),t("option",Se,l(e(a)("status.active")),1),t("option",De,l(e(a)("status.inactive")),1)]),_:1},8,["modelValue"])]),_:1}),s(e(T),{md:3},{default:n(()=>[s(e(q),{modelValue:g.value.gender,"onUpdate:modelValue":o[4]||(o[4]=i=>g.value.gender=i),onChange:b,class:"filter-select"},{default:n(()=>[t("option",Me,l(e(a)("customers.allGenders")),1),t("option",Te,l(e(a)("customers.male")),1),t("option",Ue,l(e(a)("customers.female")),1)]),_:1},8,["modelValue"])]),_:1}),s(e(T),{md:2},{default:n(()=>[s(e(k),{color:"secondary",variant:"outline",onClick:ee,class:"w-100 reset-btn"},{default:n(()=>[s(e(c),{icon:"cil-reload",class:"me-1"}),m(" "+l(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),s(Y,{title:e(a)("customers.title"),icon:"cil-list"},{footer:n(()=>[v.value.total_pages>1?(_(),p("div",dt,[t("div",rt,l(e(a)("common.view"))+" "+l((v.value.current_page-1)*v.value.per_page+1)+" "+l(e(a)("common.to")||"to")+" "+l(Math.min(v.value.current_page*v.value.per_page,v.value.total))+" "+l(e(a)("common.of")||"of")+" "+l(v.value.total),1),s(e(he),{pages:v.value.total_pages,"active-page":v.value.current_page,"onUpdate:activePage":J},null,8,["pages","active-page"])])):V("",!0)]),default:n(()=>[I.value?(_(),K(we,{key:0,text:e(a)("common.loading")},null,8,["text"])):f.value.length===0?(_(),K(Ve,{key:1,title:e(a)("common.noData"),description:e(a)("customers.title")+" - "+e(a)("common.noData"),"icon-color":"gray"},{action:n(()=>[s(e(k),{color:"primary",onClick:o[5]||(o[5]=i=>w.value=!0)},{default:n(()=>[m(l(e(a)("customers.addNew")),1)]),_:1})]),_:1},8,["title","description"])):(_(),p("div",Ee,[s(e(me),{hover:"",responsive:"",class:"table-modern customers-table"},{default:n(()=>[t("thead",null,[t("tr",Pe,[o[14]||(o[14]=t("th",{class:"th-id"},"#",-1)),t("th",Ie,l(e(a)("customers.name")),1),t("th",Ne,l(e(a)("customers.phone")),1),t("th",Be,l(e(a)("customers.email")),1),t("th",qe,l(e(a)("customers.visits")),1),t("th",Ke,l(e(a)("customers.spending")),1),t("th",We,l(e(a)("customers.points")),1),t("th",Le,l(e(a)("common.status")),1),t("th",ze,l(e(a)("common.actions")),1)])]),t("tbody",null,[(_(!0),p(ve,null,_e(f.value,i=>(_(),p("tr",{key:i.id,class:"table-row customer-row"},[t("td",Ge,[t("span",Re,"#"+l(i.id),1)]),t("td",je,[t("div",Ae,[t("strong",He,l(i.name),1),i.city?(_(),p("small",Oe,[s(e(c),{icon:"cil-location-pin",class:"location-icon"}),m(" "+l(i.city),1)])):V("",!0)])]),t("td",Qe,[t("a",{href:`tel:${i.phone}`,class:"phone-link"},[s(e(c),{icon:"cil-phone",class:"phone-icon"}),t("span",null,l(i.phone),1)],8,Xe)]),t("td",Ye,[i.email?(_(),p("a",{key:0,href:`mailto:${i.email}`,class:"email-link"},[s(e(c),{icon:"cil-envelope",class:"email-icon"}),t("span",null,l(i.email),1)],8,Ze)):(_(),p("span",Je,"-"))]),t("td",et,[s(e(U),{class:"unified-badge visits-badge"},{default:n(()=>[s(e(c),{icon:"cil-calendar-check",class:"badge-icon"}),t("span",null,l(i.total_visits||0),1)]),_:2},1024)]),t("td",tt,[t("strong",st,[s(e(c),{icon:"cil-money",class:"money-icon"}),m(" "+l(G(i.total_spent||0)),1)])]),t("td",at,[s(e(U),{class:"unified-badge points-badge"},{default:n(()=>[s(e(c),{icon:"cil-star",class:"badge-icon"}),t("span",null,l(i.loyalty_points||0),1)]),_:2},1024)]),t("td",lt,[s(e(U),{class:pe(["unified-badge status-badge",i.is_active?"status-active":"status-inactive"])},{default:n(()=>[s(e(c),{icon:i.is_active?"cil-check-circle":"cil-x-circle",class:"badge-icon"},null,8,["icon"]),t("span",null,l(i.is_active?e(a)("status.active"):e(a)("status.inactive")),1)]),_:2},1032,["class"])]),t("td",ot,[t("div",it,[t("button",{class:"action-btn",onClick:y=>le(i),title:e(a)("common.view")},[s(e(c),{icon:"cil-info"})],8,nt),t("button",{class:"action-btn",onClick:y=>j(i),title:e(a)("common.edit")},[s(e(c),{icon:"cil-pencil"})],8,ct),t("button",{class:"action-btn",onClick:y=>ae(i),title:e(a)("common.delete")},[s(e(c),{icon:"cil-trash"})],8,ut)])])]))),128))])]),_:1})]))]),_:1},8,["title"]),s(e(A),{visible:z.value,onClose:B,size:"lg"},{default:n(()=>[s(e(H),null,{default:n(()=>[s(e(O),null,{default:n(()=>[s(e(c),{icon:"cil-user",class:"me-2"}),m(" "+l(e(a)("customers.customerDetails")||"Customer Details"),1)]),_:1})]),_:1}),d.value?(_(),K(e(Q),{key:0},{default:n(()=>[t("div",mt,[t("div",vt,[t("div",_t,[s(e(c),{icon:"cil-user"})]),t("div",pt,[t("h4",ht,l(d.value.name),1),s(e(U),{color:d.value.is_active?"success":"secondary",class:"status-badge-large"},{default:n(()=>[s(e(c),{icon:d.value.is_active?"cil-check-circle":"cil-x-circle",class:"me-1"},null,8,["icon"]),m(" "+l(d.value.is_active?e(a)("status.active"):e(a)("status.inactive")),1)]),_:1},8,["color"])])]),t("div",ft,[t("div",gt,[s(e(c),{icon:"cil-calendar-check",class:"stat-icon"}),t("div",bt,[t("div",yt,l(e(a)("customers.visits")),1),t("div",Ct,l(d.value.total_visits||0),1)])]),t("div",kt,[s(e(c),{icon:"cil-money",class:"stat-icon"}),t("div",Vt,[t("div",wt,l(e(a)("customers.spending")),1),t("div",xt,l(G(d.value.total_spent||0)),1)])]),t("div",$t,[s(e(c),{icon:"cil-star",class:"stat-icon"}),t("div",Ft,[t("div",St,l(e(a)("customers.points")),1),t("div",Dt,l(d.value.loyalty_points||0),1)])])]),t("div",Mt,[t("div",Tt,[t("div",Ut,[s(e(c),{icon:"cil-phone",class:"me-2"}),m(" "+l(e(a)("customers.phone")),1)]),t("div",Et,[t("a",{href:`tel:${d.value.phone}`,class:"info-link"},l(d.value.phone),9,Pt)])]),d.value.email?(_(),p("div",It,[t("div",Nt,[s(e(c),{icon:"cil-envelope",class:"me-2"}),m(" "+l(e(a)("customers.email")),1)]),t("div",Bt,[t("a",{href:`mailto:${d.value.email}`,class:"info-link"},l(d.value.email),9,qt)])])):V("",!0),d.value.city?(_(),p("div",Kt,[t("div",Wt,[s(e(c),{icon:"cil-location-pin",class:"me-2"}),m(" "+l(e(a)("customers.city")),1)]),t("div",Lt,l(d.value.city),1)])):V("",!0),d.value.gender?(_(),p("div",zt,[t("div",Gt,[s(e(c),{icon:"cil-user",class:"me-2"}),m(" "+l(e(a)("customers.gender")),1)]),t("div",Rt,l(d.value.gender==="male"?e(a)("customers.male"):e(a)("customers.female")),1)])):V("",!0),d.value.notes?(_(),p("div",jt,[t("div",At,[s(e(c),{icon:"cil-notes",class:"me-2"}),m(" "+l(e(a)("customers.notes")),1)]),t("div",Ht,l(d.value.notes),1)])):V("",!0),t("div",Ot,[t("div",Qt,[s(e(c),{icon:"cil-calendar",class:"me-2"}),m(" "+l(e(a)("common.createdAt")||"Created At"),1)]),t("div",Xt,l(d.value.created_at?new Date(d.value.created_at).toLocaleDateString():"-"),1)])])])]),_:1})):V("",!0),s(e(X),null,{default:n(()=>[s(e(k),{color:"secondary",onClick:B},{default:n(()=>[m(l(e(a)("common.close")||"Close"),1)]),_:1}),s(e(k),{color:"primary",onClick:o[6]||(o[6]=()=>{B(),j(d.value)})},{default:n(()=>[s(e(c),{icon:"cil-pencil",class:"me-2"}),m(" "+l(e(a)("common.edit")),1)]),_:1})]),_:1})]),_:1},8,["visible"]),s(e(A),{visible:w.value||S.value,onClose:N,size:"lg"},{default:n(()=>[s(e(H),null,{default:n(()=>[s(e(O),null,{default:n(()=>[m(l(S.value?e(a)("customers.edit"):e(a)("customers.addNew")),1)]),_:1})]),_:1}),s(e(Q),null,{default:n(()=>[s(e(fe),null,{default:n(()=>[s(e(F),{modelValue:r.value.name,"onUpdate:modelValue":o[7]||(o[7]=i=>r.value.name=i),label:e(a)("customers.name"),required:""},null,8,["modelValue","label"]),s(e(F),{modelValue:r.value.phone,"onUpdate:modelValue":o[8]||(o[8]=i=>r.value.phone=i),label:e(a)("customers.phone"),required:""},null,8,["modelValue","label"]),s(e(F),{modelValue:r.value.email,"onUpdate:modelValue":o[9]||(o[9]=i=>r.value.email=i),type:"email",label:e(a)("customers.email")},null,8,["modelValue","label"]),s(e(q),{modelValue:r.value.gender,"onUpdate:modelValue":o[10]||(o[10]=i=>r.value.gender=i),label:e(a)("customers.gender")},{default:n(()=>[t("option",Yt,l(e(a)("common.select")||"Select..."),1),t("option",Zt,l(e(a)("customers.male")),1),t("option",Jt,l(e(a)("customers.female")),1)]),_:1},8,["modelValue","label"]),s(e(F),{modelValue:r.value.city,"onUpdate:modelValue":o[11]||(o[11]=i=>r.value.city=i),label:e(a)("customers.city")},null,8,["modelValue","label"]),s(e(ge),{modelValue:r.value.notes,"onUpdate:modelValue":o[12]||(o[12]=i=>r.value.notes=i),label:e(a)("customers.notes"),rows:"3"},null,8,["modelValue","label"]),s(e(be),{modelValue:r.value.is_active,"onUpdate:modelValue":o[13]||(o[13]=i=>r.value.is_active=i),label:e(a)("status.active")},null,8,["modelValue","label"])]),_:1})]),_:1}),s(e(X),null,{default:n(()=>[s(e(k),{color:"secondary",onClick:N},{default:n(()=>[m(l(e(a)("common.cancel")),1)]),_:1}),s(e(k),{color:"primary",onClick:se},{default:n(()=>[m(l(e(a)("common.save")),1)]),_:1})]),_:1})]),_:1},8,["visible"])]))}},vs=ke(es,[["__scopeId","data-v-cfd3d37b"]]);export{vs as default};
