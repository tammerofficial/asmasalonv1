import{f,g as we,i as ke,c as u,o as c,d as a,s as P,p as o,u as e,F as z,b as t,Z as ae,l as Ce,h as Me,x as g,P as h,C as m,t as l,a as w,Y as V,e as te,a4 as le,k as Y,n as oe,a7 as re,a8 as ne,a9 as ie,_ as ce,$ as S,a0 as Pe,a1 as Z,a5 as Te,aa as de}from"../chunk-vendor-vue-CVODRAc9.js";import{u as Ve,a as x}from"../chunk-component-NotificationsBell-DXvfEbaA.js";import{a as xe}from"../chunk-view-Bookings/BookingAppearance-h1g7uA93.js";import{P as Ae}from"../chunk-component-PageHeader-DIMefZ9l.js";import{S as W}from"../chunk-component-StatCard-CUh-yMQt.js";import{_ as Ne,C as $}from"../chunk-component-Card-DAbGoLxt.js";import{L as De}from"../chunk-component-LoadingSpinner-DYzABkFM.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-DSPKUyr1.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-BCBXCjN-.js";import"../chunk-view-Bookings/BookingFormPreview-CRxQyI9V.js";const Re={class:"customer-profile-page"},Fe={class:"stats-grid"},Le={class:"details-grid"},Se={class:"detail-row"},$e={class:"detail-label"},Be={class:"detail-value"},Ee=["href"],ze={key:1},We={key:0,class:"detail-row"},Ie={class:"detail-label"},Ke={class:"detail-value"},Ue=["href"],qe={key:1,class:"detail-row"},He={class:"detail-label"},Qe={class:"detail-value"},Ye={key:2,class:"detail-row"},Ze={class:"detail-label"},je={class:"detail-value"},Ge={key:3,class:"detail-row"},Je={class:"detail-label"},Oe={class:"detail-value"},Xe={key:4,class:"detail-row"},es={class:"detail-label"},ss={class:"detail-value"},as={key:5,class:"detail-row"},ts={class:"detail-label"},ls={class:"detail-value"},os={class:"membership-header"},rs={class:"membership-summary"},ns={class:"membership-title"},is={key:0,class:"membership-sub"},cs={class:"text-muted"},ds={class:"text-muted"},us={class:"membership-actions"},ms={key:0,class:"membership-badges"},_s={class:"wallet-passes-grid"},ps={class:"wallet-pass-item"},vs={class:"pass-info"},hs={key:0,class:"wallet-pass-item"},ys={class:"pass-info"},bs={class:"today-header"},fs={class:"today-date"},gs={class:"today-meta"},ws={key:0,class:"text-muted"},ks={key:1,class:"table-wrapper"},Cs={class:"table-header-row"},Ms={class:"text-center"},Ps={class:"text-end"},Ts={class:"text-center"},Vs={class:"text-end"},xs={class:"unified-amount"},As={key:0,class:"text-muted"},Ns={key:1,class:"table-wrapper"},Ds={class:"table-header-row"},Rs={class:"text-center"},Fs={class:"text-center"},Ls={value:""},Ss=["value"],$s={__name:"Profile",setup(Bs){const{t:s}=Ve(),y=xe(),ue=Ce(),me=Me(),I=f(!1),n=f({customer:null,today:{orders:[],items:[],total_amount:0,points_earned:0},membership:{current:null,history:[]},loyalty:{today_transactions:[]}}),B=f([]),K=f(!1),A=f(!1),U=f(!1),N=f(!1),T=f(!1),E=f(""),b=f({membership_plan_id:"",duration_months:1,auto_renew:!1}),C=f({months:1,amount_paid:0}),p=we(()=>{var d,r;return((r=(d=n.value)==null?void 0:d.membership)==null?void 0:r.current)||null}),j=async()=>{var d;try{const r=await x.get("/memberships/plans",{noCache:!0});B.value=((d=r.data)==null?void 0:d.data)||[]}catch{B.value=[]}},_e=d=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(d||0),G=d=>{const r=Number(d||0);return r>=1e3?`${(r/1e3).toFixed(1)}K KWD`:`${r.toFixed(0)} KWD`},q=d=>{if(!d)return"—";try{return new Date(d).toLocaleString()}catch{return String(d)}},D=async()=>{var d;I.value=!0;try{const r=ue.params.id,k=await x.get(`/customers/${r}/profile`,{noCache:!0});n.value=((d=k.data)==null?void 0:d.data)||k.data||n.value}catch(r){console.error("Load customer profile error:",r),y.error(s("common.errorLoading"))}finally{I.value=!1}},pe=()=>D(),ve=()=>me.push("/customers"),he=async()=>{K.value=!0,b.value={membership_plan_id:"",duration_months:1,auto_renew:!1},B.value.length===0&&await j()},H=()=>{K.value=!1,A.value=!1},ye=async()=>{var d,r;if(!((r=(d=n.value)==null?void 0:d.customer)!=null&&r.id)||!b.value.membership_plan_id){y.error(s("memberships.selectPlan")||"Select plan");return}A.value=!0;try{await x.post("/memberships",{customer_id:Number(n.value.customer.id),membership_plan_id:Number(b.value.membership_plan_id),duration_months:Number(b.value.duration_months||1),auto_renew:b.value.auto_renew?1:0}),y.success(s("memberships.assigned")||"Assigned"),H(),await D()}catch(k){console.error("Assign membership error:",k),y.error(s("memberships.assignError")||s("common.errorLoading"))}finally{A.value=!1}},be=()=>{U.value=!0,C.value={months:1,amount_paid:0}},Q=()=>{U.value=!1,N.value=!1},fe=async()=>{var d;if((d=p.value)!=null&&d.id){N.value=!0;try{await x.post(`/memberships/${p.value.id}/renew`,{months:Number(C.value.months||1),amount_paid:Number(C.value.amount_paid||0)}),y.success(s("memberships.renewed")||"Renewed"),Q(),await D()}catch(r){console.error("Renew membership error:",r),y.error(s("memberships.renewError")||s("common.errorLoading"))}finally{N.value=!1}}},ge=async()=>{var d;if((d=p.value)!=null&&d.id&&confirm(s("memberships.cancelConfirm")||"Cancel membership?"))try{await x.delete(`/memberships/${p.value.id}`),y.success(s("memberships.cancelled")||"Cancelled"),await D()}catch{y.error(s("common.errorLoading"))}},J=async d=>{var r,k,R,F,L;if((k=(r=n.value)==null?void 0:r.customer)!=null&&k.id){T.value=!0,E.value=d;try{const M=n.value.customer.id,i=await x.post(`/apple-wallet/create/${M}/${d}`),_=((R=i.data)==null?void 0:R.data)||i.data||{};_.pass_url?(window.open(_.pass_url,"_blank"),y.success(s("loyalty.passCreated")||"Pass created successfully")):y.error(s("loyalty.passError")||"Error creating pass")}catch(M){console.error("Error creating Apple Wallet pass:",M),y.error(((L=(F=M.response)==null?void 0:F.data)==null?void 0:L.message)||s("loyalty.passError")||"Error creating pass")}finally{T.value=!1,E.value=""}}};return ke(()=>{D(),j()}),(d,r)=>{var k,R,F,L,M;return c(),u("div",Re,[a(Ae,{title:((k=n.value.customer)==null?void 0:k.name)||e(s)("customers.title"),subtitle:e(s)("customers.profileSubtitle")||e(s)("customers.title")},{icon:o(()=>[a(e(m),{icon:"cil-user"})]),actions:o(()=>[a(e(g),{color:"secondary",variant:"outline",class:"me-2",onClick:ve},{default:o(()=>[a(e(m),{icon:"cil-arrow-left",class:"me-2"}),h(" "+l(e(s)("common.back")||"Back"),1)]),_:1}),a(e(g),{color:"primary",class:"btn-primary-custom",onClick:pe},{default:o(()=>[a(e(m),{icon:"cil-reload",class:"me-2"}),h(" "+l(e(s)("common.refresh")||"Refresh"),1)]),_:1})]),_:1},8,["title","subtitle"]),I.value?(c(),P(De,{key:0,text:e(s)("common.loading")},null,8,["text"])):(c(),u(z,{key:1},[t("div",Fe,[a(W,{label:e(s)("customers.points"),value:((R=n.value.customer)==null?void 0:R.loyalty_points)||0,"badge-variant":"info",color:"gold"},{icon:o(()=>[a(e(m),{icon:"cil-star"})]),_:1},8,["label","value"]),a(W,{label:e(s)("customers.spending"),value:G(((F=n.value.customer)==null?void 0:F.total_spent)||0),"badge-variant":"info",color:"gold"},{icon:o(()=>[a(e(m),{icon:"cil-money"})]),_:1},8,["label","value"]),a(W,{label:e(s)("customers.todaysPurchases")||"Today Purchases",value:G(((L=n.value.today)==null?void 0:L.total_amount)||0),"badge-variant":"success",color:"gold"},{icon:o(()=>[a(e(m),{icon:"cil-cart"})]),_:1},8,["label","value"]),a(W,{label:e(s)("customers.todaysPoints")||"Today Points",value:((M=n.value.today)==null?void 0:M.points_earned)||0,"badge-variant":"warning",color:"gold"},{icon:o(()=>[a(e(m),{icon:"cil-gift"})]),_:1},8,["label","value"])]),a($,{title:e(s)("customers.customerDetails")||"Customer Details",icon:"cil-user",class:"section-card"},{default:o(()=>{var i,_,v,O,X,ee,se;return[t("div",Le,[t("div",Se,[t("div",$e,l(e(s)("customers.phone")),1),t("div",Be,[(i=n.value.customer)!=null&&i.phone?(c(),u("a",{key:0,href:`tel:${n.value.customer.phone}`,class:"detail-link"},l(n.value.customer.phone),9,Ee)):(c(),u("span",ze,"—"))])]),(_=n.value.customer)!=null&&_.email?(c(),u("div",We,[t("div",Ie,l(e(s)("customers.email")),1),t("div",Ke,[t("a",{href:`mailto:${n.value.customer.email}`,class:"detail-link"},l(n.value.customer.email),9,Ue)])])):w("",!0),(v=n.value.customer)!=null&&v.city?(c(),u("div",qe,[t("div",He,l(e(s)("customers.city")),1),t("div",Qe,l(n.value.customer.city),1)])):w("",!0),(O=n.value.customer)!=null&&O.address?(c(),u("div",Ye,[t("div",Ze,l(e(s)("customers.address")||"Address"),1),t("div",je,l(n.value.customer.address),1)])):w("",!0),(X=n.value.customer)!=null&&X.gender?(c(),u("div",Ge,[t("div",Je,l(e(s)("customers.gender")),1),t("div",Oe,l(n.value.customer.gender),1)])):w("",!0),(ee=n.value.customer)!=null&&ee.notes?(c(),u("div",Xe,[t("div",es,l(e(s)("customers.notes")),1),t("div",ss,l(n.value.customer.notes),1)])):w("",!0),(se=n.value.customer)!=null&&se.created_at?(c(),u("div",as,[t("div",ts,l(e(s)("common.createdAt")||"Created At"),1),t("div",ls,l(q(n.value.customer.created_at)),1)])):w("",!0)])]}),_:1},8,["title"]),a($,{title:e(s)("memberships.title")||"Memberships",icon:"cil-credit-card",class:"section-card"},{default:o(()=>{var i,_;return[t("div",os,[t("div",rs,[t("div",ns,[t("strong",null,l(((i=p.value)==null?void 0:i.plan_name_ar)||((_=p.value)==null?void 0:_.plan_name)||e(s)("memberships.noMembership")||"No membership"),1)]),p.value?(c(),u("div",is,[t("span",cs,l(p.value.start_date)+" → "+l(p.value.end_date),1),r[7]||(r[7]=t("span",{class:"text-muted"}," · ",-1)),t("span",ds,l(e(s)("common.status"))+": "+l(p.value.status),1)])):w("",!0)]),t("div",us,[a(e(g),{color:"primary",class:"btn-primary-custom",onClick:he},{default:o(()=>[a(e(m),{icon:"cil-user-follow",class:"me-2"}),h(" "+l(e(s)("memberships.assign")||"Assign Membership"),1)]),_:1}),p.value?(c(),P(e(g),{key:0,color:"secondary",variant:"outline",class:"ms-2",onClick:be},{default:o(()=>[a(e(m),{icon:"cil-clock",class:"me-2"}),h(" "+l(e(s)("memberships.renew")||"Renew"),1)]),_:1})):w("",!0),p.value?(c(),P(e(g),{key:1,color:"secondary",variant:"outline",class:"ms-2",onClick:ge},{default:o(()=>[a(e(m),{icon:"cil-ban",class:"me-2"}),h(" "+l(e(s)("memberships.cancel")||"Cancel"),1)]),_:1})):w("",!0)])]),p.value?(c(),u("div",ms,[a(e(V),{class:"unified-badge"},{default:o(()=>[a(e(m),{icon:"cil-spreadsheet",class:"badge-icon"}),t("span",null,l(p.value.services_used||0)+" / "+l(p.value.services_limit??"∞"),1)]),_:1}),a(e(V),{class:"unified-badge"},{default:o(()=>[a(e(m),{icon:"cil-star",class:"badge-icon"}),t("span",null,"x"+l(p.value.points_multiplier||1),1)]),_:1})])):w("",!0)]}),_:1},8,["title"]),a($,{title:e(s)("loyalty.appleWallet")||"Apple Wallet Passes",icon:"cil-wallet",class:"section-card"},{default:o(()=>[t("div",_s,[t("div",ps,[t("div",vs,[a(e(m),{icon:"cil-star",class:"me-2"}),t("strong",null,l(e(s)("loyalty.title")),1)]),a(e(g),{color:"secondary",variant:"outline",size:"sm",onClick:r[0]||(r[0]=i=>J("loyalty")),disabled:T.value},{default:o(()=>[T.value&&E.value==="loyalty"?(c(),P(e(te),{key:0,size:"sm",class:"me-1"})):(c(),P(e(m),{key:1,icon:"cil-wallet",class:"me-1"})),h(" "+l(e(s)("common.create")),1)]),_:1},8,["disabled"])]),p.value?(c(),u("div",hs,[t("div",ys,[a(e(m),{icon:"cil-credit-card",class:"me-2"}),t("strong",null,l(e(s)("memberships.title")),1)]),a(e(g),{color:"secondary",variant:"outline",size:"sm",onClick:r[1]||(r[1]=i=>J("membership")),disabled:T.value},{default:o(()=>[T.value&&E.value==="membership"?(c(),P(e(te),{key:0,size:"sm",class:"me-1"})):(c(),P(e(m),{key:1,icon:"cil-wallet",class:"me-1"})),h(" "+l(e(s)("common.create")),1)]),_:1},8,["disabled"])])):w("",!0)])]),_:1},8,["title"]),a($,{title:e(s)("customers.todayDetails")||"Today Details",icon:"cil-calendar",class:"section-card"},{default:o(()=>{var i,_;return[t("div",bs,[t("div",fs,[a(e(m),{icon:"cil-calendar",class:"me-2"}),t("strong",null,l(((i=n.value.today)==null?void 0:i.date)||"—"),1)]),t("div",gs,[a(e(V),{class:"unified-badge"},{default:o(()=>{var v;return[h(l((((v=n.value.today)==null?void 0:v.orders)||[]).length)+" "+l(e(s)("customers.ordersToday")||"orders"),1)]}),_:1}),a(e(V),{class:"unified-badge"},{default:o(()=>{var v;return[h(l((((v=n.value.today)==null?void 0:v.items)||[]).length)+" "+l(e(s)("customers.itemsToday")||"items"),1)]}),_:1})])]),(((_=n.value.today)==null?void 0:_.items)||[]).length===0?(c(),u("div",ws,l(e(s)("customers.noPurchasesToday")||"No purchases today"),1)):(c(),u("div",ks,[a(e(le),{hover:"",responsive:"",class:"table-modern"},{default:o(()=>[t("thead",null,[t("tr",Cs,[t("th",null,l(e(s)("common.date")),1),t("th",null,l(e(s)("customers.item")||"Item"),1),t("th",null,l(e(s)("customers.itemType")||"Type"),1),t("th",Ms,l(e(s)("customers.quantity")||"Qty"),1),t("th",Ps,l(e(s)("customers.amount")||"Amount"),1)])]),t("tbody",null,[(c(!0),u(z,null,Y(n.value.today.items,v=>(c(),u("tr",{key:v.id,class:"table-row"},[t("td",null,l(q(v.created_at)),1),t("td",null,[t("strong",null,l(v.item_name),1)]),t("td",null,[a(e(V),{class:oe(["unified-badge",v.item_type==="product"?"badge-product":"badge-service"])},{default:o(()=>[a(e(m),{icon:v.item_type==="product"?"cil-basket":"cil-spreadsheet",class:"badge-icon"},null,8,["icon"]),t("span",null,l(v.item_type),1)]),_:2},1032,["class"])]),t("td",Ts,l(v.quantity||1),1),t("td",Vs,[t("strong",xs,l(_e(v.total||0)),1)])]))),128))])]),_:1})]))]}),_:1},8,["title"]),a($,{title:e(s)("customers.todayLoyalty")||"Today Loyalty Transactions",icon:"cil-star",class:"section-card"},{default:o(()=>{var i;return[(((i=n.value.loyalty)==null?void 0:i.today_transactions)||[]).length===0?(c(),u("div",As,l(e(s)("customers.noLoyaltyToday")||"No loyalty transactions today"),1)):(c(),u("div",Ns,[a(e(le),{hover:"",responsive:"",class:"table-modern"},{default:o(()=>[t("thead",null,[t("tr",Ds,[t("th",null,l(e(s)("common.date")),1),t("th",null,l(e(s)("loyalty.type")||"Type"),1),t("th",Rs,l(e(s)("loyalty.points")),1),t("th",null,l(e(s)("loyalty.description")||"Description"),1)])]),t("tbody",null,[(c(!0),u(z,null,Y(n.value.loyalty.today_transactions,_=>(c(),u("tr",{key:_.id,class:"table-row"},[t("td",null,l(q(_.created_at)),1),t("td",null,[a(e(V),{class:oe(["unified-badge",_.type==="earned"?"badge-earned":"badge-other"])},{default:o(()=>[a(e(m),{icon:_.type==="earned"?"cil-plus":"cil-info",class:"badge-icon"},null,8,["icon"]),t("span",null,l(_.type),1)]),_:2},1032,["class"])]),t("td",Fs,[t("strong",null,l(_.points),1)]),t("td",null,l(_.description||"—"),1)]))),128))])]),_:1})]))]}),_:1},8,["title"]),a(e(ae),{visible:K.value,onClose:H,size:"lg"},{default:o(()=>[a(e(re),null,{default:o(()=>[a(e(ne),null,{default:o(()=>[a(e(m),{icon:"cil-user-follow",class:"me-2"}),h(" "+l(e(s)("memberships.assign")||"Assign Membership"),1)]),_:1})]),_:1}),a(e(ie),null,{default:o(()=>[a(e(ce),{class:"g-3"},{default:o(()=>[a(e(S),{md:12},{default:o(()=>[a(e(Pe),{modelValue:b.value.membership_plan_id,"onUpdate:modelValue":r[2]||(r[2]=i=>b.value.membership_plan_id=i),label:e(s)("memberships.plan")||"Plan"},{default:o(()=>[t("option",Ls,l(e(s)("common.select")),1),(c(!0),u(z,null,Y(B.value,i=>(c(),u("option",{key:i.id,value:String(i.id)},l(i.name_ar||i.name),9,Ss))),128))]),_:1},8,["modelValue","label"])]),_:1}),a(e(S),{md:6},{default:o(()=>[a(e(Z),{modelValue:b.value.duration_months,"onUpdate:modelValue":r[3]||(r[3]=i=>b.value.duration_months=i),modelModifiers:{number:!0},type:"number",min:"1",step:"1",label:e(s)("memberships.durationMonths")||"Duration (months)"},null,8,["modelValue","label"])]),_:1}),a(e(S),{md:6,class:"d-flex align-items-center"},{default:o(()=>[a(e(Te),{modelValue:b.value.auto_renew,"onUpdate:modelValue":r[4]||(r[4]=i=>b.value.auto_renew=i),label:e(s)("memberships.autoRenew")||"Auto renew"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),a(e(de),null,{default:o(()=>[a(e(g),{color:"secondary",onClick:H},{default:o(()=>[h(l(e(s)("common.cancel")),1)]),_:1}),a(e(g),{color:"primary",class:"btn-primary-custom",disabled:A.value,onClick:ye},{default:o(()=>[a(e(m),{icon:"cil-check",class:"me-2"}),h(" "+l(A.value?e(s)("common.saving"):e(s)("memberships.assign")||"Assign"),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),a(e(ae),{visible:U.value,onClose:Q,size:"lg"},{default:o(()=>[a(e(re),null,{default:o(()=>[a(e(ne),null,{default:o(()=>[a(e(m),{icon:"cil-clock",class:"me-2"}),h(" "+l(e(s)("memberships.renew")||"Renew"),1)]),_:1})]),_:1}),a(e(ie),null,{default:o(()=>[a(e(ce),{class:"g-3"},{default:o(()=>[a(e(S),{md:6},{default:o(()=>[a(e(Z),{modelValue:C.value.months,"onUpdate:modelValue":r[5]||(r[5]=i=>C.value.months=i),modelModifiers:{number:!0},type:"number",min:"1",step:"1",label:e(s)("memberships.monthsToExtend")||"Months"},null,8,["modelValue","label"])]),_:1}),a(e(S),{md:6},{default:o(()=>[a(e(Z),{modelValue:C.value.amount_paid,"onUpdate:modelValue":r[6]||(r[6]=i=>C.value.amount_paid=i),modelModifiers:{number:!0},type:"number",min:"0",step:"0.001",label:e(s)("memberships.amountPaid")||"Amount paid"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),a(e(de),null,{default:o(()=>[a(e(g),{color:"secondary",onClick:Q},{default:o(()=>[h(l(e(s)("common.cancel")),1)]),_:1}),a(e(g),{color:"primary",class:"btn-primary-custom",disabled:N.value,onClick:fe},{default:o(()=>[a(e(m),{icon:"cil-check",class:"me-2"}),h(" "+l(N.value?e(s)("common.saving"):e(s)("memberships.renew")||"Renew"),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"])],64))])}}},Js=Ne($s,[["__scopeId","data-v-7e54d027"]]);export{Js as default};
