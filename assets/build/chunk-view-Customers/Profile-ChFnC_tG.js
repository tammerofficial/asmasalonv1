import{f,g as be,i as ye,c as u,o as d,d as s,s as U,p as o,u as e,F as D,b as t,Z as X,l as fe,h as ge,x as g,P as v,C as m,t as l,a as y,Y as M,a4 as ee,k as E,n as se,a7 as ae,a8 as te,a9 as le,_ as oe,$ as P,a0 as we,a1 as W,a5 as ke,aa as ne}from"../chunk-vendor-vue-Bg1B1rts.js";import{u as Ce,a as A}from"../chunk-component-NotificationsBell-DEeZs3pc.js";import{a as Me}from"../chunk-view-Bookings/BookingAppearance-KKyyhntW.js";import{P as Ve}from"../chunk-component-PageHeader-ChZS5WBt.js";import{S as R}from"../chunk-component-StatCard-CJeSjoUF.js";import{_ as xe,C as F}from"../chunk-component-Card-Ft_8dSMe.js";import{L as Te}from"../chunk-component-LoadingSpinner-Bt4P2D5C.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-B7RCkv_6.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-BfIieaUO.js";import"../chunk-view-Bookings/BookingFormPreview-DdV3FhC4.js";const Pe={class:"customer-profile-page"},Ae={class:"stats-grid"},Ne={class:"details-grid"},De={class:"detail-row"},Re={class:"detail-label"},Fe={class:"detail-value"},Le=["href"],Se={key:1},Be={key:0,class:"detail-row"},$e={class:"detail-label"},Ie={class:"detail-value"},Ke=["href"],Ue={key:1,class:"detail-row"},Ee={class:"detail-label"},We={class:"detail-value"},ze={key:2,class:"detail-row"},qe={class:"detail-label"},He={class:"detail-value"},Qe={key:3,class:"detail-row"},Ye={class:"detail-label"},Ze={class:"detail-value"},je={key:4,class:"detail-row"},Ge={class:"detail-label"},Je={class:"detail-value"},Oe={key:5,class:"detail-row"},Xe={class:"detail-label"},es={class:"detail-value"},ss={class:"membership-header"},as={class:"membership-summary"},ts={class:"membership-title"},ls={key:0,class:"membership-sub"},os={class:"text-muted"},ns={class:"text-muted"},rs={class:"membership-actions"},is={key:0,class:"membership-badges"},cs={class:"today-header"},ds={class:"today-date"},us={class:"today-meta"},ms={key:0,class:"text-muted"},_s={key:1,class:"table-wrapper"},ps={class:"table-header-row"},hs={class:"text-center"},vs={class:"text-end"},bs={class:"text-center"},ys={class:"text-end"},fs={class:"unified-amount"},gs={key:0,class:"text-muted"},ws={key:1,class:"table-wrapper"},ks={class:"table-header-row"},Cs={class:"text-center"},Ms={class:"text-center"},Vs={value:""},xs=["value"],Ts={__name:"Profile",setup(Ps){const{t:a}=Ce(),w=Me(),re=fe(),ie=ge(),L=f(!1),n=f({customer:null,today:{orders:[],items:[],total_amount:0,points_earned:0},membership:{current:null,history:[]},loyalty:{today_transactions:[]}}),N=f([]),S=f(!1),V=f(!1),B=f(!1),x=f(!1),b=f({membership_plan_id:"",duration_months:1,auto_renew:!1}),k=f({months:1,amount_paid:0}),p=be(()=>{var i,r;return((r=(i=n.value)==null?void 0:i.membership)==null?void 0:r.current)||null}),z=async()=>{var i;try{const r=await A.get("/memberships/plans",{noCache:!0});N.value=((i=r.data)==null?void 0:i.data)||[]}catch{N.value=[]}},ce=i=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(i||0),q=i=>{const r=Number(i||0);return r>=1e3?`${(r/1e3).toFixed(1)}K KWD`:`${r.toFixed(0)} KWD`},$=i=>{if(!i)return"—";try{return new Date(i).toLocaleString()}catch{return String(i)}},T=async()=>{var i;L.value=!0;try{const r=re.params.id,C=await A.get(`/customers/${r}/profile`,{noCache:!0});n.value=((i=C.data)==null?void 0:i.data)||C.data||n.value}catch(r){console.error("Load customer profile error:",r),w.error(a("common.errorLoading"))}finally{L.value=!1}},de=()=>T(),ue=()=>ie.push("/customers"),me=async()=>{S.value=!0,b.value={membership_plan_id:"",duration_months:1,auto_renew:!1},N.value.length===0&&await z()},I=()=>{S.value=!1,V.value=!1},_e=async()=>{var i,r;if(!((r=(i=n.value)==null?void 0:i.customer)!=null&&r.id)||!b.value.membership_plan_id){w.error(a("memberships.selectPlan")||"Select plan");return}V.value=!0;try{await A.post("/memberships",{customer_id:Number(n.value.customer.id),membership_plan_id:Number(b.value.membership_plan_id),duration_months:Number(b.value.duration_months||1),auto_renew:b.value.auto_renew?1:0}),w.success(a("memberships.assigned")||"Assigned"),I(),await T()}catch(C){console.error("Assign membership error:",C),w.error(a("memberships.assignError")||a("common.errorLoading"))}finally{V.value=!1}},pe=()=>{B.value=!0,k.value={months:1,amount_paid:0}},K=()=>{B.value=!1,x.value=!1},he=async()=>{var i;if((i=p.value)!=null&&i.id){x.value=!0;try{await A.post(`/memberships/${p.value.id}/renew`,{months:Number(k.value.months||1),amount_paid:Number(k.value.amount_paid||0)}),w.success(a("memberships.renewed")||"Renewed"),K(),await T()}catch(r){console.error("Renew membership error:",r),w.error(a("memberships.renewError")||a("common.errorLoading"))}finally{x.value=!1}}},ve=async()=>{var i;if((i=p.value)!=null&&i.id&&confirm(a("memberships.cancelConfirm")||"Cancel membership?"))try{await A.delete(`/memberships/${p.value.id}`),w.success(a("memberships.cancelled")||"Cancelled"),await T()}catch{w.error(a("common.errorLoading"))}};return ye(()=>{T(),z()}),(i,r)=>{var C,H,Q,Y,Z;return d(),u("div",Pe,[s(Ve,{title:((C=n.value.customer)==null?void 0:C.name)||e(a)("customers.title"),subtitle:e(a)("customers.profileSubtitle")||e(a)("customers.title")},{icon:o(()=>[s(e(m),{icon:"cil-user"})]),actions:o(()=>[s(e(g),{color:"secondary",variant:"outline",class:"me-2",onClick:ue},{default:o(()=>[s(e(m),{icon:"cil-arrow-left",class:"me-2"}),v(" "+l(e(a)("common.back")||"Back"),1)]),_:1}),s(e(g),{color:"primary",class:"btn-primary-custom",onClick:de},{default:o(()=>[s(e(m),{icon:"cil-reload",class:"me-2"}),v(" "+l(e(a)("common.refresh")||"Refresh"),1)]),_:1})]),_:1},8,["title","subtitle"]),L.value?(d(),U(Te,{key:0,text:e(a)("common.loading")},null,8,["text"])):(d(),u(D,{key:1},[t("div",Ae,[s(R,{label:e(a)("customers.points"),value:((H=n.value.customer)==null?void 0:H.loyalty_points)||0,"badge-variant":"info",color:"gold"},{icon:o(()=>[s(e(m),{icon:"cil-star"})]),_:1},8,["label","value"]),s(R,{label:e(a)("customers.spending"),value:q(((Q=n.value.customer)==null?void 0:Q.total_spent)||0),"badge-variant":"info",color:"gold"},{icon:o(()=>[s(e(m),{icon:"cil-money"})]),_:1},8,["label","value"]),s(R,{label:e(a)("customers.todaysPurchases")||"Today Purchases",value:q(((Y=n.value.today)==null?void 0:Y.total_amount)||0),"badge-variant":"success",color:"gold"},{icon:o(()=>[s(e(m),{icon:"cil-cart"})]),_:1},8,["label","value"]),s(R,{label:e(a)("customers.todaysPoints")||"Today Points",value:((Z=n.value.today)==null?void 0:Z.points_earned)||0,"badge-variant":"warning",color:"gold"},{icon:o(()=>[s(e(m),{icon:"cil-gift"})]),_:1},8,["label","value"])]),s(F,{title:e(a)("customers.customerDetails")||"Customer Details",icon:"cil-user",class:"section-card"},{default:o(()=>{var c,h,_,j,G,J,O;return[t("div",Ne,[t("div",De,[t("div",Re,l(e(a)("customers.phone")),1),t("div",Fe,[(c=n.value.customer)!=null&&c.phone?(d(),u("a",{key:0,href:`tel:${n.value.customer.phone}`,class:"detail-link"},l(n.value.customer.phone),9,Le)):(d(),u("span",Se,"—"))])]),(h=n.value.customer)!=null&&h.email?(d(),u("div",Be,[t("div",$e,l(e(a)("customers.email")),1),t("div",Ie,[t("a",{href:`mailto:${n.value.customer.email}`,class:"detail-link"},l(n.value.customer.email),9,Ke)])])):y("",!0),(_=n.value.customer)!=null&&_.city?(d(),u("div",Ue,[t("div",Ee,l(e(a)("customers.city")),1),t("div",We,l(n.value.customer.city),1)])):y("",!0),(j=n.value.customer)!=null&&j.address?(d(),u("div",ze,[t("div",qe,l(e(a)("customers.address")||"Address"),1),t("div",He,l(n.value.customer.address),1)])):y("",!0),(G=n.value.customer)!=null&&G.gender?(d(),u("div",Qe,[t("div",Ye,l(e(a)("customers.gender")),1),t("div",Ze,l(n.value.customer.gender),1)])):y("",!0),(J=n.value.customer)!=null&&J.notes?(d(),u("div",je,[t("div",Ge,l(e(a)("customers.notes")),1),t("div",Je,l(n.value.customer.notes),1)])):y("",!0),(O=n.value.customer)!=null&&O.created_at?(d(),u("div",Oe,[t("div",Xe,l(e(a)("common.createdAt")||"Created At"),1),t("div",es,l($(n.value.customer.created_at)),1)])):y("",!0)])]}),_:1},8,["title"]),s(F,{title:e(a)("memberships.title")||"Memberships",icon:"cil-credit-card",class:"section-card"},{default:o(()=>{var c,h;return[t("div",ss,[t("div",as,[t("div",ts,[t("strong",null,l(((c=p.value)==null?void 0:c.plan_name_ar)||((h=p.value)==null?void 0:h.plan_name)||e(a)("memberships.noMembership")||"No membership"),1)]),p.value?(d(),u("div",ls,[t("span",os,l(p.value.start_date)+" → "+l(p.value.end_date),1),r[5]||(r[5]=t("span",{class:"text-muted"}," · ",-1)),t("span",ns,l(e(a)("common.status"))+": "+l(p.value.status),1)])):y("",!0)]),t("div",rs,[s(e(g),{color:"primary",class:"btn-primary-custom",onClick:me},{default:o(()=>[s(e(m),{icon:"cil-user-follow",class:"me-2"}),v(" "+l(e(a)("memberships.assign")||"Assign Membership"),1)]),_:1}),p.value?(d(),U(e(g),{key:0,color:"secondary",variant:"outline",class:"ms-2",onClick:pe},{default:o(()=>[s(e(m),{icon:"cil-clock",class:"me-2"}),v(" "+l(e(a)("memberships.renew")||"Renew"),1)]),_:1})):y("",!0),p.value?(d(),U(e(g),{key:1,color:"secondary",variant:"outline",class:"ms-2",onClick:ve},{default:o(()=>[s(e(m),{icon:"cil-ban",class:"me-2"}),v(" "+l(e(a)("memberships.cancel")||"Cancel"),1)]),_:1})):y("",!0)])]),p.value?(d(),u("div",is,[s(e(M),{class:"unified-badge"},{default:o(()=>[s(e(m),{icon:"cil-spreadsheet",class:"badge-icon"}),t("span",null,l(p.value.services_used||0)+" / "+l(p.value.services_limit??"∞"),1)]),_:1}),s(e(M),{class:"unified-badge"},{default:o(()=>[s(e(m),{icon:"cil-star",class:"badge-icon"}),t("span",null,"x"+l(p.value.points_multiplier||1),1)]),_:1})])):y("",!0)]}),_:1},8,["title"]),s(F,{title:e(a)("customers.todayDetails")||"Today Details",icon:"cil-calendar",class:"section-card"},{default:o(()=>{var c,h;return[t("div",cs,[t("div",ds,[s(e(m),{icon:"cil-calendar",class:"me-2"}),t("strong",null,l(((c=n.value.today)==null?void 0:c.date)||"—"),1)]),t("div",us,[s(e(M),{class:"unified-badge"},{default:o(()=>{var _;return[v(l((((_=n.value.today)==null?void 0:_.orders)||[]).length)+" "+l(e(a)("customers.ordersToday")||"orders"),1)]}),_:1}),s(e(M),{class:"unified-badge"},{default:o(()=>{var _;return[v(l((((_=n.value.today)==null?void 0:_.items)||[]).length)+" "+l(e(a)("customers.itemsToday")||"items"),1)]}),_:1})])]),(((h=n.value.today)==null?void 0:h.items)||[]).length===0?(d(),u("div",ms,l(e(a)("customers.noPurchasesToday")||"No purchases today"),1)):(d(),u("div",_s,[s(e(ee),{hover:"",responsive:"",class:"table-modern"},{default:o(()=>[t("thead",null,[t("tr",ps,[t("th",null,l(e(a)("common.date")),1),t("th",null,l(e(a)("customers.item")||"Item"),1),t("th",null,l(e(a)("customers.itemType")||"Type"),1),t("th",hs,l(e(a)("customers.quantity")||"Qty"),1),t("th",vs,l(e(a)("customers.amount")||"Amount"),1)])]),t("tbody",null,[(d(!0),u(D,null,E(n.value.today.items,_=>(d(),u("tr",{key:_.id,class:"table-row"},[t("td",null,l($(_.created_at)),1),t("td",null,[t("strong",null,l(_.item_name),1)]),t("td",null,[s(e(M),{class:se(["unified-badge",_.item_type==="product"?"badge-product":"badge-service"])},{default:o(()=>[s(e(m),{icon:_.item_type==="product"?"cil-basket":"cil-spreadsheet",class:"badge-icon"},null,8,["icon"]),t("span",null,l(_.item_type),1)]),_:2},1032,["class"])]),t("td",bs,l(_.quantity||1),1),t("td",ys,[t("strong",fs,l(ce(_.total||0)),1)])]))),128))])]),_:1})]))]}),_:1},8,["title"]),s(F,{title:e(a)("customers.todayLoyalty")||"Today Loyalty Transactions",icon:"cil-star",class:"section-card"},{default:o(()=>{var c;return[(((c=n.value.loyalty)==null?void 0:c.today_transactions)||[]).length===0?(d(),u("div",gs,l(e(a)("customers.noLoyaltyToday")||"No loyalty transactions today"),1)):(d(),u("div",ws,[s(e(ee),{hover:"",responsive:"",class:"table-modern"},{default:o(()=>[t("thead",null,[t("tr",ks,[t("th",null,l(e(a)("common.date")),1),t("th",null,l(e(a)("loyalty.type")||"Type"),1),t("th",Cs,l(e(a)("loyalty.points")),1),t("th",null,l(e(a)("loyalty.description")||"Description"),1)])]),t("tbody",null,[(d(!0),u(D,null,E(n.value.loyalty.today_transactions,h=>(d(),u("tr",{key:h.id,class:"table-row"},[t("td",null,l($(h.created_at)),1),t("td",null,[s(e(M),{class:se(["unified-badge",h.type==="earned"?"badge-earned":"badge-other"])},{default:o(()=>[s(e(m),{icon:h.type==="earned"?"cil-plus":"cil-info",class:"badge-icon"},null,8,["icon"]),t("span",null,l(h.type),1)]),_:2},1032,["class"])]),t("td",Ms,[t("strong",null,l(h.points),1)]),t("td",null,l(h.description||"—"),1)]))),128))])]),_:1})]))]}),_:1},8,["title"]),s(e(X),{visible:S.value,onClose:I,size:"lg"},{default:o(()=>[s(e(ae),null,{default:o(()=>[s(e(te),null,{default:o(()=>[s(e(m),{icon:"cil-user-follow",class:"me-2"}),v(" "+l(e(a)("memberships.assign")||"Assign Membership"),1)]),_:1})]),_:1}),s(e(le),null,{default:o(()=>[s(e(oe),{class:"g-3"},{default:o(()=>[s(e(P),{md:12},{default:o(()=>[s(e(we),{modelValue:b.value.membership_plan_id,"onUpdate:modelValue":r[0]||(r[0]=c=>b.value.membership_plan_id=c),label:e(a)("memberships.plan")||"Plan"},{default:o(()=>[t("option",Vs,l(e(a)("common.select")),1),(d(!0),u(D,null,E(N.value,c=>(d(),u("option",{key:c.id,value:String(c.id)},l(c.name_ar||c.name),9,xs))),128))]),_:1},8,["modelValue","label"])]),_:1}),s(e(P),{md:6},{default:o(()=>[s(e(W),{modelValue:b.value.duration_months,"onUpdate:modelValue":r[1]||(r[1]=c=>b.value.duration_months=c),modelModifiers:{number:!0},type:"number",min:"1",step:"1",label:e(a)("memberships.durationMonths")||"Duration (months)"},null,8,["modelValue","label"])]),_:1}),s(e(P),{md:6,class:"d-flex align-items-center"},{default:o(()=>[s(e(ke),{modelValue:b.value.auto_renew,"onUpdate:modelValue":r[2]||(r[2]=c=>b.value.auto_renew=c),label:e(a)("memberships.autoRenew")||"Auto renew"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),s(e(ne),null,{default:o(()=>[s(e(g),{color:"secondary",onClick:I},{default:o(()=>[v(l(e(a)("common.cancel")),1)]),_:1}),s(e(g),{color:"primary",class:"btn-primary-custom",disabled:V.value,onClick:_e},{default:o(()=>[s(e(m),{icon:"cil-check",class:"me-2"}),v(" "+l(V.value?e(a)("common.saving"):e(a)("memberships.assign")||"Assign"),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),s(e(X),{visible:B.value,onClose:K,size:"lg"},{default:o(()=>[s(e(ae),null,{default:o(()=>[s(e(te),null,{default:o(()=>[s(e(m),{icon:"cil-clock",class:"me-2"}),v(" "+l(e(a)("memberships.renew")||"Renew"),1)]),_:1})]),_:1}),s(e(le),null,{default:o(()=>[s(e(oe),{class:"g-3"},{default:o(()=>[s(e(P),{md:6},{default:o(()=>[s(e(W),{modelValue:k.value.months,"onUpdate:modelValue":r[3]||(r[3]=c=>k.value.months=c),modelModifiers:{number:!0},type:"number",min:"1",step:"1",label:e(a)("memberships.monthsToExtend")||"Months"},null,8,["modelValue","label"])]),_:1}),s(e(P),{md:6},{default:o(()=>[s(e(W),{modelValue:k.value.amount_paid,"onUpdate:modelValue":r[4]||(r[4]=c=>k.value.amount_paid=c),modelModifiers:{number:!0},type:"number",min:"0",step:"0.001",label:e(a)("memberships.amountPaid")||"Amount paid"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),s(e(ne),null,{default:o(()=>[s(e(g),{color:"secondary",onClick:K},{default:o(()=>[v(l(e(a)("common.cancel")),1)]),_:1}),s(e(g),{color:"primary",class:"btn-primary-custom",disabled:x.value,onClick:he},{default:o(()=>[s(e(m),{icon:"cil-check",class:"me-2"}),v(" "+l(x.value?e(a)("common.saving"):e(a)("memberships.renew")||"Renew"),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"])],64))])}}},Ws=xe(Ts,[["__scopeId","data-v-273bcf1d"]]);export{Ws as default};
