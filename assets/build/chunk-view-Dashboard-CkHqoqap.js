import{f as _,g as R,i as de,w as ue,c as q,o as v,d as s,b as n,p as c,u as e,s as y,a as ve,h as be,x as B,P as p,C as l,t as r,ad as me,ae as H,F as Q,k as J,Y,n as G}from"./chunk-vendor-vue-CVODRAc9.js";import{b as ge,u as he,a as U,c as pe}from"./chunk-component-NotificationsBell-DXvfEbaA.js";import{C as fe,a as ke,b as _e,P as ye,c as we,A as Ce,p as qe,d as $e,i as Se}from"./chunk-vendor-charts-C66rl4lP.js";import{P as Be}from"./chunk-component-PageHeader-DIMefZ9l.js";import{S as w}from"./chunk-component-StatCard-CUh-yMQt.js";import{_ as De,C as x}from"./chunk-component-Card-DAbGoLxt.js";import{E as X}from"./chunk-component-EmptyState-B8o9iOHP.js";import{L as V}from"./chunk-component-LoadingSpinner-DYzABkFM.js";import{u as Ae,a as Re}from"./chunk-view-Bookings/BookingAppearance-h1g7uA93.js";import{u as We}from"./chunk-component-Sidebar-BCBXCjN-.js";import"./chunk-vendor-6xaPOP3o.js";import"./chunk-vendor-pinia-DSPKUyr1.js";import"./chunk-vendor-axios-B9ygI19o.js";import"./chunk-view-Bookings/BookingFormPreview-CRxQyI9V.js";function Ee(){const $=Ae(),a=ge();async function D(){try{await Promise.all([$.prefetchServices(),$.prefetchStaff()]),setTimeout(async()=>{try{await $.prefetchAppointments()}catch(g){console.error("Error prefetching appointments:",g)}},1e3),setTimeout(async()=>{try{await a.prefetchNotifications()}catch(g){console.error("Error prefetching notifications:",g)}},2e3)}catch(g){console.error("Error in background prefetch:",g)}}async function P(g,C={}){try{switch(g){case"services":return await $.prefetchServices(C);case"staff":return await $.prefetchStaff(C);case"appointments":case"bookings":return await $.prefetchAppointments(C);case"notifications":return await a.prefetchNotifications(C);default:return console.warn(`Unknown prefetch resource: ${g}`),null}}catch(A){return console.error(`Error prefetching ${g}:`,A),null}}return{prefetchAllWithDelay:D,prefetchResource:P}}const Le={class:"asmaa-salon-dashboard"},Te={class:"stats-grid"},Ne={key:1,class:"charts-grid"},Oe={class:"chart-panel"},xe={class:"chart-title"},Pe={class:"chart-canvas"},Ie={class:"chart-panel"},Ue={class:"chart-title"},Ve={class:"chart-canvas chart-canvas-sm"},Fe={class:"chart-panel"},Ke={class:"chart-title"},Me={class:"chart-canvas chart-canvas-sm"},je={class:"content-grid"},ze={key:2,class:"bookings-list-modern"},He=["onClick"],Qe={class:"booking-number"},Je={class:"booking-details-modern"},Ye={class:"booking-customer-name"},Ge={class:"booking-meta-modern"},Xe={class:"booking-time-modern"},Ze={key:2,class:"queue-list-modern"},eo={class:"queue-info-modern"},oo={class:"queue-customer-name"},ao={class:"queue-service-modern"},to={class:"quick-actions-grid"},so={class:"quick-action-icon blue"},no={class:"quick-action-content"},io={class:"quick-action-title"},ro={class:"quick-action-desc"},co={class:"quick-action-icon gold"},lo={class:"quick-action-content"},uo={class:"quick-action-title"},vo={class:"quick-action-desc"},bo={class:"quick-action-icon brown"},mo={class:"quick-action-content"},go={class:"quick-action-title"},ho={class:"quick-action-desc"},po={class:"quick-action-icon pink"},fo={class:"quick-action-content"},ko={class:"quick-action-title"},_o={class:"quick-action-desc"},yo={__name:"Dashboard",setup($){be();const{t:a}=he(),D=Re(),{prefetchAllWithDelay:P}=Ee(),g=_(!1),C=_(!1),A=_(!1),I=_(!1),b=_({customers:0,bookingsToday:0,monthlyRevenue:0,activeStaff:0,totalServices:0,pendingOrders:0,unpaidInvoices:0,queueWaiting:0}),W=_([]),E=_([]),f=_({sales_last_7_days:{labels:[],orders:[],revenue:[]},bookings_status_last_30_days:{pending:0,confirmed:0,completed:0,cancelled:0},invoices_status:{}}),L=_("charts-0"),Z=t=>{if(!t&&t!==0)return"0 KWD";const o=parseFloat(t);return o>=1e3?`${(o/1e3).toFixed(1)}K KWD`:`${o.toFixed(0)} KWD`},ee=t=>({pending:a("bookings.pending"),confirmed:a("bookings.confirmed"),completed:a("bookings.completed"),cancelled:a("bookings.cancelled")})[t]||t,oe=t=>({pending:"warning",confirmed:"info",completed:"success",cancelled:"danger"})[t]||"info",ae=t=>{if(!t)return"-";const o=String(t);try{if(o.includes("T")||o.includes("-"))return new Date(o).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});const d=o.length===5?`${o}:00`:o;return new Date(`1970-01-01T${d}`).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}catch{return o}},te=()=>{const t={exported_at:new Date().toISOString(),stats:b.value,recent_bookings:W.value,queue:E.value},o=JSON.stringify(t,null,2),d=new Blob([o],{type:"application/json;charset=utf-8"}),h=URL.createObjectURL(d),m=document.createElement("a");m.href=h,m.download=`asmaa-salon-dashboard-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,document.body.appendChild(m),m.click(),m.remove(),URL.revokeObjectURL(h),D.success("✅ Exported dashboard snapshot")},se=async()=>{g.value=!0;try{pe(),await F(),await j(),await z(),D.success("✅ Dashboard refreshed")}catch(t){console.error("Error refreshing data:",t),D.error("❌ Failed to refresh dashboard")}finally{g.value=!1}},F=async()=>{var t;I.value=!0;try{const o=await U.get("/reports/dashboard",{noCache:!0}),d=((t=o.data)==null?void 0:t.data)||o.data||{};b.value={...b.value,...d||{}},d!=null&&d.charts&&(f.value={sales_last_7_days:d.charts.sales_last_7_days||f.value.sales_last_7_days,bookings_status_last_30_days:d.charts.bookings_status_last_30_days||f.value.bookings_status_last_30_days,invoices_status:d.charts.invoices_status||f.value.invoices_status},K())}catch(o){console.error("Error loading dashboard:",o)}finally{I.value=!1}},u=(t,o="")=>{try{return(getComputedStyle(document.documentElement).getPropertyValue(t)||"").trim()||o}catch{return o}},K=()=>{L.value=`charts-${Date.now()}`};fe.register(ke,_e,ye,we,Ce,qe,$e,Se);const ne=R(()=>{var S,i,k;const t=u("--asmaa-primary","#BBA07A"),o=u("--asmaa-primary-soft","rgba(187,160,122,0.14)"),d=((S=f.value.sales_last_7_days)==null?void 0:S.labels)||[],h=((i=f.value.sales_last_7_days)==null?void 0:i.revenue)||[],m=((k=f.value.sales_last_7_days)==null?void 0:k.orders)||[];return{labels:d,datasets:[{label:a("dashboard.revenue")||"Revenue (KWD)",data:h,borderColor:t,backgroundColor:o,fill:!0,tension:.35,pointRadius:3,pointHoverRadius:5},{label:a("dashboard.orders")||"Orders",data:m,borderColor:u("--asmaa-secondary","#475569"),backgroundColor:u("--asmaa-secondary-soft","rgba(71,85,105,0.14)"),fill:!1,tension:.35,pointRadius:3,pointHoverRadius:5}]}}),T=()=>u("--border-color","#e5e7eb"),N=()=>u("--text-secondary","#64748b"),O=()=>u("--text-primary","#111827"),ie=R(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:N(),usePointStyle:!0,boxWidth:8}},tooltip:{backgroundColor:u("--bg-primary","#fff"),titleColor:O(),bodyColor:O(),borderColor:T(),borderWidth:1}},scales:{x:{ticks:{color:N()},grid:{color:T()}},y:{ticks:{color:N()},grid:{color:T()}}}})),M=R(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:N(),usePointStyle:!0,boxWidth:8}},tooltip:{backgroundColor:u("--bg-primary","#fff"),titleColor:O(),bodyColor:O(),borderColor:T(),borderWidth:1}}})),re=R(()=>{const t=f.value.bookings_status_last_30_days||{};return{labels:[a("bookings.pending")||"Pending",a("bookings.confirmed")||"Confirmed",a("bookings.completed")||"Completed",a("bookings.cancelled")||"Cancelled"],datasets:[{data:[t.pending||0,t.confirmed||0,t.completed||0,t.cancelled||0],backgroundColor:[u("--asmaa-warning","#f59e0b"),u("--asmaa-primary","#BBA07A"),u("--asmaa-primary-700","#A68B5B"),u("--asmaa-danger","#ef4444")],borderColor:u("--bg-primary","#fff"),borderWidth:2}]}}),ce=R(()=>{const t=f.value.invoices_status||{},o=Object.keys(t).filter(Boolean),d=o.map(m=>Number(t[m]||0)),h=[u("--asmaa-primary","#BBA07A"),u("--asmaa-primary-700","#A68B5B"),u("--asmaa-warning","#f59e0b"),u("--asmaa-danger","#ef4444"),u("--asmaa-secondary","#475569")];return{labels:o.length?o:[a("common.noData")||"No data"],datasets:[{data:o.length?d:[1],backgroundColor:o.length?o.map((m,S)=>h[S%h.length]):[u("--asmaa-secondary-soft","rgba(71,85,105,0.14)")],borderColor:u("--bg-primary","#fff"),borderWidth:2}]}}),j=async()=>{var t;C.value=!0;try{const o=await U.get("/bookings",{params:{per_page:5,orderby:"date",order:"desc"}}),d=((t=o.data)==null?void 0:t.data)||o.data||{};W.value=d.items||[]}catch(o){console.error("Error loading recent bookings:",o)}finally{C.value=!1}},z=async()=>{var t;A.value=!0;try{const o=await U.get("/queue"),d=((t=o.data)==null?void 0:t.data)||o.data||{};E.value=d.items||[]}catch(o){console.error("Error loading queue:",o)}finally{A.value=!1}};de(async()=>{await Promise.all([F(),j(),z()]),P().catch(()=>{})});const le=We();return ue(()=>le.theme,()=>K()),(t,o)=>{var d,h,m,S;return v(),q("div",Le,[s(Be,{title:e(a)("dashboard.title"),subtitle:e(a)("dashboard.subtitle")},{icon:c(()=>[...o[16]||(o[16]=[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),n("path",{d:"M3 9h18"}),n("path",{d:"M9 21V9"})],-1)])]),actions:c(()=>[s(e(B),{color:"secondary",variant:"outline",onClick:te,class:"action-btn"},{default:c(()=>[s(e(l),{icon:"cil-cloud-download",class:"me-2"}),p(" "+r(e(a)("common.export")),1)]),_:1}),s(e(B),{color:"primary",onClick:se,class:"action-btn refresh-btn"},{default:c(()=>[s(e(l),{icon:"cil-reload",class:"me-2"}),p(" "+r(e(a)("common.refresh")),1)]),_:1})]),_:1},8,["title","subtitle"]),n("div",Te,[s(w,{label:e(a)("dashboard.totalCustomers"),value:b.value.customers||0,badge:e(a)("common.active")+" "+e(a)("nav.customers"),"badge-variant":"info",color:"blue",clickable:!0,onClick:o[0]||(o[0]=i=>t.$router.push("/customers"))},{icon:c(()=>[s(e(l),{icon:"cil-people"})]),_:1},8,["label","value","badge"]),s(w,{label:e(a)("dashboard.todaysBookings"),value:b.value.bookingsToday||0,badge:"85%","badge-variant":"info",color:"gold",clickable:!0,onClick:o[1]||(o[1]=i=>t.$router.push("/bookings"))},{icon:c(()=>[s(e(l),{icon:"cil-calendar"})]),_:1},8,["label","value"]),s(w,{label:e(a)("dashboard.monthlyRevenue"),value:Z(b.value.monthlyRevenue||0),badge:e(a)("dashboard.monthlyRevenue"),"badge-variant":"info",color:"yellow"},{icon:c(()=>[s(e(l),{icon:"cil-money"})]),_:1},8,["label","value","badge"]),s(w,{label:e(a)("dashboard.activeStaff"),value:b.value.activeStaff||0,badge:e(a)("common.active"),"badge-variant":"info",color:"gold",clickable:!0,onClick:o[2]||(o[2]=i=>t.$router.push("/staff"))},{icon:c(()=>[s(e(l),{icon:"cil-user"})]),_:1},8,["label","value","badge"]),s(w,{label:`${e(a)("common.total")||"Total"} ${e(a)("nav.services")}`,value:b.value.totalServices||0,badge:e(a)("common.active"),"badge-variant":"info",color:"pink",clickable:!0,onClick:o[3]||(o[3]=i=>t.$router.push("/services"))},{icon:c(()=>[s(e(l),{icon:"cil-spreadsheet"})]),_:1},8,["label","value","badge"]),s(w,{label:e(a)("orders.pending")+" "+e(a)("nav.orders"),value:b.value.pendingOrders||0,badge:b.value.pendingOrders||"0 "+e(a)("orders.pending"),"badge-variant":"warning",color:"teal",clickable:!0,onClick:o[4]||(o[4]=i=>t.$router.push("/orders"))},{icon:c(()=>[s(e(l),{icon:"cil-cart"})]),_:1},8,["label","value","badge"]),s(w,{label:e(a)("invoices.unpaid")+" "+e(a)("nav.invoices"),value:b.value.unpaidInvoices||0,badge:e(a)("common.status"),"badge-variant":"warning",color:"gold",clickable:!0,onClick:o[5]||(o[5]=i=>t.$router.push("/invoices"))},{icon:c(()=>[s(e(l),{icon:"cil-file"})]),_:1},8,["label","value","badge"]),s(w,{label:e(a)("queue.waiting"),value:b.value.queueWaiting||0,badge:e(a)("dashboard.currentWaiting"),"badge-variant":"info",color:"orange",clickable:!0,onClick:o[6]||(o[6]=i=>t.$router.push("/queue"))},{icon:c(()=>[s(e(l),{icon:"cil-list"})]),_:1},8,["label","value","badge"]),(d=b.value.woocommerce)!=null&&d.active?(v(),y(w,{key:0,label:e(a)("settings.woocommerce.title")||"WooCommerce",value:(h=b.value.woocommerce)!=null&&h.enabled?e(a)("common.active"):e(a)("common.inactive"),badge:((m=b.value.woocommerce)==null?void 0:m.synced_orders)+" "+e(a)("nav.orders"),"badge-variant":(S=b.value.woocommerce)!=null&&S.enabled?"info":"secondary",color:"gold",clickable:!0,onClick:o[7]||(o[7]=i=>t.$router.push("/settings/woocommerce"))},{icon:c(()=>[s(e(l),{icon:"cil-cart"})]),_:1},8,["label","value","badge","badge-variant"])):ve("",!0)]),s(x,{title:e(a)("dashboard.chartsTitle")||"Analytics",subtitle:e(a)("dashboard.chartsSubtitle")||"Sales & activity insights",icon:"cil-chart-line",class:"charts-card"},{default:c(()=>[I.value?(v(),y(V,{key:0,text:e(a)("common.loading")},null,8,["text"])):(v(),q("div",Ne,[n("div",Oe,[n("div",xe,r(e(a)("dashboard.salesLast7Days")||"Sales (Last 7 Days)"),1),n("div",Pe,[(v(),y(e(me),{data:ne.value,options:ie.value,key:L.value},null,8,["data","options"]))])]),n("div",Ie,[n("div",Ue,r(e(a)("dashboard.bookingsStatus")||"Bookings Status (Last 30 Days)"),1),n("div",Ve,[(v(),y(e(H),{data:re.value,options:M.value,key:L.value+"-b"},null,8,["data","options"]))])]),n("div",Fe,[n("div",Ke,r(e(a)("dashboard.invoicesStatus")||"Invoices Status"),1),n("div",Me,[(v(),y(e(H),{data:ce.value,options:M.value,key:L.value+"-i"},null,8,["data","options"]))])])]))]),_:1},8,["title","subtitle"]),n("div",je,[s(x,{title:e(a)("dashboard.recentBookings"),subtitle:e(a)("dashboard.recentActivity"),icon:"cil-calendar"},{actions:c(()=>[s(e(B),{color:"secondary",variant:"ghost",size:"sm",onClick:o[8]||(o[8]=i=>t.$router.push("/bookings"))},{default:c(()=>[p(r(e(a)("dashboard.viewAll"))+" ",1),s(e(l),{icon:"cil-arrow-right",class:"ms-1"})]),_:1})]),footer:c(()=>[s(e(B),{color:"secondary",variant:"ghost",onClick:o[10]||(o[10]=i=>t.$router.push("/bookings")),class:"w-100"},{default:c(()=>[p(r(e(a)("dashboard.viewAllOrders"))+" ",1),s(e(l),{icon:"cil-arrow-right",class:"ms-2"})]),_:1})]),default:c(()=>[C.value?(v(),y(V,{key:0,text:e(a)("common.loading")},null,8,["text"])):W.value.length?(v(),q("div",ze,[(v(!0),q(Q,null,J(W.value.slice(0,5),i=>(v(),q("div",{key:i.id,class:"booking-item-modern",onClick:k=>t.$router.push(`/bookings/${i.id}`)},[n("div",Qe,"#"+r(i.id),1),n("div",Je,[n("div",Ye,r(i.customer_name||"Customer #"+i.customer_id),1),n("div",Ge,[s(e(Y),{color:oe(i.status),class:"status-badge"},{default:c(()=>[p(r(ee(i.status)),1)]),_:2},1032,["color"]),n("span",Xe,[s(e(l),{icon:"cil-clock",class:"me-1"}),p(" "+r(ae(i.booking_time)),1)])])]),s(e(l),{icon:"cil-chevron-right",class:"booking-arrow"})],8,He))),128))])):(v(),y(X,{key:1,title:e(a)("dashboard.noBookings"),description:e(a)("dashboard.noBookingsFound"),"icon-color":"gray"},{action:c(()=>[s(e(B),{color:"primary",onClick:o[9]||(o[9]=i=>t.$router.push("/bookings?action=create"))},{default:c(()=>[p(r(`${e(a)("common.add")} ${e(a)("nav.bookings")}`),1)]),_:1})]),_:1},8,["title","description"]))]),_:1},8,["title","subtitle"]),s(x,{title:e(a)("dashboard.queueStatus"),subtitle:e(a)("dashboard.currentWaiting"),icon:"cil-list"},{actions:c(()=>[s(e(B),{color:"secondary",variant:"ghost",size:"sm",onClick:o[11]||(o[11]=i=>t.$router.push("/queue"))},{default:c(()=>[p(r(e(a)("dashboard.viewAll"))+" ",1),s(e(l),{icon:"cil-arrow-right",class:"ms-1"})]),_:1})]),default:c(()=>[A.value?(v(),y(V,{key:0,text:e(a)("common.loading")},null,8,["text"])):E.value.length?(v(),q("div",Ze,[(v(!0),q(Q,null,J(E.value.slice(0,5),(i,k)=>(v(),q("div",{key:i.id,class:G(["queue-item-modern",{"queue-item-next":k===0}])},[n("div",{class:G(["queue-position",{"queue-position-next":k===0}])},r(k+1),3),n("div",eo,[n("div",oo,r(i.customer_name),1),n("div",ao,[s(e(l),{icon:"cil-spreadsheet",class:"me-1"}),p(" "+r(i.service_name),1)])]),s(e(Y),{color:k===0?"warning":"secondary",class:"queue-status-badge"},{default:c(()=>[p(r(k===0?e(a)("queue.next"):e(a)("queue.waiting")),1)]),_:2},1032,["color"])],2))),128))])):(v(),y(X,{key:1,title:e(a)("queue.noWaiting"),description:"","icon-color":"gold"},{icon:c(()=>[s(e(l),{icon:"cil-check-circle",size:"3xl"})]),_:1},8,["title"]))]),_:1},8,["title","subtitle"])]),s(x,{title:e(a)("dashboard.quickActions"),icon:"cil-bolt"},{default:c(()=>[n("div",to,[n("button",{class:"quick-action-btn",onClick:o[12]||(o[12]=i=>t.$router.push("/customers?action=create"))},[n("div",so,[s(e(l),{icon:"cil-plus"})]),n("div",no,[n("div",io,r(e(a)("common.add"))+" "+r(e(a)("nav.customers")),1),n("div",ro,r(e(a)("customers.addNew")),1)]),s(e(l),{icon:"cil-arrow-right",class:"quick-action-arrow"})]),n("button",{class:"quick-action-btn",onClick:o[13]||(o[13]=i=>t.$router.push("/bookings?action=create"))},[n("div",co,[s(e(l),{icon:"cil-calendar"})]),n("div",lo,[n("div",uo,r(e(a)("common.add"))+" "+r(e(a)("nav.bookings")),1),n("div",vo,r(e(a)("bookings.addNew")),1)]),s(e(l),{icon:"cil-arrow-right",class:"quick-action-arrow"})]),n("button",{class:"quick-action-btn",onClick:o[14]||(o[14]=i=>t.$router.push("/services?action=create"))},[n("div",bo,[s(e(l),{icon:"cil-spreadsheet"})]),n("div",mo,[n("div",go,r(e(a)("common.add"))+" "+r(e(a)("nav.services")),1),n("div",ho,r(e(a)("services.addNew")),1)]),s(e(l),{icon:"cil-arrow-right",class:"quick-action-arrow"})]),n("button",{class:"quick-action-btn",onClick:o[15]||(o[15]=i=>t.$router.push("/staff?action=create"))},[n("div",po,[s(e(l),{icon:"cil-user"})]),n("div",fo,[n("div",ko,r(e(a)("common.add"))+" "+r(e(a)("nav.staff")),1),n("div",_o,r(e(a)("staff.addNew")),1)]),s(e(l),{icon:"cil-arrow-right",class:"quick-action-arrow"})])])]),_:1},8,["title"])])}}},Oo=De(yo,[["__scopeId","data-v-ccb523b1"]]);export{Oo as default};
