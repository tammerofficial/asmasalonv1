import{f as o,g as i,w as V,i as M,af as q,c as w,o as I,b as s,d as v,u as m,C as f,P as b,t as D,n as B}from"../chunk-vendor-vue-Bg1B1rts.js";import{a as R}from"../chunk-component-NotificationsBell-DEeZs3pc.js";import{_ as k}from"../chunk-component-Card-Ft_8dSMe.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-B7RCkv_6.js";import"../chunk-vendor-axios-B9ygI19o.js";const z={class:"display-header"},P={class:"header-content"},T={class:"logo-section"},W={class:"logo-icon-wrapper"},X={class:"header-info"},$={class:"date-time-group"},j={class:"display-date"},F={class:"display-time"},G={class:"display-content"},H={class:"display-section serving-section"},J={class:"customer-name-display"},K={key:1,class:"empty-serving"},Y={class:"empty-icon-large"},Z=3,ee=2e4,te={__name:"Queue",setup(se){const n=o([]),_=o(!1);o(!1);const u=o(!1),x=o(""),C=o("");o(null);const A=()=>{const t=new Date;x.value=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),C.value=t.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},L=async()=>{var t;_.value=!0;try{const e=await R.get("/queue",{params:{per_page:100}}),a=((t=e.data)==null?void 0:t.data)||e.data||{};n.value=a.items||[]}catch(e){console.error("Error loading tickets:",e),n.value=[]}finally{_.value=!1}},g=i(()=>n.value.find(t=>t.status==="serving")||null),c=i(()=>n.value.find(t=>t.status==="called")||null),d=i(()=>g.value||c.value||null);i(()=>{var e;const t=(e=g.value)==null?void 0:e.id;return n.value.filter(a=>a.status!=="completed"&&a.id!==t).sort((a,S)=>{const Q={serving:3,called:2,waiting:1},U=(Q[S.status]||0)-(Q[a.status]||0);return U!==0?U:new Date(a.created_at)-new Date(S.created_at)}).map((a,S)=>({...a,is_you:!1}))}),i(()=>n.value.filter(t=>t.status!=="completed").length),i(()=>n.value.filter(t=>t.status==="serving").length),i(()=>{const t=new Date().toISOString().split("T")[0];return n.value.filter(e=>e.status!=="completed"?!1:(e.completed_at?new Date(e.completed_at).toISOString().split("T")[0]:null)===t).length}),i(()=>{const t=new Date().toISOString().split("T")[0];return n.value.filter(e=>(e.created_at?new Date(e.created_at).toISOString().split("T")[0]:null)===t).length});let y=null,h=null,l=null,r=0;const N=(t=null)=>{const e=t||d.value;if(!e)return;const a=e.customer_name||"Customer";E(`العميل ${a}`)},E=t=>{if(!("speechSynthesis"in window)){console.warn("Text-to-speech is not supported in your browser");return}window.speechSynthesis.cancel();const e=new SpeechSynthesisUtterance(t);e.lang="ar-SA",e.rate=.9,e.pitch=1,e.volume=1,e.onend=()=>{u.value=!1},e.onerror=()=>{u.value=!1},u.value=!0,window.speechSynthesis.speak(e)},O=t=>{l&&(clearInterval(l),l=null),r=0,N(t),r++,l=setInterval(()=>{r<Z?(N(t),r++):(clearInterval(l),l=null,r=0)},ee)},p=()=>{l&&(clearInterval(l),l=null),r=0,window.speechSynthesis.cancel(),u.value=!1};return V(c,(t,e)=>{t&&t.id!==(e==null?void 0:e.id)&&t.status==="called"?(p(),setTimeout(()=>{O(t)},500)):!t&&e&&p()},{immediate:!1}),V(g,(t,e)=>{t&&t.id!==(e==null?void 0:e.id)?p():!t&&e&&c.value&&c.value.status==="called"&&setTimeout(()=>{O(c.value)},500)},{immediate:!1}),M(()=>{A(),y=setInterval(A,1e3),L(),h=setInterval(L,3e3)}),q(()=>{y&&clearInterval(y),h&&clearInterval(h),p()}),(t,e)=>(I(),w("div",{class:B(["queue-display",{"is-loading":_.value}])},[s("div",z,[s("div",P,[s("div",T,[s("div",W,[v(m(f),{icon:"cil-list",class:"logo-icon"})]),e[0]||(e[0]=s("div",{class:"title-group"},[s("h1",{class:"display-title"},"Queue Display"),s("p",{class:"display-subtitle"},"Real-time Queue Management System")],-1))]),s("div",X,[s("div",$,[s("div",j,[v(m(f),{icon:"cil-calendar",class:"info-icon"}),b(" "+D(C.value),1)]),s("div",F,[v(m(f),{icon:"cil-clock",class:"info-icon"}),b(" "+D(x.value),1)])])])])]),s("div",G,[s("div",H,[d.value?(I(),w("div",{key:0,class:B(["serving-card-simple",{"next-customer":d.value.status==="called"}])},[s("div",J,D(d.value.customer_name||"Customer"),1)],2)):(I(),w("div",K,[s("div",Y,[v(m(f),{icon:"cil-pause"})]),e[1]||(e[1]=s("p",{class:"empty-text"},"No service currently",-1)),e[2]||(e[2]=s("p",{class:"empty-subtext"},"Waiting for next customer",-1))]))])])],2))}},ue=k(te,[["__scopeId","data-v-65f45d0e"]]);export{ue as default};
