import{f as u,w as P,g as Q,i as X,af as $,c as m,o as f,b as t,d as l,u as c,C as i,P as D,t as r,F as j,k as G,n as y,Q as H,a as B}from"../chunk-vendor-vue-9XB69CcG.js";import{a as J}from"../chunk-component-NotificationsBell-PEptZHCy.js";import{_ as K}from"../chunk-component-Card-CPZTx4Dn.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-BpPt1UDF.js";import"../chunk-vendor-axios-B9ygI19o.js";const Y={class:"display-header"},Z={class:"header-content"},ee={class:"logo-section"},te={class:"logo-icon-wrapper"},se={class:"header-info"},ae={class:"date-time-group"},ne={class:"display-date"},oe={class:"display-time"},le=["title"],ce={class:"display-content"},ie={key:0,class:"calls-grid"},re={class:"card-header"},de={class:"staff-info"},ue={class:"staff-name"},me={class:"card-body"},fe={class:"customer-section"},ve={class:"customer-name"},pe={key:0,class:"services-section"},_e={class:"services-list"},ge={class:"service-badge"},he={key:1,class:"ticket-info"},ye={class:"card-footer"},be={key:1,class:"empty-state"},ke={class:"empty-icon-large"},Ce=3,we={__name:"WorkerCalls",setup(Ee){const g=u([]),v=u(new Map),S=u(new Set),b=u(!1),M=u(""),I=u(""),h=u(!1);let d=null,k=0,C=null,w=null;const x=()=>{const e=new Date;M.value=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),I.value=e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},N=()=>new Date().toISOString().slice(0,10),L=()=>{try{const e=new Audio("/wp-content/plugins/asmasalonv1/assets/sounds/ding.mp3");e.volume=.5,e.play().catch(a=>{console.log("Audio play failed (may need user interaction):",a)})}catch(e){console.log("Audio not available:",e)}},E=async()=>{var a,s;d&&d.abort(),d=new AbortController;const e=setTimeout(()=>d.abort(),5e3);b.value=!0;try{const n=await J.get("/worker-calls",{params:{status:"active",per_page:50,date:N()},signal:d.signal,noCache:!0});clearTimeout(e),k=0;const p=((s=(a=n.data)==null?void 0:a.data)==null?void 0:s.items)||[],W=new Set(p.map(_=>_.id)),q=S.value;p.find(_=>!q.has(_.id))&&L(),p.forEach(_=>{const A=g.value.find(O=>O.id===_.id);A&&A.status==="pending"&&_.status==="staff_called"&&L()}),g.value=p,S.value=W}catch(n){clearTimeout(e),n.name!=="AbortError"&&k<Ce?(k++,setTimeout(E,Math.pow(2,k)*1e3)):console.error("Error loading worker calls:",n)}finally{b.value=!1}};P(g,e=>{e.forEach(a=>{if(["accepted","serving"].includes(a.status)&&!v.value.has(a.id)){const s=setTimeout(()=>{v.value.delete(a.id)},8e3);v.value.set(a.id,s)}})},{deep:!0});const F=Q(()=>{const e=[...g.value];return v.value.forEach((a,s)=>{if(!e.find(n=>n.id===s)){const n=g.value.find(p=>p.id===s);n&&e.push({...n,isSticky:!0})}}),e}),z=e=>({pending:"status-pending",staff_called:"status-staff-called",customer_called:"status-customer-called",accepted:"status-accepted",serving:"status-serving"})[e]||"status-default",V=e=>({pending:"#f59e0b",staff_called:"#3b82f6",customer_called:"#10b981",accepted:"#8b5cf6",serving:"#8b5cf6"})[e]||"#BBA07A",R=e=>({pending:"cil-clock",staff_called:"cil-bell",customer_called:"cil-user",accepted:"cil-check-circle",serving:"cil-check-circle"})[e]||"cil-info",U=e=>({pending:"في الانتظار",staff_called:"تم استدعاء الموظفة",customer_called:"تم نداء العميلة",accepted:"قيد التنفيذ",serving:"قيد التنفيذ"})[e]||e,T=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{h.value=!1}):document.documentElement.requestFullscreen().then(()=>{h.value=!0}).catch(e=>{console.log("Error attempting to enable fullscreen:",e)})},o=()=>{h.value=!!document.fullscreenElement};return X(()=>{x(),w=setInterval(x,1e3),E(),C=setInterval(()=>{b.value||E()},3e3),document.addEventListener("fullscreenchange",o),document.addEventListener("webkitfullscreenchange",o),document.addEventListener("mozfullscreenchange",o),document.addEventListener("MSFullscreenChange",o),document.addEventListener("keydown",e=>{e.key==="F11"&&(e.preventDefault(),T())})}),$(()=>{w&&clearInterval(w),C&&clearInterval(C),d&&d.abort(),v.value.forEach(e=>clearTimeout(e)),v.value.clear(),document.removeEventListener("fullscreenchange",o),document.removeEventListener("webkitfullscreenchange",o),document.removeEventListener("mozfullscreenchange",o),document.removeEventListener("MSFullscreenChange",o)}),(e,a)=>(f(),m("div",{class:y(["worker-calls-display",{"is-loading":b.value}])},[t("div",Y,[t("div",Z,[t("div",ee,[t("div",te,[l(c(i),{icon:"cil-bell",class:"logo-icon"})]),a[0]||(a[0]=t("div",{class:"title-group"},[t("h1",{class:"display-title"},"Worker Calls Display"),t("p",{class:"display-subtitle"},"Real-time Staff Call Management System")],-1))]),t("div",se,[t("div",ae,[t("div",ne,[l(c(i),{icon:"cil-calendar",class:"info-icon"}),D(" "+r(I.value),1)]),t("div",oe,[l(c(i),{icon:"cil-clock",class:"info-icon"}),D(" "+r(M.value),1)])]),t("button",{class:"fullscreen-btn",onClick:T,title:h.value?"Exit Fullscreen":"Enter Fullscreen"},[l(c(i),{icon:h.value?"cil-fullscreen-exit":"cil-fullscreen"},null,8,["icon"])],8,le)])])]),t("div",ce,[F.value.length?(f(),m("div",ie,[(f(!0),m(j,null,G(F.value,s=>(f(),m("div",{key:s.id,class:y(["call-card",z(s.status)]),style:H({borderLeft:`8px solid ${V(s.status)}`})},[t("div",re,[t("div",de,[t("h2",ue,r(s.staff_name||"Staff"),1),t("div",{class:y(["chair-badge",{"no-chair":!s.staff_chair_number||s.staff_chair_number===0}])},[l(c(i),{icon:"cil-chair",class:"chair-icon"}),t("span",null,"كرسي: "+r(!s.staff_chair_number||s.staff_chair_number===0?"غير محدد":s.staff_chair_number),1)],2)]),t("div",{class:y(["status-icon-wrapper",s.status])},[l(c(i),{icon:R(s.status),class:"status-icon"},null,8,["icon"])],2)]),t("div",me,[t("div",fe,[a[1]||(a[1]=t("p",{class:"label"},"العميلة:",-1)),t("h3",ve,r(s.customer_name||"Customer"),1)]),s.service_name?(f(),m("div",pe,[a[2]||(a[2]=t("p",{class:"label"},"الخدمات:",-1)),t("div",_e,[t("span",ge,r(s.service_name),1)])])):B("",!0),s.ticket_number?(f(),m("div",he,[l(c(i),{icon:"cil-ticket",class:"ticket-icon"}),t("span",null,r(s.ticket_number),1)])):B("",!0)]),t("div",ye,[t("span",{class:y(["status-badge",s.status])},r(U(s.status)),3)])],6))),128))])):(f(),m("div",be,[t("div",ke,[l(c(i),{icon:"cil-bell"})]),a[3]||(a[3]=t("p",{class:"empty-text"},"لا توجد نداءات حالياً",-1)),a[4]||(a[4]=t("p",{class:"empty-subtext"},"في انتظار نداءات جديدة",-1))]))])],2))}},De=K(we,[["__scopeId","data-v-f3c68bde"]]);export{De as default};
