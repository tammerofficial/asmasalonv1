import{f as y,j as Y,c as _,o as r,b as t,d as s,t as a,u as e,w as n,Y as T,s as q,a as F,x as h,C as d,$ as J,h as K,F as S,g as j,ae as O,a0 as Q,l as X,P as m,a2 as V,aa as Z,ab as ee,a3 as U,a4 as N,n as te,a5 as se,a6 as ae,a7 as oe,a8 as le}from"../chunk-vendor-vue-VAxhpvd9.js";import{u as ne,a as w}from"../chunk-component-NotificationsBell-CTLJWkW4.js";import{u as ce}from"../chunk-view-AppleWallet/Simulator-BwS6bEkK.js";import{H as ie}from"../chunk-component-HelpSection-NeetTt3d.js";import{_ as de}from"../chunk-component-Card-DPM96EeB.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-pinia-CjQxP09R.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-PageHeader-CMYNL4hu.js";const re={class:"loyalty-page p-4"},ue={class:"pos-header-top d-flex justify-content-between align-items-center mb-4"},_e={class:"header-left d-flex align-items-center gap-3"},me={class:"mb-0 fw-bold text-primary"},pe={class:"header-right d-flex gap-2"},ve={class:"nano-stats-bar mb-4"},ye={class:"stat-card-nano"},he={class:"stat-icon-bg points-issued"},fe={class:"stat-info"},ge={class:"stat-value"},be={class:"stat-label"},Ce={class:"stat-card-nano"},we={class:"stat-icon-bg points-redeemed"},xe={class:"stat-info"},ke={class:"stat-value text-warning"},Te={class:"stat-label"},Ve={class:"stat-card-nano"},Me={class:"stat-icon-bg points-active"},Ie={class:"stat-info"},Re={class:"stat-value text-success"},Be={class:"stat-label"},Fe={class:"stat-card-nano"},Se={class:"stat-icon-bg members-active"},je={class:"stat-info"},Ue={class:"stat-value text-info"},Ne={class:"stat-label"},$e={class:"nano-filters-bar p-3 bg-secondary rounded-4 mb-4 shadow-sm border border-light"},Pe={value:""},ze={value:"earned"},He={value:"redeemed"},Ae={value:"adjustment"},De={class:"nano-panel"},Ge={key:0,class:"text-center p-5"},Le={key:1,class:"text-center p-5 text-muted opacity-50"},We={key:2},Ee={class:"nano-table-container"},Ye={class:"nano-table w-100"},qe={class:"text-start"},Je={class:"text-center"},Ke={class:"text-start"},Oe={class:"fw-bold"},Qe={class:"small text-muted"},Xe={key:0,class:"d-flex justify-content-center mt-5"},Ze={class:"mb-3"},et={class:"form-label fw-bold"},tt={value:null},st=["value"],at={class:"mb-3"},ot={class:"form-label fw-bold"},lt={__name:"Index",setup(nt){const{t:l}=ne(),M=ce(),I=X(),x=y(!1),k=y([]),R=y([]),f=y({total_points_issued:0,total_points_redeemed:0,active_points:0,active_customers:0}),p=y({current_page:1,per_page:15,total:0,total_pages:0}),g=y({type:"",customer_search:""}),C=y(!1),v=y({customer_id:null,points:0}),b=async()=>{var i,c;x.value=!0;try{const o=await w.get("/loyalty/transactions",{params:{page:p.value.current_page,per_page:p.value.per_page,...g.value}}),u=((i=o.data)==null?void 0:i.data)||o.data;k.value=u.items||[],p.value=u.pagination||p.value;const B=await w.get("/loyalty/stats");f.value=((c=B.data)==null?void 0:c.data)||B.data||f.value}catch(o){console.error("Failed to load loyalty data:",o)}finally{x.value=!1}},$=async()=>{var c,o,u;const i=await w.get("/customers",{params:{per_page:1e3}});R.value=((o=(c=i.data)==null?void 0:c.data)==null?void 0:o.items)||((u=i.data)==null?void 0:u.items)||[]},P=()=>{clearTimeout(window.searchTimer),window.searchTimer=setTimeout(b,500)},z=()=>{g.value={type:"",customer_search:""},b()},H=i=>{p.value.current_page=i,b()},A=i=>{switch(i){case"earned":return"success";case"redeemed":return"warning";case"adjustment":return"info";case"expired":return"danger";default:return"secondary"}},D=()=>{v.value={customer_id:null,points:0},C.value=!0},G=async()=>{try{await w.post("/loyalty/redeem",v.value),M.success(l("loyalty.redeemedSuccessfully")),C.value=!1,b()}catch{M.error(l("loyalty.failedToRedeem"))}},L=i=>I.push(`/customers/${i}`),W=()=>I.push("/settings/loyalty"),E=()=>{};return Y(()=>{b(),$()}),(i,c)=>(r(),_("div",re,[t("div",ue,[t("div",_e,[t("h2",me,a(e(l)("loyalty.title")),1),s(e(T),{color:"gold",shape:"rounded-pill",class:"px-3 py-2 fw-bold text-dark"},{default:n(()=>[s(e(d),{icon:"cil-gift",class:"me-1"}),m(" "+a(e(l)("loyalty.rewards")),1)]),_:1})]),t("div",pe,[i.selectedCustomerId?(r(),q(e(h),{key:0,color:"success",class:"nano-btn-success",onClick:E},{default:n(()=>[s(e(d),{icon:"cil-wallet",class:"me-2"}),m(a(e(l)("loyalty.addToAppleWallet")),1)]),_:1})):F("",!0),s(e(h),{color:"primary",class:"nano-btn",onClick:D},{default:n(()=>[s(e(d),{icon:"cil-gift",class:"me-2"}),m(a(e(l)("loyalty.redeem")),1)]),_:1}),s(e(h),{color:"secondary",variant:"ghost",onClick:W},{default:n(()=>[s(e(d),{icon:"cil-settings"})]),_:1})])]),t("div",ve,[t("div",ye,[t("div",he,[s(e(d),{icon:"cil-star"})]),t("div",fe,[t("div",ge,a(f.value.total_points_issued||0),1),t("div",be,a(e(l)("loyalty.pointsIssued")),1)])]),t("div",Ce,[t("div",we,[s(e(d),{icon:"cil-gift"})]),t("div",xe,[t("div",ke,a(f.value.total_points_redeemed||0),1),t("div",Te,a(e(l)("loyalty.pointsRedeemed")),1)])]),t("div",Ve,[t("div",Me,[s(e(d),{icon:"cil-check-circle"})]),t("div",Ie,[t("div",Re,a(f.value.active_points||0),1),t("div",Be,a(e(l)("loyalty.activeBalance")),1)])]),t("div",Fe,[t("div",Se,[s(e(d),{icon:"cil-user"})]),t("div",je,[t("div",Ue,a(f.value.active_customers||0),1),t("div",Ne,a(e(l)("loyalty.members")),1)])])]),t("div",$e,[s(e(J),{class:"g-3 align-items-center"},{default:n(()=>[s(e(V),{md:"4"},{default:n(()=>[s(e(Z),null,{default:n(()=>[s(e(ee),{class:"bg-transparent border-0"},{default:n(()=>[s(e(d),{icon:"cil-magnifying-glass"})]),_:1}),s(e(U),{modelValue:g.value.customer_search,"onUpdate:modelValue":c[0]||(c[0]=o=>g.value.customer_search=o),placeholder:e(l)("loyalty.searchCustomer"),onInput:P,class:"border-0 bg-transparent"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),s(e(V),{md:"3"},{default:n(()=>[s(e(N),{modelValue:g.value.type,"onUpdate:modelValue":c[1]||(c[1]=o=>g.value.type=o),onChange:b,class:"rounded-3"},{default:n(()=>[t("option",Pe,a(e(l)("loyalty.allTransactions")),1),t("option",ze,a(e(l)("loyalty.earned")),1),t("option",He,a(e(l)("loyalty.redeemed")),1),t("option",Ae,a(e(l)("loyalty.adjustment")),1)]),_:1},8,["modelValue"])]),_:1}),s(e(V),{md:"3"},{default:n(()=>[s(e(h),{color:"primary",variant:"ghost",class:"w-100",onClick:z},{default:n(()=>[s(e(d),{icon:"cil-filter-x",class:"me-1"}),m(a(e(l)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),t("div",De,[x.value?(r(),_("div",Ge,[s(e(K),{color:"primary"})])):k.value.length===0?(r(),_("div",Le,[s(e(d),{icon:"cil-gift",size:"xl",class:"mb-3"}),t("p",null,a(e(l)("loyalty.noTransactions")),1)])):(r(),_("div",We,[t("div",Ee,[t("table",Ye,[t("thead",null,[t("tr",null,[t("th",qe,a(e(l)("common.customer")),1),t("th",null,a(e(l)("common.type")),1),t("th",Je,a(e(l)("loyalty.points")),1),t("th",null,a(e(l)("orders.orderNumber")),1),t("th",null,a(e(l)("common.date")),1),t("th",null,a(e(l)("common.actions")),1)])]),t("tbody",null,[(r(!0),_(S,null,j(k.value,o=>(r(),_("tr",{key:o.id,class:"nano-table-row"},[t("td",Ke,[t("div",Oe,a(o.customer_name||e(l)("common.anonymous")),1),t("div",Qe,a(o.customer_phone),1)]),t("td",null,[s(e(T),{color:A(o.type),shape:"rounded-pill",class:"px-3"},{default:n(()=>{var u;return[m(a((u=o.type)==null?void 0:u.toUpperCase()),1)]}),_:2},1032,["color"])]),t("td",{class:te(["text-center fw-bold fs-5",o.points>0?"text-success":"text-danger"])},a(o.points>0?"+":"")+a(o.points),3),t("td",null,[s(e(T),{color:"secondary",variant:"outline"},{default:n(()=>[m("#"+a(o.order_id||"â€”"),1)]),_:2},1024)]),t("td",null,a(new Date(o.created_at).toLocaleString()),1),t("td",null,[s(e(h),{size:"sm",color:"primary",variant:"ghost",onClick:u=>L(o.customer_id)},{default:n(()=>[s(e(d),{icon:"cil-external-link"})]),_:1},8,["onClick"])])]))),128))])])]),p.value.total_pages>1?(r(),_("div",Xe,[s(e(O),{pages:p.value.total_pages,"active-page":p.value.current_page,"onUpdate:activePage":H},null,8,["pages","active-page"])])):F("",!0)]))]),s(e(Q),{visible:C.value,onClose:c[5]||(c[5]=o=>C.value=!1),alignment:"center"},{default:n(()=>[s(e(se),null,{default:n(()=>[s(e(ae),null,{default:n(()=>[s(e(d),{icon:"cil-gift",class:"me-2"}),m(a(e(l)("loyalty.redeem")),1)]),_:1})]),_:1}),s(e(oe),{class:"p-4"},{default:n(()=>[t("div",Ze,[t("label",et,a(e(l)("loyalty.selectCustomer")),1),s(e(N),{modelValue:v.value.customer_id,"onUpdate:modelValue":c[2]||(c[2]=o=>v.value.customer_id=o)},{default:n(()=>[t("option",tt,a(e(l)("loyalty.chooseMember")),1),(r(!0),_(S,null,j(R.value,o=>(r(),_("option",{key:o.id,value:o.id},a(o.name)+" ("+a(o.points)+" "+a(e(l)("loyalty.pts"))+")",9,st))),128))]),_:1},8,["modelValue"])]),t("div",at,[t("label",ot,a(e(l)("loyalty.pointsToRedeem")),1),s(e(U),{type:"number",modelValue:v.value.points,"onUpdate:modelValue":c[3]||(c[3]=o=>v.value.points=o),modelModifiers:{number:!0}},null,8,["modelValue"])])]),_:1}),s(e(le),null,{default:n(()=>[s(e(h),{color:"secondary",variant:"ghost",onClick:c[4]||(c[4]=o=>C.value=!1)},{default:n(()=>[m(a(e(l)("common.cancel")),1)]),_:1}),s(e(h),{color:"primary",class:"nano-btn",onClick:G,disabled:!v.value.customer_id||!v.value.points},{default:n(()=>[m(a(e(l)("loyalty.processRedemption")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),s(ie,{"page-key":"loyalty"})]))}},yt=de(lt,[["__scopeId","data-v-3a11370a"]]);export{yt as default};
