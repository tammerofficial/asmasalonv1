import{f as p,g as ae,i as oe,c as _,o as m,d as a,b as n,p as l,u as e,a5 as le,h as se,v as h,O as y,C as u,t as s,Y as E,Z as b,_ as F,a0 as re,a1 as ne,$ as j,q as U,a2 as ie,F as L,k as O,a as z,X as ce,n as G,a4 as de,a6 as ue,a7 as me,a8 as pe,a9 as _e}from"../chunk-vendor-vue-DxcSX1Jd.js";import{u as ye,a as V}from"../chunk-component-NotificationsBell-eCwis6PW.js";import{a as ve}from"../chunk-view-Bookings/BookingAppearance-CtCwBfZ1.js";import{P as ge}from"../chunk-component-PageHeader-BsA6C9en.js";import{S as w}from"../chunk-component-StatCard-AHk13FwB.js";import{_ as fe,C as H}from"../chunk-component-Card-BWbCGpFM.js";import{E as he}from"../chunk-component-EmptyState-B78c8qVh.js";import{L as be}from"../chunk-component-LoadingSpinner-PYO1Yq7-.js";import"../chunk-vendor-BwxB3d-x.js";import"../chunk-vendor-charts-CNHMDSF7.js";import"../chunk-vendor-pinia-DRDRCEXO.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-DOq58Wm8.js";import"../chunk-view-Bookings/BookingFormPreview-BJuYIHYB.js";const Ce={class:"loyalty-page"},xe={class:"stats-grid"},ke={value:""},Ve={value:"earned"},we={value:"redeemed"},Se={value:"adjustment"},Te={value:"expired"},Ie={key:2,class:"table-wrapper"},Me={class:"table-header-row"},je={class:"th-date"},Ne={class:"th-customer"},De={class:"th-type"},Pe={class:"th-points"},Re={class:"th-desc"},Be={class:"td-id"},Ee={class:"tx-id-badge"},Fe={class:"td-date"},Ue={class:"td-customer"},Le={class:"customer-cell"},Oe={class:"customer-name"},ze=["href"],Ge={class:"td-type"},He={class:"td-points"},$e={class:"td-desc"},qe={class:"transaction-description"},Ae={key:0,class:"d-flex justify-content-between align-items-center"},Xe={class:"text-muted"},Ye={value:""},Ze=["value"],Je={__name:"Index",setup(Ke){const{t}=ye(),C=ve(),$=se(),k=p([]),v=p({}),S=p(!1),T=p(!1),x=p(!1),I=p([]),d=p({customer_id:"",points:1,description:""}),g=p({type:"",customer_search:""}),c=p({current_page:1,per_page:20,total:0,total_pages:0}),q=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",A=i=>({earned:t("loyalty.earned"),redeemed:t("loyalty.redeemed"),adjustment:t("loyalty.adjustment"),expired:t("loyalty.expired")})[i]||i,X=i=>({earned:"cil-plus",redeemed:"cil-minus",adjustment:"cil-pen",expired:"cil-x-circle"})[i]||"cil-info",f=async()=>{var i;S.value=!0;try{const r={page:c.value.current_page,per_page:c.value.per_page,...g.value};Object.keys(r).forEach(B=>{r[B]===""&&delete r[B]});const o=await V.get("/loyalty/transactions",{params:r,noCache:!0}),R=((i=o.data)==null?void 0:i.data)||o.data||{};k.value=R.items||[],c.value=R.pagination||c.value}catch(r){console.error("Error loading transactions:",r),C.error(t("common.errorLoading")),k.value=[],c.value={current_page:1,per_page:20,total:0,total_pages:0}}finally{S.value=!1}},N=async()=>{var i;try{const r=await V.get("/loyalty/stats",{noCache:!0});v.value=((i=r.data)==null?void 0:i.data)||{}}catch(r){console.error("Error loading stats:",r),v.value={}}},Y=async()=>{var i;try{const r=await V.get("/customers",{params:{per_page:200},noCache:!0}),o=((i=r.data)==null?void 0:i.data)||r.data||{};I.value=o.items||o||[]}catch{I.value=[]}},Z=ae(()=>I.value||[]),J=i=>{c.value.current_page=i,f()};let D;const K=()=>{clearTimeout(D),D=setTimeout(()=>{c.value.current_page=1,f()},500)},Q=()=>{g.value={type:"",customer_search:""},c.value.current_page=1,f()},P=()=>{T.value=!0,d.value={customer_id:"",points:1,description:""}},M=()=>{T.value=!1,x.value=!1},W=async()=>{if(!d.value.customer_id){C.error(t("loyalty.selectCustomer")||"Select customer");return}if(Number(d.value.points||0)<=0){C.error(t("loyalty.invalidPoints")||"Invalid points");return}x.value=!0;try{await V.post("/loyalty/redeem",{customer_id:Number(d.value.customer_id),points:Number(d.value.points||0),reference_type:"manual",reference_id:null,description:d.value.description||""}),C.success(t("loyalty.redeemedSuccess")||"Redeemed successfully"),M(),await Promise.all([N(),f()])}catch(i){console.error("Redeem points error:",i),C.error(t("loyalty.redeemError")||t("common.errorLoading"))}finally{x.value=!1}},ee=()=>{$.push("/programs/settings")},te=i=>{const r=String(i||"");return r==="earned"?"badge-earned":r==="redeemed"?"badge-redeemed":r==="adjustment"?"badge-adjustment":"badge-expired"};return oe(()=>{f(),N(),Y()}),(i,r)=>(m(),_("div",Ce,[a(ge,{title:e(t)("loyalty.title"),subtitle:e(t)("loyalty.subtitle")||e(t)("loyalty.title")+" - "+e(t)("dashboard.subtitle")},{icon:l(()=>[a(e(u),{icon:"cil-gift"})]),actions:l(()=>[a(e(h),{color:"secondary",variant:"outline",class:"me-2 settings-btn",onClick:ee},{default:l(()=>[a(e(u),{icon:"cil-settings",class:"me-2"}),y(" "+s(e(t)("nav.programsSettings")),1)]),_:1}),a(e(h),{color:"primary",class:"btn-primary-custom",onClick:P},{default:l(()=>[a(e(u),{icon:"cil-gift",class:"me-2"}),y(" "+s(e(t)("loyalty.redeem")),1)]),_:1})]),_:1},8,["title","subtitle"]),n("div",xe,[a(w,{label:e(t)("loyalty.totalIssued"),value:v.value.total_points_issued||0,"badge-variant":"info",color:"gold"},{icon:l(()=>[a(e(u),{icon:"cil-star"})]),_:1},8,["label","value"]),a(w,{label:e(t)("loyalty.totalRedeemed"),value:v.value.total_points_redeemed||0,"badge-variant":"warning",color:"gold"},{icon:l(()=>[a(e(u),{icon:"cil-gift"})]),_:1},8,["label","value"]),a(w,{label:e(t)("loyalty.points"),value:v.value.active_points||0,"badge-variant":"success",color:"gold"},{icon:l(()=>[a(e(u),{icon:"cil-check-circle"})]),_:1},8,["label","value"]),a(w,{label:e(t)("loyalty.activeCustomers"),value:v.value.active_customers||0,"badge-variant":"info",color:"gold"},{icon:l(()=>[a(e(u),{icon:"cil-user"})]),_:1},8,["label","value"])]),a(H,{title:e(t)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:l(()=>[a(e(E),{class:"g-3"},{default:l(()=>[a(e(b),{md:4},{default:l(()=>[a(e(F),{modelValue:g.value.type,"onUpdate:modelValue":r[0]||(r[0]=o=>g.value.type=o),label:e(t)("common.status"),onChange:f},{default:l(()=>[n("option",ke,s(e(t)("common.all")||"All"),1),n("option",Ve,s(e(t)("loyalty.earned")),1),n("option",we,s(e(t)("loyalty.redeemed")),1),n("option",Se,s(e(t)("loyalty.adjustment")),1),n("option",Te,s(e(t)("loyalty.expired")),1)]),_:1},8,["modelValue","label"])]),_:1}),a(e(b),{md:6},{default:l(()=>[a(e(re),{class:"search-input-group"},{default:l(()=>[a(e(ne),{class:"search-icon-wrapper"},{default:l(()=>[a(e(u),{icon:"cil-magnifying-glass"})]),_:1}),a(e(j),{modelValue:g.value.customer_search,"onUpdate:modelValue":r[1]||(r[1]=o=>g.value.customer_search=o),placeholder:e(t)("loyalty.searchCustomer"),onInput:K,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(e(b),{md:2},{default:l(()=>[a(e(h),{color:"secondary",variant:"outline",onClick:Q,class:"w-100 reset-btn"},{default:l(()=>[a(e(u),{icon:"cil-reload",class:"me-1"}),y(" "+s(e(t)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),a(H,{title:e(t)("loyalty.title"),icon:"cil-list"},{footer:l(()=>[c.value.total_pages>1?(m(),_("div",Ae,[n("div",Xe,s(e(t)("common.view"))+" "+s((c.value.current_page-1)*c.value.per_page+1)+" "+s(e(t)("common.to"))+" "+s(Math.min(c.value.current_page*c.value.per_page,c.value.total))+" "+s(e(t)("common.of"))+" "+s(c.value.total),1),a(e(de),{pages:c.value.total_pages,"active-page":c.value.current_page,"onUpdate:activePage":J},null,8,["pages","active-page"])])):z("",!0)]),default:l(()=>[S.value?(m(),U(be,{key:0,text:e(t)("common.loading")},null,8,["text"])):k.value.length===0?(m(),U(he,{key:1,title:e(t)("common.noData"),description:e(t)("loyalty.noTransactions")||e(t)("loyalty.title")+" - "+e(t)("common.noData"),"icon-color":"gray"},{action:l(()=>[a(e(h),{color:"primary",class:"btn-primary-custom",onClick:P},{default:l(()=>[y(s(e(t)("loyalty.redeem")),1)]),_:1})]),_:1},8,["title","description"])):(m(),_("div",Ie,[a(e(ie),{hover:"",responsive:"",class:"table-modern loyalty-table"},{default:l(()=>[n("thead",null,[n("tr",Me,[r[5]||(r[5]=n("th",{class:"th-id"},"#",-1)),n("th",je,s(e(t)("common.date")),1),n("th",Ne,s(e(t)("loyalty.customer")),1),n("th",De,s(e(t)("loyalty.type")||"Type"),1),n("th",Pe,s(e(t)("loyalty.points")),1),n("th",Re,s(e(t)("loyalty.description")||"Description"),1)])]),n("tbody",null,[(m(!0),_(L,null,O(k.value,o=>(m(),_("tr",{key:o.id,class:"table-row loyalty-row"},[n("td",Be,[n("span",Ee,"#"+s(o.id),1)]),n("td",Fe,s(q(o.created_at)),1),n("td",Ue,[n("div",Le,[n("strong",Oe,s(o.customer_name||"—"),1),o.customer_phone?(m(),_("a",{key:0,class:"customer-phone",href:`tel:${o.customer_phone}`},s(o.customer_phone),9,ze)):z("",!0)])]),n("td",Ge,[a(e(ce),{class:G(["unified-badge",te(o.type)])},{default:l(()=>[a(e(u),{icon:X(o.type),class:"badge-icon"},null,8,["icon"]),n("span",null,s(A(o.type)),1)]),_:2},1032,["class"])]),n("td",He,[n("strong",{class:G(["points-amount",Number(o.points)>=0?"points-plus":"points-minus"])},s(Number(o.points)>=0?"+":"")+s(o.points),3)]),n("td",$e,[n("span",qe,s(o.description||"—"),1)])]))),128))])]),_:1})]))]),_:1},8,["title"]),a(e(le),{visible:T.value,onClose:M,size:"lg"},{default:l(()=>[a(e(ue),null,{default:l(()=>[a(e(me),null,{default:l(()=>[a(e(u),{icon:"cil-gift",class:"me-2"}),y(" "+s(e(t)("loyalty.redeem")),1)]),_:1})]),_:1}),a(e(pe),null,{default:l(()=>[a(e(E),{class:"g-3"},{default:l(()=>[a(e(b),{md:6},{default:l(()=>[a(e(F),{modelValue:d.value.customer_id,"onUpdate:modelValue":r[2]||(r[2]=o=>d.value.customer_id=o),label:e(t)("loyalty.customer"),class:"filter-select"},{default:l(()=>[n("option",Ye,s(e(t)("common.select")),1),(m(!0),_(L,null,O(Z.value,o=>(m(),_("option",{key:o.id,value:String(o.id)},s(o.name)+" ("+s(o.phone)+") ",9,Ze))),128))]),_:1},8,["modelValue","label"])]),_:1}),a(e(b),{md:6},{default:l(()=>[a(e(j),{modelValue:d.value.points,"onUpdate:modelValue":r[3]||(r[3]=o=>d.value.points=o),modelModifiers:{number:!0},type:"number",min:"1",step:"1",label:e(t)("loyalty.points"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(b),{md:12},{default:l(()=>[a(e(j),{modelValue:d.value.description,"onUpdate:modelValue":r[4]||(r[4]=o=>d.value.description=o),label:e(t)("loyalty.description")||"Description",class:"filter-input"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),a(e(_e),null,{default:l(()=>[a(e(h),{color:"secondary",onClick:M},{default:l(()=>[y(s(e(t)("common.cancel")),1)]),_:1}),a(e(h),{color:"primary",class:"btn-primary-custom",disabled:x.value,onClick:W},{default:l(()=>[a(e(u),{icon:"cil-check",class:"me-2"}),y(" "+s(x.value?e(t)("loyalty.processing")||e(t)("common.loading"):e(t)("loyalty.redeem")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"])]))}},mt=fe(Je,[["__scopeId","data-v-27446e73"]]);export{mt as default};
