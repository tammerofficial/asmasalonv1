import{f as y,j as O,c as m,o as c,b as e,d as a,t as l,u as t,w as n,Y as V,s as Y,a as F,x as f,C as d,$ as q,h as J,F as B,g as S,ae as K,a0 as Q,l as X,P as p,a2 as T,aa as Z,ab as ee,a3 as j,a4 as U,n as te,a5 as se,a6 as ae,a7 as oe,a8 as le}from"../chunk-vendor-vue-BKzcbwC-.js";import{u as ne,a as w}from"../chunk-component-NotificationsBell-BXS18BTB.js";import{u as ie}from"../chunk-view-AppleWallet/Simulator-DWRUiMHd.js";import{H as de}from"../chunk-component-HelpSection-B1vxldAY.js";import{_ as re}from"../chunk-component-Card-D7ddNvJz.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-pinia-CsGkbfJ3.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-PageHeader-CI_3JpQM.js";const ce={class:"loyalty-page p-4"},ue={class:"pos-header-top d-flex justify-content-between align-items-center mb-4"},me={class:"header-left d-flex align-items-center gap-3"},pe={class:"mb-0 fw-bold text-primary"},_e={class:"header-right d-flex gap-2"},ve={class:"nano-stats-bar mb-4"},ye={class:"stat-card-nano"},fe={class:"stat-icon-bg points-issued"},ge={class:"stat-info"},be={class:"stat-value"},he={class:"stat-card-nano"},Ce={class:"stat-icon-bg points-redeemed"},we={class:"stat-info"},xe={class:"stat-value text-warning"},ke={class:"stat-card-nano"},Ve={class:"stat-icon-bg points-active"},Te={class:"stat-info"},Me={class:"stat-value text-success"},Ie={class:"stat-card-nano"},Pe={class:"stat-icon-bg members-active"},Re={class:"stat-info"},Fe={class:"stat-value text-info"},Be={class:"nano-filters-bar p-3 bg-secondary rounded-4 mb-4 shadow-sm border border-light"},Se={value:""},je={value:"earned"},Ue={value:"redeemed"},Ae={value:"adjustment"},Ne={class:"nano-panel"},$e={key:0,class:"text-center p-5"},Le={key:1,class:"text-center p-5 text-muted opacity-50"},ze={key:2},De={class:"nano-table-container"},He={class:"nano-table w-100"},Ge={class:"text-start"},We={class:"fw-bold"},Ee={class:"small text-muted"},Oe={key:0,class:"d-flex justify-content-center mt-5"},Ye={class:"mb-3"},qe=["value"],Je={class:"mb-3"},Ke={__name:"Index",setup(Qe){const{t:r}=ne(),M=ie(),I=X(),x=y(!1),k=y([]),P=y([]),g=y({total_points_issued:0,total_points_redeemed:0,active_points:0,active_customers:0}),_=y({current_page:1,per_page:15,total:0,total_pages:0}),b=y({type:"",customer_search:""}),C=y(!1),v=y({customer_id:null,points:0}),h=async()=>{var i,s;x.value=!0;try{const o=await w.get("/loyalty/transactions",{params:{page:_.value.current_page,per_page:_.value.per_page,...b.value}}),u=((i=o.data)==null?void 0:i.data)||o.data;k.value=u.items||[],_.value=u.pagination||_.value;const R=await w.get("/loyalty/stats");g.value=((s=R.data)==null?void 0:s.data)||R.data||g.value}catch(o){console.error("Failed to load loyalty data:",o)}finally{x.value=!1}},A=async()=>{var s,o,u;const i=await w.get("/customers",{params:{per_page:1e3}});P.value=((o=(s=i.data)==null?void 0:s.data)==null?void 0:o.items)||((u=i.data)==null?void 0:u.items)||[]},N=()=>{clearTimeout(window.searchTimer),window.searchTimer=setTimeout(h,500)},$=()=>{b.value={type:"",customer_search:""},h()},L=i=>{_.value.current_page=i,h()},z=i=>{switch(i){case"earned":return"success";case"redeemed":return"warning";case"adjustment":return"info";case"expired":return"danger";default:return"secondary"}},D=()=>{v.value={customer_id:null,points:0},C.value=!0},H=async()=>{try{await w.post("/loyalty/redeem",v.value),M.success("Points redeemed successfully"),C.value=!1,h()}catch{M.error("Failed to redeem points")}},G=i=>I.push(`/customers/${i}`),W=()=>I.push("/settings/loyalty"),E=()=>{};return O(()=>{h(),A()}),(i,s)=>(c(),m("div",ce,[e("div",ue,[e("div",me,[e("h2",pe,l(t(r)("loyalty.title")),1),a(t(V),{color:"gold",shape:"rounded-pill",class:"px-3 py-2 fw-bold text-dark"},{default:n(()=>[a(t(d),{icon:"cil-gift",class:"me-1"}),s[6]||(s[6]=p(" Loyalty Rewards ",-1))]),_:1})]),e("div",_e,[i.selectedCustomerId?(c(),Y(t(f),{key:0,color:"success",class:"nano-btn-success",onClick:E},{default:n(()=>[a(t(d),{icon:"cil-wallet",class:"me-2"}),p(l(t(r)("loyalty.addToAppleWallet")),1)]),_:1})):F("",!0),a(t(f),{color:"primary",class:"nano-btn",onClick:D},{default:n(()=>[a(t(d),{icon:"cil-gift",class:"me-2"}),p(l(t(r)("loyalty.redeem")),1)]),_:1}),a(t(f),{color:"secondary",variant:"ghost",onClick:W},{default:n(()=>[a(t(d),{icon:"cil-settings"})]),_:1})])]),e("div",ve,[e("div",ye,[e("div",fe,[a(t(d),{icon:"cil-star"})]),e("div",ge,[e("div",be,l(g.value.total_points_issued||0),1),s[7]||(s[7]=e("div",{class:"stat-label"},"Points Issued",-1))])]),e("div",he,[e("div",Ce,[a(t(d),{icon:"cil-gift"})]),e("div",we,[e("div",xe,l(g.value.total_points_redeemed||0),1),s[8]||(s[8]=e("div",{class:"stat-label"},"Points Redeemed",-1))])]),e("div",ke,[e("div",Ve,[a(t(d),{icon:"cil-check-circle"})]),e("div",Te,[e("div",Me,l(g.value.active_points||0),1),s[9]||(s[9]=e("div",{class:"stat-label"},"Active Balance",-1))])]),e("div",Ie,[e("div",Pe,[a(t(d),{icon:"cil-user"})]),e("div",Re,[e("div",Fe,l(g.value.active_customers||0),1),s[10]||(s[10]=e("div",{class:"stat-label"},"Loyalty Members",-1))])])]),e("div",Be,[a(t(q),{class:"g-3 align-items-center"},{default:n(()=>[a(t(T),{md:"4"},{default:n(()=>[a(t(Z),null,{default:n(()=>[a(t(ee),{class:"bg-transparent border-0"},{default:n(()=>[a(t(d),{icon:"cil-magnifying-glass"})]),_:1}),a(t(j),{modelValue:b.value.customer_search,"onUpdate:modelValue":s[0]||(s[0]=o=>b.value.customer_search=o),placeholder:t(r)("loyalty.searchCustomer"),onInput:N,class:"border-0 bg-transparent"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(t(T),{md:"3"},{default:n(()=>[a(t(U),{modelValue:b.value.type,"onUpdate:modelValue":s[1]||(s[1]=o=>b.value.type=o),onChange:h,class:"rounded-3"},{default:n(()=>[e("option",Se,l(t(r)("common.all"))+" Transactions",1),e("option",je,l(t(r)("loyalty.earned")),1),e("option",Ue,l(t(r)("loyalty.redeemed")),1),e("option",Ae,l(t(r)("loyalty.adjustment")),1)]),_:1},8,["modelValue"])]),_:1}),a(t(T),{md:"3"},{default:n(()=>[a(t(f),{color:"primary",variant:"ghost",class:"w-100",onClick:$},{default:n(()=>[a(t(d),{icon:"cil-filter-x",class:"me-1"}),p(l(t(r)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),e("div",Ne,[x.value?(c(),m("div",$e,[a(t(J),{color:"primary"})])):k.value.length===0?(c(),m("div",Le,[a(t(d),{icon:"cil-gift",size:"xl",class:"mb-3"}),s[11]||(s[11]=e("p",null,"No loyalty transactions found",-1))])):(c(),m("div",ze,[e("div",De,[e("table",He,[s[12]||(s[12]=e("thead",null,[e("tr",null,[e("th",{class:"text-start"},"Customer"),e("th",null,"Type"),e("th",{class:"text-center"},"Points"),e("th",null,"Order #"),e("th",null,"Date"),e("th",null,"Actions")])],-1)),e("tbody",null,[(c(!0),m(B,null,S(k.value,o=>(c(),m("tr",{key:o.id,class:"nano-table-row"},[e("td",Ge,[e("div",We,l(o.customer_name||"Anonymous"),1),e("div",Ee,l(o.customer_phone),1)]),e("td",null,[a(t(V),{color:z(o.type),shape:"rounded-pill",class:"px-3"},{default:n(()=>{var u;return[p(l((u=o.type)==null?void 0:u.toUpperCase()),1)]}),_:2},1032,["color"])]),e("td",{class:te(["text-center fw-bold fs-5",o.points>0?"text-success":"text-danger"])},l(o.points>0?"+":"")+l(o.points),3),e("td",null,[a(t(V),{color:"secondary",variant:"outline"},{default:n(()=>[p("#"+l(o.order_id||"â€”"),1)]),_:2},1024)]),e("td",null,l(new Date(o.created_at).toLocaleString()),1),e("td",null,[a(t(f),{size:"sm",color:"primary",variant:"ghost",onClick:u=>G(o.customer_id)},{default:n(()=>[a(t(d),{icon:"cil-external-link"})]),_:1},8,["onClick"])])]))),128))])])]),_.value.total_pages>1?(c(),m("div",Oe,[a(t(K),{pages:_.value.total_pages,"active-page":_.value.current_page,"onUpdate:activePage":L},null,8,["pages","active-page"])])):F("",!0)]))]),a(t(Q),{visible:C.value,onClose:s[5]||(s[5]=o=>C.value=!1),alignment:"center"},{default:n(()=>[a(t(se),null,{default:n(()=>[a(t(ae),null,{default:n(()=>[a(t(d),{icon:"cil-gift",class:"me-2"}),p(l(t(r)("loyalty.redeem")),1)]),_:1})]),_:1}),a(t(oe),{class:"p-4"},{default:n(()=>[e("div",Ye,[s[14]||(s[14]=e("label",{class:"form-label fw-bold"},"Select Customer",-1)),a(t(U),{modelValue:v.value.customer_id,"onUpdate:modelValue":s[2]||(s[2]=o=>v.value.customer_id=o)},{default:n(()=>[s[13]||(s[13]=e("option",{value:null},"Choose a member...",-1)),(c(!0),m(B,null,S(P.value,o=>(c(),m("option",{key:o.id,value:o.id},l(o.name)+" ("+l(o.points)+" pts)",9,qe))),128))]),_:1},8,["modelValue"])]),e("div",Je,[s[15]||(s[15]=e("label",{class:"form-label fw-bold"},"Points to Redeem",-1)),a(t(j),{type:"number",modelValue:v.value.points,"onUpdate:modelValue":s[3]||(s[3]=o=>v.value.points=o),modelModifiers:{number:!0}},null,8,["modelValue"])])]),_:1}),a(t(le),null,{default:n(()=>[a(t(f),{color:"secondary",variant:"ghost",onClick:s[4]||(s[4]=o=>C.value=!1)},{default:n(()=>[p(l(t(r)("common.cancel")),1)]),_:1}),a(t(f),{color:"primary",class:"nano-btn",onClick:H,disabled:!v.value.customer_id||!v.value.points},{default:n(()=>[...s[16]||(s[16]=[p(" Process Redemption ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),a(de,{"page-key":"loyalty"})]))}},it=re(Ke,[["__scopeId","data-v-d994bcf7"]]);export{it as default};
