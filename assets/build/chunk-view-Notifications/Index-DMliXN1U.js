import{f as S,g as C,w as Z,i as ee,c as I,o as y,d as l,b as c,p as s,u as e,ak as te,h as ae,x as b,P as g,C as d,n as T,t as n,_ as oe,$ as L,a2 as ie,a3 as le,a1 as se,a0 as D,s as $,a as F,F as ne,k as ce,Y as q,X as re}from"../chunk-vendor-vue-9XB69CcG.js";import{u as ue,b as de}from"../chunk-component-NotificationsBell-B08mqdYR.js";import{P as me}from"../chunk-component-PageHeader-DOCn2Cgp.js";import{S as w}from"../chunk-component-StatCard-COK6V2Ia.js";import{_ as ve,C as U}from"../chunk-component-Card-CPZTx4Dn.js";import{L as pe}from"../chunk-component-LoadingSpinner-CoUPkIjP.js";import{E as fe}from"../chunk-component-EmptyState-EtsdDTwC.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-BpPt1UDF.js";import"../chunk-vendor-axios-B9ygI19o.js";const ye={class:"notifications-page"},_e={class:"stats-grid"},ge={value:"all"},he={value:"unread"},be={value:"read"},ke={value:"all"},Ce={value:"booking"},we={value:"order"},xe={value:"payment"},Se={value:"invoice"},$e={value:"system"},Ne={value:"low_stock"},Me={value:"membership_expiry"},Ve={class:"card-actions"},Ie={class:"result-count"},Le={key:2,class:"notifications-list"},Pe=["onClick"],Re={class:"notification-content"},Te={class:"notification-header"},Fe={class:"notification-title"},Je={class:"notification-time"},Oe={class:"notification-message"},Ae={class:"notification-meta"},Be={class:"pagination-footer"},ze={class:"pagination-info"},De={class:"pagination"},qe={class:"page-info"},Ue={__name:"Index",setup(Ee){const E=ae(),{t:i,currentLocale:J}=ue(),p=de(),_=S(""),v=S("all"),m=S("all"),u=S(1),k=S(20),x=C(()=>p.items),P=C(()=>p.unreadCount),N=C(()=>p.loading),h=C(()=>{let a=[...x.value];if(_.value.trim()){const t=_.value.toLowerCase();a=a.filter(o=>{const r=M(o,"title").toLowerCase(),f=M(o,"message").toLowerCase();return r.includes(t)||f.includes(t)})}return v.value==="unread"?a=a.filter(t=>!t.read_at):v.value==="read"&&(a=a.filter(t=>t.read_at)),m.value!=="all"&&(a=a.filter(t=>{try{return(t!=null&&t.data?JSON.parse(t.data):{}).type===m.value||t.type===m.value}catch{return!1}})),a}),O=C(()=>Math.ceil(h.value.length/k.value)),G=C(()=>{const a=(u.value-1)*k.value,t=a+k.value;return h.value.slice(a,t)});Z([_,v,m],()=>{u.value=1});const H=async()=>{await p.fetch({perPage:100,noCache:!0})},j=async()=>{await p.markAllRead()},K=async a=>{await p.markRead(a)},Q=async a=>{var t,o;a.read_at||await p.markRead(a.id);try{const r=a!=null&&a.data?JSON.parse(a.data):{},f=(t=r==null?void 0:r.action)==null?void 0:t.route,V=((o=r==null?void 0:r.action)==null?void 0:o.query)||null;f&&E.push({path:f,query:V||void 0})}catch{}},M=(a,t)=>{try{const o=a!=null&&a.data?JSON.parse(a.data):{};return((J.value||"ar")==="ar"?o==null?void 0:o[`${t}_ar`]:o==null?void 0:o[`${t}_en`])||(o==null?void 0:o[`${t}_ar`])||(o==null?void 0:o[`${t}_en`])||"—"}catch{return"—"}},W=a=>{if(!a)return"";try{const t=new Date(a.replace(" ","T")),r=new Date-t,f=Math.floor(r/6e4),V=Math.floor(r/36e5),z=Math.floor(r/864e5);return f<1?i("common.justNow"):f<60?`${f} ${i("common.minutesAgo")}`:V<24?`${V} ${i("common.hoursAgo")}`:z<7?`${z} ${i("common.daysAgo")}`:t.toLocaleString(J.value==="ar"?"ar-KW":"en-US",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return String(a)}},X=a=>{try{const o=(a!=null&&a.data?JSON.parse(a.data):{}).type||a.type||"";return{booking:"cil-calendar",order:"cil-cart",payment:"cil-money",invoice:"cil-file",system:"cil-bell",low_stock:"cil-warning",membership_expiry:"cil-credit-card"}[o]||"cil-bell"}catch{return"cil-bell"}},Y=a=>{try{const o=(a!=null&&a.data?JSON.parse(a.data):{}).type||a.type||"system";return i(`notifications.types.${o}`)||o}catch{return i("notifications.types.system")}},A=a=>{try{const o=(a!=null&&a.data?JSON.parse(a.data):{}).type||a.type||"system";return{booking:"info",order:"warning",payment:"success",invoice:"primary",system:"secondary",low_stock:"danger",membership_expiry:"warning"}[o]||"secondary"}catch{return"secondary"}},R=a=>x.value.filter(t=>{try{return(t!=null&&t.data?JSON.parse(t.data):{}).type===a||t.type===a}catch{return!1}}).length,B=()=>{_.value="",v.value="all",m.value="all",u.value=1};return ee(()=>{p.fetch({perPage:100,noCache:!0}),p.startPolling(2e4)}),(a,t)=>(y(),I("div",ye,[l(me,{title:e(i)("notifications.title"),subtitle:e(i)("notifications.subtitle")},{icon:s(()=>[l(e(d),{icon:"cil-bell"})]),actions:s(()=>[l(e(b),{color:"secondary",variant:"outline",onClick:H,class:"me-2",disabled:N.value},{default:s(()=>[l(e(d),{icon:"cil-reload",class:T(["me-2",{spinning:N.value}])},null,8,["class"]),g(" "+n(e(i)("common.refresh")),1)]),_:1},8,["disabled"]),l(e(b),{color:"primary",class:"btn-primary-custom",onClick:j,disabled:P.value===0||N.value},{default:s(()=>[l(e(d),{icon:"cil-check-circle",class:"me-2"}),g(" "+n(e(i)("notifications.markAllRead")),1)]),_:1},8,["disabled"])]),_:1},8,["title","subtitle"]),c("div",_e,[l(w,{label:e(i)("notifications.all"),value:x.value.length,"badge-variant":"info",color:"blue",clickable:!0,onClick:t[0]||(t[0]=()=>{v.value="all",u.value=1})},{icon:s(()=>[l(e(d),{icon:"cil-bell"})]),_:1},8,["label","value"]),l(w,{label:e(i)("notifications.unread"),value:P.value,"badge-variant":"warning",color:"gold",clickable:!0,onClick:t[1]||(t[1]=()=>{v.value="unread",u.value=1})},{icon:s(()=>[l(e(d),{icon:"cil-bell-exclamation"})]),_:1},8,["label","value"]),l(w,{label:e(i)("notifications.read"),value:x.value.length-P.value,"badge-variant":"success",color:"green",clickable:!0,onClick:t[2]||(t[2]=()=>{v.value="read",u.value=1})},{icon:s(()=>[l(e(d),{icon:"cil-check-circle"})]),_:1},8,["label","value"]),l(w,{label:e(i)("notifications.types.system"),value:R("system"),"badge-variant":"secondary",color:"gold",clickable:!0,onClick:t[3]||(t[3]=()=>{m.value="system",u.value=1})},{icon:s(()=>[l(e(d),{icon:"cil-settings"})]),_:1},8,["label","value"]),l(w,{label:e(i)("notifications.lowStock"),value:R("low_stock"),"badge-variant":"warning",color:"orange",clickable:!0,onClick:t[4]||(t[4]=()=>{m.value="low_stock",u.value=1})},{icon:s(()=>[l(e(d),{icon:"cil-warning"})]),_:1},8,["label","value"]),l(w,{label:e(i)("memberships.title"),value:R("membership_expiry"),"badge-variant":"warning",color:"gold",clickable:!0,onClick:t[5]||(t[5]=()=>{m.value="membership_expiry",u.value=1})},{icon:s(()=>[l(e(d),{icon:"cil-credit-card"})]),_:1},8,["label","value"])]),l(U,{title:e(i)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:s(()=>[l(e(oe),{class:"g-3"},{default:s(()=>[l(e(L),{md:4},{default:s(()=>[l(e(ie),{class:"search-input-group"},{default:s(()=>[l(e(le),{class:"search-icon-wrapper"},{default:s(()=>[l(e(d),{icon:"cil-magnifying-glass"})]),_:1}),l(e(se),{modelValue:_.value,"onUpdate:modelValue":t[6]||(t[6]=o=>_.value=o),placeholder:e(i)("common.search")+"...",class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),l(e(L),{md:3},{default:s(()=>[l(e(D),{modelValue:v.value,"onUpdate:modelValue":t[7]||(t[7]=o=>v.value=o),class:"filter-select"},{default:s(()=>[c("option",ge,n(e(i)("notifications.filter.all")),1),c("option",he,n(e(i)("notifications.filter.unread")),1),c("option",be,n(e(i)("notifications.filter.read")),1)]),_:1},8,["modelValue"])]),_:1}),l(e(L),{md:3},{default:s(()=>[l(e(D),{modelValue:m.value,"onUpdate:modelValue":t[8]||(t[8]=o=>m.value=o),class:"filter-select"},{default:s(()=>[c("option",ke,n(e(i)("notifications.types.all")),1),c("option",Ce,n(e(i)("notifications.types.booking")),1),c("option",we,n(e(i)("notifications.types.order")),1),c("option",xe,n(e(i)("notifications.types.payment")),1),c("option",Se,n(e(i)("notifications.types.invoice")),1),c("option",$e,n(e(i)("notifications.types.system")),1),c("option",Ne,n(e(i)("notifications.types.low_stock")),1),c("option",Me,n(e(i)("notifications.types.membership_expiry")),1)]),_:1},8,["modelValue"])]),_:1}),l(e(L),{md:2},{default:s(()=>[l(e(b),{color:"secondary",variant:"outline",onClick:B,class:"w-100 reset-btn"},{default:s(()=>[l(e(d),{icon:"cil-reload",class:"me-1"}),g(" "+n(e(i)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),l(U,{title:e(i)("notifications.all"),icon:"cil-list"},te({actions:s(()=>[c("div",Ve,[c("span",Ie,n(h.value.length)+" "+n(e(i)("common.results")||"results"),1)])]),default:s(()=>[N.value&&x.value.length===0?(y(),$(pe,{key:0,text:e(i)("common.loading")},null,8,["text"])):h.value.length===0?(y(),$(fe,{key:1,title:_.value||v.value!=="all"||m.value!=="all"?e(i)("common.noData"):e(i)("notifications.empty"),description:e(i)("notifications.noNotifications"),"icon-color":"gray"},{icon:s(()=>[l(e(d),{icon:"cil-bell",size:"3xl"})]),action:s(()=>[_.value||v.value!=="all"||m.value!=="all"?(y(),$(e(b),{key:0,color:"secondary",variant:"outline",onClick:B},{default:s(()=>[g(n(e(i)("common.reset")),1)]),_:1})):F("",!0)]),_:1},8,["title","description"])):(y(),I("div",Le,[(y(!0),I(ne,null,ce(G.value,o=>(y(),I("div",{key:o.id,class:T(["notification-item",{unread:!o.read_at}]),onClick:r=>Q(o)},[c("div",{class:T(["notification-icon",`notification-icon-${A(o)}`])},[l(e(d),{icon:X(o)},null,8,["icon"])],2),c("div",Re,[c("div",Te,[c("div",Fe,n(M(o,"title")),1),c("div",Je,n(W(o.created_at)),1)]),c("div",Oe,n(M(o,"message")),1),c("div",Ae,[o.read_at?F("",!0):(y(),$(e(q),{key:0,color:"primary",class:"unread-badge"},{default:s(()=>[g(n(e(i)("notifications.unread")),1)]),_:1})),l(e(q),{color:A(o),class:"type-badge"},{default:s(()=>[g(n(Y(o)),1)]),_:2},1032,["color"])])]),c("div",{class:"notification-actions",onClick:t[9]||(t[9]=re(()=>{},["stop"]))},[o.read_at?F("",!0):(y(),$(e(b),{key:0,color:"secondary",variant:"ghost",size:"sm",onClick:r=>K(o.id),title:e(i)("notifications.markRead")},{default:s(()=>[l(e(d),{icon:"cil-check"})]),_:1},8,["onClick","title"]))])],10,Pe))),128))]))]),_:2},[h.value.length>k.value?{name:"footer",fn:s(()=>[c("div",Be,[c("div",ze,n(e(i)("common.showing")||"Showing")+" "+n((u.value-1)*k.value+1)+" - "+n(Math.min(u.value*k.value,h.value.length))+" "+n(e(i)("common.of")||"of")+" "+n(h.value.length),1),c("div",De,[l(e(b),{color:"secondary",variant:"outline",size:"sm",onClick:t[10]||(t[10]=o=>u.value--),disabled:u.value===1},{default:s(()=>[l(e(d),{icon:"cil-chevron-left"}),g(" "+n(e(i)("common.previous")),1)]),_:1},8,["disabled"]),c("span",qe,n(e(i)("common.page"))+" "+n(u.value)+" / "+n(O.value),1),l(e(b),{color:"secondary",variant:"outline",size:"sm",onClick:t[11]||(t[11]=o=>u.value++),disabled:u.value===O.value},{default:s(()=>[g(n(e(i)("common.next"))+" ",1),l(e(d),{icon:"cil-chevron-right"})]),_:1},8,["disabled"])])])]),key:"0"}:void 0]),1032,["title"])]))}},at=ve(Ue,[["__scopeId","data-v-fc717115"]]);export{at as default};
