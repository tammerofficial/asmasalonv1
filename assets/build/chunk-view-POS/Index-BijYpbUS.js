import{f as v,e as Z,j as Ke,c as d,o as u,b as s,d as l,s as N,a as V,t as o,u as e,w as r,Y as te,x as S,a0 as me,l as Xe,p as Qe,P as m,C as g,Z as Ee,F as D,g as M,n as Ie,aa as Ye,ab as Ze,a3 as O,z as pe,a1 as ve,a4 as Ne,a5 as fe,a6 as _e,a7 as ye,$ as Je,a2 as Oe,a8 as Fe,X as et}from"../chunk-vendor-vue-Dg0iJD_h.js";import{a as T,u as We,N as tt}from"../chunk-component-NotificationsBell-B2dAMSJx.js";import{u as Ge}from"../chunk-view-AppleWallet/Simulator-FWAoI2CS.js";import{d as st}from"../chunk-vendor-pinia-AvH0NMyG.js";import"../chunk-component-PageHeader-CswlebSl.js";import{_ as at,C as Ue}from"../chunk-component-Card-BEqwRdY0.js";import{E as Te}from"../chunk-component-EmptyState-CH7raFYe.js";import{L as ot}from"../chunk-component-LoadingSpinner-BdAD-dqG.js";import{Q as lt}from"./Components/QuickStatsBar-CktDjUa3.js";import{C as nt}from"./Components/CustomerQuickView-BErHM-Nm.js";import{B as it}from"./Components/BookingCard-jxhGI_yK.js";import{Q as rt}from"./Components/QueueTicketCard-D8pY_Pl2.js";import{P as ct}from"./Components/PaymentMethodsGrid-DjUx0tFa.js";import{S as ut}from"./Components/StaffStatusWidget-Cys4OVEg.js";import{L as dt}from"./Components/LiveAnalyticsDashboard-1aiwFW9f.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-axios-B9ygI19o.js";const He=st("pos",()=>{const b=v([]),n=v([]),h=v([]),R=v([]),i=v([]),H=v([]),K=v([]),se=v([]),P=v([]),he=v([]),be=v([]),Ce=v([]),ke=v([]),_=v(null),p=v([]),A=v(null),z=v(0),F=v("cash"),$=v(0),ae=v(""),J=v([{method:"cash",amount:0},{method:"knet",amount:0},{method:"credit_card",amount:0},{method:"wallet",amount:0}]),oe=v([]),W=v({date:null,services:[],total:0,staff_name:""}),le=v({services:[],products:[]}),G=v([]),q=v({products:!1,services:!1,staff:!1,customers:!1,activeCustomers:!1,session:!1,loyalty:!1,finance:!1}),U=Z(()=>p.value.reduce((f,k)=>f+k.unit_price*k.quantity,0)),L=Z(()=>Math.max(0,U.value-z.value-$.value)),B=Z(()=>Math.floor(L.value)),I=Z(()=>A.value?R.value.find(f=>Number(f.id)===Number(A.value))||H.value.find(f=>Number(f.id)===Number(A.value)):null);function j(f,k){const w=J.value.find(Q=>Q.method===f);w&&(w.amount=Number(k))}function E(){J.value=[{method:"cash",amount:0},{method:"knet",amount:0},{method:"credit_card",amount:0},{method:"wallet",amount:0}]}function ne(f){oe.value.push(f)}function De(){oe.value=[]}function Me(f){W.value=f}async function Le(){var f,k,w,Q,ie,ee,re,ce,ue,X,de,ge,Ve,Ae,Pe,$e,c;q.value.products=!0,q.value.services=!0,q.value.staff=!0,q.value.customers=!0,q.value.activeCustomers=!0,q.value.session=!0;try{const[a,y,C,t,x,Y,Be]=await Promise.all([T.get("/products",{params:{per_page:1e3,is_active:1}}),T.get("/services",{params:{per_page:1e3,is_active:1}}),T.get("/staff",{params:{per_page:1e3,status:"active"}}),T.get("/customers",{params:{per_page:1e3}}),T.get("/memberships/plans",{params:{is_active:1}}),T.get("/pos"),T.get("/pos/session")]);b.value=((k=(f=a.data)==null?void 0:f.data)==null?void 0:k.items)||((w=a.data)==null?void 0:w.items)||[],n.value=((ie=(Q=y.data)==null?void 0:Q.data)==null?void 0:ie.items)||((ee=y.data)==null?void 0:ee.items)||[],h.value=((ce=(re=C.data)==null?void 0:re.data)==null?void 0:ce.items)||((ue=C.data)==null?void 0:ue.items)||[],R.value=((de=(X=t.data)==null?void 0:X.data)==null?void 0:de.items)||((ge=t.data)==null?void 0:ge.items)||[],i.value=((Ae=(Ve=x.data)==null?void 0:Ve.data)==null?void 0:Ae.items)||((Pe=x.data)==null?void 0:Pe.items)||[];const qe=(($e=Y.data)==null?void 0:$e.data)||Y.data||{};H.value=qe.active_customers||[],K.value=qe.bookings||[],se.value=qe.queue_tickets||[],le.value=qe.popularity||{services:[],products:[]},_.value=((c=Be.data)==null?void 0:c.data)||Be.data||null}catch(a){console.error("Error fetching POS data:",a)}finally{Object.keys(q.value).forEach(a=>q.value[a]=!1)}}async function we(f){var k;if(!f)return null;q.value.loyalty=!0;try{const w=await T.get(`/customers/${f}/loyalty`);return((k=w.data)==null?void 0:k.data)||w.data}catch(w){return console.error("Error fetching loyalty data:",w),null}finally{q.value.loyalty=!1}}async function xe(f){var k,w,Q,ie,ee,re,ce,ue;if(f){q.value.finance=!0;try{const[X,de,ge]=await Promise.all([T.get("/invoices",{params:{customer_id:f,limit:5}}),T.get("/payments",{params:{customer_id:f,limit:5}}),T.get(`/pos/prepaid/${f}`)]);he.value=((w=(k=X.data)==null?void 0:k.data)==null?void 0:w.items)||((Q=X.data)==null?void 0:Q.items)||[],be.value=((ee=(ie=de.data)==null?void 0:ie.data)==null?void 0:ee.items)||((re=de.data)==null?void 0:re.items)||[],$.value=((ue=(ce=ge.data)==null?void 0:ce.data)==null?void 0:ue.total_prepaid)||0}catch(X){console.error("Error fetching financial data:",X)}finally{q.value.finance=!1}}}function Se(f){const k=p.value.findIndex(w=>w.type===f.type&&(f.type==="product"?w.product_id===f.product_id:w.service_id===f.service_id)&&w.staff_id===f.staff_id&&(w.note||"")===(f.note||""));k>-1&&!f.is_custom?p.value[k].quantity+=f.quantity||1:p.value.push({...f,quantity:f.quantity||1,note:f.note||""})}function je(f){p.value.splice(f,1)}function Re(){p.value=[],z.value=0,ae.value="",$.value=0}function ze(){!W.value||!W.value.services||W.value.services.forEach(f=>{const k=n.value.find(w=>(w.name_ar||w.name)===f);k&&Se({type:"service",service_id:k.id,name:k.name_ar||k.name,unit_price:parseFloat(k.price||0),quantity:1,staff_id:null,staff_name:""})})}return{products:b,services:n,staff:h,customers:R,activeCustomers:H,bookings:K,queueTickets:se,orders:P,invoices:he,payments:be,commissions:Ce,workerCalls:ke,openSession:_,cart:p,selectedCustomerId:A,discount:z,discountReason:ae,paymentMethod:F,prepaidAmount:$,loading:q,popularity:le,lastServices:G,subtotal:U,total:L,potentialPoints:B,selectedCustomer:I,splitPayments:J,customerAlerts:oe,lastVisitDetails:W,fetchAllData:Le,fetchLoyaltyData:we,fetchCustomerFinancials:xe,addToCart:Se,removeFromCart:je,clearCart:Re,repeatLastVisit:ze,setSplitPaymentAmount:j,clearSplitPayments:E,addCustomerAlert:ne,clearCustomerAlerts:De,setLastVisitDetails:Me}});function mt(){const b=He(),{t:n}=We(),h=Ge(),R=v(!1);async function i(_){b.selectedCustomerId=_.id||_.customer_id,b.clearCustomerAlerts(),b.setLastVisitDetails({date:null,services:[],total:0,staff_name:""}),await Promise.all([b.fetchLoyaltyData(b.selectedCustomerId),b.fetchCustomerFinancials(b.selectedCustomerId)]),h.success(n("pos.customerSelected")||"تم اختيار العميلة: "+(_.name||_.customer_name))}async function H(){var _;try{const p=await T.post("/queue/call-next");if((_=p.data)!=null&&_.data){const A=p.data.data;return await T.post(`/queue/${A.id}/call`),h.success(`${n("queue.ticketCalled")}: ${A.ticket_number||A.id}`),await b.fetchAllData(),A}else h.warning(n("queue.noWaitingTickets"))}catch(p){console.error("Error calling next:",p),h.error(n("queue.errorCallingTicket"))}return null}async function K(_){try{await T.post(`/queue/${_}/call`),h.success(n("queue.ticketCalled")||"تم استدعاء التذكرة"),await b.fetchAllData()}catch(p){console.error("Error calling ticket:",p),h.error(n("queue.errorCallingTicket"))}}async function se(_){try{await T.post(`/queue/${_}/start`),h.success(n("queue.serviceStarted")||"بدء الخدمة"),await b.fetchAllData()}catch(p){console.error("Error starting service:",p),h.error(n("queue.errorStartingService"))}}async function P(_){var p;if(!b.selectedCustomerId)return!1;try{if((p=(await T.post("/loyalty/redeem",{customer_id:b.selectedCustomerId,points:_,description:n("pos.redeemPointsDescription")||"استبدال نقاط من خلال POS"})).data)!=null&&p.success)return h.success(n("loyalty.redeemed")||"تم استبدال النقاط بنجاح"),await b.fetchLoyaltyData(b.selectedCustomerId),!0}catch(A){console.error("Error redeeming points:",A),h.error(n("loyalty.errorRedeeming")||"خطأ في استبدال النقاط")}return!1}async function he(_){try{return R.value=!0,_.customer_id&&await i({id:_.customer_id,name:_.customer_name}),_.service_id&&b.addToCart({service_id:_.service_id,name:_.service_name,unit_price:_.price,quantity:1,staff_id:_.staff_id}),h.success(n("pos.bookingProcessed")||"تم تحويل الحجز إلى سلة المشتريات"),!0}catch(p){return console.error("Error processing booking arrival:",p),h.error(n("pos.errorProcessingArrival")),!1}finally{R.value=!1}}async function be(_){try{return R.value=!0,_.customer_id&&await i({id:_.customer_id,name:_.customer_name}),_.service_id&&b.addToCart({service_id:_.service_id,name:_.service_name,unit_price:_.price,quantity:1,staff_id:_.staff_id}),await se(_.id),h.success(n("pos.queueProcessed")||"تم تحويل التذكرة إلى سلة المشتريات وبدء الخدمة"),!0}catch(p){return console.error("Error processing queue arrival:",p),h.error(n("pos.errorProcessingArrival")),!1}finally{R.value=!1}}async function Ce(_){var p,A;if(b.cart.length===0)return h.error(n("pos.emptyCart")),!1;R.value=!0;try{const z={customer_id:b.selectedCustomerId?Number(b.selectedCustomerId):null,items:b.cart.map($=>({service_id:$.service_id||null,product_id:$.product_id||null,staff_id:$.staff_id||null,quantity:$.quantity,unit_price:$.unit_price,name:$.name})),payment_method:b.paymentMethod,discount:b.discount||0,discount_reason:b.discountReason||"",client_side_id:_,is_split_payment:b.splitPayments.some($=>$.amount>0),split_payments:b.splitPayments.filter($=>$.amount>0)},F=await T.post("/pos/process",z);return(p=F.data)!=null&&p.success?(h.success(n("pos.orderProcessed")||"تمت معالجة الطلب بنجاح"),b.clearCart(),b.clearSplitPayments(),await b.fetchAllData(),F.data.data):(h.error(((A=F.data)==null?void 0:A.message)||n("pos.errorProcessing")),!1)}catch(z){return console.error("Error in checkout:",z),h.error(n("pos.errorProcessing")||"خطأ في معالجة الطلب"),!1}finally{R.value=!1}}function ke(_){return new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(_||0)}return{isProcessing:R,selectActiveCustomer:i,processCheckout:Ce,formatCurrency:ke,processBookingArrival:he,processQueueTicketArrival:be,callNextInQueue:H,callSpecificTicket:K,serveTicket:se,redeemLoyaltyPoints:P}}const pt={class:"pos-page"},vt={class:"pos-header-top d-flex justify-content-between align-items-center mb-3"},ft={class:"header-left d-flex align-items-center gap-3"},_t={class:"mb-0 fw-bold text-primary"},yt={class:"header-right d-flex align-items-center gap-3"},ht={class:"pos-layout"},bt={class:"pos-column pos-operations"},gt={class:"d-flex justify-content-between align-items-center w-100"},Ct={class:"fw-bold"},kt={class:"operations-scroll-area flex-grow-1 overflow-auto p-3"},wt={class:"operation-section mb-4"},xt={class:"section-title d-flex justify-content-between align-items-center mb-2"},St={class:"arrived-hub bg-tertiary rounded-4 p-2 border-dashed border-primary"},Vt={key:0,class:"small text-muted text-center py-2"},At={key:1,class:"d-flex flex-column gap-2"},Pt=["onClick"],$t={class:"d-flex align-items-center gap-2"},qt={class:"mini-avatar-box"},It={class:"info"},Nt={class:"name fw-bold small truncate",style:{"max-width":"80px"}},Tt={class:"time tiny text-muted"},Dt={class:"operation-section mb-4"},Mt={class:"section-title d-flex justify-content-between align-items-center"},Lt={class:"operation-list"},jt=["onClick"],Rt={class:"item-avatar"},zt={class:"item-info"},Et={class:"item-name"},Ft={class:"item-meta"},Ut={class:"ms-2 small text-muted"},Bt={key:0,class:"empty-state-mini text-center p-3 opacity-50"},Qt={class:"operation-section mb-4"},Ot={class:"section-title d-flex justify-content-between"},Wt={class:"operation-list"},Gt={class:"operation-section mb-4"},Ht={class:"section-title d-flex justify-content-between"},Kt={class:"operation-list"},Xt={class:"pos-column pos-catalog"},Yt={key:0,class:"customer-alert-banner bg-danger text-white p-2 rounded-3 mb-2 d-flex align-items-center gap-3 pulse-red shadow-sm"},Zt={class:"alert-content flex-grow-1"},Jt={class:"small fw-bold"},es={class:"catalog-header-actions w-100"},ts={class:"d-flex gap-2"},ss={key:0,class:"smart-upsell-bar px-3 py-2 border-bottom bg-light d-flex align-items-center gap-3 overflow-auto"},as={class:"upsell-title small fw-bold text-nowrap text-primary"},os={class:"upsell-items d-flex gap-2"},ls={class:"catalog-grid-wrapper"},ns={key:1,class:"catalog-grid"},is=["onClick"],rs={key:0,class:"item-category-badge"},cs={class:"item-name"},us={class:"item-price"},ds={key:1,class:"item-stock"},ms={class:"quick-add"},ps={class:"pos-column pos-checkout"},vs={class:"fw-bold"},fs={class:"checkout-customer-section"},_s={key:1,class:"customer-selection-empty"},ys={value:null},hs=["value"],bs={key:2,class:"last-services-box mt-3 p-3 bg-tertiary rounded-4 border"},gs={class:"d-flex justify-content-between align-items-center mb-2"},Cs={class:"small fw-bold text-muted d-flex align-items-center"},ks={class:"d-flex flex-wrap gap-2"},ws={class:"cart-items-section"},xs={key:0,class:"empty-cart-display"},Ss={key:1,class:"cart-list"},Vs={class:"cart-item"},As={class:"item-info"},Ps={class:"item-name"},$s={key:0,class:"item-staff"},qs={class:"item-controls"},Is={class:"quantity-picker"},Ns=["onClick"],Ts=["onClick"],Ds={class:"item-total"},Ms={class:"cart-item-note"},Ls={class:"checkout-footer"},js={class:"summary-details"},Rs={class:"summary-line"},zs={key:0,class:"summary-line"},Es={class:"text-success"},Fs={class:"summary-line discount-line"},Us={class:"d-flex flex-column align-items-end gap-1"},Bs={class:"summary-line total-line"},Qs={class:"total-amount"},Os={key:0,class:"loyalty-preview-banner mt-2 p-2 rounded-3 text-center small fw-bold"},Ws={class:"payment-section mt-3"},Gs={class:"d-flex justify-content-between align-items-center mb-2"},Hs={class:"small fw-bold text-muted uppercase"},Ks={key:0,class:"split-payment-grid bg-tertiary p-3 rounded-4 border mb-3"},Xs={class:"checkout-actions"},Ys={key:0,class:"history-list"},Zs={class:"d-flex justify-content-between"},Js={class:"fw-bold"},ea={class:"text-primary fw-bold"},ta={class:"d-flex justify-content-between mt-1"},sa={class:"small text-muted"},aa={key:1,class:"history-list"},oa={class:"d-flex justify-content-between"},la={class:"fw-bold"},na={class:"text-primary fw-bold"},ia={class:"d-flex justify-content-between mt-1"},ra={class:"small text-muted"},ca={key:2,class:"history-list"},ua={class:"d-flex justify-content-between"},da={class:"fw-bold"},ma={class:"text-success fw-bold"},pa={class:"d-flex justify-content-between mt-1"},va={class:"small text-muted"},fa={class:"item-preview-card"},_a={class:"item-name h4"},ya={class:"item-price h3 text-primary"},ha={class:"mb-3"},ba={class:"form-label small fw-bold text-muted"},ga={value:""},Ca=["value"],ka={key:0,class:"mt-2 small text-success fw-bold"},wa={class:"mb-3"},xa={class:"form-label small fw-bold text-muted"},Sa={class:"quantity-input-large"},Va={class:"offers-section"},Aa={class:"section-title small fw-bold text-muted mb-2 uppercase"},Pa={class:"empty-state-mini border rounded p-3 text-center"},$a={class:"mb-3"},qa={class:"form-label small fw-bold text-muted"},Ia={class:"mb-3"},Na={class:"form-label small fw-bold text-muted"},Ta={class:"mb-3"},Da={class:"form-label small fw-bold text-muted"},Ma={value:"service"},La={value:"product"},ja={class:"mb-3"},Ra={class:"form-label small fw-bold text-muted"},za={value:""},Ea=["value"],Fa={class:"mb-3"},Ua={class:"form-label"},Ba={class:"mb-3"},Qa={class:"form-label"},Oa={class:"mb-3"},Wa={class:"form-label"},Ga={class:"invoice-container p-4",id:"printable-invoice"},Ha={class:"invoice-header text-center mb-4"},Ka={class:"small"},Xa={class:"invoice-items mb-4"},Ya={class:"invoice-summary"},Za={class:"d-flex justify-content-between"},Ja={key:0,class:"d-flex justify-content-between text-danger"},eo={class:"d-flex justify-content-between fw-bold h4 mt-2"},to={class:"invoice-footer text-center mt-5"},so={class:"settings-list"},ao={class:"setting-item d-flex justify-content-between align-items-center mb-3 p-2 border rounded"},oo={class:"fw-bold"},lo={class:"small text-muted"},no={class:"setting-item d-flex justify-content-between align-items-center mb-3 p-2 border rounded"},io={class:"fw-bold"},ro={class:"small text-muted"},co={__name:"Index",setup(b){const{t:n}=We(),h=Ge(),R=Xe(),i=He(),{isProcessing:H,selectActiveCustomer:K,processCheckout:se,formatCurrency:P,processBookingArrival:he,processQueueTicketArrival:be,callNextInQueue:Ce,callSpecificTicket:ke,serveTicket:_}=mt(),p=v("services"),A=v(""),z=v(!1),F=v(!1),$=v(!1),ae=v(!1),J=v(!1),oe=v(!1),W=v(!1),le=v(!1),G=v(null),q=v(!1),U=v({name:"",phone:"",email:""}),L=v({name:"",price:0,type:"service"}),B=v("orders"),I=v(null),j=v(""),E=v(1),ne=Z(()=>{const c=i.splitPayments.reduce((a,y)=>a+(Number(y.amount)||0),0);return i.total-c}),De=c=>{switch(c){case"cash":return"cil-money";case"knet":return"cil-credit-card";case"credit_card":return"cil-bank";case"wallet":return"cil-wallet";default:return"cil-money"}},Me=c=>{switch(c){case"cash":return"text-success";case"knet":return"text-info";case"credit_card":return"text-primary";case"wallet":return"text-warning";default:return""}},Le=Z(()=>i.staff.length?[...i.staff].sort((a,y)=>getStaffCurrentLoad(a.id)-getStaffCurrentLoad(y.id))[0].id:null),we=Z(()=>{if(!j.value||!I.value)return 0;const c=i.staff.find(C=>Number(C.id)===Number(j.value));if(!c)return 0;const a=parseFloat(I.value.price||I.value.selling_price||0),y=parseFloat(c.commission_rate||10);return a*E.value*(y/100)}),xe=Z(()=>{let c=[];if(p.value==="services"?c=i.services:p.value==="products"?c=i.products:p.value==="memberships"&&(c=i.memberships),!A.value)return c;const a=A.value.toLowerCase();return c.filter(y=>(y.name_ar||y.name||"").toLowerCase().includes(a)||(y.category||"").toLowerCase().includes(a)||(y.sku||"").toLowerCase().includes(a))}),Se=Z(()=>{if(i.cart.length===0)return[];const c=i.cart.map(C=>C.service_id||C.product_id),a=p.value==="services"?i.services:i.products,y=i.cart.map(C=>{const t=a.find(x=>x.id===(C.service_id||C.product_id));return t==null?void 0:t.category}).filter(Boolean);return a.filter(C=>!c.includes(C.id)).filter(C=>y.includes(C.category)||Math.random()>.7).slice(0,4)}),je=c=>{var C;const a=ne.value,y=((C=i.splitPayments.find(t=>t.method===c))==null?void 0:C.amount)||0;i.setSplitPaymentAmount(c,y+a)},Re=()=>{L.value={name:"",price:0,type:"service"},j.value="",E.value=1,F.value=!0},ze=()=>{if(!L.value.name||L.value.price<0)return;const c=i.staff.find(y=>Number(y.id)===Number(j.value)),a={type:L.value.type,name:L.value.name,quantity:E.value,unit_price:parseFloat(L.value.price),staff_id:j.value||null,staff_name:c?c.name:"",is_custom:!0};i.addToCart(a),F.value=!1,h.success(n("pos.addedToCart")||"تمت الإضافة للسلة")},f=c=>{if(p.value==="products"&&(c.stock_quantity||0)<=0){h.error(n("pos.outOfStock")||"المنتج غير متوفر في المخزون");return}I.value=c,j.value="",E.value=1,z.value=!0},k=async c=>{await he(c)&&(p.value="services",await Q(c.customer_id))},w=async c=>{await be(c)&&(p.value="services",c.customer_id&&await Q(c.customer_id))},Q=async c=>{var a,y;if(c)try{const C=await api.get(`/customers/${c}`),t=((a=C.data)==null?void 0:a.data)||C.data;t!=null&&t.notes&&(i.clearCustomerAlerts(),i.addCustomerAlert(t.notes));const x=await api.get(`/customers/${c}/last-visit`);(y=x.data)!=null&&y.data&&i.setLastVisitDetails(x.data.data)}catch(C){console.error("Error fetching receptionist data:",C)}},ie=()=>{const c=i.staff.find(C=>Number(C.id)===Number(j.value)),a=p.value==="services"?"service":p.value==="products"?"product":"membership",y={type:a,service_id:a==="service"?I.value.id:null,product_id:a==="product"?I.value.id:null,membership_id:a==="membership"?I.value.id:null,name:I.value.name_ar||I.value.name,quantity:E.value,unit_price:parseFloat(I.value.price||I.value.selling_price||0),staff_id:j.value||null,staff_name:c?c.name:""};i.addToCart(y),z.value=!1,h.success(n("pos.addedToCart")||"تمت الإضافة للسلة")},ee=(c,a)=>{const y=i.cart[c];y.quantity+a>0&&(y.quantity+=a)},re=async()=>{if(i.selectedCustomerId){const c=i.customers.find(a=>Number(a.id)===Number(i.selectedCustomerId));c&&(await K(c),await Q(c.id))}},ce=async()=>{const c="pos_"+Date.now(),a=await se(c);a&&(G.value=a,W.value=!0)},ue=c=>{R.push(`/customers/${c}`)},X=async c=>{var a;try{(a=(await api.post(`/loyalty/apple-wallet/send/${c}`)).data)!=null&&a.success&&h.success(n("loyalty.passSent")||"تم إرسال بطاقة المحفظة بنجاح")}catch(y){console.error("Error sending wallet pass:",y),h.error(n("loyalty.errorSendingPass")||"خطأ في إرسال بطاقة المحفظة")}},de=async()=>{var c;q.value=!0;try{const a=await api.post("/customers",U.value);(c=a.data)!=null&&c.success&&(h.success(n("customers.added")||"تمت إضافة العميلة بنجاح"),await i.fetchAllData(),K(a.data.data),ae.value=!1,U.value={name:"",phone:"",email:""})}catch(a){console.error("Error adding customer:",a),h.error(n("customers.errorAdding")||"خطأ في إضافة العميلة")}finally{q.value=!1}},ge=async()=>{await Ce()},Ve=async c=>{await ke(c.id)},Ae=async c=>{await _(c.id),K({id:c.customer_id,name:c.customer_name,type:"queue",ticket_number:c.ticket_number})},Pe=async c=>{var a;if(c.status!=="available"){h.warning(n("workerCalls.staffNotAvailable")||"الموظفة مشغولة حالياً");return}try{(a=(await api.post("/worker-calls",{staff_id:c.id,customer_id:i.selectedCustomerId,reason:"POS Service Request"})).data)!=null&&a.success&&(h.success(n("workerCalls.callSent")||"تم إرسال النداء للموظفة: "+c.name),await i.fetchAllData())}catch(y){console.error("Error calling staff:",y),h.error(n("workerCalls.errorCalling")||"خطأ في إرسال النداء")}},$e=async()=>{var c;if(confirm(n("pos.confirmCloseSession")||"هل أنت متأكد من إغلاق الجلسة؟"))try{(c=(await api.post(`/pos/session/${i.openSession.id}/close`)).data)!=null&&c.success&&(h.success(n("pos.sessionClosed")||"تم إغلاق الجلسة بنجاح"),J.value=!1,await i.fetchAllData())}catch(a){console.error("Error closing session:",a),h.error(n("pos.errorClosingSession"))}};return Ke(()=>{i.fetchAllData()}),(c,a)=>{const y=Qe("router-link"),C=Qe("CFormSwitch");return u(),d("div",pt,[s("div",vt,[s("div",ft,[s("h4",_t,o(e(n)("pos.title")),1),e(i).openSession?(u(),N(e(te),{key:0,color:"success",shape:"rounded-pill"},{default:r(()=>[m(o(e(n)("pos.sessionOpen")||"الجلسة مفتوحة")+" (#"+o(e(i).openSession.id)+") ",1)]),_:1})):V("",!0)]),s("div",yt,[l(e(S),{color:"info",variant:"ghost",onClick:a[0]||(a[0]=t=>oe.value=!0)},{default:r(()=>[l(e(g),{icon:"cil-chart-line"})]),_:1}),l(tt),l(e(S),{color:"secondary",variant:"ghost",onClick:a[1]||(a[1]=t=>J.value=!0)},{default:r(()=>[l(e(g),{icon:"cil-settings"})]),_:1})])]),l(lt,{session:e(i).openSession,activeCustomersCount:e(i).activeCustomers.length},null,8,["session","activeCustomersCount"]),s("div",ht,[s("div",bt,[l(Ue,{class:"operations-card h-100"},{header:r(()=>[s("div",gt,[s("span",Ct,o(e(n)("pos.operations")||"العمليات"),1),l(e(S),{size:"sm",color:"primary",variant:"ghost",onClick:e(i).fetchAllData},{default:r(()=>[l(e(g),{icon:"cil-reload"})]),_:1},8,["onClick"])])]),default:r(()=>[s("div",kt,[l(e(Ee),{variant:"pills",class:"flex-column operations-nav"},{default:r(()=>[s("div",wt,[s("div",xt,[s("span",null,[l(e(g),{icon:"cil-room",class:"me-2 text-primary"}),m(" "+o(e(n)("pos.arrivedToday")||"وصلوا الآن"),1)]),l(e(te),{color:"primary",shape:"rounded-pill"},{default:r(()=>[m(o(e(i).bookings.filter(t=>t.status==="confirmed").length),1)]),_:1})]),s("div",St,[e(i).bookings.filter(t=>t.status==="confirmed").length===0?(u(),d("div",Vt,o(e(n)("pos.noArrivals")||"لا يوجد حجوزات منتظرة"),1)):(u(),d("div",At,[(u(!0),d(D,null,M(e(i).bookings.filter(t=>t.status==="confirmed").slice(0,3),t=>{var x;return u(),d("div",{key:t.id,class:"arrival-quick-card d-flex justify-content-between align-items-center p-2 bg-secondary rounded-3 shadow-sm border-start border-4 border-success",style:{cursor:"pointer"},onClick:Y=>k(t)},[s("div",$t,[s("div",qt,o((x=t.customer_name)==null?void 0:x.charAt(0)),1),s("div",It,[s("div",Nt,o(t.customer_name),1),s("div",Tt,o(t.booking_time),1)])]),l(e(S),{color:"success",size:"sm",variant:"ghost",class:"p-1"},{default:r(()=>[l(e(g),{icon:"cil-check-circle"})]),_:1})],8,Pt)}),128))]))])]),s("div",Dt,[s("div",Mt,[s("span",null,[l(e(g),{icon:"cil-people",class:"me-2"}),m(" "+o(e(n)("pos.activeCustomers")),1)]),l(e(S),{size:"sm",color:"success",variant:"ghost",onClick:a[2]||(a[2]=t=>ae.value=!0)},{default:r(()=>[l(e(g),{icon:"cil-plus"})]),_:1})]),s("div",Lt,[(u(!0),d(D,null,M(e(i).activeCustomers,t=>{var x;return u(),d("div",{key:t.id,class:Ie(["operation-item",{selected:Number(e(i).selectedCustomerId)===Number(t.id)}]),onClick:Y=>e(K)(t)},[s("div",Rt,o(((x=t.name)==null?void 0:x.charAt(0))||"C"),1),s("div",zt,[s("div",Et,o(t.name),1),s("div",Ft,[l(e(te),{color:t.type==="queue"?"info":"primary",size:"sm"},{default:r(()=>[m(o(t.type==="queue"?"#"+t.ticket_number:e(n)("bookings.title")),1)]),_:2},1032,["color"]),s("span",Ut,o(t.current_service||"N/A"),1)])])],10,jt)}),128)),e(i).activeCustomers.length===0?(u(),d("div",Bt,o(e(n)("pos.noActiveCustomers")),1)):V("",!0)])]),s("div",Qt,[s("div",Ot,[s("span",null,[l(e(g),{icon:"cil-calendar",class:"me-2"}),m(" "+o(e(n)("bookings.title")),1)]),l(y,{to:"/bookings",class:"text-primary text-decoration-none small"},{default:r(()=>[m(o(e(n)("common.viewAll")),1)]),_:1})]),s("div",Wt,[(u(!0),d(D,null,M(e(i).bookings.slice(0,3),t=>(u(),N(it,{key:t.id,booking:t,onProcess:k,onArrive:k},null,8,["booking"]))),128))])]),s("div",Gt,[s("div",Ht,[s("span",null,[l(e(g),{icon:"cil-list",class:"me-2"}),m(" "+o(e(n)("queue.title")),1)]),l(e(S),{size:"sm",color:"primary",variant:"ghost",onClick:ge},{default:r(()=>[m(o(e(n)("queue.next")),1)]),_:1})]),s("div",Kt,[(u(!0),d(D,null,M(e(i).queueTickets.filter(t=>t.status!=="completed").slice(0,3),t=>(u(),N(rt,{key:t.id,ticket:t,onCall:Ve,onServe:Ae,onArrive:w},null,8,["ticket"]))),128))])]),l(ut,{staff:e(i).staff,onCall:Pe},null,8,["staff"])]),_:1})])]),_:1})]),s("div",Xt,[l(Ue,{class:"catalog-card h-100"},{header:r(()=>[e(i).selectedCustomer&&e(i).customerAlerts.length>0?(u(),d("div",Yt,[l(e(g),{icon:"cil-warning"}),s("div",Zt,[s("div",Jt,o(e(i).customerAlerts[0]),1)]),l(e(S),{color:"light",size:"sm",variant:"ghost",class:"py-0 px-1",onClick:a[3]||(a[3]=t=>e(i).customerAlerts=[])},{default:r(()=>[...a[40]||(a[40]=[m("X",-1)])]),_:1})])):V("",!0),s("div",es,[s("div",ts,[l(e(Ye),{class:"flex-grow-1"},{default:r(()=>[l(e(Ze),null,{default:r(()=>[l(e(g),{icon:"cil-magnifying-glass"})]),_:1}),l(e(O),{modelValue:A.value,"onUpdate:modelValue":a[4]||(a[4]=t=>A.value=t),placeholder:e(n)("common.search")+"...",class:"border-start-0"},null,8,["modelValue","placeholder"])]),_:1}),l(e(S),{color:"primary",variant:"outline",onClick:Re},{default:r(()=>[l(e(g),{icon:"cil-pencil"})]),_:1})]),l(e(Ee),{variant:"pills",class:"catalog-tabs mt-3"},{default:r(()=>[l(e(pe),null,{default:r(()=>[l(e(ve),{active:p.value==="services",onClick:a[5]||(a[5]=t=>p.value="services")},{default:r(()=>[l(e(g),{icon:"cil-spreadsheet",class:"me-2"}),m(o(e(n)("pos.services")),1)]),_:1},8,["active"])]),_:1}),l(e(pe),null,{default:r(()=>[l(e(ve),{active:p.value==="products",onClick:a[6]||(a[6]=t=>p.value="products")},{default:r(()=>[l(e(g),{icon:"cil-basket",class:"me-2"}),m(o(e(n)("pos.products")),1)]),_:1},8,["active"])]),_:1}),l(e(pe),null,{default:r(()=>[l(e(ve),{active:p.value==="memberships",onClick:a[7]||(a[7]=t=>p.value="memberships")},{default:r(()=>[l(e(g),{icon:"cil-gem",class:"me-2"}),m(o(e(n)("memberships.title")||"العضويات"),1)]),_:1},8,["active"])]),_:1}),l(e(pe),null,{default:r(()=>[l(e(ve),{active:p.value==="favorites",onClick:a[8]||(a[8]=t=>p.value="favorites")},{default:r(()=>[l(e(g),{icon:"cil-star",class:"me-2"}),m(o(e(n)("common.favorites")||"المفضلة"),1)]),_:1},8,["active"])]),_:1})]),_:1})])]),default:r(()=>[e(i).cart.length>0&&p.value==="services"?(u(),d("div",ss,[s("div",as,[l(e(g),{icon:"cil-lightbulb",class:"me-1"}),m(" "+o(e(n)("pos.smartUpsellTitle")||"هل فكرتِ في هذا؟"),1)]),s("div",os,[(u(!0),d(D,null,M(Se.value,t=>(u(),N(e(te),{key:t.id,color:"info",shape:"rounded-pill",variant:"outline",class:"upsell-badge",style:{cursor:"pointer"},onClick:x=>f(t)},{default:r(()=>[m(" + "+o(t.name_ar||t.name),1)]),_:2},1032,["onClick"]))),128))])])):V("",!0),s("div",ls,[e(i).loading.products||e(i).loading.services?(u(),N(ot,{key:0})):(u(),d("div",ns,[(u(!0),d(D,null,M(xe.value,t=>(u(),d("div",{key:t.id,class:Ie(["catalog-item-card",{"out-of-stock":p.value==="products"&&(t.stock_quantity||0)<=0}]),onClick:x=>f(t)},[t.category?(u(),d("div",rs,o(t.category),1)):V("",!0),s("div",cs,o(t.name_ar||t.name),1),s("div",us,o(e(P)(t.price||t.selling_price||0)),1),p.value==="products"?(u(),d("div",ds,o(e(n)("products.stock"))+": "+o(t.stock_quantity||0),1)):V("",!0),s("div",ms,[l(e(g),{icon:"cil-plus"})])],10,is))),128))])),xe.value.length?V("",!0):(u(),N(Te,{key:2,title:e(n)("common.noResults"),icon:"cil-search"},null,8,["title"]))])]),_:1})]),s("div",ps,[l(Ue,{class:"checkout-card h-100"},{header:r(()=>[s("div",vs,o(e(n)("pos.cart")),1)]),default:r(()=>[s("div",fs,[e(i).selectedCustomer?(u(),N(nt,{key:0,customer:e(i).selectedCustomer,"customer-alerts":e(i).customerAlerts,"last-visit":e(i).lastVisitDetails,onViewProfile:ue,onViewHistory:a[9]||(a[9]=t=>$.value=!0),onSendWalletPass:X},null,8,["customer","customer-alerts","last-visit"])):(u(),d("div",_s,[l(e(Ne),{modelValue:e(i).selectedCustomerId,"onUpdate:modelValue":a[10]||(a[10]=t=>e(i).selectedCustomerId=t),onChange:re},{default:r(()=>[s("option",ys,o(e(n)("pos.walkInCustomer")),1),(u(!0),d(D,null,M(e(i).customers,t=>(u(),d("option",{key:t.id,value:t.id},o(t.name)+" - "+o(t.phone),9,hs))),128))]),_:1},8,["modelValue"])])),e(i).selectedCustomer&&e(i).lastServices.length>0?(u(),d("div",bs,[s("div",gs,[s("div",Cs,[l(e(g),{icon:"cil-history",class:"me-2"}),m(" "+o(e(n)("pos.lastVisited")||"آخر خدمات"),1)]),l(e(S),{size:"sm",color:"primary",variant:"ghost",class:"p-0 tiny fw-bold",onClick:e(i).repeatLastVisit},{default:r(()=>[m(o(e(n)("pos.repeatAll")||"تكرار الكل"),1)]),_:1},8,["onClick"])]),s("div",ks,[(u(!0),d(D,null,M(e(i).lastServices,t=>(u(),N(e(te),{key:t.id,color:"secondary",shape:"rounded-pill",class:"fw-normal",style:{cursor:"pointer"},onClick:x=>f(t)},{default:r(()=>[m(o(t.name),1)]),_:2},1032,["onClick"]))),128))])])):V("",!0)]),s("div",ws,[e(i).cart.length===0?(u(),d("div",xs,[l(e(g),{icon:"cil-cart",class:"mb-2",size:"xl"}),s("div",null,o(e(n)("pos.emptyCartDesc")),1)])):(u(),d("div",Ss,[(u(!0),d(D,null,M(e(i).cart,(t,x)=>(u(),d("div",{key:x,class:"cart-item-wrapper"},[s("div",Vs,[s("div",As,[s("div",Ps,o(t.name),1),t.staff_name?(u(),d("div",$s,[l(e(g),{icon:"cil-user",class:"me-1"}),m(o(t.staff_name),1)])):V("",!0)]),s("div",qs,[s("div",Is,[s("button",{onClick:Y=>ee(x,-1)},"-",8,Ns),s("span",null,o(t.quantity),1),s("button",{onClick:Y=>ee(x,1)},"+",8,Ts)]),s("div",Ds,o(e(P)(t.unit_price*t.quantity)),1),l(e(S),{size:"sm",color:"danger",variant:"ghost",onClick:Y=>e(i).removeFromCart(x)},{default:r(()=>[l(e(g),{icon:"cil-trash"})]),_:1},8,["onClick"])])]),s("div",Ms,[l(e(O),{size:"sm",modelValue:t.note,"onUpdate:modelValue":Y=>t.note=Y,placeholder:e(n)("pos.itemNote")||"ملاحظة خاصة بالخدمة...",class:"border-0 bg-transparent py-0 px-2 tiny"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]))),128))]))]),s("div",Ls,[s("div",js,[s("div",Rs,[s("span",null,o(e(n)("pos.subtotal")),1),s("span",null,o(e(P)(e(i).subtotal)),1)]),e(i).prepaidAmount>0?(u(),d("div",zs,[s("span",null,o(e(n)("pos.prepaid")),1),s("span",Es,"-"+o(e(P)(e(i).prepaidAmount)),1)])):V("",!0),s("div",Fs,[s("span",null,o(e(n)("pos.discount")),1),s("div",Us,[l(e(O),{modelValue:e(i).discount,"onUpdate:modelValue":a[11]||(a[11]=t=>e(i).discount=t),modelModifiers:{number:!0},type:"number",step:"0.5",size:"sm",class:"summary-input"},null,8,["modelValue"]),e(i).discount>0?(u(),N(e(O),{key:0,modelValue:e(i).discountReason,"onUpdate:modelValue":a[12]||(a[12]=t=>e(i).discountReason=t),size:"sm",class:"summary-input tiny",placeholder:e(n)("pos.discountReason")||"سبب الخصم..."},null,8,["modelValue","placeholder"])):V("",!0)])]),s("div",Bs,[s("span",null,o(e(n)("pos.total")),1),s("span",Qs,o(e(P)(e(i).total)),1)])]),e(i).selectedCustomer&&e(i).potentialPoints>0?(u(),d("div",Os,[l(e(g),{icon:"cil-star",class:"text-warning me-1"}),m(" "+o(e(n)("pos.pointsEarnedPreview",{points:e(i).potentialPoints})||`ستكسبين ${e(i).potentialPoints} نقطة من هذا الطلب`),1)])):V("",!0),s("div",Ws,[s("div",Gs,[s("div",Hs,o(e(n)("pos.paymentMethod")),1),l(e(S),{color:"primary",variant:"ghost",size:"sm",onClick:a[13]||(a[13]=t=>le.value=!le.value)},{default:r(()=>[m(o(le.value?e(n)("pos.singlePayment"):e(n)("pos.splitPayment")||"دفع متعدد"),1)]),_:1})]),le.value?(u(),d("div",Ks,[(u(!0),d(D,null,M(e(i).splitPayments,t=>(u(),d("div",{key:t.method,class:"mb-2 d-flex align-items-center gap-2"},[l(e(g),{icon:De(t.method),class:Ie(Me(t.method))},null,8,["icon","class"]),l(e(O),{value:t.amount,onInput:x=>e(i).setSplitPaymentAmount(t.method,x.target.value),type:"number",size:"sm",placeholder:e(n)(`pos.payment_${t.method}`)||t.method},null,8,["value","onInput","placeholder"]),l(e(S),{size:"sm",color:"primary",variant:"ghost",onClick:x=>je(t.method),disabled:ne.value<=0},{default:r(()=>[m(o(e(n)("common.all")||"الكل"),1)]),_:1},8,["onClick","disabled"])]))),128)),s("div",{class:Ie(["remaining-balance tiny text-center fw-bold",ne.value<=0?"text-success":"text-danger"])},o(ne.value>0?e(n)("pos.remaining")||"المتبقي":e(n)("pos.change")||"الباقي للعميلة")+": "+o(e(P)(Math.abs(ne.value))),3)])):(u(),N(ct,{key:1,modelValue:e(i).paymentMethod,"onUpdate:modelValue":a[14]||(a[14]=t=>e(i).paymentMethod=t)},null,8,["modelValue"]))]),s("div",Xs,[l(e(S),{color:"primary",class:"w-100 checkout-btn py-3",disabled:!e(i).cart.length||e(H),onClick:ce},{default:r(()=>[e(H)?(u(),N(e(g),{key:0,icon:"cil-reload",class:"spinning me-2"})):(u(),N(e(g),{key:1,icon:"cil-check-circle",class:"me-2"})),m(" "+o(e(H)?e(n)("pos.processing"):e(n)("pos.processOrder")),1)]),_:1},8,["disabled"]),l(e(S),{color:"secondary",variant:"ghost",class:"w-100 mt-2",onClick:e(i).clearCart},{default:r(()=>[m(o(e(n)("pos.clearCart")),1)]),_:1},8,["onClick"])])])]),_:1})])]),l(e(me),{visible:oe.value,onClose:a[15]||(a[15]=t=>oe.value=!1),size:"lg",alignment:"center"},{default:r(()=>[l(e(fe),null,{default:r(()=>[l(e(_e),null,{default:r(()=>[m(o(e(n)("analytics.title")||"التحليلات الحية"),1)]),_:1})]),_:1}),l(e(ye),null,{default:r(()=>[l(dt,{session:e(i).openSession},null,8,["session"])]),_:1})]),_:1},8,["visible"]),l(e(me),{visible:$.value,onClose:a[19]||(a[19]=t=>$.value=!1),size:"xl",alignment:"center"},{default:r(()=>[l(e(fe),null,{default:r(()=>[l(e(_e),null,{default:r(()=>{var t;return[m(o(e(n)("common.history")||"السجل")+" - "+o((t=e(i).selectedCustomer)==null?void 0:t.name),1)]}),_:1})]),_:1}),l(e(ye),null,{default:r(()=>[l(e(Ee),{variant:"tabs",class:"mb-3"},{default:r(()=>[l(e(pe),null,{default:r(()=>[l(e(ve),{active:B.value==="orders",onClick:a[16]||(a[16]=t=>B.value="orders")},{default:r(()=>[m(o(e(n)("orders.title")),1)]),_:1},8,["active"])]),_:1}),l(e(pe),null,{default:r(()=>[l(e(ve),{active:B.value==="invoices",onClick:a[17]||(a[17]=t=>B.value="invoices")},{default:r(()=>[m(o(e(n)("invoices.title")),1)]),_:1},8,["active"])]),_:1}),l(e(pe),null,{default:r(()=>[l(e(ve),{active:B.value==="payments",onClick:a[18]||(a[18]=t=>B.value="payments")},{default:r(()=>[m(o(e(n)("payments.title")),1)]),_:1},8,["active"])]),_:1})]),_:1}),B.value==="orders"?(u(),d("div",Ys,[(u(!0),d(D,null,M(e(i).orders,t=>(u(),d("div",{key:t.id,class:"history-item border rounded p-3 mb-2"},[s("div",Zs,[s("span",Js,"#"+o(t.order_number),1),s("span",ea,o(e(P)(t.total)),1)]),s("div",ta,[s("span",sa,o(t.created_at),1),l(e(te),{color:t.status==="completed"?"success":"warning"},{default:r(()=>[m(o(t.status),1)]),_:2},1032,["color"])])]))),128)),e(i).orders.length?V("",!0):(u(),N(Te,{key:0,title:e(n)("orders.noOrders"),icon:"cil-cart"},null,8,["title"]))])):V("",!0),B.value==="invoices"?(u(),d("div",aa,[(u(!0),d(D,null,M(e(i).invoices,t=>(u(),d("div",{key:t.id,class:"history-item border rounded p-3 mb-2"},[s("div",oa,[s("span",la,"#"+o(t.invoice_number),1),s("span",na,o(e(P)(t.total_amount)),1)]),s("div",ia,[s("span",ra,o(t.created_at),1),l(e(te),{color:t.status==="paid"?"success":"danger"},{default:r(()=>[m(o(t.status),1)]),_:2},1032,["color"])])]))),128)),e(i).invoices.length?V("",!0):(u(),N(Te,{key:0,title:e(n)("invoices.noInvoices"),icon:"cil-file"},null,8,["title"]))])):V("",!0),B.value==="payments"?(u(),d("div",ca,[(u(!0),d(D,null,M(e(i).payments,t=>(u(),d("div",{key:t.id,class:"history-item border rounded p-3 mb-2"},[s("div",ua,[s("span",da,o(t.payment_method),1),s("span",ma,o(e(P)(t.amount)),1)]),s("div",pa,[s("span",va,o(t.created_at),1),l(e(te),{color:"info"},{default:r(()=>[m("#"+o(t.id),1)]),_:2},1024)])]))),128)),e(i).payments.length?V("",!0):(u(),N(Te,{key:0,title:e(n)("payments.noPayments"),icon:"cil-money"},null,8,["title"]))])):V("",!0)]),_:1})]),_:1},8,["visible"]),l(e(me),{visible:z.value,onClose:a[25]||(a[25]=t=>z.value=!1),size:"lg",alignment:"center"},{default:r(()=>[l(e(fe),null,{default:r(()=>[l(e(_e),null,{default:r(()=>[m(o(p.value==="services"?e(n)("pos.addService"):e(n)("pos.addProduct")),1)]),_:1})]),_:1}),I.value?(u(),N(e(ye),{key:0},{default:r(()=>[l(e(Je),null,{default:r(()=>[l(e(Oe),{md:"6"},{default:r(()=>[s("div",fa,[s("div",_a,o(I.value.name_ar||I.value.name),1),s("div",ya,o(e(P)(I.value.price||I.value.selling_price||0)),1),a[43]||(a[43]=s("hr",null,null,-1)),s("div",ha,[s("label",ba,o(e(n)("pos.staff")),1),l(e(Ne),{modelValue:j.value,"onUpdate:modelValue":a[20]||(a[20]=t=>j.value=t)},{default:r(()=>[s("option",ga,o(e(n)("pos.selectStaff")),1),(u(!0),d(D,null,M(e(i).staff,t=>(u(),d("option",{key:t.id,value:t.id},o(t.name)+" ("+o(c.getStaffCurrentLoad(t.id))+" "+o(e(n)("pos.activeCustomers"))+") "+o(Number(t.id)===Number(Le.value)?" ✨ "+(e(n)("pos.bestStaffMatch")||"الأكثر توافراً"):""),9,Ca))),128))]),_:1},8,["modelValue"]),we.value>0?(u(),d("div",ka,[l(e(g),{icon:"cil-money",class:"me-1"}),m(" "+o(e(n)("commissions.estimated")||"العمولة المقدرة")+": "+o(e(P)(we.value)),1)])):V("",!0)]),s("div",wa,[s("label",xa,o(e(n)("pos.quantity")),1),s("div",Sa,[l(e(S),{color:"secondary",variant:"outline",onClick:a[21]||(a[21]=t=>E.value>1?E.value--:null)},{default:r(()=>[...a[41]||(a[41]=[m("-",-1)])]),_:1}),l(e(O),{modelValue:E.value,"onUpdate:modelValue":a[22]||(a[22]=t=>E.value=t),modelModifiers:{number:!0},type:"number",min:"1",class:"text-center"},null,8,["modelValue"]),l(e(S),{color:"secondary",variant:"outline",onClick:a[23]||(a[23]=t=>E.value++)},{default:r(()=>[...a[42]||(a[42]=[m("+",-1)])]),_:1})])])])]),_:1}),l(e(Oe),{md:"6"},{default:r(()=>[s("div",Va,[s("div",Aa,o(e(n)("loyalty.offers")||"العروض المتاحة"),1),s("div",Pa,o(e(n)("loyalty.noOffers")||"لا توجد عروض لهذه الخدمة حالياً"),1)])]),_:1})]),_:1})]),_:1})):V("",!0),l(e(Fe),null,{default:r(()=>[l(e(S),{color:"secondary",variant:"ghost",onClick:a[24]||(a[24]=t=>z.value=!1)},{default:r(()=>[m(o(e(n)("common.cancel")),1)]),_:1}),l(e(S),{color:"primary",onClick:ie},{default:r(()=>[m(o(e(n)("pos.addToCart")),1)]),_:1})]),_:1})]),_:1},8,["visible"]),l(e(me),{visible:F.value,onClose:a[31]||(a[31]=t=>F.value=!1),alignment:"center"},{default:r(()=>[l(e(fe),null,{default:r(()=>[l(e(_e),null,{default:r(()=>[m(o(e(n)("pos.addCustom")||"إضافة بند مخصص"),1)]),_:1})]),_:1}),l(e(ye),null,{default:r(()=>[s("div",$a,[s("label",qa,o(e(n)("common.name")),1),l(e(O),{modelValue:L.value.name,"onUpdate:modelValue":a[26]||(a[26]=t=>L.value.name=t),placeholder:e(n)("pos.customNamePlaceholder")||"اسم الخدمة/المنتج"},null,8,["modelValue","placeholder"])]),s("div",Ia,[s("label",Na,o(e(n)("pos.price")),1),l(e(O),{modelValue:L.value.price,"onUpdate:modelValue":a[27]||(a[27]=t=>L.value.price=t),modelModifiers:{number:!0},type:"number",step:"0.5"},null,8,["modelValue"])]),s("div",Ta,[s("label",Da,o(e(n)("common.type")),1),l(e(Ne),{modelValue:L.value.type,"onUpdate:modelValue":a[28]||(a[28]=t=>L.value.type=t)},{default:r(()=>[s("option",Ma,o(e(n)("pos.service")),1),s("option",La,o(e(n)("pos.product")),1)]),_:1},8,["modelValue"])]),s("div",ja,[s("label",Ra,o(e(n)("pos.staff")),1),l(e(Ne),{modelValue:j.value,"onUpdate:modelValue":a[29]||(a[29]=t=>j.value=t)},{default:r(()=>[s("option",za,o(e(n)("pos.selectStaff")),1),(u(!0),d(D,null,M(e(i).staff,t=>(u(),d("option",{key:t.id,value:t.id},o(t.name)+" ("+o(c.getStaffCurrentLoad(t.id))+") ",9,Ea))),128))]),_:1},8,["modelValue"])])]),_:1}),l(e(Fe),null,{default:r(()=>[l(e(S),{color:"secondary",variant:"ghost",onClick:a[30]||(a[30]=t=>F.value=!1)},{default:r(()=>[m(o(e(n)("common.cancel")),1)]),_:1}),l(e(S),{color:"primary",onClick:ze},{default:r(()=>[m(o(e(n)("pos.addToCart")),1)]),_:1})]),_:1})]),_:1},8,["visible"]),l(e(me),{visible:ae.value,onClose:a[35]||(a[35]=t=>ae.value=!1),alignment:"center"},{default:r(()=>[l(e(fe),null,{default:r(()=>[l(e(_e),null,{default:r(()=>[m(o(e(n)("customers.add")||"إضافة عميلة جديدة"),1)]),_:1})]),_:1}),l(e(ye),null,{default:r(()=>[s("form",{onSubmit:et(de,["prevent"])},[s("div",Fa,[s("label",Ua,o(e(n)("customers.name")),1),l(e(O),{modelValue:U.value.name,"onUpdate:modelValue":a[32]||(a[32]=t=>U.value.name=t),required:""},null,8,["modelValue"])]),s("div",Ba,[s("label",Qa,o(e(n)("customers.phone")),1),l(e(O),{modelValue:U.value.phone,"onUpdate:modelValue":a[33]||(a[33]=t=>U.value.phone=t),required:""},null,8,["modelValue"])]),s("div",Oa,[s("label",Wa,o(e(n)("customers.email")),1),l(e(O),{modelValue:U.value.email,"onUpdate:modelValue":a[34]||(a[34]=t=>U.value.email=t),type:"email"},null,8,["modelValue"])]),l(e(S),{type:"submit",color:"primary",class:"w-100",disabled:q.value},{default:r(()=>[q.value?(u(),N(e(g),{key:0,icon:"cil-reload",class:"spinning me-2"})):V("",!0),m(" "+o(e(n)("common.save")),1)]),_:1},8,["disabled"])],32)]),_:1})]),_:1},8,["visible"]),l(e(me),{visible:W.value,onClose:a[38]||(a[38]=t=>W.value=!1),size:"lg",alignment:"center"},{default:r(()=>[l(e(fe),null,{default:r(()=>[l(e(_e),null,{default:r(()=>[m(o(e(n)("pos.invoicePreview")||"معاينة الفاتورة"),1)]),_:1})]),_:1}),G.value?(u(),N(e(ye),{key:0,class:"p-0"},{default:r(()=>[s("div",Ga,[s("div",Ha,[a[44]||(a[44]=s("h3",{class:"fw-bold"},"SALON ASMAA",-1)),s("div",null,o(e(n)("pos.receipt"))+" #"+o(G.value.order_number),1),s("div",Ka,o(new Date().toLocaleString()),1)]),a[45]||(a[45]=s("hr",null,null,-1)),s("div",Xa,[(u(!0),d(D,null,M(G.value.items,t=>(u(),d("div",{key:t.id,class:"d-flex justify-content-between mb-2"},[s("span",null,o(t.name)+" x "+o(t.quantity),1),s("span",null,o(e(P)(t.total)),1)]))),128))]),a[46]||(a[46]=s("hr",null,null,-1)),s("div",Ya,[s("div",Za,[s("span",null,o(e(n)("pos.subtotal")),1),s("span",null,o(e(P)(G.value.subtotal)),1)]),G.value.discount>0?(u(),d("div",Ja,[s("span",null,o(e(n)("pos.discount")),1),s("span",null,"-"+o(e(P)(G.value.discount)),1)])):V("",!0),s("div",eo,[s("span",null,o(e(n)("pos.total")),1),s("span",null,o(e(P)(G.value.total)),1)])]),s("div",to,[s("p",null,o(e(n)("pos.thankYou")||"شكراً لزيارتكم"),1)])])]),_:1})):V("",!0),l(e(Fe),null,{default:r(()=>[l(e(S),{color:"secondary",onClick:a[36]||(a[36]=t=>W.value=!1)},{default:r(()=>[m(o(e(n)("common.close")),1)]),_:1}),l(e(S),{color:"primary",onClick:a[37]||(a[37]=t=>c.window.print())},{default:r(()=>[l(e(g),{icon:"cil-print",class:"me-2"}),m(" "+o(e(n)("common.print")),1)]),_:1})]),_:1})]),_:1},8,["visible"]),l(e(me),{visible:J.value,onClose:a[39]||(a[39]=t=>J.value=!1),alignment:"center"},{default:r(()=>[l(e(fe),null,{default:r(()=>[l(e(_e),null,{default:r(()=>[m(o(e(n)("settings.title")||"الإعدادات السريعة"),1)]),_:1})]),_:1}),l(e(ye),null,{default:r(()=>[s("div",so,[s("div",ao,[s("div",null,[s("div",oo,o(e(n)("pos.autoPrint")||"طباعة تلقائية"),1),s("div",lo,o(e(n)("pos.autoPrintDesc")||"طباعة الفاتورة فور إتمام الطلب"),1)]),l(C)]),s("div",no,[s("div",null,[s("div",io,o(e(n)("pos.soundNotifications")||"تنبيهات صوتية"),1),s("div",ro,o(e(n)("pos.soundNotificationsDesc")||"تفعيل الصوت عند استدعاء الطابور"),1)]),l(C,{checked:!0})]),a[47]||(a[47]=s("hr",null,null,-1)),l(e(S),{color:"danger",variant:"outline",class:"w-100",onClick:$e},{default:r(()=>[l(e(g),{icon:"cil-lock-locked",class:"me-2"}),m(" "+o(e(n)("pos.closeSession")||"إغلاق الجلسة"),1)]),_:1})])]),_:1})]),_:1},8,["visible"])])}}},Po=at(co,[["__scopeId","data-v-c0073c44"]]);export{Po as default};
