import{f as b,e as ve,j as fe,c as v,o as p,d as a,b as o,w as c,u as e,a0 as R,x,P as h,C as u,t as n,$ as G,a2 as y,aa as ye,ab as he,a3 as N,a4 as D,s as F,ac as ge,F as q,g as Y,a as k,Y as J,n as be,ae as ke,a5 as Q,a6 as X,a7 as Z,a8 as ee}from"../chunk-vendor-vue-VAxhpvd9.js";import{u as Ce,a as M}from"../chunk-component-NotificationsBell-CTLJWkW4.js";import{P as we}from"../chunk-component-PageHeader-CMYNL4hu.js";import{S as P}from"../chunk-component-StatCard-B1HS9GpT.js";import{_ as Ve,C as te}from"../chunk-component-Card-DPM96EeB.js";import{E as xe}from"../chunk-component-EmptyState-DXFewvrN.js";import{L as ae}from"../chunk-component-LoadingSpinner-CNyGcK0V.js";import{H as Ne}from"../chunk-component-HelpSection-NeetTt3d.js";import{u as De}from"../chunk-view-AppleWallet/Simulator-BwS6bEkK.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-pinia-CjQxP09R.js";import"../chunk-vendor-axios-B9ygI19o.js";const Me={class:"payments-page"},Se={class:"stats-grid"},Te={value:""},Ue={value:"completed"},Fe={value:"pending"},Pe={value:"failed"},Ee={value:"refunded"},Ie={value:""},$e={value:"cash"},Ke={value:"card"},Le={key:2,class:"table-wrapper"},Oe={class:"table-header-row"},Ae={class:"th-number"},Be={class:"th-customer"},We={class:"th-amount"},ze={class:"th-method"},He={class:"th-status"},je={class:"th-date"},Re={class:"th-actions"},Ge={class:"td-id"},qe={class:"payment-id-badge"},Ye={class:"td-number"},Je={class:"d-flex align-items-center gap-2"},Qe={class:"payment-number"},Xe={class:"td-customer"},Ze={class:"payment-customer-cell"},et={class:"customer-name"},tt=["href"],at={key:1,class:"text-muted d-block"},ot={class:"td-amount"},st={class:"unified-amount"},lt={class:"td-method"},nt={class:"td-status"},ct={class:"td-date"},it={class:"date-cell"},rt={class:"td-actions"},ut={class:"actions-group"},dt=["onClick","title"],mt=["onClick","title"],pt={key:0,class:"d-flex justify-content-between align-items-center"},_t={class:"text-muted"},vt={key:1,class:"payment-details"},ft={class:"details-grid"},yt={class:"detail-row"},ht={class:"k"},gt={class:"v"},bt={key:0,class:"detail-row"},kt={class:"v"},Ct={class:"detail-row"},wt={class:"k"},Vt={class:"v"},xt={class:"detail-row"},Nt={class:"k"},Dt={class:"v"},Mt={class:"detail-row"},St={class:"k"},Tt={class:"v"},Ut={class:"detail-row"},Ft={class:"k"},Pt={class:"v"},Et={key:1,class:"detail-row"},It={class:"k"},$t={class:"v"},Kt={key:2,class:"detail-row"},Lt={class:"v"},Ot={key:3,class:"detail-row"},At={class:"v"},Bt={value:""},Wt=["value"],zt={value:"cash"},Ht={value:"card"},jt={value:"completed"},Rt={value:"pending"},Gt={value:"failed"},qt={__name:"Index",setup(Yt){const{t}=Ce(),w=De(),C=b([]),E=b(!1),I=b(!1),$=b(!1),m=b(null),S=b(!1),T=b(!1),K=b([]),_=b({search:"",status:"",payment_method:"",date_from:"",date_to:""}),d=b({current_page:1,per_page:20,total:0,total_pages:0}),U=ve(()=>{const i=C.value.length,s=C.value.filter(V=>V.status==="completed").length,l=C.value.filter(V=>V.status==="pending").length,g=C.value.reduce((V,_e)=>V+(parseFloat(_e.amount)||0),0);return{total:i,completed:s,pending:l,totalAmount:g}}),O=i=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(i||0),oe=i=>{if(!i&&i!==0)return"0 KWD";const s=parseFloat(i);return s>=1e3?`${(s/1e3).toFixed(1)}K KWD`:`${s.toFixed(0)} KWD`},A=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",B=i=>({completed:t("payments.completed"),pending:t("payments.pending"),failed:t("payments.failed"),refunded:t("payments.refunded")})[i]||i,W=i=>({cash:t("payments.cash"),card:t("payments.card"),knet:"KNET",online:"Online"})[i]||i,se=i=>({cash:"cil-money",card:"cil-credit-card",knet:"cil-bank",online:"cil-globe-alt"})[i]||"cil-info",le=i=>({completed:"cil-check-circle",pending:"cil-clock",failed:"cil-x-circle",refunded:"cil-reload"})[i]||"cil-info",f=async()=>{var i;E.value=!0;try{const s={page:d.value.current_page,per_page:d.value.per_page,..._.value};Object.keys(s).forEach(V=>{s[V]===""&&delete s[V]});const l=await M.get("/payments",{params:s,noCache:!0}),g=((i=l.data)==null?void 0:i.data)||l.data||{};C.value=g.items||[],d.value=g.pagination||d.value}catch(s){console.error("Error loading payments:",s),w.error(t("common.errorLoading")),C.value=[],d.value={current_page:1,per_page:20,total:0,total_pages:0}}finally{E.value=!1}},ne=i=>{d.value.current_page=i,f()};let z;const ce=()=>{clearTimeout(z),z=setTimeout(()=>{d.value.current_page=1,f()},500)},ie=()=>{_.value={search:"",status:"",payment_method:"",date_from:"",date_to:""},d.value.current_page=1,f()},re=()=>{console.log("Exporting payments data..."),alert(t("common.export")+" - "+t("payments.title"))},H=()=>{$.value=!1,m.value=null,S.value=!1},ue=async i=>{var s;$.value=!0,S.value=!0,m.value=i;try{const l=await M.get(`/payments/${i.id}`,{noCache:!0}),g=((s=l.data)==null?void 0:s.data)||l.data||{};m.value={...i,...g}}catch(l){console.error("Error loading payment:",l),w.error(t("common.errorLoading"))}finally{S.value=!1}},de=async i=>{if(confirm(`Approve payment ${i.payment_number}?`))try{await M.put(`/payments/${i.id}`,{status:"completed"}),w.success(t("payments.completed")),f()}catch(s){console.error("Error approving payment:",s),w.error(t("common.errorLoading"))}},L=()=>{I.value=!1,T.value=!1},j=async()=>{I.value=!0,await me()},me=async()=>{var i;if(!(K.value.length>0))try{const s=await M.get("/customers",{params:{per_page:100},noCache:!0}),l=((i=s.data)==null?void 0:i.data)||s.data||{};K.value=l.items||[]}catch(s){console.error("Error loading customers:",s)}},r=b({customer_id:"",amount:0,payment_method:"cash",status:"completed",reference_number:"",notes:"",payment_date:""}),pe=async()=>{if(!r.value.customer_id){w.error(`${t("payments.customer")} is required`);return}if(!r.value.amount||Number(r.value.amount)<=0){w.error("Amount must be greater than 0");return}T.value=!0;try{const i={customer_id:Number(r.value.customer_id),amount:Number(r.value.amount),payment_method:r.value.payment_method,status:r.value.status,reference_number:r.value.reference_number||"",notes:r.value.notes||"",payment_date:r.value.payment_date?new Date(r.value.payment_date).toISOString().slice(0,19).replace("T"," "):void 0};await M.post("/payments",i),w.success(t("common.save")),L(),r.value={customer_id:"",amount:0,payment_method:"cash",status:"completed",reference_number:"",notes:"",payment_date:""},f()}catch(i){console.error("Create payment error:",i),w.error(t("common.errorLoading"))}finally{T.value=!1}};return fe(()=>{f()}),(i,s)=>(p(),v("div",Me,[a(we,{title:e(t)("payments.title"),subtitle:e(t)("payments.subtitle")||e(t)("payments.title")+" - "+e(t)("dashboard.subtitle")},{icon:c(()=>[a(e(u),{icon:"cil-money"})]),actions:c(()=>[a(e(x),{color:"secondary",variant:"outline",onClick:re,class:"me-2 export-btn"},{default:c(()=>[a(e(u),{icon:"cil-cloud-download",class:"me-2"}),h(" "+n(e(t)("common.export")),1)]),_:1}),a(e(x),{color:"primary",class:"btn-primary-custom",onClick:j},{default:c(()=>[a(e(u),{icon:"cil-plus",class:"me-2"}),h(" "+n(e(t)("payments.addNew")),1)]),_:1})]),_:1},8,["title","subtitle"]),o("div",Se,[a(P,{label:e(t)("payments.title"),value:U.value.total||C.value.length,"badge-variant":"info",color:"gold",clickable:!0,onClick:s[0]||(s[0]=()=>{_.value.status="",d.value.current_page=1,f()})},{icon:c(()=>[a(e(u),{icon:"cil-money"})]),_:1},8,["label","value"]),a(P,{label:e(t)("payments.completed"),value:U.value.completed,"badge-variant":"success",color:"gold",clickable:!0,onClick:s[1]||(s[1]=()=>{_.value.status="completed",d.value.current_page=1,f()})},{icon:c(()=>[a(e(u),{icon:"cil-check-circle"})]),_:1},8,["label","value"]),a(P,{label:e(t)("payments.pending"),value:U.value.pending,"badge-variant":"warning",color:"gold",clickable:!0,onClick:s[2]||(s[2]=()=>{_.value.status="pending",d.value.current_page=1,f()})},{icon:c(()=>[a(e(u),{icon:"cil-clock"})]),_:1},8,["label","value"]),a(P,{label:e(t)("payments.totalAmount"),value:oe(U.value.totalAmount),"badge-variant":"info",color:"gold"},{icon:c(()=>[a(e(u),{icon:"cil-dollar"})]),_:1},8,["label","value"])]),a(te,{title:e(t)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:c(()=>[a(e(G),{class:"g-3"},{default:c(()=>[a(e(y),{md:4},{default:c(()=>[a(e(ye),{class:"search-input-group"},{default:c(()=>[a(e(he),{class:"search-icon-wrapper"},{default:c(()=>[a(e(u),{icon:"cil-magnifying-glass"})]),_:1}),a(e(N),{modelValue:_.value.search,"onUpdate:modelValue":s[3]||(s[3]=l=>_.value.search=l),placeholder:e(t)("common.search"),onInput:ce,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(e(y),{md:3},{default:c(()=>[a(e(D),{modelValue:_.value.status,"onUpdate:modelValue":s[4]||(s[4]=l=>_.value.status=l),onChange:f,class:"filter-select"},{default:c(()=>[o("option",Te,n(e(t)("common.status")),1),o("option",Ue,n(e(t)("payments.completed")),1),o("option",Fe,n(e(t)("payments.pending")),1),o("option",Pe,n(e(t)("payments.failed")),1),o("option",Ee,n(e(t)("payments.refunded")),1)]),_:1},8,["modelValue"])]),_:1}),a(e(y),{md:3},{default:c(()=>[a(e(D),{modelValue:_.value.payment_method,"onUpdate:modelValue":s[5]||(s[5]=l=>_.value.payment_method=l),onChange:f,class:"filter-select"},{default:c(()=>[o("option",Ie,n(e(t)("payments.method")),1),o("option",$e,n(e(t)("payments.cash")),1),o("option",Ke,n(e(t)("payments.card")),1),s[15]||(s[15]=o("option",{value:"knet"},"KNET",-1)),s[16]||(s[16]=o("option",{value:"online"},"Online",-1))]),_:1},8,["modelValue"])]),_:1}),a(e(y),{md:2},{default:c(()=>[a(e(N),{modelValue:_.value.date_from,"onUpdate:modelValue":s[6]||(s[6]=l=>_.value.date_from=l),type:"date",label:e(t)("reports.fromDate"),onChange:f,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(y),{md:2},{default:c(()=>[a(e(N),{modelValue:_.value.date_to,"onUpdate:modelValue":s[7]||(s[7]=l=>_.value.date_to=l),type:"date",label:e(t)("reports.toDate"),onChange:f,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(y),{md:2},{default:c(()=>[a(e(x),{color:"secondary",variant:"outline",onClick:ie,class:"w-100 reset-btn"},{default:c(()=>[a(e(u),{icon:"cil-reload",class:"me-1"}),h(" "+n(e(t)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),a(te,{title:e(t)("payments.title"),icon:"cil-list"},{footer:c(()=>[d.value.total_pages>1?(p(),v("div",pt,[o("div",_t,n(e(t)("common.view"))+" "+n((d.value.current_page-1)*d.value.per_page+1)+" "+n(e(t)("common.to"))+" "+n(Math.min(d.value.current_page*d.value.per_page,d.value.total))+" "+n(e(t)("common.of"))+" "+n(d.value.total),1),a(e(ke),{pages:d.value.total_pages,"active-page":d.value.current_page,"onUpdate:activePage":ne},null,8,["pages","active-page"])])):k("",!0)]),default:c(()=>[E.value?(p(),F(ae,{key:0,text:e(t)("common.loading")},null,8,["text"])):C.value.length===0?(p(),F(xe,{key:1,title:e(t)("common.noData"),description:e(t)("payments.title")+" - "+e(t)("common.noData"),"icon-color":"gray"},{action:c(()=>[a(e(x),{color:"primary",class:"btn-primary-custom",onClick:j},{default:c(()=>[h(n(e(t)("payments.addNew")),1)]),_:1})]),_:1},8,["title","description"])):(p(),v("div",Le,[a(e(ge),{hover:"",responsive:"",class:"table-modern payments-table"},{default:c(()=>[o("thead",null,[o("tr",Oe,[s[17]||(s[17]=o("th",{class:"th-id"},"#",-1)),o("th",Ae,n(e(t)("payments.paymentNumber")),1),o("th",Be,n(e(t)("payments.customer")),1),o("th",We,n(e(t)("payments.amount")),1),o("th",ze,n(e(t)("payments.method")),1),o("th",He,n(e(t)("common.status")),1),o("th",je,n(e(t)("payments.date")),1),o("th",Re,n(e(t)("common.actions")),1)])]),o("tbody",null,[(p(!0),v(q,null,Y(C.value,l=>(p(),v("tr",{key:l.id,class:"table-row payment-row"},[o("td",Ge,[o("span",qe,"#"+n(l.id),1)]),o("td",Ye,[o("div",Je,[o("strong",Qe,"#"+n(l.payment_number||l.id),1),l.wc_payment_id?(p(),F(e(x),{key:0,color:"success",size:"sm",variant:"outline",href:`/wp-admin/post.php?post=${l.wc_payment_id}&action=edit`,target:"_blank",title:"WooCommerce Order #"+l.wc_payment_id,class:"wc-link-btn"},{default:c(()=>[a(e(u),{icon:"cil-cart",class:"me-1"}),s[18]||(s[18]=h(" WC ",-1))]),_:1},8,["href","title"])):k("",!0)])]),o("td",Xe,[o("div",Ze,[o("strong",et,n(l.customer_name||"N/A"),1),l.customer_phone?(p(),v("a",{key:0,href:`tel:${l.customer_phone}`,class:"phone-link"},[a(e(u),{icon:"cil-phone",class:"phone-icon"}),o("span",null,n(l.customer_phone),1)],8,tt)):k("",!0),l.invoice_number?(p(),v("small",at,[a(e(u),{icon:"cil-file",class:"me-1"}),h(" "+n(e(t)("payments.invoice"))+": "+n(l.invoice_number),1)])):k("",!0)])]),o("td",ot,[o("strong",st,[a(e(u),{icon:"cil-money",class:"money-icon"}),h(" "+n(O(l.amount||0)),1)])]),o("td",lt,[a(e(J),{class:"unified-badge"},{default:c(()=>[a(e(u),{icon:se(l.payment_method),class:"badge-icon"},null,8,["icon"]),o("span",null,n(W(l.payment_method)),1)]),_:2},1024)]),o("td",nt,[a(e(J),{class:be(["unified-badge status-badge",`status-${l.status||"pending"}`])},{default:c(()=>[a(e(u),{icon:le(l.status),class:"badge-icon"},null,8,["icon"]),o("span",null,n(B(l.status)),1)]),_:2},1032,["class"])]),o("td",ct,[o("div",it,[a(e(u),{icon:"cil-calendar",class:"date-icon"}),o("span",null,n(A(l.payment_date)),1)])]),o("td",rt,[o("div",ut,[o("button",{class:"action-btn",onClick:g=>ue(l),title:e(t)("common.view")},[a(e(u),{icon:"cil-info"})],8,dt),l.status==="pending"?(p(),v("button",{key:0,class:"action-btn",onClick:g=>de(l),title:e(t)("payments.completed")},[a(e(u),{icon:"cil-check"})],8,mt)):k("",!0)])])]))),128))])]),_:1})]))]),_:1},8,["title"]),a(e(R),{visible:$.value,onClose:H,size:"lg"},{default:c(()=>[a(e(Q),null,{default:c(()=>[a(e(X),null,{default:c(()=>{var l,g;return[a(e(u),{icon:"cil-money",class:"me-2"}),h(" "+n(e(t)("payments.paymentNumber"))+" "+n(((l=m.value)==null?void 0:l.payment_number)||((g=m.value)==null?void 0:g.id)||""),1)]}),_:1})]),_:1}),a(e(Z),null,{default:c(()=>[S.value?(p(),F(ae,{key:0,text:e(t)("common.loading")},null,8,["text"])):m.value?(p(),v("div",vt,[o("div",ft,[o("div",yt,[o("span",ht,n(e(t)("payments.customer")),1),o("span",gt,n(m.value.customer_name||"N/A"),1)]),m.value.customer_phone?(p(),v("div",bt,[s[19]||(s[19]=o("span",{class:"k"},"Phone",-1)),o("span",kt,n(m.value.customer_phone),1)])):k("",!0),o("div",Ct,[o("span",wt,n(e(t)("payments.amount")),1),o("span",Vt,n(O(m.value.amount||0)),1)]),o("div",xt,[o("span",Nt,n(e(t)("payments.method")),1),o("span",Dt,n(W(m.value.payment_method)),1)]),o("div",Mt,[o("span",St,n(e(t)("common.status")),1),o("span",Tt,n(B(m.value.status)),1)]),o("div",Ut,[o("span",Ft,n(e(t)("payments.date")),1),o("span",Pt,n(A(m.value.payment_date)),1)]),m.value.invoice_number?(p(),v("div",Et,[o("span",It,n(e(t)("payments.invoice")),1),o("span",$t,n(m.value.invoice_number),1)])):k("",!0),m.value.reference_number?(p(),v("div",Kt,[s[20]||(s[20]=o("span",{class:"k"},"Reference",-1)),o("span",Lt,n(m.value.reference_number),1)])):k("",!0),m.value.notes?(p(),v("div",Ot,[s[21]||(s[21]=o("span",{class:"k"},"Notes",-1)),o("span",At,n(m.value.notes),1)])):k("",!0)])])):k("",!0)]),_:1}),a(e(ee),null,{default:c(()=>[a(e(x),{color:"secondary",onClick:H},{default:c(()=>[h(n(e(t)("common.close")),1)]),_:1})]),_:1})]),_:1},8,["visible"]),a(e(R),{visible:I.value,onClose:L,size:"lg"},{default:c(()=>[a(e(Q),null,{default:c(()=>[a(e(X),null,{default:c(()=>[a(e(u),{icon:"cil-plus",class:"me-2"}),h(" "+n(e(t)("payments.addNew")),1)]),_:1})]),_:1}),a(e(Z),null,{default:c(()=>[a(e(G),{class:"g-3"},{default:c(()=>[a(e(y),{md:6},{default:c(()=>[a(e(D),{modelValue:r.value.customer_id,"onUpdate:modelValue":s[8]||(s[8]=l=>r.value.customer_id=l),label:e(t)("payments.customer"),class:"filter-select"},{default:c(()=>[o("option",Bt,n(e(t)("common.select")),1),(p(!0),v(q,null,Y(K.value,l=>(p(),v("option",{key:l.id,value:l.id},n(l.name)+" - "+n(l.phone),9,Wt))),128))]),_:1},8,["modelValue","label"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(N),{modelValue:r.value.amount,"onUpdate:modelValue":s[9]||(s[9]=l=>r.value.amount=l),modelModifiers:{number:!0},type:"number",step:"0.001",min:"0",label:e(t)("payments.amount"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(D),{modelValue:r.value.payment_method,"onUpdate:modelValue":s[10]||(s[10]=l=>r.value.payment_method=l),label:e(t)("payments.method"),class:"filter-select"},{default:c(()=>[o("option",zt,n(e(t)("payments.cash")),1),o("option",Ht,n(e(t)("payments.card")),1),s[22]||(s[22]=o("option",{value:"knet"},"KNET",-1)),s[23]||(s[23]=o("option",{value:"online"},"Online",-1))]),_:1},8,["modelValue","label"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(D),{modelValue:r.value.status,"onUpdate:modelValue":s[11]||(s[11]=l=>r.value.status=l),label:e(t)("common.status"),class:"filter-select"},{default:c(()=>[o("option",jt,n(e(t)("payments.completed")),1),o("option",Rt,n(e(t)("payments.pending")),1),o("option",Gt,n(e(t)("payments.failed")),1)]),_:1},8,["modelValue","label"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(N),{modelValue:r.value.reference_number,"onUpdate:modelValue":s[12]||(s[12]=l=>r.value.reference_number=l),label:"Reference",class:"filter-input"},null,8,["modelValue"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(N),{modelValue:r.value.payment_date,"onUpdate:modelValue":s[13]||(s[13]=l=>r.value.payment_date=l),type:"datetime-local",label:e(t)("payments.date"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(y),{md:12},{default:c(()=>[a(e(N),{modelValue:r.value.notes,"onUpdate:modelValue":s[14]||(s[14]=l=>r.value.notes=l),label:"Notes",class:"filter-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(e(ee),null,{default:c(()=>[a(e(x),{color:"secondary",onClick:L},{default:c(()=>[h(n(e(t)("common.cancel")),1)]),_:1}),a(e(x),{color:"primary",class:"btn-primary-custom",disabled:T.value,onClick:pe},{default:c(()=>[a(e(u),{icon:"cil-save",class:"me-2"}),h(" "+n(e(t)("common.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),a(Ne,{"page-key":"payments"})]))}},ia=Ve(qt,[["__scopeId","data-v-89b6145c"]]);export{ia as default};
