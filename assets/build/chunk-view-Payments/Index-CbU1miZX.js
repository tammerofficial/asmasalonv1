import{f as g,g as ve,i as fe,c as v,o as p,d as a,b as o,p as c,u as e,a5 as q,v as x,O as b,C as d,t as n,Y as G,Z as y,a0 as ye,a1 as he,$ as N,_ as D,q as L,a2 as ge,F as H,k as X,a as C,X as Y,n as be,a4 as ke,a6 as Z,a7 as J,a8 as Q,a9 as ee}from"../chunk-vendor-vue-DxcSX1Jd.js";import{u as Ce,a as M}from"../chunk-component-NotificationsBell-eCwis6PW.js";import{P as Ve}from"../chunk-component-PageHeader-BsA6C9en.js";import{S as F}from"../chunk-component-StatCard-AHk13FwB.js";import{_ as we,C as te}from"../chunk-component-Card-BWbCGpFM.js";import{E as xe}from"../chunk-component-EmptyState-B78c8qVh.js";import{L as ae}from"../chunk-component-LoadingSpinner-PYO1Yq7-.js";import{a as Ne}from"../chunk-view-Bookings/BookingAppearance-CtCwBfZ1.js";import"../chunk-vendor-BwxB3d-x.js";import"../chunk-vendor-charts-CNHMDSF7.js";import"../chunk-vendor-pinia-DRDRCEXO.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-DOq58Wm8.js";import"../chunk-view-Bookings/BookingFormPreview-BJuYIHYB.js";const De={class:"payments-page"},Me={class:"stats-grid"},Te={value:""},Se={value:"completed"},Ue={value:"pending"},Fe={value:"failed"},Ee={value:"refunded"},Ie={value:""},Pe={value:"cash"},$e={value:"card"},Ke={key:2,class:"table-wrapper"},Le={class:"table-header-row"},Oe={class:"th-number"},Ae={class:"th-customer"},Be={class:"th-amount"},We={class:"th-method"},ze={class:"th-status"},Re={class:"th-date"},je={class:"th-actions"},qe={class:"td-id"},Ge={class:"payment-id-badge"},He={class:"td-number"},Xe={class:"payment-number"},Ye={class:"td-customer"},Ze={class:"payment-customer-cell"},Je={class:"customer-name"},Qe=["href"],et={key:1,class:"text-muted d-block"},tt={class:"td-amount"},at={class:"unified-amount"},ot={class:"td-method"},st={class:"td-status"},lt={class:"td-date"},nt={class:"date-cell"},ct={class:"td-actions"},it={class:"actions-group"},ut=["onClick","title"],rt=["onClick","title"],dt={key:0,class:"d-flex justify-content-between align-items-center"},mt={class:"text-muted"},pt={key:1,class:"payment-details"},_t={class:"details-grid"},vt={class:"detail-row"},ft={class:"k"},yt={class:"v"},ht={key:0,class:"detail-row"},gt={class:"v"},bt={class:"detail-row"},kt={class:"k"},Ct={class:"v"},Vt={class:"detail-row"},wt={class:"k"},xt={class:"v"},Nt={class:"detail-row"},Dt={class:"k"},Mt={class:"v"},Tt={class:"detail-row"},St={class:"k"},Ut={class:"v"},Ft={key:1,class:"detail-row"},Et={class:"k"},It={class:"v"},Pt={key:2,class:"detail-row"},$t={class:"v"},Kt={key:3,class:"detail-row"},Lt={class:"v"},Ot={value:""},At=["value"],Bt={value:"cash"},Wt={value:"card"},zt={value:"completed"},Rt={value:"pending"},jt={value:"failed"},qt={__name:"Index",setup(Gt){const{t}=Ce(),V=Ne(),k=g([]),E=g(!1),I=g(!1),P=g(!1),m=g(null),T=g(!1),S=g(!1),$=g([]),_=g({search:"",status:"",payment_method:"",date_from:"",date_to:""}),r=g({current_page:1,per_page:20,total:0,total_pages:0}),U=ve(()=>{const i=k.value.length,s=k.value.filter(w=>w.status==="completed").length,l=k.value.filter(w=>w.status==="pending").length,h=k.value.reduce((w,_e)=>w+(parseFloat(_e.amount)||0),0);return{total:i,completed:s,pending:l,totalAmount:h}}),O=i=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",minimumFractionDigits:3}).format(i||0),oe=i=>{if(!i&&i!==0)return"0 KWD";const s=parseFloat(i);return s>=1e3?`${(s/1e3).toFixed(1)}K KWD`:`${s.toFixed(0)} KWD`},A=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",B=i=>({completed:t("payments.completed"),pending:t("payments.pending"),failed:t("payments.failed"),refunded:t("payments.refunded")})[i]||i,W=i=>({cash:t("payments.cash"),card:t("payments.card"),knet:"KNET",online:"Online"})[i]||i,se=i=>({cash:"cil-money",card:"cil-credit-card",knet:"cil-bank",online:"cil-globe-alt"})[i]||"cil-info",le=i=>({completed:"cil-check-circle",pending:"cil-clock",failed:"cil-x-circle",refunded:"cil-reload"})[i]||"cil-info",f=async()=>{var i;E.value=!0;try{const s={page:r.value.current_page,per_page:r.value.per_page,..._.value};Object.keys(s).forEach(w=>{s[w]===""&&delete s[w]});const l=await M.get("/payments",{params:s,noCache:!0}),h=((i=l.data)==null?void 0:i.data)||l.data||{};k.value=h.items||[],r.value=h.pagination||r.value}catch(s){console.error("Error loading payments:",s),V.error(t("common.errorLoading")),k.value=[],r.value={current_page:1,per_page:20,total:0,total_pages:0}}finally{E.value=!1}},ne=i=>{r.value.current_page=i,f()};let z;const ce=()=>{clearTimeout(z),z=setTimeout(()=>{r.value.current_page=1,f()},500)},ie=()=>{_.value={search:"",status:"",payment_method:"",date_from:"",date_to:""},r.value.current_page=1,f()},ue=()=>{console.log("Exporting payments data..."),alert(t("common.export")+" - "+t("payments.title"))},R=()=>{P.value=!1,m.value=null,T.value=!1},re=async i=>{var s;P.value=!0,T.value=!0,m.value=i;try{const l=await M.get(`/payments/${i.id}`,{noCache:!0}),h=((s=l.data)==null?void 0:s.data)||l.data||{};m.value={...i,...h}}catch(l){console.error("Error loading payment:",l),V.error(t("common.errorLoading"))}finally{T.value=!1}},de=async i=>{if(confirm(`Approve payment ${i.payment_number}?`))try{await M.put(`/payments/${i.id}`,{status:"completed"}),V.success(t("payments.completed")),f()}catch(s){console.error("Error approving payment:",s),V.error(t("common.errorLoading"))}},K=()=>{I.value=!1,S.value=!1},j=async()=>{I.value=!0,await me()},me=async()=>{var i;if(!($.value.length>0))try{const s=await M.get("/customers",{params:{per_page:100},noCache:!0}),l=((i=s.data)==null?void 0:i.data)||s.data||{};$.value=l.items||[]}catch(s){console.error("Error loading customers:",s)}},u=g({customer_id:"",amount:0,payment_method:"cash",status:"completed",reference_number:"",notes:"",payment_date:""}),pe=async()=>{if(!u.value.customer_id){V.error(`${t("payments.customer")} is required`);return}if(!u.value.amount||Number(u.value.amount)<=0){V.error("Amount must be greater than 0");return}S.value=!0;try{const i={customer_id:Number(u.value.customer_id),amount:Number(u.value.amount),payment_method:u.value.payment_method,status:u.value.status,reference_number:u.value.reference_number||"",notes:u.value.notes||"",payment_date:u.value.payment_date?new Date(u.value.payment_date).toISOString().slice(0,19).replace("T"," "):void 0};await M.post("/payments",i),V.success(t("common.save")),K(),u.value={customer_id:"",amount:0,payment_method:"cash",status:"completed",reference_number:"",notes:"",payment_date:""},f()}catch(i){console.error("Create payment error:",i),V.error(t("common.errorLoading"))}finally{S.value=!1}};return fe(()=>{f()}),(i,s)=>(p(),v("div",De,[a(Ve,{title:e(t)("payments.title"),subtitle:e(t)("payments.subtitle")||e(t)("payments.title")+" - "+e(t)("dashboard.subtitle")},{icon:c(()=>[a(e(d),{icon:"cil-money"})]),actions:c(()=>[a(e(x),{color:"secondary",variant:"outline",onClick:ue,class:"me-2 export-btn"},{default:c(()=>[a(e(d),{icon:"cil-cloud-download",class:"me-2"}),b(" "+n(e(t)("common.export")),1)]),_:1}),a(e(x),{color:"primary",class:"btn-primary-custom",onClick:j},{default:c(()=>[a(e(d),{icon:"cil-plus",class:"me-2"}),b(" "+n(e(t)("payments.addNew")),1)]),_:1})]),_:1},8,["title","subtitle"]),o("div",Me,[a(F,{label:e(t)("payments.title"),value:U.value.total||k.value.length,"badge-variant":"info",color:"gold",clickable:!0,onClick:s[0]||(s[0]=()=>{_.value.status="",r.value.current_page=1,f()})},{icon:c(()=>[a(e(d),{icon:"cil-money"})]),_:1},8,["label","value"]),a(F,{label:e(t)("payments.completed"),value:U.value.completed,"badge-variant":"success",color:"gold",clickable:!0,onClick:s[1]||(s[1]=()=>{_.value.status="completed",r.value.current_page=1,f()})},{icon:c(()=>[a(e(d),{icon:"cil-check-circle"})]),_:1},8,["label","value"]),a(F,{label:e(t)("payments.pending"),value:U.value.pending,"badge-variant":"warning",color:"gold",clickable:!0,onClick:s[2]||(s[2]=()=>{_.value.status="pending",r.value.current_page=1,f()})},{icon:c(()=>[a(e(d),{icon:"cil-clock"})]),_:1},8,["label","value"]),a(F,{label:e(t)("payments.totalAmount"),value:oe(U.value.totalAmount),"badge-variant":"info",color:"gold"},{icon:c(()=>[a(e(d),{icon:"cil-dollar"})]),_:1},8,["label","value"])]),a(te,{title:e(t)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:c(()=>[a(e(G),{class:"g-3"},{default:c(()=>[a(e(y),{md:4},{default:c(()=>[a(e(ye),{class:"search-input-group"},{default:c(()=>[a(e(he),{class:"search-icon-wrapper"},{default:c(()=>[a(e(d),{icon:"cil-magnifying-glass"})]),_:1}),a(e(N),{modelValue:_.value.search,"onUpdate:modelValue":s[3]||(s[3]=l=>_.value.search=l),placeholder:e(t)("common.search"),onInput:ce,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(e(y),{md:3},{default:c(()=>[a(e(D),{modelValue:_.value.status,"onUpdate:modelValue":s[4]||(s[4]=l=>_.value.status=l),onChange:f,class:"filter-select"},{default:c(()=>[o("option",Te,n(e(t)("common.status")),1),o("option",Se,n(e(t)("payments.completed")),1),o("option",Ue,n(e(t)("payments.pending")),1),o("option",Fe,n(e(t)("payments.failed")),1),o("option",Ee,n(e(t)("payments.refunded")),1)]),_:1},8,["modelValue"])]),_:1}),a(e(y),{md:3},{default:c(()=>[a(e(D),{modelValue:_.value.payment_method,"onUpdate:modelValue":s[5]||(s[5]=l=>_.value.payment_method=l),onChange:f,class:"filter-select"},{default:c(()=>[o("option",Ie,n(e(t)("payments.method")),1),o("option",Pe,n(e(t)("payments.cash")),1),o("option",$e,n(e(t)("payments.card")),1),s[15]||(s[15]=o("option",{value:"knet"},"KNET",-1)),s[16]||(s[16]=o("option",{value:"online"},"Online",-1))]),_:1},8,["modelValue"])]),_:1}),a(e(y),{md:2},{default:c(()=>[a(e(N),{modelValue:_.value.date_from,"onUpdate:modelValue":s[6]||(s[6]=l=>_.value.date_from=l),type:"date",label:e(t)("reports.fromDate"),onChange:f,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(y),{md:2},{default:c(()=>[a(e(N),{modelValue:_.value.date_to,"onUpdate:modelValue":s[7]||(s[7]=l=>_.value.date_to=l),type:"date",label:e(t)("reports.toDate"),onChange:f,class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(y),{md:2},{default:c(()=>[a(e(x),{color:"secondary",variant:"outline",onClick:ie,class:"w-100 reset-btn"},{default:c(()=>[a(e(d),{icon:"cil-reload",class:"me-1"}),b(" "+n(e(t)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),a(te,{title:e(t)("payments.title"),icon:"cil-list"},{footer:c(()=>[r.value.total_pages>1?(p(),v("div",dt,[o("div",mt,n(e(t)("common.view"))+" "+n((r.value.current_page-1)*r.value.per_page+1)+" "+n(e(t)("common.to"))+" "+n(Math.min(r.value.current_page*r.value.per_page,r.value.total))+" "+n(e(t)("common.of"))+" "+n(r.value.total),1),a(e(ke),{pages:r.value.total_pages,"active-page":r.value.current_page,"onUpdate:activePage":ne},null,8,["pages","active-page"])])):C("",!0)]),default:c(()=>[E.value?(p(),L(ae,{key:0,text:e(t)("common.loading")},null,8,["text"])):k.value.length===0?(p(),L(xe,{key:1,title:e(t)("common.noData"),description:e(t)("payments.title")+" - "+e(t)("common.noData"),"icon-color":"gray"},{action:c(()=>[a(e(x),{color:"primary",class:"btn-primary-custom",onClick:j},{default:c(()=>[b(n(e(t)("payments.addNew")),1)]),_:1})]),_:1},8,["title","description"])):(p(),v("div",Ke,[a(e(ge),{hover:"",responsive:"",class:"table-modern payments-table"},{default:c(()=>[o("thead",null,[o("tr",Le,[s[17]||(s[17]=o("th",{class:"th-id"},"#",-1)),o("th",Oe,n(e(t)("payments.paymentNumber")),1),o("th",Ae,n(e(t)("payments.customer")),1),o("th",Be,n(e(t)("payments.amount")),1),o("th",We,n(e(t)("payments.method")),1),o("th",ze,n(e(t)("common.status")),1),o("th",Re,n(e(t)("payments.date")),1),o("th",je,n(e(t)("common.actions")),1)])]),o("tbody",null,[(p(!0),v(H,null,X(k.value,l=>(p(),v("tr",{key:l.id,class:"table-row payment-row"},[o("td",qe,[o("span",Ge,"#"+n(l.id),1)]),o("td",He,[o("strong",Xe,"#"+n(l.payment_number||l.id),1)]),o("td",Ye,[o("div",Ze,[o("strong",Je,n(l.customer_name||"N/A"),1),l.customer_phone?(p(),v("a",{key:0,href:`tel:${l.customer_phone}`,class:"phone-link"},[a(e(d),{icon:"cil-phone",class:"phone-icon"}),o("span",null,n(l.customer_phone),1)],8,Qe)):C("",!0),l.invoice_number?(p(),v("small",et,[a(e(d),{icon:"cil-file",class:"me-1"}),b(" "+n(e(t)("payments.invoice"))+": "+n(l.invoice_number),1)])):C("",!0)])]),o("td",tt,[o("strong",at,[a(e(d),{icon:"cil-money",class:"money-icon"}),b(" "+n(O(l.amount||0)),1)])]),o("td",ot,[a(e(Y),{class:"unified-badge"},{default:c(()=>[a(e(d),{icon:se(l.payment_method),class:"badge-icon"},null,8,["icon"]),o("span",null,n(W(l.payment_method)),1)]),_:2},1024)]),o("td",st,[a(e(Y),{class:be(["unified-badge status-badge",`status-${l.status||"pending"}`])},{default:c(()=>[a(e(d),{icon:le(l.status),class:"badge-icon"},null,8,["icon"]),o("span",null,n(B(l.status)),1)]),_:2},1032,["class"])]),o("td",lt,[o("div",nt,[a(e(d),{icon:"cil-calendar",class:"date-icon"}),o("span",null,n(A(l.payment_date)),1)])]),o("td",ct,[o("div",it,[o("button",{class:"action-btn",onClick:h=>re(l),title:e(t)("common.view")},[a(e(d),{icon:"cil-info"})],8,ut),l.status==="pending"?(p(),v("button",{key:0,class:"action-btn",onClick:h=>de(l),title:e(t)("payments.completed")},[a(e(d),{icon:"cil-check"})],8,rt)):C("",!0)])])]))),128))])]),_:1})]))]),_:1},8,["title"]),a(e(q),{visible:P.value,onClose:R,size:"lg"},{default:c(()=>[a(e(Z),null,{default:c(()=>[a(e(J),null,{default:c(()=>{var l,h;return[a(e(d),{icon:"cil-money",class:"me-2"}),b(" "+n(e(t)("payments.paymentNumber"))+" "+n(((l=m.value)==null?void 0:l.payment_number)||((h=m.value)==null?void 0:h.id)||""),1)]}),_:1})]),_:1}),a(e(Q),null,{default:c(()=>[T.value?(p(),L(ae,{key:0,text:e(t)("common.loading")},null,8,["text"])):m.value?(p(),v("div",pt,[o("div",_t,[o("div",vt,[o("span",ft,n(e(t)("payments.customer")),1),o("span",yt,n(m.value.customer_name||"N/A"),1)]),m.value.customer_phone?(p(),v("div",ht,[s[18]||(s[18]=o("span",{class:"k"},"Phone",-1)),o("span",gt,n(m.value.customer_phone),1)])):C("",!0),o("div",bt,[o("span",kt,n(e(t)("payments.amount")),1),o("span",Ct,n(O(m.value.amount||0)),1)]),o("div",Vt,[o("span",wt,n(e(t)("payments.method")),1),o("span",xt,n(W(m.value.payment_method)),1)]),o("div",Nt,[o("span",Dt,n(e(t)("common.status")),1),o("span",Mt,n(B(m.value.status)),1)]),o("div",Tt,[o("span",St,n(e(t)("payments.date")),1),o("span",Ut,n(A(m.value.payment_date)),1)]),m.value.invoice_number?(p(),v("div",Ft,[o("span",Et,n(e(t)("payments.invoice")),1),o("span",It,n(m.value.invoice_number),1)])):C("",!0),m.value.reference_number?(p(),v("div",Pt,[s[19]||(s[19]=o("span",{class:"k"},"Reference",-1)),o("span",$t,n(m.value.reference_number),1)])):C("",!0),m.value.notes?(p(),v("div",Kt,[s[20]||(s[20]=o("span",{class:"k"},"Notes",-1)),o("span",Lt,n(m.value.notes),1)])):C("",!0)])])):C("",!0)]),_:1}),a(e(ee),null,{default:c(()=>[a(e(x),{color:"secondary",onClick:R},{default:c(()=>[b(n(e(t)("common.close")),1)]),_:1})]),_:1})]),_:1},8,["visible"]),a(e(q),{visible:I.value,onClose:K,size:"lg"},{default:c(()=>[a(e(Z),null,{default:c(()=>[a(e(J),null,{default:c(()=>[a(e(d),{icon:"cil-plus",class:"me-2"}),b(" "+n(e(t)("payments.addNew")),1)]),_:1})]),_:1}),a(e(Q),null,{default:c(()=>[a(e(G),{class:"g-3"},{default:c(()=>[a(e(y),{md:6},{default:c(()=>[a(e(D),{modelValue:u.value.customer_id,"onUpdate:modelValue":s[8]||(s[8]=l=>u.value.customer_id=l),label:e(t)("payments.customer"),class:"filter-select"},{default:c(()=>[o("option",Ot,n(e(t)("common.select")),1),(p(!0),v(H,null,X($.value,l=>(p(),v("option",{key:l.id,value:l.id},n(l.name)+" - "+n(l.phone),9,At))),128))]),_:1},8,["modelValue","label"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(N),{modelValue:u.value.amount,"onUpdate:modelValue":s[9]||(s[9]=l=>u.value.amount=l),modelModifiers:{number:!0},type:"number",step:"0.001",min:"0",label:e(t)("payments.amount"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(D),{modelValue:u.value.payment_method,"onUpdate:modelValue":s[10]||(s[10]=l=>u.value.payment_method=l),label:e(t)("payments.method"),class:"filter-select"},{default:c(()=>[o("option",Bt,n(e(t)("payments.cash")),1),o("option",Wt,n(e(t)("payments.card")),1),s[21]||(s[21]=o("option",{value:"knet"},"KNET",-1)),s[22]||(s[22]=o("option",{value:"online"},"Online",-1))]),_:1},8,["modelValue","label"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(D),{modelValue:u.value.status,"onUpdate:modelValue":s[11]||(s[11]=l=>u.value.status=l),label:e(t)("common.status"),class:"filter-select"},{default:c(()=>[o("option",zt,n(e(t)("payments.completed")),1),o("option",Rt,n(e(t)("payments.pending")),1),o("option",jt,n(e(t)("payments.failed")),1)]),_:1},8,["modelValue","label"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(N),{modelValue:u.value.reference_number,"onUpdate:modelValue":s[12]||(s[12]=l=>u.value.reference_number=l),label:"Reference",class:"filter-input"},null,8,["modelValue"])]),_:1}),a(e(y),{md:6},{default:c(()=>[a(e(N),{modelValue:u.value.payment_date,"onUpdate:modelValue":s[13]||(s[13]=l=>u.value.payment_date=l),type:"datetime-local",label:e(t)("payments.date"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(y),{md:12},{default:c(()=>[a(e(N),{modelValue:u.value.notes,"onUpdate:modelValue":s[14]||(s[14]=l=>u.value.notes=l),label:"Notes",class:"filter-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(e(ee),null,{default:c(()=>[a(e(x),{color:"secondary",onClick:K},{default:c(()=>[b(n(e(t)("common.cancel")),1)]),_:1}),a(e(x),{color:"primary",class:"btn-primary-custom",disabled:S.value,onClick:pe},{default:c(()=>[a(e(d),{icon:"cil-save",class:"me-2"}),b(" "+n(e(t)("common.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"])]))}},ia=we(qt,[["__scopeId","data-v-8dbb1758"]]);export{ia as default};
