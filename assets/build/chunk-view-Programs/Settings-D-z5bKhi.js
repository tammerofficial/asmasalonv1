import{f as b,g as S,i as E,c as v,o as f,d as o,b as n,p as i,u as e,v as H,O as K,C as p,t as d,Y as x,Z as c,al as P,$ as _,_ as Y,F as U,k as I}from"../chunk-vendor-vue-DxcSX1Jd.js";import{u as Z,a as w}from"../chunk-component-NotificationsBell-eCwis6PW.js";import{a as q}from"../chunk-view-Bookings/BookingAppearance-CtCwBfZ1.js";import{P as z}from"../chunk-component-PageHeader-BsA6C9en.js";import{S as V}from"../chunk-component-StatCard-AHk13FwB.js";import{_ as G,C as M}from"../chunk-component-Card-BWbCGpFM.js";import"../chunk-vendor-BwxB3d-x.js";import"../chunk-vendor-charts-CNHMDSF7.js";import"../chunk-vendor-pinia-DRDRCEXO.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-DOq58Wm8.js";import"../chunk-view-Bookings/BookingFormPreview-BJuYIHYB.js";const J={class:"programs-settings-page"},Q={class:"stats-grid"},W={class:"override-builder"},X={class:"override-builder-title"},ee={class:"override-builder-row staff-override-row"},te={value:""},se=["value"],ae={class:"staff-rate"},oe={class:"small text-muted"},le={class:"staff-rate"},re={class:"small text-muted"},ie=["title"],ne={class:"overrides-list"},de={class:"overrides-list-title"},ue={key:0,class:"text-muted small"},me={key:1,class:"overrides-grid"},ce={class:"override-pill-title"},ve={class:"override-pill-value"},fe=["onClick"],pe={__name:"Settings",setup(_e){const{t:a}=Z(),g=q(),y=b(!1),C=b(null),l=b({loyalty:{enabled:!0,default_service_points:1,default_product_points:1,point_value_kwd:0,item_overrides:{}},commissions:{enabled:!0,default_service_rate:10,default_product_rate:5,staff_overrides:{}}}),k=b([]),u=b({staffId:"",service_rate:0,product_rate:0}),O=S({get(){var t,m,N,h;const r=Number(((m=(t=l.value)==null?void 0:t.loyalty)==null?void 0:m.default_service_points)??1),s=Number(((h=(N=l.value)==null?void 0:N.loyalty)==null?void 0:h.default_product_points)??r);return Number.isFinite(r)?r:Number.isFinite(s)?s:1},set(r){const s=Math.max(0,Number(r||0));l.value.loyalty.default_service_points=s,l.value.loyalty.default_product_points=s}}),F=S(()=>k.value||[]),D=S(()=>{var s,t;return Object.keys(((t=(s=l.value)==null?void 0:s.commissions)==null?void 0:t.staff_overrides)||{}).length}),L=S(()=>{if(!C.value)return"—";try{return new Date(C.value).toLocaleString()}catch{return"—"}}),B=async()=>{var t,m;const r=await w.get("/programs/settings",{noCache:!0}),s=((t=r.data)==null?void 0:t.data)||r.data||{};l.value={loyalty:{...l.value.loyalty||{},...s.loyalty||{},item_overrides:{}},commissions:{...l.value.commissions||{},...s.commissions||{},staff_overrides:((m=s.commissions)==null?void 0:m.staff_overrides)||{}}}},R=async()=>{var t;const[r]=await Promise.all([w.get("/staff",{params:{per_page:200},noCache:!0})]),s=((t=r.data)==null?void 0:t.data)||r.data||{};k.value=s.items||s||[]},T=()=>{const r=String(u.value.staffId||"");if(!r){g.error(a("programsSettings.selectStaff"));return}const s=Number(u.value.service_rate||0),t=Number(u.value.product_rate||0);l.value.commissions.staff_overrides={...l.value.commissions.staff_overrides||{},[r]:{service_rate:s,product_rate:t}},u.value={staffId:"",service_rate:0,product_rate:0},g.success(a("programsSettings.added"))},$=r=>{const s={...l.value.commissions.staff_overrides||{}};delete s[String(r)],l.value.commissions.staff_overrides=s},j=r=>{const s=k.value.find(t=>String(t.id)===String(r));return s?s.name:`#${r}`},A=async()=>{y.value=!0;try{const r={loyalty:{...l.value.loyalty,default_service_points:Number(l.value.loyalty.default_service_points||0),default_product_points:Number(l.value.loyalty.default_product_points||0),point_value_kwd:Number(l.value.loyalty.point_value_kwd||0),item_overrides:{}},commissions:{...l.value.commissions,default_service_rate:Number(l.value.commissions.default_service_rate||0),default_product_rate:Number(l.value.commissions.default_product_rate||0)}};await w.put("/programs/settings",r),C.value=new Date().toISOString(),g.success(a("programsSettings.saved"))}catch(r){console.error("Save programs settings error:",r),g.error(a("common.errorLoading"))}finally{y.value=!1}};return E(async()=>{try{await Promise.all([R(),B()])}catch(r){console.error("Programs settings init error:",r),g.error(a("common.errorLoading"))}}),(r,s)=>(f(),v("div",J,[o(z,{title:e(a)("programsSettings.title"),subtitle:e(a)("programsSettings.subtitle")},{icon:i(()=>[o(e(p),{icon:"cil-settings"})]),actions:i(()=>[o(e(H),{color:"primary",class:"btn-primary-custom",disabled:y.value,onClick:A},{default:i(()=>[o(e(p),{icon:"cil-save",class:"me-2"}),K(" "+d(y.value?e(a)("common.saving"):e(a)("common.save")),1)]),_:1},8,["disabled"])]),_:1},8,["title","subtitle"]),n("div",Q,[o(V,{label:e(a)("programsSettings.loyaltySection"),value:l.value.loyalty.enabled?e(a)("common.active"):e(a)("common.inactive"),"badge-variant":"info",color:"gold"},{icon:i(()=>[o(e(p),{icon:"cil-star"})]),_:1},8,["label","value"]),o(V,{label:e(a)("programsSettings.commissionsSection"),value:l.value.commissions.enabled?e(a)("common.active"):e(a)("common.inactive"),"badge-variant":"info",color:"gold"},{icon:i(()=>[o(e(p),{icon:"cil-dollar"})]),_:1},8,["label","value"]),o(V,{label:e(a)("programsSettings.overrides"),value:D.value,"badge-variant":"info",color:"gold"},{icon:i(()=>[o(e(p),{icon:"cil-list"})]),_:1},8,["label","value"]),o(V,{label:e(a)("programsSettings.lastSaved"),value:L.value,"badge-variant":"info",color:"gold"},{icon:i(()=>[o(e(p),{icon:"cil-clock"})]),_:1},8,["label","value"])]),o(M,{title:e(a)("programsSettings.loyaltySection"),icon:"cil-star",class:"section-card"},{default:i(()=>[o(e(x),{class:"g-3"},{default:i(()=>[o(e(c),{md:4},{default:i(()=>[o(e(P),{modelValue:l.value.loyalty.enabled,"onUpdate:modelValue":s[0]||(s[0]=t=>l.value.loyalty.enabled=t),label:e(a)("programsSettings.enabled")},null,8,["modelValue","label"])]),_:1}),o(e(c),{md:4},{default:i(()=>[o(e(_),{modelValue:O.value,"onUpdate:modelValue":s[1]||(s[1]=t=>O.value=t),modelModifiers:{number:!0},type:"number",min:"0",step:"1",label:e(a)("programsSettings.defaultPointsPerItem"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),o(e(c),{md:4},{default:i(()=>[o(e(_),{modelValue:l.value.loyalty.point_value_kwd,"onUpdate:modelValue":s[2]||(s[2]=t=>l.value.loyalty.point_value_kwd=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.001",label:e(a)("programsSettings.pointValueKwd"),class:"filter-input"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["title"]),o(M,{title:e(a)("programsSettings.commissionsSection"),icon:"cil-dollar",class:"section-card"},{default:i(()=>[o(e(x),{class:"g-3"},{default:i(()=>[o(e(c),{md:4},{default:i(()=>[o(e(P),{modelValue:l.value.commissions.enabled,"onUpdate:modelValue":s[3]||(s[3]=t=>l.value.commissions.enabled=t),label:e(a)("programsSettings.enabled")},null,8,["modelValue","label"])]),_:1}),o(e(c),{md:4},{default:i(()=>[o(e(_),{modelValue:l.value.commissions.default_service_rate,"onUpdate:modelValue":s[4]||(s[4]=t=>l.value.commissions.default_service_rate=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",label:e(a)("programsSettings.defaultServiceCommission"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),o(e(c),{md:4},{default:i(()=>[o(e(_),{modelValue:l.value.commissions.default_product_rate,"onUpdate:modelValue":s[5]||(s[5]=t=>l.value.commissions.default_product_rate=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",label:e(a)("programsSettings.defaultProductCommission"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),o(e(c),{md:12},{default:i(()=>[n("div",W,[n("div",X,d(e(a)("programsSettings.addStaffOverride")),1),n("div",ee,[o(e(Y),{modelValue:u.value.staffId,"onUpdate:modelValue":s[6]||(s[6]=t=>u.value.staffId=t),class:"filter-select"},{default:i(()=>[n("option",te,d(e(a)("programsSettings.selectStaff")),1),(f(!0),v(U,null,I(F.value,t=>(f(),v("option",{key:t.id,value:String(t.id)},d(t.name),9,se))),128))]),_:1},8,["modelValue"]),n("div",ae,[n("label",oe,d(e(a)("programsSettings.service"))+" %",1),o(e(_),{modelValue:u.value.service_rate,"onUpdate:modelValue":s[7]||(s[7]=t=>u.value.service_rate=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",class:"filter-input"},null,8,["modelValue"])]),n("div",le,[n("label",re,d(e(a)("programsSettings.product"))+" %",1),o(e(_),{modelValue:u.value.product_rate,"onUpdate:modelValue":s[8]||(s[8]=t=>u.value.product_rate=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",class:"filter-input"},null,8,["modelValue"])]),n("button",{class:"action-btn",type:"button",onClick:T,title:e(a)("common.add")},[o(e(p),{icon:"cil-plus"})],8,ie)])])]),_:1}),o(e(c),{md:12},{default:i(()=>[n("div",ne,[n("div",de,d(e(a)("programsSettings.currentStaffOverrides")),1),Object.keys(l.value.commissions.staff_overrides||{}).length===0?(f(),v("div",ue,d(e(a)("programsSettings.noStaffOverrides")),1)):(f(),v("div",me,[(f(!0),v(U,null,I(l.value.commissions.staff_overrides,(t,m)=>(f(),v("div",{key:m,class:"override-pill"},[n("div",ce,d(j(m)),1),n("div",ve,d(e(a)("programsSettings.service"))+": "+d(Number((t==null?void 0:t.service_rate)||0))+"% · "+d(e(a)("programsSettings.product"))+": "+d(Number((t==null?void 0:t.product_rate)||0))+"% ",1),n("button",{class:"pill-remove",type:"button",onClick:N=>$(m)},"×",8,fe)]))),128))]))])]),_:1})]),_:1})]),_:1},8,["title"])]))}},Pe=G(pe,[["__scopeId","data-v-ca7128bd"]]);export{Pe as default};
