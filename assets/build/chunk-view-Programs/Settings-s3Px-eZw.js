import{f as p,g as C,i as J,c as f,o as u,d as a,b as d,p as i,u as e,Z as Q,x as V,P as y,C as m,t as n,_ as x,$ as _,am as I,a1 as g,a0 as B,F as O,k as U,a7 as X,a8 as Y,a9 as ee,aa as te,s as D,e as ae}from"../chunk-vendor-vue-9XB69CcG.js";import{u as le,a as W}from"../chunk-component-NotificationsBell-B08mqdYR.js";import{u as se}from"../chunk-view-AppleWallet/Simulator-DC-H5xYN.js";import{P as oe}from"../chunk-component-PageHeader-DOCn2Cgp.js";import{S as k}from"../chunk-component-StatCard-COK6V2Ia.js";import{_ as re,C as L}from"../chunk-component-Card-CPZTx4Dn.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-BpPt1UDF.js";import"../chunk-vendor-axios-B9ygI19o.js";const ie={class:"programs-settings-page"},ne={class:"stats-grid"},de={class:"override-builder"},ue={class:"override-builder-title"},ce={class:"override-builder-row staff-override-row"},me={value:""},ve=["value"],pe={class:"staff-rate"},fe={class:"small text-muted"},_e={class:"staff-rate"},ge={class:"small text-muted"},be=["title"],ye={class:"overrides-list"},Se={class:"overrides-list-title"},Ce={key:0,class:"text-muted small"},Ve={key:1,class:"overrides-grid"},ke={class:"override-pill-title"},we={class:"override-pill-value"},Ne=["onClick"],Me={value:""},he=["value"],Pe={__name:"Settings",setup(Oe){const{t:s}=le(),b=se(),S=p(!1),w=p(null),T=p(!1),N=p(!1),R=p([]),M=p({customer_id:""}),o=p({loyalty:{enabled:!0,default_service_points:1,default_product_points:1,point_value_kwd:0,item_overrides:{}},commissions:{enabled:!0,default_service_rate:10,default_product_rate:5,staff_overrides:{}}}),h=p([]),c=p({staffId:"",service_rate:0,product_rate:0}),A=C({get(){var t,v,P,F;const r=Number(((v=(t=o.value)==null?void 0:t.loyalty)==null?void 0:v.default_service_points)??1),l=Number(((F=(P=o.value)==null?void 0:P.loyalty)==null?void 0:F.default_product_points)??r);return Number.isFinite(r)?r:Number.isFinite(l)?l:1},set(r){const l=Math.max(0,Number(r||0));o.value.loyalty.default_service_points=l,o.value.loyalty.default_product_points=l}}),$=C(()=>h.value||[]),j=C(()=>{var l,t;return Object.keys(((t=(l=o.value)==null?void 0:l.commissions)==null?void 0:t.staff_overrides)||{}).length}),z=C(()=>{if(!w.value)return"—";try{return new Date(w.value).toLocaleString()}catch{return"—"}}),H=async()=>{var t,v;const r=await W.get("/programs/settings",{noCache:!0}),l=((t=r.data)==null?void 0:t.data)||r.data||{};o.value={loyalty:{...o.value.loyalty||{},...l.loyalty||{},item_overrides:{}},commissions:{...o.value.commissions||{},...l.commissions||{},staff_overrides:((v=l.commissions)==null?void 0:v.staff_overrides)||{}}}},E=async()=>{var t;const[r]=await Promise.all([W.get("/staff",{params:{per_page:200},noCache:!0})]),l=((t=r.data)==null?void 0:t.data)||r.data||{};h.value=l.items||l||[]},K=()=>{const r=String(c.value.staffId||"");if(!r){b.error(s("programsSettings.selectStaff"));return}const l=Number(c.value.service_rate||0),t=Number(c.value.product_rate||0);o.value.commissions.staff_overrides={...o.value.commissions.staff_overrides||{},[r]:{service_rate:l,product_rate:t}},c.value={staffId:"",service_rate:0,product_rate:0},b.success(s("programsSettings.added"))},Z=r=>{const l={...o.value.commissions.staff_overrides||{}};delete l[String(r)],o.value.commissions.staff_overrides=l},q=r=>{const l=h.value.find(t=>String(t.id)===String(r));return l?l.name:`#${r}`},G=async()=>{S.value=!0;try{const r={loyalty:{...o.value.loyalty,default_service_points:Number(o.value.loyalty.default_service_points||0),default_product_points:Number(o.value.loyalty.default_product_points||0),point_value_kwd:Number(o.value.loyalty.point_value_kwd||0),item_overrides:{}},commissions:{...o.value.commissions,default_service_rate:Number(o.value.commissions.default_service_rate||0),default_product_rate:Number(o.value.commissions.default_product_rate||0)}};await W.put("/programs/settings",r),w.value=new Date().toISOString(),b.success(s("programsSettings.saved"))}catch(r){console.error("Save programs settings error:",r),b.error(s("common.errorLoading"))}finally{S.value=!1}};return J(async()=>{try{await Promise.all([E(),H()])}catch(r){console.error("Programs settings init error:",r),b.error(s("common.errorLoading"))}}),(r,l)=>(u(),f("div",ie,[a(oe,{title:e(s)("programsSettings.title"),subtitle:e(s)("programsSettings.subtitle")},{icon:i(()=>[a(e(m),{icon:"cil-settings"})]),actions:i(()=>[a(e(V),{color:"secondary",variant:"outline",class:"me-2 apple-wallet-btn",onClick:r.openAppleWalletModal},{default:i(()=>[a(e(m),{icon:"cil-wallet",class:"me-2"}),y(" "+n(e(s)("programsSettings.appleWallet")||"Apple Wallet"),1)]),_:1},8,["onClick"]),a(e(V),{color:"primary",class:"btn-primary-custom",disabled:S.value,onClick:G},{default:i(()=>[a(e(m),{icon:"cil-save",class:"me-2"}),y(" "+n(S.value?e(s)("common.saving"):e(s)("common.save")),1)]),_:1},8,["disabled"])]),_:1},8,["title","subtitle"]),d("div",ne,[a(k,{label:e(s)("programsSettings.loyaltySection"),value:o.value.loyalty.enabled?e(s)("common.active"):e(s)("common.inactive"),"badge-variant":"info",color:"gold"},{icon:i(()=>[a(e(m),{icon:"cil-star"})]),_:1},8,["label","value"]),a(k,{label:e(s)("programsSettings.commissionsSection"),value:o.value.commissions.enabled?e(s)("common.active"):e(s)("common.inactive"),"badge-variant":"info",color:"gold"},{icon:i(()=>[a(e(m),{icon:"cil-dollar"})]),_:1},8,["label","value"]),a(k,{label:e(s)("programsSettings.overrides"),value:j.value,"badge-variant":"info",color:"gold"},{icon:i(()=>[a(e(m),{icon:"cil-list"})]),_:1},8,["label","value"]),a(k,{label:e(s)("programsSettings.lastSaved"),value:z.value,"badge-variant":"info",color:"gold"},{icon:i(()=>[a(e(m),{icon:"cil-clock"})]),_:1},8,["label","value"])]),a(L,{title:e(s)("programsSettings.loyaltySection"),icon:"cil-star",class:"section-card"},{default:i(()=>[a(e(x),{class:"g-3"},{default:i(()=>[a(e(_),{md:4},{default:i(()=>[a(e(I),{modelValue:o.value.loyalty.enabled,"onUpdate:modelValue":l[0]||(l[0]=t=>o.value.loyalty.enabled=t),label:e(s)("programsSettings.enabled")},null,8,["modelValue","label"])]),_:1}),a(e(_),{md:4},{default:i(()=>[a(e(g),{modelValue:A.value,"onUpdate:modelValue":l[1]||(l[1]=t=>A.value=t),modelModifiers:{number:!0},type:"number",min:"0",step:"1",label:e(s)("programsSettings.defaultPointsPerItem"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(_),{md:4},{default:i(()=>[a(e(g),{modelValue:o.value.loyalty.point_value_kwd,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.loyalty.point_value_kwd=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.001",label:e(s)("programsSettings.pointValueKwd"),class:"filter-input"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["title"]),a(L,{title:e(s)("programsSettings.commissionsSection"),icon:"cil-dollar",class:"section-card"},{default:i(()=>[a(e(x),{class:"g-3"},{default:i(()=>[a(e(_),{md:4},{default:i(()=>[a(e(I),{modelValue:o.value.commissions.enabled,"onUpdate:modelValue":l[3]||(l[3]=t=>o.value.commissions.enabled=t),label:e(s)("programsSettings.enabled")},null,8,["modelValue","label"])]),_:1}),a(e(_),{md:4},{default:i(()=>[a(e(g),{modelValue:o.value.commissions.default_service_rate,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value.commissions.default_service_rate=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",label:e(s)("programsSettings.defaultServiceCommission"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(_),{md:4},{default:i(()=>[a(e(g),{modelValue:o.value.commissions.default_product_rate,"onUpdate:modelValue":l[5]||(l[5]=t=>o.value.commissions.default_product_rate=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",label:e(s)("programsSettings.defaultProductCommission"),class:"filter-input"},null,8,["modelValue","label"])]),_:1}),a(e(_),{md:12},{default:i(()=>[d("div",de,[d("div",ue,n(e(s)("programsSettings.addStaffOverride")),1),d("div",ce,[a(e(B),{modelValue:c.value.staffId,"onUpdate:modelValue":l[6]||(l[6]=t=>c.value.staffId=t),class:"filter-select"},{default:i(()=>[d("option",me,n(e(s)("programsSettings.selectStaff")),1),(u(!0),f(O,null,U($.value,t=>(u(),f("option",{key:t.id,value:String(t.id)},n(t.name),9,ve))),128))]),_:1},8,["modelValue"]),d("div",pe,[d("label",fe,n(e(s)("programsSettings.service"))+" %",1),a(e(g),{modelValue:c.value.service_rate,"onUpdate:modelValue":l[7]||(l[7]=t=>c.value.service_rate=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",class:"filter-input"},null,8,["modelValue"])]),d("div",_e,[d("label",ge,n(e(s)("programsSettings.product"))+" %",1),a(e(g),{modelValue:c.value.product_rate,"onUpdate:modelValue":l[8]||(l[8]=t=>c.value.product_rate=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",class:"filter-input"},null,8,["modelValue"])]),d("button",{class:"action-btn",type:"button",onClick:K,title:e(s)("common.add")},[a(e(m),{icon:"cil-plus"})],8,be)])])]),_:1}),a(e(_),{md:12},{default:i(()=>[d("div",ye,[d("div",Se,n(e(s)("programsSettings.currentStaffOverrides")),1),Object.keys(o.value.commissions.staff_overrides||{}).length===0?(u(),f("div",Ce,n(e(s)("programsSettings.noStaffOverrides")),1)):(u(),f("div",Ve,[(u(!0),f(O,null,U(o.value.commissions.staff_overrides,(t,v)=>(u(),f("div",{key:v,class:"override-pill"},[d("div",ke,n(q(v)),1),d("div",we,n(e(s)("programsSettings.service"))+": "+n(Number((t==null?void 0:t.service_rate)||0))+"% · "+n(e(s)("programsSettings.product"))+": "+n(Number((t==null?void 0:t.product_rate)||0))+"% ",1),d("button",{class:"pill-remove",type:"button",onClick:P=>Z(v)},"×",8,Ne)]))),128))]))])]),_:1})]),_:1})]),_:1},8,["title"]),a(e(Q),{visible:T.value,onClose:r.closeAppleWalletModal,size:"lg"},{default:i(()=>[a(e(X),null,{default:i(()=>[a(e(Y),null,{default:i(()=>[a(e(m),{icon:"cil-wallet",class:"me-2"}),y(" "+n(e(s)("programsSettings.createAppleWallet")||"Create Apple Wallet Pass"),1)]),_:1})]),_:1}),a(e(ee),null,{default:i(()=>[a(e(B),{modelValue:M.value.customer_id,"onUpdate:modelValue":l[9]||(l[9]=t=>M.value.customer_id=t),label:e(s)("common.selectCustomer")||"Select Customer",class:"mb-3"},{default:i(()=>[d("option",Me,n(e(s)("common.selectCustomer")||"Select Customer"),1),(u(!0),f(O,null,U(R.value,t=>(u(),f("option",{key:t.id,value:t.id},n(t.display_name||t.user_email),9,he))),128))]),_:1},8,["modelValue","label"])]),_:1}),a(e(te),null,{default:i(()=>[a(e(V),{color:"secondary",onClick:r.closeAppleWalletModal},{default:i(()=>[y(n(e(s)("common.cancel")),1)]),_:1},8,["onClick"]),a(e(V),{color:"primary",onClick:r.createAppleWalletPass,disabled:N.value||!M.value.customer_id},{default:i(()=>[N.value?(u(),D(e(ae),{key:0,size:"sm",class:"me-2"})):(u(),D(e(m),{key:1,icon:"cil-wallet",class:"me-2"})),y(" "+n(N.value?e(s)("common.creating"):e(s)("common.create")),1)]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["visible","onClose"])]))}},Re=re(Pe,[["__scopeId","data-v-6a323448"]]);export{Re as default};
