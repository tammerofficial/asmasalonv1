import{f as h,g as E,i as We,af as He,c as m,o as d,d as i,b as l,s as x,a as p,p as n,u as e,Z as Te,h as Je,x as q,n as L,P as _,C as r,t as c,Y as P,_ as Ge,$ as Y,a2 as Ye,a3 as Ze,a1 as Ke,a0 as Q,a4 as Xe,F as R,k as F,a6 as et,a7 as Se,a8 as $e,a9 as xe,aa as De,ac as tt}from"../chunk-vendor-vue-CVODRAc9.js";import{u as st,a as T}from"../chunk-component-NotificationsBell-BlaTfaiw.js";import{a as at}from"../chunk-view-Bookings/BookingAppearance-Vn9NL_13.js";import{P as ot}from"../chunk-component-PageHeader-DIMefZ9l.js";import{S as Z}from"../chunk-component-StatCard-CUh-yMQt.js";import{_ as lt,C as ue}from"../chunk-component-Card-DAbGoLxt.js";import{E as it}from"../chunk-component-EmptyState-B8o9iOHP.js";import{L as ct}from"../chunk-component-LoadingSpinner-DYzABkFM.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-DSPKUyr1.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-ChD_VDDH.js";import"../chunk-view-Bookings/BookingFormPreview-CiRU9DIL.js";const nt={class:"queue-page"},rt={class:"stats-grid"},ut={value:""},dt={value:"waiting"},vt={value:"called"},_t={value:"serving"},mt={value:"completed"},ft={value:""},pt={value:"today"},gt={value:"week"},ht={value:"month"},kt={key:2,class:"table-wrapper"},bt={class:"table-header-row"},yt={class:"th-ticket"},wt={class:"th-customer"},qt={class:"th-service"},Ct={class:"th-staff"},Tt={class:"th-status"},St={class:"th-time"},$t={class:"th-actions"},xt={class:"td-id"},Dt={class:"ticket-id-badge"},Vt={class:"td-ticket"},It={class:"ticket-number"},Bt={class:"td-customer"},At={class:"queue-customer-cell"},Et={class:"customer-name"},Lt={key:0,class:"text-muted d-block"},Mt={class:"td-service"},Ut={class:"queue-service-cell"},Nt={class:"td-staff"},Ot={class:"td-status"},Pt={class:"td-time"},Qt={class:"time-cell"},Rt={class:"td-actions"},Ft={class:"actions-group"},jt=["onClick","title","disabled"],zt=["onClick","title","disabled"],Wt=["onClick","title","disabled"],Ht=["onClick","title"],Jt={key:0,class:"d-flex justify-content-between align-items-center"},Gt={class:"text-muted"},Yt={key:3,class:"auto-refresh-indicator"},Zt={class:"text-muted"},Kt={class:"ticket-details-view"},Xt={class:"ticket-header"},es={class:"ticket-avatar"},ts={class:"ticket-header-info"},ss={class:"ticket-number-large"},as={class:"ticket-stats-grid"},os={class:"stat-item"},ls={class:"stat-content"},is={class:"stat-label"},cs={class:"stat-value"},ns={key:0,class:"stat-item"},rs={class:"stat-content"},us={class:"stat-label"},ds={class:"stat-value"},vs={key:1,class:"stat-item"},_s={class:"stat-content"},ms={class:"stat-label"},fs={class:"stat-value"},ps={key:2,class:"stat-item"},gs={class:"stat-content"},hs={class:"stat-label"},ks={class:"stat-value"},bs={class:"ticket-info-grid"},ys={key:0,class:"info-row"},ws={class:"info-label"},qs={class:"info-value"},Cs={key:1,class:"info-row"},Ts={class:"info-label"},Ss={class:"info-value"},$s=["href"],xs={key:2,class:"info-row"},Ds={class:"info-label"},Vs={class:"info-value"},Is={key:3,class:"info-row"},Bs={class:"info-label"},As={class:"info-value"},Es={key:4,class:"info-row"},Ls={class:"info-label"},Ms={class:"info-value"},Us={key:5,class:"info-row"},Ns={class:"info-label"},Os={class:"info-value"},Ps={class:"create-ticket-form"},Qs={class:"form-description"},Rs={class:"form-group"},Fs={class:"form-label"},js={class:"text-muted"},zs={value:null},Ws=["value"],Hs={class:"form-group"},Js={class:"form-label"},Gs={value:null},Ys=["value"],Zs={class:"form-group"},Ks={class:"form-label"},Xs={class:"text-muted"},ea={value:null},ta=["value"],sa={key:0,class:"text-muted d-block mt-1"},aa={key:1,class:"staff-status-legend mt-2"},oa={class:"text-muted d-flex align-items-center gap-2"},la={class:"form-group"},ia={class:"form-label"},ca={class:"upcoming-bookings-list"},na={class:"booking-time-display"},ra={class:"booking-details"},ua={class:"booking-customer-name"},da={class:"booking-service-name"},va={key:0,class:"booking-staff-name"},_a={class:"booking-action"},ma={__name:"Index",setup(fa){const{t:a}=st(),b=at();Je();const D=h([]),$=h(!1),j=h(!1),v=h(null),V=h(!0);let z=null;const K=h(!1),M=h([]),X=h(!1),de=h(""),ee=h(null),W=h(!1),g=h({customer_id:null,service_id:null,staff_id:null,notes:""}),te=h([]),se=h([]),ae=h([]),oe=h([]),ve=h(!1),_e=h(!1),me=h(!1),fe=E(()=>g.value.service_id?ae.value.filter(o=>{if(!o.is_active)return!1;let t=[];if(o.service_ids){if(Array.isArray(o.service_ids))t=o.service_ids;else if(typeof o.service_ids=="string")try{t=JSON.parse(o.service_ids)}catch{t=[]}}return!t||t.length===0?!0:t.includes(g.value.service_id)}).map(o=>{const t=oe.value.find(u=>u.staff_id===o.id&&["pending","customer_called","staff_called"].includes(u.status)),s=t&&t.queue_status&&t.queue_status!=="completed";return{...o,isBusy:s,currentCall:t}}).sort((o,t)=>o.isBusy===t.isBusy?0:o.isBusy?1:-1):[]),Ve=o=>{const t=o.isBusy?`[${a("workerCalls.busy")}]`:`[${a("workerCalls.available")}]`,s=o.name,u=o.position?` - ${o.position}`:"";return`${t} ${s}${u}`},y=h({search:"",status:"",date_filter:""}),w=h({current_page:1,per_page:20,total:0,total_pages:0}),B=E(()=>D.value.filter(o=>o.status==="waiting").length),le=E(()=>D.value.filter(o=>o.status==="serving").length),ie=E(()=>D.value.filter(o=>o.status==="completed").length),pe=E(()=>{const o=new Date().toISOString().split("T")[0];return D.value.filter(t=>(t.created_at?new Date(t.created_at).toISOString().split("T")[0]:null)===o).length}),ge=E(()=>{let o=[...D.value];if(y.value.status&&(o=o.filter(t=>t.status===y.value.status)),y.value.search){const t=y.value.search.toLowerCase();o=o.filter(s=>{const u=(s.ticket_number||`T-${s.id}`).toLowerCase(),f=(s.customer_name||"").toLowerCase(),k=(s.service_name||"").toLowerCase(),S=(s.staff_name||"").toLowerCase();return u.includes(t)||f.includes(t)||k.includes(t)||S.includes(t)})}if(y.value.date_filter){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate());o=o.filter(u=>{if(!u.created_at)return!1;const f=new Date(u.created_at);if(y.value.date_filter==="today")return f>=s;if(y.value.date_filter==="week"){const k=new Date(s);return k.setDate(k.getDate()-7),f>=k}else if(y.value.date_filter==="month"){const k=new Date(s);return k.setMonth(k.getMonth()-1),f>=k}return!0})}return o.sort((t,s)=>{const u={waiting:1,called:2,serving:3,completed:4},f=u[t.status]||5,k=u[s.status]||5;return f!==k?f-k:new Date(s.created_at)-new Date(t.created_at)})}),he=o=>({waiting:"status-waiting",called:"status-called",serving:"status-serving",completed:"status-completed"})[o]||"",ke=o=>({waiting:a("queue.waiting"),called:a("queue.called"),serving:a("queue.inProgress"),completed:a("bookings.completed"),cancelled:a("bookings.cancelled")})[o]||o,be=o=>({waiting:"cil-clock",called:"cil-bell",serving:"cil-user",completed:"cil-check-circle",cancelled:"cil-x-circle"})[o]||"cil-info",N=o=>o?new Date(o).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",C=async()=>{var o;$.value=!0;try{const t={page:w.value.current_page,per_page:w.value.per_page,...y.value};Object.keys(t).forEach(f=>{t[f]===""&&delete t[f]});const s=await T.get("/queue",{params:t}),u=((o=s.data)==null?void 0:o.data)||s.data||{};D.value=u.items||[],w.value=u.pagination||w.value}catch(t){console.error("Error loading tickets:",t),D.value=[],b.error(a("common.errorLoading"))}finally{$.value=!1}},Ie=o=>{w.value.current_page=o,C()};let ye;const Be=()=>{clearTimeout(ye),ye=setTimeout(()=>{w.value.current_page=1,C()},500)},Ae=()=>{y.value={search:"",status:"",date_filter:""},w.value.current_page=1,C()},H=o=>{y.value.status=o||"",w.value.current_page=1,C()},Ee=async()=>{var o;if(B.value===0){b.warning(a("queue.noWaitingTickets"));return}try{const t=await T.post("/queue/call-next");(o=t.data)!=null&&o.data?await ce(t.data.data):b.warning(a("queue.noWaitingTickets"))}catch(t){console.error("Error calling next:",t),b.error(a("queue.errorCallingTicket"))}},ce=async o=>{try{await T.post(`/queue/${o.id}/call`),b.success(`${a("queue.ticketCalled")}: ${o.ticket_number||o.id}`),await C()}catch(t){console.error("Error calling ticket:",t),b.error(a("queue.errorCallingTicket"))}},we=async o=>{try{await T.post(`/queue/${o.id}/start`),b.success(`${a("queue.serviceStarted")}: ${o.ticket_number||o.id}`),await C()}catch(t){console.error("Error starting service:",t),b.error(a("queue.errorStartingService"))}},qe=async o=>{try{await T.post(`/queue/${o.id}/complete`),b.success(`${a("queue.ticketCompleted")}: ${o.ticket_number||o.id}`),await C()}catch(t){console.error("Error completing ticket:",t),b.error(a("queue.errorCompletingTicket"))}},Le=async o=>{var t;try{const s=await T.get(`/queue/${o.id}`);v.value=((t=s.data)==null?void 0:t.data)||s.data||o,j.value=!0}catch(s){console.error("Error loading ticket details:",s),v.value=o,j.value=!0}},O=()=>{j.value=!1,v.value=null},Me=()=>{const o={exported_at:new Date().toISOString(),tickets:D.value,stats:{waiting:B.value,serving:le.value,completed:ie.value,totalToday:pe.value}},t=JSON.stringify(o,null,2),s=new Blob([t],{type:"application/json;charset=utf-8"}),u=URL.createObjectURL(s),f=document.createElement("a");f.href=u,f.download=`queue-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,document.body.appendChild(f),f.click(),f.remove(),URL.revokeObjectURL(u),b.success("âœ… "+a("common.export")+" "+a("queue.title"))},Ue=()=>{V.value=!V.value,V.value?Ce():ne()},Ce=()=>{ne(),z=setInterval(()=>{$.value||C()},5e3)},ne=()=>{z&&(clearInterval(z),z=null)},Ne=()=>{const t=`${window.location.href.split("#")[0]}#/display/queue`;window.open(t,"_blank","fullscreen=yes,width=1920,height=1080")},Oe=async()=>{var o,t,s;ve.value=!0;try{const u=await T.get("/customers",{params:{per_page:100,is_active:1}});te.value=((t=(o=u.data)==null?void 0:o.data)==null?void 0:t.items)||((s=u.data)==null?void 0:s.items)||[]}catch(u){console.error("Error loading customers:",u),te.value=[]}finally{ve.value=!1}},Pe=async()=>{var o,t,s;_e.value=!0;try{const u=await T.get("/services",{params:{per_page:100,is_active:1}});se.value=((t=(o=u.data)==null?void 0:o.data)==null?void 0:t.items)||((s=u.data)==null?void 0:s.items)||[]}catch(u){console.error("Error loading services:",u),se.value=[]}finally{_e.value=!1}},Qe=async()=>{var o,t,s,u,f,k;me.value=!0;try{const[S,A]=await Promise.all([T.get("/staff",{params:{per_page:100,is_active:1}}),T.get("/worker-calls",{params:{per_page:200}})]),U=((t=(o=S.data)==null?void 0:o.data)==null?void 0:t.items)||((s=S.data)==null?void 0:s.items)||[];oe.value=((f=(u=A.data)==null?void 0:u.data)==null?void 0:f.items)||((k=A.data)==null?void 0:k.items)||[],ae.value=U.map(I=>{let G=[];if(I.service_ids){if(Array.isArray(I.service_ids))G=I.service_ids;else if(typeof I.service_ids=="string")try{G=JSON.parse(I.service_ids)}catch{G=[]}}return{...I,service_ids:G}})}catch(S){console.error("Error loading staff:",S),ae.value=[],oe.value=[]}finally{me.value=!1}},Re=()=>{g.value.staff_id=null},Fe=async()=>{K.value=!0,g.value={customer_id:null,service_id:null,staff_id:null,notes:""},await Promise.all([Oe(),Pe(),Qe()])},re=()=>{K.value=!1,g.value={customer_id:null,service_id:null,staff_id:null,notes:""}},je=async()=>{var o;if(!g.value.service_id){b.error(a("queue.serviceRequired")||"Service is required");return}W.value=!0;try{const t={customer_id:g.value.customer_id||null,service_id:g.value.service_id,staff_id:g.value.staff_id||null,notes:g.value.notes||""};(o=(await T.post("/queue",t)).data)!=null&&o.data?(b.success(a("queue.ticketCreated")||"Ticket created successfully"),re(),await C(),await J()):b.error(a("queue.errorCreatingTicket")||"Error creating ticket")}catch(t){console.error("Error creating ticket:",t),b.error(a("queue.errorCreatingTicket")||"Error creating ticket")}finally{W.value=!1}},J=async()=>{var o,t,s;X.value=!0;try{const u=new Date().toISOString().split("T")[0],f=await T.get("/bookings",{params:{booking_date:u,status:"pending,confirmed",per_page:100}}),k=((t=(o=f.data)==null?void 0:o.data)==null?void 0:t.items)||((s=f.data)==null?void 0:s.items)||[];M.value=k.filter(S=>{if(!S.booking_date)return!1;const A=new Date(S.booking_date),U=new Date;return U.setHours(0,0,0,0),A>=U}).sort((S,A)=>{const U=new Date(`${S.booking_date} ${S.booking_time}`),I=new Date(`${A.booking_date} ${A.booking_time}`);return U-I})}catch(u){console.error("Error loading upcoming bookings:",u),M.value=[]}finally{X.value=!1}};E(()=>{if(!de.value)return M.value;const o=de.value.toLowerCase();return M.value.filter(t=>{const s=(t.customer_name||"").toLowerCase(),u=(t.service_name||"").toLowerCase(),f=(t.staff_name||"").toLowerCase(),k=(t.booking_time||"").toLowerCase();return s.includes(o)||u.includes(o)||f.includes(o)||k.includes(o)})});const ze=async o=>{var t;ee.value=o.id;try{const s={customer_id:o.customer_id,service_id:o.service_id,staff_id:o.staff_id||null,booking_id:o.id,notes:`From booking: ${o.booking_date} ${o.booking_time}`};(t=(await T.post("/queue",s)).data)!=null&&t.data?(b.success(a("queue.bookingAddedToQueue")||"Booking added to queue successfully"),await C(),await J()):b.error(a("queue.errorAddingToQueue")||"Error adding booking to queue")}catch(s){console.error("Error adding booking to queue:",s),b.error(a("queue.errorAddingToQueue")||"Error adding booking to queue")}finally{ee.value=null}};return We(()=>{C(),J(),V.value&&Ce(),setInterval(()=>{X.value||J()},3e4)}),He(()=>{ne()}),(o,t)=>(d(),m("div",nt,[i(ot,{title:e(a)("queue.title"),subtitle:e(a)("queue.subtitle")},{icon:n(()=>[i(e(r),{icon:"cil-list"})]),actions:n(()=>[i(e(q),{color:"secondary",variant:"outline",onClick:Ue,class:L([{active:V.value},"me-2"])},{default:n(()=>[i(e(r),{icon:V.value?"cil-reload":"cil-media-pause",class:"me-2"},null,8,["icon"]),_(" "+c(V.value?e(a)("queue.autoRefresh"):e(a)("common.pause")),1)]),_:1},8,["class"]),i(e(q),{color:"secondary",variant:"outline",onClick:Me,class:"me-2"},{default:n(()=>[i(e(r),{icon:"cil-cloud-download",class:"me-2"}),_(" "+c(e(a)("common.export")),1)]),_:1}),i(e(q),{color:"secondary",variant:"outline",onClick:C,disabled:$.value},{default:n(()=>[i(e(r),{icon:"cil-reload",class:L(["me-2",{spinning:$.value}])},null,8,["class"]),_(" "+c(e(a)("common.refresh")),1)]),_:1},8,["disabled"]),i(e(q),{color:"secondary",variant:"outline",onClick:Ne,class:"me-2"},{default:n(()=>[i(e(r),{icon:"cil-screen-desktop",class:"me-2"}),_(" "+c(e(a)("queue.displayMode")||"Display Mode"),1)]),_:1}),i(e(q),{color:"primary",size:"lg",onClick:Fe,class:"ms-2 btn-primary-custom"},{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-2"}),_(" "+c(e(a)("queue.addQueue")||"Add Queue"),1)]),_:1}),i(e(q),{color:"primary",size:"lg",onClick:Ee,disabled:B.value===0||$.value,class:"ms-2 btn-primary-custom"},{default:n(()=>[i(e(r),{icon:"cil-bell",class:"me-2"}),_(" "+c(e(a)("queue.next"))+" ",1),B.value>0?(d(),x(e(P),{key:0,color:"warning",class:"ms-2"},{default:n(()=>[_(c(B.value),1)]),_:1})):p("",!0)]),_:1},8,["disabled"])]),_:1},8,["title","subtitle"]),l("div",rt,[i(Z,{label:e(a)("queue.waiting"),value:B.value,badge:B.value+" "+e(a)("queue.waiting"),"badge-variant":"warning",color:"gold",clickable:!0,onClick:t[0]||(t[0]=s=>H("waiting"))},{icon:n(()=>[i(e(r),{icon:"cil-clock"})]),_:1},8,["label","value","badge"]),i(Z,{label:e(a)("queue.inProgress"),value:le.value,badge:le.value+" "+e(a)("queue.inProgress"),"badge-variant":"info",color:"gold",clickable:!0,onClick:t[1]||(t[1]=s=>H("serving"))},{icon:n(()=>[i(e(r),{icon:"cil-user"})]),_:1},8,["label","value","badge"]),i(Z,{label:e(a)("bookings.completed"),value:ie.value,badge:ie.value+" "+e(a)("bookings.completed"),"badge-variant":"success",color:"gold",clickable:!0,onClick:t[2]||(t[2]=s=>H("completed"))},{icon:n(()=>[i(e(r),{icon:"cil-check-circle"})]),_:1},8,["label","value","badge"]),i(Z,{label:e(a)("queue.totalToday"),value:pe.value,badge:e(a)("queue.totalToday"),"badge-variant":"info",color:"gold",clickable:!0,onClick:t[3]||(t[3]=s=>H(null))},{icon:n(()=>[i(e(r),{icon:"cil-list"})]),_:1},8,["label","value","badge"])]),i(ue,{title:e(a)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:n(()=>[i(e(Ge),{class:"g-3"},{default:n(()=>[i(e(Y),{md:4},{default:n(()=>[i(e(Ye),{class:"search-input-group"},{default:n(()=>[i(e(Ze),{class:"search-icon-wrapper"},{default:n(()=>[i(e(r),{icon:"cil-magnifying-glass"})]),_:1}),i(e(Ke),{modelValue:y.value.search,"onUpdate:modelValue":t[4]||(t[4]=s=>y.value.search=s),placeholder:e(a)("queue.searchPlaceholder"),onInput:Be,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),i(e(Y),{md:3},{default:n(()=>[i(e(Q),{modelValue:y.value.status,"onUpdate:modelValue":t[5]||(t[5]=s=>y.value.status=s),onChange:C,class:"filter-select"},{default:n(()=>[l("option",ut,c(e(a)("queue.allStatuses")),1),l("option",dt,c(e(a)("queue.waiting")),1),l("option",vt,c(e(a)("queue.called")),1),l("option",_t,c(e(a)("queue.inProgress")),1),l("option",mt,c(e(a)("bookings.completed")),1)]),_:1},8,["modelValue"])]),_:1}),i(e(Y),{md:3},{default:n(()=>[i(e(Q),{modelValue:y.value.date_filter,"onUpdate:modelValue":t[6]||(t[6]=s=>y.value.date_filter=s),onChange:C,class:"filter-select"},{default:n(()=>[l("option",ft,c(e(a)("common.date")||"Date"),1),l("option",pt,c(e(a)("common.today")||"Today"),1),l("option",gt,c(e(a)("common.thisWeek")||"This Week"),1),l("option",ht,c(e(a)("common.thisMonth")||"This Month"),1)]),_:1},8,["modelValue"])]),_:1}),i(e(Y),{md:2},{default:n(()=>[i(e(q),{color:"secondary",variant:"outline",onClick:Ae,class:"w-100 reset-btn"},{default:n(()=>[i(e(r),{icon:"cil-reload",class:"me-1"}),_(" "+c(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),i(ue,{title:e(a)("queue.title"),icon:"cil-list"},{footer:n(()=>[w.value.total_pages>1?(d(),m("div",Jt,[l("div",Gt,c(e(a)("common.view"))+" "+c((w.value.current_page-1)*w.value.per_page+1)+" "+c(e(a)("common.to"))+" "+c(Math.min(w.value.current_page*w.value.per_page,w.value.total))+" "+c(e(a)("common.of"))+" "+c(w.value.total),1),i(e(et),{pages:w.value.total_pages,"active-page":w.value.current_page,"onUpdate:activePage":Ie},null,8,["pages","active-page"])])):p("",!0)]),default:n(()=>[$.value?(d(),x(ct,{key:0,text:e(a)("common.loading")},null,8,["text"])):ge.value.length===0?(d(),x(it,{key:1,title:e(a)("queue.noTickets"),description:e(a)("queue.noTicketsDesc"),"icon-color":"gray"},{action:n(()=>[i(e(q),{color:"primary",class:"btn-primary-custom",onClick:t[7]||(t[7]=s=>o.showCreateModal=!0)},{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-2"}),_(" "+c(e(a)("queue.addTicket")),1)]),_:1})]),_:1},8,["title","description"])):(d(),m("div",kt,[i(e(Xe),{hover:"",responsive:"",class:"table-modern queue-table"},{default:n(()=>[l("thead",null,[l("tr",bt,[t[15]||(t[15]=l("th",{class:"th-id"},"#",-1)),l("th",yt,c(e(a)("queue.ticketNumber")),1),l("th",wt,c(e(a)("queue.customer")),1),l("th",qt,c(e(a)("queue.service")),1),l("th",Ct,c(e(a)("queue.staff")),1),l("th",Tt,c(e(a)("queue.status")),1),l("th",St,c(e(a)("queue.checkInTime")),1),l("th",$t,c(e(a)("queue.actions")),1)])]),l("tbody",null,[(d(!0),m(R,null,F(ge.value,s=>(d(),m("tr",{key:s.id,class:L(["table-row queue-row",{"highlight-row":s.status==="waiting","serving-row":s.status==="serving","completed-row":s.status==="completed"}])},[l("td",xt,[l("span",Dt,"#"+c(s.id),1)]),l("td",Vt,[l("strong",It,c(s.ticket_number||`T-${String(s.id).padStart(4,"0")}`),1)]),l("td",Bt,[l("div",At,[l("strong",Et,c(s.customer_name||"-"),1),s.customer_phone?(d(),m("small",Lt,[i(e(r),{icon:"cil-phone",class:"me-1"}),_(" "+c(s.customer_phone),1)])):p("",!0)])]),l("td",Mt,[l("div",Ut,[i(e(r),{icon:"cil-spreadsheet",class:"me-1"}),_(" "+c(s.service_name||"-"),1)])]),l("td",Nt,[i(e(P),{color:"info",variant:"outline",class:"staff-badge"},{default:n(()=>[i(e(r),{icon:"cil-user",class:"me-1"}),_(" "+c(s.staff_name||"-"),1)]),_:2},1024)]),l("td",Ot,[i(e(P),{class:L(["unified-badge status-badge",he(s.status)])},{default:n(()=>[i(e(r),{icon:be(s.status),class:"badge-icon"},null,8,["icon"]),l("span",null,c(ke(s.status)),1)]),_:2},1032,["class"])]),l("td",Pt,[l("div",Qt,[i(e(r),{icon:"cil-clock",class:"me-1"}),_(" "+c(N(s.check_in_at)),1)])]),l("td",Rt,[l("div",Ft,[s.status==="waiting"?(d(),m("button",{key:0,class:"action-btn",onClick:u=>ce(s),title:e(a)("queue.call"),disabled:$.value},[i(e(r),{icon:"cil-bell"})],8,jt)):p("",!0),s.status==="called"?(d(),m("button",{key:1,class:"action-btn",onClick:u=>we(s),title:e(a)("queue.startService"),disabled:$.value},[i(e(r),{icon:"cil-play"})],8,zt)):p("",!0),s.status==="serving"?(d(),m("button",{key:2,class:"action-btn",onClick:u=>qe(s),title:e(a)("queue.complete"),disabled:$.value},[i(e(r),{icon:"cil-check"})],8,Wt)):p("",!0),l("button",{class:"action-btn",onClick:u=>Le(s),title:e(a)("common.view")},[i(e(r),{icon:"cil-info"})],8,Ht)])])],2))),128))])]),_:1})])),V.value&&!$.value?(d(),m("div",Yt,[i(e(r),{icon:"cil-reload",class:"spinning-slow me-2"}),l("small",Zt,c(e(a)("queue.refreshInterval")),1)])):p("",!0)]),_:1},8,["title"]),i(e(Te),{visible:j.value,onClose:O,size:"lg"},{default:n(()=>[i(e(Se),null,{default:n(()=>[i(e($e),null,{default:n(()=>[i(e(r),{icon:"cil-list",class:"me-2"}),_(" "+c(e(a)("queue.ticketDetails")||"Ticket Details"),1)]),_:1})]),_:1}),v.value?(d(),x(e(xe),{key:0},{default:n(()=>[l("div",Kt,[l("div",Xt,[l("div",es,[i(e(r),{icon:"cil-list"})]),l("div",ts,[l("h4",ss,c(v.value.ticket_number||`T-${String(v.value.id).padStart(4,"0")}`),1),i(e(P),{class:L(["unified-badge status-badge-large",he(v.value.status)])},{default:n(()=>[i(e(r),{icon:be(v.value.status),class:"me-1"},null,8,["icon"]),_(" "+c(ke(v.value.status)),1)]),_:1},8,["class"])])]),l("div",as,[l("div",os,[i(e(r),{icon:"cil-clock",class:"stat-icon"}),l("div",ls,[l("div",is,c(e(a)("queue.checkInTime")),1),l("div",cs,c(N(v.value.check_in_at)),1)])]),v.value.called_at?(d(),m("div",ns,[i(e(r),{icon:"cil-bell",class:"stat-icon"}),l("div",rs,[l("div",us,c(e(a)("queue.called")),1),l("div",ds,c(N(v.value.called_at)),1)])])):p("",!0),v.value.started_at?(d(),m("div",vs,[i(e(r),{icon:"cil-play",class:"stat-icon"}),l("div",_s,[l("div",ms,c(e(a)("queue.serviceStarted")),1),l("div",fs,c(N(v.value.started_at)),1)])])):p("",!0),v.value.completed_at?(d(),m("div",ps,[i(e(r),{icon:"cil-check-circle",class:"stat-icon"}),l("div",gs,[l("div",hs,c(e(a)("queue.complete")),1),l("div",ks,c(N(v.value.completed_at)),1)])])):p("",!0)]),l("div",bs,[v.value.customer_name?(d(),m("div",ys,[l("div",ws,[i(e(r),{icon:"cil-user",class:"me-2"}),_(" "+c(e(a)("queue.customer")),1)]),l("div",qs,c(v.value.customer_name),1)])):p("",!0),v.value.customer_phone?(d(),m("div",Cs,[l("div",Ts,[i(e(r),{icon:"cil-phone",class:"me-2"}),_(" "+c(e(a)("customers.phone")),1)]),l("div",Ss,[l("a",{href:`tel:${v.value.customer_phone}`,class:"info-link"},c(v.value.customer_phone),9,$s)])])):p("",!0),v.value.service_name?(d(),m("div",xs,[l("div",Ds,[i(e(r),{icon:"cil-spreadsheet",class:"me-2"}),_(" "+c(e(a)("queue.service")),1)]),l("div",Vs,c(v.value.service_name),1)])):p("",!0),v.value.staff_name?(d(),m("div",Is,[l("div",Bs,[i(e(r),{icon:"cil-user",class:"me-2"}),_(" "+c(e(a)("queue.staff")),1)]),l("div",As,c(v.value.staff_name),1)])):p("",!0),v.value.notes?(d(),m("div",Es,[l("div",Ls,[i(e(r),{icon:"cil-notes",class:"me-2"}),_(" "+c(e(a)("common.notes")||"Notes"),1)]),l("div",Ms,c(v.value.notes),1)])):p("",!0),v.value.created_at?(d(),m("div",Us,[l("div",Ns,[i(e(r),{icon:"cil-calendar",class:"me-2"}),_(" "+c(e(a)("common.createdAt")||"Created At"),1)]),l("div",Os,c(v.value.created_at?new Date(v.value.created_at).toLocaleString():"-"),1)])):p("",!0)])])]),_:1})):p("",!0),i(e(De),null,{default:n(()=>[i(e(q),{color:"secondary",onClick:O},{default:n(()=>[_(c(e(a)("common.close")||"Close"),1)]),_:1}),v.value&&v.value.status==="waiting"?(d(),x(e(q),{key:0,color:"primary",class:"btn-primary-custom",onClick:t[8]||(t[8]=()=>{O(),ce(v.value)})},{default:n(()=>[i(e(r),{icon:"cil-bell",class:"me-2"}),_(" "+c(e(a)("queue.call")),1)]),_:1})):p("",!0),v.value&&v.value.status==="called"?(d(),x(e(q),{key:1,color:"primary",class:"btn-primary-custom",onClick:t[9]||(t[9]=()=>{O(),we(v.value)})},{default:n(()=>[i(e(r),{icon:"cil-play",class:"me-2"}),_(" "+c(e(a)("queue.startService")),1)]),_:1})):p("",!0),v.value&&v.value.status==="serving"?(d(),x(e(q),{key:2,color:"primary",class:"btn-primary-custom",onClick:t[10]||(t[10]=()=>{O(),qe(v.value)})},{default:n(()=>[i(e(r),{icon:"cil-check",class:"me-2"}),_(" "+c(e(a)("queue.complete")),1)]),_:1})):p("",!0)]),_:1})]),_:1},8,["visible"]),i(e(Te),{visible:K.value,onClose:re,size:"lg",backdrop:"static"},{default:n(()=>[i(e(Se),null,{default:n(()=>[i(e($e),null,{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-2"}),_(" "+c(e(a)("queue.createTicket")||"Create Queue Ticket"),1)]),_:1})]),_:1}),i(e(xe),null,{default:n(()=>[l("div",Ps,[l("p",Qs,[i(e(r),{icon:"cil-info",class:"me-2"}),_(" "+c(e(a)("queue.createTicketDesc")||"Issue a ticket for a walk-in customer."),1)]),l("div",Rs,[l("label",Fs,[_(c(e(a)("bookings.customer"))+" ",1),l("span",js,"("+c(e(a)("common.optional")||"optional")+")",1)]),i(e(Q),{modelValue:g.value.customer_id,"onUpdate:modelValue":t[11]||(t[11]=s=>g.value.customer_id=s),class:"form-select-custom"},{default:n(()=>[l("option",zs,c(e(a)("queue.walkIn")||"Walk-in"),1),(d(!0),m(R,null,F(te.value,s=>(d(),m("option",{key:s.id,value:s.id},c(s.name)+c(s.phone?" - "+s.phone:""),9,Ws))),128))]),_:1},8,["modelValue"])]),l("div",Hs,[l("label",Js,[_(c(e(a)("bookings.service"))+" ",1),t[16]||(t[16]=l("span",{class:"text-danger"},"*",-1))]),i(e(Q),{modelValue:g.value.service_id,"onUpdate:modelValue":t[12]||(t[12]=s=>g.value.service_id=s),class:"form-select-custom",required:"",onChange:Re},{default:n(()=>[l("option",Gs,c(e(a)("queue.selectService")||"Select service"),1),(d(!0),m(R,null,F(se.value,s=>(d(),m("option",{key:s.id,value:s.id},c(s.name||s.name_ar||s.title),9,Ys))),128))]),_:1},8,["modelValue"])]),l("div",Zs,[l("label",Ks,[_(c(e(a)("bookings.staff"))+" ",1),l("span",Xs,"("+c(e(a)("common.optional")||"optional")+")",1)]),i(e(Q),{modelValue:g.value.staff_id,"onUpdate:modelValue":t[13]||(t[13]=s=>g.value.staff_id=s),class:"form-select-custom staff-select",disabled:!g.value.service_id},{default:n(()=>[l("option",ea,c(e(a)("queue.anyAvailableStaff")||"Any Available Staff"),1),(d(!0),m(R,null,F(fe.value,s=>(d(),m("option",{key:s.id,value:s.id,class:L(s.isBusy?"staff-busy-option":"staff-available-option")},c(Ve(s)),11,ta))),128))]),_:1},8,["modelValue","disabled"]),g.value.service_id?p("",!0):(d(),m("small",sa,c(e(a)("queue.selectServiceFirst")||"Please select a service first"),1)),g.value.service_id&&fe.value.length>0?(d(),m("div",aa,[l("small",oa,[t[17]||(t[17]=l("span",{class:"status-indicator available"},null,-1)),_(" "+c(e(a)("workerCalls.available"))+" ",1),t[18]||(t[18]=l("span",{class:"status-indicator busy ms-3"},null,-1)),_(" "+c(e(a)("workerCalls.busy")),1)])])):p("",!0)]),l("div",la,[l("label",ia,c(e(a)("common.notes")||"Notes"),1),i(e(tt),{modelValue:g.value.notes,"onUpdate:modelValue":t[14]||(t[14]=s=>g.value.notes=s),placeholder:e(a)("queue.notesPlaceholder")||"Optional notes for reception...",rows:"3",class:"form-textarea-custom"},null,8,["modelValue","placeholder"])])])]),_:1}),i(e(De),null,{default:n(()=>[i(e(q),{color:"secondary",onClick:re},{default:n(()=>[_(c(e(a)("common.cancel")||"Cancel"),1)]),_:1}),i(e(q),{color:"primary",class:"btn-primary-custom",onClick:je,disabled:!g.value.service_id||W.value},{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-2"}),_(" "+c(W.value?e(a)("common.creating")||"Creating...":e(a)("queue.createTicket")||"Create Ticket"),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),M.value.length>0?(d(),x(ue,{key:0,title:e(a)("queue.upcomingBookings")||"Upcoming Bookings",icon:"cil-calendar",class:"upcoming-bookings-card"},{default:n(()=>[l("div",ca,[(d(!0),m(R,null,F(M.value,s=>(d(),m("div",{key:s.id,class:L(["upcoming-booking-item",{"has-queue":s.queue_ticket_id}])},[l("div",na,[i(e(r),{icon:"cil-clock",class:"me-2"}),l("strong",null,c(s.booking_time),1)]),l("div",ra,[l("div",ua,[i(e(r),{icon:"cil-user",class:"me-1"}),_(" "+c(s.customer_name),1)]),l("div",da,[i(e(r),{icon:"cil-spreadsheet",class:"me-1"}),_(" "+c(s.service_name),1)]),s.staff_name?(d(),m("div",va,[i(e(r),{icon:"cil-user-female",class:"me-1"}),_(" "+c(s.staff_name),1)])):p("",!0)]),l("div",_a,[s.queue_ticket_id?(d(),x(e(P),{key:0,color:"success"},{default:n(()=>[i(e(r),{icon:"cil-check-circle",class:"me-1"}),_(" "+c(e(a)("queue.inQueue")||"In Queue"),1)]),_:1})):(d(),x(e(q),{key:1,color:"primary",size:"sm",onClick:u=>ze(s),disabled:ee.value===s.id},{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-1"}),_(" "+c(e(a)("queue.addToQueue")||"Add to Queue"),1)]),_:1},8,["onClick","disabled"]))])],2))),128))])]),_:1},8,["title"])):p("",!0)]))}},Ia=lt(ma,[["__scopeId","data-v-ff088ac3"]]);export{Ia as default};
