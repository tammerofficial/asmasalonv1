import{f as m,e as x,j as Ce,ag as Te,c as r,o as u,b as t,d as s,a as H,t as o,u as e,w as n,Y as L,x as v,C as d,$ as Se,P as _,F as C,g as T,a0 as se,l as Ve,n as Fe,a2 as S,a3 as $e,h as Be,s as ae,a5 as le,a6 as oe,a7 as ie,a8 as ne,a4 as E,a9 as Ie}from"../chunk-vendor-vue-VAxhpvd9.js";import{u as Me,a as b}from"../chunk-component-NotificationsBell-CTLJWkW4.js";import{u as De}from"../chunk-view-AppleWallet/Simulator-BwS6bEkK.js";import{H as Qe}from"../chunk-component-HelpSection-NeetTt3d.js";import{_ as Re}from"../chunk-component-Card-DPM96EeB.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-pinia-CjQxP09R.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-PageHeader-CMYNL4hu.js";const ze={class:"queue-page p-4"},Ue={class:"pos-header-top d-flex justify-content-between align-items-center mb-4"},Ae={class:"header-left d-flex align-items-center gap-3"},Ne={class:"mb-0 fw-bold text-primary"},Pe={class:"header-right d-flex gap-2"},je={class:"nano-stats-bar mb-4"},He={class:"stat-icon-bg waiting"},Le={class:"stat-info"},Ee={class:"stat-value text-warning"},Oe={class:"stat-label"},We={class:"stat-icon-bg serving"},Ye={class:"stat-info"},Ge={class:"stat-value text-info"},Je={class:"stat-label"},Ke={class:"stat-icon-bg completed"},Xe={class:"stat-info"},Ze={class:"stat-value text-success"},et={class:"stat-label"},tt={class:"stat-card-nano"},st={class:"stat-icon-bg avg"},at={class:"stat-info"},lt={class:"stat-label"},ot={class:"nano-panel h-100"},it={class:"panel-header d-flex justify-content-between align-items-center mb-4"},nt={class:"fw-bold mb-0"},ct={key:0,class:"text-center p-5"},dt={key:1,class:"text-center p-5 text-muted opacity-50"},ut={key:2,class:"nano-ticket-list d-flex flex-column gap-3"},rt={class:"ticket-number-box"},_t={class:"number"},mt={class:"label"},vt={class:"ticket-info flex-grow-1 ms-3"},ft={class:"customer-name fw-bold fs-5"},pt={class:"service-name small text-muted"},ht={class:"wait-time small text-warning fw-bold mt-1"},gt={class:"ticket-actions d-flex gap-2"},bt={class:"nano-panel h-100 serving-panel"},kt={class:"fw-bold mb-4 text-info"},wt={key:0,class:"text-center p-5 text-muted opacity-50 border-dashed rounded-4"},yt={key:1,class:"d-flex flex-column gap-3"},qt={class:"d-flex justify-content-between align-items-start mb-3"},xt={class:"fw-bold text-info"},Ct={class:"fw-bold mb-1"},Tt={class:"small text-muted mb-3"},St={class:"d-flex gap-2"},Vt={key:0,class:"nano-panel mb-4"},Ft={class:"fw-bold mb-3 d-flex align-items-center"},$t={class:"upcoming-scroll d-flex gap-3 overflow-auto pb-2"},Bt={class:"fw-bold text-primary mb-1"},It={class:"fw-bold mb-1 truncate"},Mt={class:"small text-muted truncate mb-2"},Dt={class:"d-flex align-items-center gap-4 mb-4"},Qt={class:"ticket-number-badge large"},Rt={class:"fw-bold mb-1"},zt={class:"nano-stats-grid row g-3"},Ut={class:"p-3 bg-tertiary rounded-4"},At={class:"small text-muted fw-bold d-block mb-1"},Nt={class:"fw-bold"},Pt={class:"p-3 bg-tertiary rounded-4"},jt={class:"small text-muted fw-bold d-block mb-1"},Ht={class:"fw-bold"},Lt={class:"p-3 bg-tertiary rounded-4"},Et={class:"small text-muted fw-bold d-block mb-1"},Ot={class:"fw-bold"},Wt={class:"p-3 bg-tertiary rounded-4"},Yt={class:"small text-muted fw-bold d-block mb-1"},Gt={class:"fw-bold text-warning"},Jt={class:"mb-4"},Kt={class:"form-label fw-bold"},Xt={value:null},Zt=["value"],es={class:"mb-4"},ts={class:"form-label fw-bold"},ss={value:null},as=["value"],ls={class:"mb-4"},os={class:"form-label fw-bold"},is={value:null},ns=["value"],cs={class:"mb-2"},ds={class:"form-label fw-bold"},us={__name:"Index",setup(rs){const{t:i}=Me(),g=De(),O=Ve(),y=m([]),W=m([]),Y=m([]),Q=m([]),q=m(!1),B=m(!1);m(!0);const R=m(null),G=m(""),z=x(()=>y.value.filter(l=>l.status==="waiting"||l.status==="called").length),ce=x(()=>y.value.filter(l=>l.status==="serving").length),de=x(()=>y.value.filter(l=>l.status==="completed").length),I=x(()=>y.value.filter(l=>l.status==="waiting"||l.status==="called").sort((l,c)=>new Date(l.check_in_at)-new Date(c.check_in_at))),J=x(()=>y.value.filter(l=>l.status==="serving")),U=m([]),A=m(!1),N=m(!1),f=m(null),p=m({customer_id:null,service_id:null,staff_id:null,notes:""}),k=async()=>{var l,c,a,h,V,F;q.value=!0;try{const[w,$]=await Promise.all([b.get("/queue/tickets",{params:{status_not:"completed,cancelled"}}),b.get("/bookings",{params:{date:new Date().toISOString().split("T")[0],status:"confirmed"}})]);y.value=((c=(l=w.data)==null?void 0:l.data)==null?void 0:c.items)||((a=w.data)==null?void 0:a.items)||[],U.value=(((V=(h=$.data)==null?void 0:h.data)==null?void 0:V.items)||((F=$.data)==null?void 0:F.items)||[]).filter(M=>!M.queue_ticket_id)}catch(w){console.error("Failed to load queue:",w)}finally{q.value=!1}},ue=async()=>{var l,c,a,h,V,F,w,$,M;try{const[D,ee,te]=await Promise.all([b.get("/customers",{params:{per_page:1e3}}),b.get("/services",{params:{per_page:1e3}}),b.get("/staff",{params:{per_page:1e3}})]);W.value=((c=(l=D.data)==null?void 0:l.data)==null?void 0:c.items)||((a=D.data)==null?void 0:a.items)||[],Y.value=((V=(h=ee.data)==null?void 0:h.data)==null?void 0:V.items)||((F=ee.data)==null?void 0:F.items)||[],Q.value=(($=(w=te.data)==null?void 0:w.data)==null?void 0:$.items)||((M=te.data)==null?void 0:M.items)||[]}catch(D){console.error("Failed to load form data:",D)}},re=()=>{p.value={customer_id:null,service_id:null,staff_id:null,notes:""},A.value=!0},P=()=>A.value=!1,_e=async()=>{B.value=!0;try{await b.post("/queue/tickets",p.value),g.success(i("queue.ticketCreated")||"تم إنشاء التذكرة"),P(),k()}catch{g.error("Failed to create ticket")}finally{B.value=!1}},K=async l=>{try{await b.post(`/queue/tickets/${l.id}/call`),g.info(`${i("queue.calling")}: ${l.ticket_number}`),k()}catch{g.error("Failed to call ticket")}},me=()=>{I.value.length>0&&K(I.value[0])},X=async l=>{try{await b.post(`/queue/tickets/${l.id}/serve`),g.success(i("queue.serviceStarted")),k()}catch{g.error("Failed to start service")}},ve=async l=>{try{await b.post(`/queue/tickets/${l.id}/complete`),g.success(i("queue.complete")),k()}catch{g.error("Failed to complete ticket")}},fe=l=>{O.push({path:"/pos",query:{customer_id:l.customer_id,queue_id:l.id,service_id:l.service_id,staff_id:l.staff_id}})},pe=l=>{f.value=l,N.value=!0},j=()=>N.value=!1,he=async l=>{try{await b.post("/queue/tickets",{customer_id:l.customer_id,service_id:l.service_id,staff_id:l.staff_id,booking_id:l.id,notes:l.notes}),g.success(i("queue.addedFromBooking")),k()}catch{g.error("Failed to add booking to queue")}},ge=l=>l?new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--",Z=l=>{if(!l)return"0m";const c=new Date(l);return`${Math.floor((new Date-c)/6e4)}m`},be=l=>{switch(l){case"waiting":return i("queue.waiting");case"called":return i("queue.called");case"serving":return i("queue.serving");case"completed":return i("bookings.completed");default:return l}},ke=l=>{switch(l){case"waiting":return"warning";case"called":return"primary";case"serving":return"info";case"completed":return"success";default:return"secondary"}},we=()=>{const l=O.resolve({name:"QueueDisplay"}).href;window.open(l,"_blank","width=1200,height=800")},ye=x(()=>(p.value.service_id,Q.value)),qe=()=>{R.value=setInterval(k,3e4)},xe=()=>{R.value&&clearInterval(R.value)};return Ce(()=>{k(),ue(),qe()}),Te(()=>{xe()}),(l,c)=>(u(),r("div",ze,[t("div",Ue,[t("div",Ae,[t("h2",Ne,o(e(i)("queue.title")),1),s(e(L),{color:"gold",shape:"rounded-pill",class:"px-3 py-2 fw-bold text-dark"},{default:n(()=>[s(e(d),{icon:"cil-people",class:"me-1"}),_(" "+o(z.value)+" "+o(e(i)("queue.waiting")),1)]),_:1})]),t("div",Pe,[s(e(v),{color:"primary",class:"nano-btn",onClick:re},{default:n(()=>[s(e(d),{icon:"cil-plus",class:"me-2"}),_(" "+o(e(i)("queue.addQueue")||"إضافة للطابور"),1)]),_:1}),s(e(v),{color:"success",class:"nano-btn-success",onClick:me,disabled:z.value===0||q.value},{default:n(()=>[s(e(d),{icon:"cil-bell",class:"me-2"}),_(" "+o(e(i)("queue.next")),1)]),_:1},8,["disabled"]),s(e(v),{color:"secondary",variant:"ghost",onClick:k,disabled:q.value},{default:n(()=>[s(e(d),{icon:"cil-reload",class:Fe({spinning:q.value})},null,8,["class"])]),_:1},8,["disabled"]),s(e(v),{color:"secondary",variant:"ghost",onClick:we},{default:n(()=>[s(e(d),{icon:"cil-screen-desktop"})]),_:1})])]),t("div",je,[t("div",{class:"stat-card-nano",onClick:c[0]||(c[0]=a=>l.filterByStatus("waiting"))},[t("div",He,[s(e(d),{icon:"cil-clock"})]),t("div",Le,[t("div",Ee,o(z.value),1),t("div",Oe,o(e(i)("queue.waiting")),1)])]),t("div",{class:"stat-card-nano",onClick:c[1]||(c[1]=a=>l.filterByStatus("serving"))},[t("div",We,[s(e(d),{icon:"cil-user"})]),t("div",Ye,[t("div",Ge,o(ce.value),1),t("div",Je,o(e(i)("queue.inProgress")),1)])]),t("div",{class:"stat-card-nano",onClick:c[2]||(c[2]=a=>l.filterByStatus("completed"))},[t("div",Ke,[s(e(d),{icon:"cil-check-circle"})]),t("div",Xe,[t("div",Ze,o(de.value),1),t("div",et,o(e(i)("bookings.completed")),1)])]),t("div",tt,[t("div",st,[s(e(d),{icon:"cil-timer"})]),t("div",at,[c[9]||(c[9]=t("div",{class:"stat-value"},"12m",-1)),t("div",lt,o(e(i)("queue.avgWaitTime")||"متوسط الانتظار"),1)])])]),s(e(Se),{class:"g-4 mb-4"},{default:n(()=>[s(e(S),{lg:"8"},{default:n(()=>[t("div",ot,[t("div",it,[t("h4",nt,o(e(i)("queue.waitingList")||"قائمة الانتظار"),1),s(e($e),{modelValue:G.value,"onUpdate:modelValue":c[3]||(c[3]=a=>G.value=a),placeholder:e(i)("common.search"),class:"nano-search-input"},null,8,["modelValue","placeholder"])]),q.value?(u(),r("div",ct,[s(e(Be),{color:"primary"})])):I.value.length===0?(u(),r("div",dt,[s(e(d),{icon:"cil-coffee",size:"xl",class:"mb-3"}),t("p",null,o(e(i)("queue.noTickets")||"لا يوجد عميلات في الانتظار"),1)])):(u(),r("div",ut,[(u(!0),r(C,null,T(I.value,a=>(u(),r("div",{key:a.id,class:"nano-ticket-card waiting"},[t("div",rt,[t("span",_t,"#"+o(a.ticket_number||a.id),1),t("span",mt,o(e(i)("queue.ticket")),1)]),t("div",vt,[t("div",ft,o(a.customer_name||e(i)("queue.walkIn")),1),t("div",pt,[s(e(d),{icon:"cil-spreadsheet",class:"me-1"}),_(o(a.service_name),1)]),t("div",ht,[s(e(d),{icon:"cil-clock",class:"me-1"}),_(o(Z(a.check_in_at)),1)])]),t("div",gt,[s(e(v),{color:"primary",variant:"ghost",onClick:h=>K(a),title:e(i)("queue.call")},{default:n(()=>[s(e(d),{icon:"cil-bell"})]),_:1},8,["onClick","title"]),s(e(v),{color:"success",variant:"ghost",onClick:h=>X(a),title:e(i)("queue.startService")},{default:n(()=>[s(e(d),{icon:"cil-play"})]),_:1},8,["onClick","title"]),s(e(v),{color:"secondary",variant:"ghost",onClick:h=>pe(a)},{default:n(()=>[s(e(d),{icon:"cil-info"})]),_:1},8,["onClick"])])]))),128))]))])]),_:1}),s(e(S),{lg:"4"},{default:n(()=>[t("div",bt,[t("h4",kt,o(e(i)("queue.inProgress")),1),J.value.length===0?(u(),r("div",wt,[s(e(d),{icon:"cil-smile",size:"xl",class:"mb-3"}),t("p",null,o(e(i)("queue.noActiveServices")||"لا يوجد عميلات قيد الخدمة حالياً"),1)])):(u(),r("div",yt,[(u(!0),r(C,null,T(J.value,a=>(u(),r("div",{key:a.id,class:"nano-ticket-card serving border-info shadow-sm"},[t("div",qt,[s(e(L),{color:"info",shape:"rounded-pill",class:"px-3 py-2"},{default:n(()=>[s(e(d),{icon:"cil-user",class:"me-1"}),_(o(a.staff_name),1)]),_:2},1024),t("span",xt,"#"+o(a.ticket_number||a.id),1)]),t("h5",Ct,o(a.customer_name||e(i)("queue.walkIn")),1),t("div",Tt,o(a.service_name),1),t("div",St,[s(e(v),{color:"success",class:"flex-grow-1 nano-btn-sm",onClick:h=>ve(a)},{default:n(()=>[s(e(d),{icon:"cil-check",class:"me-1"}),_(o(e(i)("queue.complete")),1)]),_:1},8,["onClick"]),s(e(v),{color:"info",variant:"ghost",onClick:h=>fe(a),title:e(i)("queue.checkout")},{default:n(()=>[s(e(d),{icon:"cil-cart"})]),_:1},8,["onClick","title"])])]))),128))]))])]),_:1})]),_:1}),U.value.length>0?(u(),r("div",Vt,[t("h5",Ft,[s(e(d),{icon:"cil-calendar",class:"me-2 text-primary"}),_(" "+o(e(i)("queue.upcomingBookings")),1)]),t("div",$t,[(u(!0),r(C,null,T(U.value,a=>(u(),r("div",{key:a.id,class:"booking-mini-card p-3 rounded-4 border bg-tertiary"},[t("div",Bt,o(a.booking_time),1),t("div",It,o(a.customer_name),1),t("div",Mt,o(a.service_name),1),s(e(v),{size:"sm",color:"primary",variant:"ghost",onClick:h=>he(a),disabled:a.queue_ticket_id},{default:n(()=>[_(o(a.queue_ticket_id?e(i)("queue.inQueue"):e(i)("queue.addToQueue")),1)]),_:2},1032,["onClick","disabled"])]))),128))])])):H("",!0),s(e(se),{visible:N.value,onClose:j,size:"lg",alignment:"center"},{default:n(()=>[s(e(le),null,{default:n(()=>[s(e(oe),null,{default:n(()=>[s(e(d),{icon:"cil-list",class:"me-2"}),_(o(e(i)("queue.ticketDetails")),1)]),_:1})]),_:1}),f.value?(u(),ae(e(ie),{key:0,class:"p-4"},{default:n(()=>[t("div",Dt,[t("div",Qt,"#"+o(f.value.ticket_number||f.value.id),1),t("div",null,[t("h3",Rt,o(f.value.customer_name||e(i)("pos.walkInCustomer")),1),s(e(L),{color:ke(f.value.status),shape:"rounded-pill",class:"px-3 py-2"},{default:n(()=>[_(o(be(f.value.status)),1)]),_:1},8,["color"])])]),t("div",zt,[s(e(S),{md:"6"},{default:n(()=>[t("div",Ut,[t("label",At,o(e(i)("booking.service")),1),t("div",Nt,o(f.value.service_name),1)])]),_:1}),s(e(S),{md:"6"},{default:n(()=>[t("div",Pt,[t("label",jt,o(e(i)("booking.staff")),1),t("div",Ht,o(f.value.staff_name||e(i)("queue.unassigned")),1)])]),_:1}),s(e(S),{md:"6"},{default:n(()=>[t("div",Lt,[t("label",Et,o(e(i)("queue.checkIn")),1),t("div",Ot,o(ge(f.value.check_in_at)),1)])]),_:1}),s(e(S),{md:"6"},{default:n(()=>[t("div",Wt,[t("label",Yt,o(e(i)("queue.waitTime")),1),t("div",Gt,o(Z(f.value.check_in_at)),1)])]),_:1})])]),_:1})):H("",!0),s(e(ne),null,{default:n(()=>[s(e(v),{color:"secondary",variant:"ghost",onClick:j},{default:n(()=>[_(o(e(i)("common.close")),1)]),_:1}),f.value.status==="waiting"?(u(),ae(e(v),{key:0,color:"primary",onClick:c[4]||(c[4]=()=>{j(),X(f.value)})},{default:n(()=>[_(o(e(i)("queue.startService")),1)]),_:1})):H("",!0)]),_:1})]),_:1},8,["visible"]),s(e(se),{visible:A.value,onClose:P,size:"lg",alignment:"center"},{default:n(()=>[s(e(le),null,{default:n(()=>[s(e(oe),null,{default:n(()=>[s(e(d),{icon:"cil-plus",class:"me-2"}),_(o(e(i)("queue.createTicket")),1)]),_:1})]),_:1}),s(e(ie),{class:"p-4"},{default:n(()=>[t("div",Jt,[t("label",Kt,o(e(i)("bookings.customer")),1),s(e(E),{modelValue:p.value.customer_id,"onUpdate:modelValue":c[5]||(c[5]=a=>p.value.customer_id=a),class:"rounded-3"},{default:n(()=>[t("option",Xt,o(e(i)("queue.walkIn")),1),(u(!0),r(C,null,T(W.value,a=>(u(),r("option",{key:a.id,value:a.id},o(a.name),9,Zt))),128))]),_:1},8,["modelValue"])]),t("div",es,[t("label",ts,o(e(i)("bookings.service"))+" *",1),s(e(E),{modelValue:p.value.service_id,"onUpdate:modelValue":c[6]||(c[6]=a=>p.value.service_id=a),onChange:l.onServiceChange,class:"rounded-3"},{default:n(()=>[t("option",ss,o(e(i)("queue.selectService")),1),(u(!0),r(C,null,T(Y.value,a=>(u(),r("option",{key:a.id,value:a.id},o(a.name||a.title),9,as))),128))]),_:1},8,["modelValue","onChange"])]),t("div",ls,[t("label",os,o(e(i)("bookings.staff")),1),s(e(E),{modelValue:p.value.staff_id,"onUpdate:modelValue":c[7]||(c[7]=a=>p.value.staff_id=a),class:"rounded-3"},{default:n(()=>[t("option",is,o(e(i)("queue.anyAvailableStaff")),1),(u(!0),r(C,null,T(ye.value,a=>(u(),r("option",{key:a.id,value:a.id},o(a.name),9,ns))),128))]),_:1},8,["modelValue"])]),t("div",cs,[t("label",ds,o(e(i)("common.notes")),1),s(e(Ie),{modelValue:p.value.notes,"onUpdate:modelValue":c[8]||(c[8]=a=>p.value.notes=a),rows:"3",class:"rounded-3"},null,8,["modelValue"])])]),_:1}),s(e(ne),null,{default:n(()=>[s(e(v),{color:"secondary",variant:"ghost",onClick:P},{default:n(()=>[_(o(e(i)("common.cancel")),1)]),_:1}),s(e(v),{color:"primary",class:"nano-btn",onClick:_e,disabled:!p.value.service_id||B.value},{default:n(()=>[_(o(B.value?e(i)("common.creating"):e(i)("queue.createTicket")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),s(Qe,{"page-key":"queue"})]))}},ws=Re(us,[["__scopeId","data-v-71c49a97"]]);export{ws as default};
