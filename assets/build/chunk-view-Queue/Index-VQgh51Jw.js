import{f as h,g as A,i as Je,af as Ge,c as p,o as v,d as i,b as l,s as x,a as f,p as n,u as e,Z as Se,h as Ye,x as q,n as L,P as _,C as r,t as c,Y as P,_ as Ze,$ as Y,a2 as Ke,a3 as Xe,a1 as et,a0 as Q,a4 as tt,F as R,k as F,a6 as st,a7 as $e,a8 as xe,a9 as De,aa as Ve,ac as at}from"../chunk-vendor-vue-9XB69CcG.js";import{u as ot,a as T}from"../chunk-component-NotificationsBell-PEptZHCy.js";import{u as lt}from"../chunk-view-AppleWallet/Simulator-D4f6g6Az.js";import{P as it}from"../chunk-component-PageHeader-DOCn2Cgp.js";import{S as Z}from"../chunk-component-StatCard-COK6V2Ia.js";import{_ as ct,C as ue}from"../chunk-component-Card-CPZTx4Dn.js";import{E as nt}from"../chunk-component-EmptyState-EtsdDTwC.js";import{L as rt}from"../chunk-component-LoadingSpinner-CoUPkIjP.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-BpPt1UDF.js";import"../chunk-vendor-axios-B9ygI19o.js";const ut={class:"queue-page"},dt={class:"stats-grid"},vt={value:""},_t={value:"waiting"},mt={value:"called"},pt={value:"serving"},ft={value:"completed"},gt={value:""},ht={value:"today"},kt={value:"week"},bt={value:"month"},yt={key:2,class:"table-wrapper"},wt={class:"table-header-row"},qt={class:"th-ticket"},Ct={class:"th-customer"},Tt={class:"th-service"},St={class:"th-staff"},$t={class:"th-status"},xt={class:"th-time"},Dt={class:"th-actions"},Vt={class:"td-id"},It={class:"ticket-id-badge"},Et={class:"td-ticket"},Bt={class:"ticket-number"},At={class:"td-customer"},Lt={class:"queue-customer-cell"},Mt={class:"customer-name"},Ut={key:0,class:"text-muted d-block"},Nt={class:"td-service"},Ot={class:"queue-service-cell"},Pt={class:"td-staff"},Qt={class:"td-status"},Rt={class:"td-time"},Ft={class:"time-cell"},jt={class:"td-actions"},zt={class:"actions-group"},Wt=["onClick","title","disabled"],Ht=["onClick","title","disabled"],Jt=["onClick","title","disabled"],Gt=["onClick","title","disabled"],Yt=["onClick","title"],Zt={key:0,class:"d-flex justify-content-between align-items-center"},Kt={class:"text-muted"},Xt={key:3,class:"auto-refresh-indicator"},es={class:"text-muted"},ts={class:"ticket-details-view"},ss={class:"ticket-header"},as={class:"ticket-avatar"},os={class:"ticket-header-info"},ls={class:"ticket-number-large"},is={class:"ticket-stats-grid"},cs={class:"stat-item"},ns={class:"stat-content"},rs={class:"stat-label"},us={class:"stat-value"},ds={key:0,class:"stat-item"},vs={class:"stat-content"},_s={class:"stat-label"},ms={class:"stat-value"},ps={key:1,class:"stat-item"},fs={class:"stat-content"},gs={class:"stat-label"},hs={class:"stat-value"},ks={key:2,class:"stat-item"},bs={class:"stat-content"},ys={class:"stat-label"},ws={class:"stat-value"},qs={class:"ticket-info-grid"},Cs={key:0,class:"info-row"},Ts={class:"info-label"},Ss={class:"info-value"},$s={key:1,class:"info-row"},xs={class:"info-label"},Ds={class:"info-value"},Vs=["href"],Is={key:2,class:"info-row"},Es={class:"info-label"},Bs={class:"info-value"},As={key:3,class:"info-row"},Ls={class:"info-label"},Ms={class:"info-value"},Us={key:4,class:"info-row"},Ns={class:"info-label"},Os={class:"info-value"},Ps={key:5,class:"info-row"},Qs={class:"info-label"},Rs={class:"info-value"},Fs={class:"create-ticket-form"},js={class:"form-description"},zs={class:"form-group"},Ws={class:"form-label"},Hs={class:"text-muted"},Js={value:null},Gs=["value"],Ys={class:"form-group"},Zs={class:"form-label"},Ks={value:null},Xs=["value"],ea={class:"form-group"},ta={class:"form-label"},sa={class:"text-muted"},aa={value:null},oa=["value"],la={key:0,class:"text-muted d-block mt-1"},ia={key:1,class:"staff-status-legend mt-2"},ca={class:"text-muted d-flex align-items-center gap-2"},na={class:"form-group"},ra={class:"form-label"},ua={class:"upcoming-bookings-list"},da={class:"booking-time-display"},va={class:"booking-details"},_a={class:"booking-customer-name"},ma={class:"booking-service-name"},pa={key:0,class:"booking-staff-name"},fa={class:"booking-action"},ga={__name:"Index",setup(ha){const{t:a}=ot(),k=lt(),Ie=Ye(),D=h([]),S=h(!1),j=h(!1),d=h(null),V=h(!0);let z=null;const K=h(!1),M=h([]),X=h(!1),de=h(""),ee=h(null),W=h(!1),g=h({customer_id:null,service_id:null,staff_id:null,notes:""}),te=h([]),se=h([]),ae=h([]),oe=h([]),ve=h(!1),_e=h(!1),me=h(!1),pe=A(()=>g.value.service_id?ae.value.filter(o=>{if(!o.is_active)return!1;let t=[];if(o.service_ids){if(Array.isArray(o.service_ids))t=o.service_ids;else if(typeof o.service_ids=="string")try{t=JSON.parse(o.service_ids)}catch{t=[]}}return!t||t.length===0?!0:t.includes(g.value.service_id)}).map(o=>{const t=oe.value.find(u=>u.staff_id===o.id&&["pending","customer_called","staff_called"].includes(u.status)),s=t&&t.queue_status&&t.queue_status!=="completed";return{...o,isBusy:s,currentCall:t}}).sort((o,t)=>o.isBusy===t.isBusy?0:o.isBusy?1:-1):[]),Ee=o=>{const t=o.isBusy?`[${a("workerCalls.busy")}]`:`[${a("workerCalls.available")}]`,s=o.name,u=o.position?` - ${o.position}`:"";return`${t} ${s}${u}`},y=h({search:"",status:"",date_filter:""}),w=h({current_page:1,per_page:20,total:0,total_pages:0}),E=A(()=>D.value.filter(o=>o.status==="waiting").length),le=A(()=>D.value.filter(o=>o.status==="serving").length),ie=A(()=>D.value.filter(o=>o.status==="completed").length),fe=A(()=>{const o=new Date().toISOString().split("T")[0];return D.value.filter(t=>(t.created_at?new Date(t.created_at).toISOString().split("T")[0]:null)===o).length}),ge=A(()=>{let o=[...D.value];if(y.value.status&&(o=o.filter(t=>t.status===y.value.status)),y.value.search){const t=y.value.search.toLowerCase();o=o.filter(s=>{const u=(s.ticket_number||`T-${s.id}`).toLowerCase(),m=(s.customer_name||"").toLowerCase(),b=(s.service_name||"").toLowerCase(),$=(s.staff_name||"").toLowerCase();return u.includes(t)||m.includes(t)||b.includes(t)||$.includes(t)})}if(y.value.date_filter){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate());o=o.filter(u=>{if(!u.created_at)return!1;const m=new Date(u.created_at);if(y.value.date_filter==="today")return m>=s;if(y.value.date_filter==="week"){const b=new Date(s);return b.setDate(b.getDate()-7),m>=b}else if(y.value.date_filter==="month"){const b=new Date(s);return b.setMonth(b.getMonth()-1),m>=b}return!0})}return o.sort((t,s)=>{const u={waiting:1,called:2,serving:3,completed:4},m=u[t.status]||5,b=u[s.status]||5;return m!==b?m-b:new Date(s.created_at)-new Date(t.created_at)})}),he=o=>({waiting:"status-waiting",called:"status-called",serving:"status-serving",completed:"status-completed"})[o]||"",ke=o=>({waiting:a("queue.waiting"),called:a("queue.called"),serving:a("queue.inProgress"),completed:a("bookings.completed"),cancelled:a("bookings.cancelled")})[o]||o,be=o=>({waiting:"cil-clock",called:"cil-bell",serving:"cil-user",completed:"cil-check-circle",cancelled:"cil-x-circle"})[o]||"cil-info",O=o=>o?new Date(o).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-",C=async()=>{var o;S.value=!0;try{const t={page:w.value.current_page,per_page:w.value.per_page,...y.value};Object.keys(t).forEach(m=>{t[m]===""&&delete t[m]});const s=await T.get("/queue",{params:t}),u=((o=s.data)==null?void 0:o.data)||s.data||{};D.value=u.items||[],w.value=u.pagination||w.value}catch(t){console.error("Error loading tickets:",t),D.value=[],k.error(a("common.errorLoading"))}finally{S.value=!1}},Be=o=>{w.value.current_page=o,C()};let ye;const Ae=()=>{clearTimeout(ye),ye=setTimeout(()=>{w.value.current_page=1,C()},500)},Le=()=>{y.value={search:"",status:"",date_filter:""},w.value.current_page=1,C()},H=o=>{y.value.status=o||"",w.value.current_page=1,C()},Me=async()=>{var o;if(E.value===0){k.warning(a("queue.noWaitingTickets"));return}try{const t=await T.post("/queue/call-next");(o=t.data)!=null&&o.data?await ce(t.data.data):k.warning(a("queue.noWaitingTickets"))}catch(t){console.error("Error calling next:",t),k.error(a("queue.errorCallingTicket"))}},ce=async o=>{try{await T.post(`/queue/${o.id}/call`),k.success(`${a("queue.ticketCalled")}: ${o.ticket_number||o.id}`),await C()}catch(t){console.error("Error calling ticket:",t),k.error(a("queue.errorCallingTicket"))}},we=async o=>{try{await T.post(`/queue/${o.id}/start`),k.success(`${a("queue.serviceStarted")}: ${o.ticket_number||o.id}`),await C()}catch(t){console.error("Error starting service:",t),k.error(a("queue.errorStartingService"))}},qe=async o=>{try{await T.post(`/queue/${o.id}/complete`),k.success(`${a("queue.ticketCompleted")}: ${o.ticket_number||o.id}`),await C()}catch(t){console.error("Error completing ticket:",t),k.error(a("queue.errorCompletingTicket"))}},Ce=async o=>{var t,s,u;try{const m=await T.post(`/queue/${o.id}/checkout`,{payment_method:"cash",additional_items:[]});(t=m.data)!=null&&t.data&&(k.success(a("queue.checkoutSuccess")||"Checkout completed successfully"),await C(),Ie.push(`/orders/${m.data.data.order_id}`))}catch(m){console.error("Error checking out ticket:",m),k.error(((u=(s=m.response)==null?void 0:s.data)==null?void 0:u.message)||a("queue.checkoutError")||"Error during checkout")}},Ue=async o=>{var t;try{const s=await T.get(`/queue/${o.id}`);d.value=((t=s.data)==null?void 0:t.data)||s.data||o,j.value=!0}catch(s){console.error("Error loading ticket details:",s),d.value=o,j.value=!0}},U=()=>{j.value=!1,d.value=null},Ne=()=>{const o={exported_at:new Date().toISOString(),tickets:D.value,stats:{waiting:E.value,serving:le.value,completed:ie.value,totalToday:fe.value}},t=JSON.stringify(o,null,2),s=new Blob([t],{type:"application/json;charset=utf-8"}),u=URL.createObjectURL(s),m=document.createElement("a");m.href=u,m.download=`queue-export-${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.json`,document.body.appendChild(m),m.click(),m.remove(),URL.revokeObjectURL(u),k.success("âœ… "+a("common.export")+" "+a("queue.title"))},Oe=()=>{V.value=!V.value,V.value?Te():ne()},Te=()=>{ne(),z=setInterval(()=>{S.value||C()},5e3)},ne=()=>{z&&(clearInterval(z),z=null)},Pe=()=>{const t=`${window.location.href.split("#")[0]}#/display/queue`;window.open(t,"_blank","fullscreen=yes,width=1920,height=1080")},Qe=async()=>{var o,t,s;ve.value=!0;try{const u=await T.get("/customers",{params:{per_page:100,is_active:1}});te.value=((t=(o=u.data)==null?void 0:o.data)==null?void 0:t.items)||((s=u.data)==null?void 0:s.items)||[]}catch(u){console.error("Error loading customers:",u),te.value=[]}finally{ve.value=!1}},Re=async()=>{var o,t,s;_e.value=!0;try{const u=await T.get("/services",{params:{per_page:100,is_active:1}});se.value=((t=(o=u.data)==null?void 0:o.data)==null?void 0:t.items)||((s=u.data)==null?void 0:s.items)||[]}catch(u){console.error("Error loading services:",u),se.value=[]}finally{_e.value=!1}},Fe=async()=>{var o,t,s,u,m,b;me.value=!0;try{const[$,B]=await Promise.all([T.get("/staff",{params:{per_page:100,is_active:1}}),T.get("/worker-calls",{params:{per_page:200}})]),N=((t=(o=$.data)==null?void 0:o.data)==null?void 0:t.items)||((s=$.data)==null?void 0:s.items)||[];oe.value=((m=(u=B.data)==null?void 0:u.data)==null?void 0:m.items)||((b=B.data)==null?void 0:b.items)||[],ae.value=N.map(I=>{let G=[];if(I.service_ids){if(Array.isArray(I.service_ids))G=I.service_ids;else if(typeof I.service_ids=="string")try{G=JSON.parse(I.service_ids)}catch{G=[]}}return{...I,service_ids:G}})}catch($){console.error("Error loading staff:",$),ae.value=[],oe.value=[]}finally{me.value=!1}},je=()=>{g.value.staff_id=null},ze=async()=>{K.value=!0,g.value={customer_id:null,service_id:null,staff_id:null,notes:""},await Promise.all([Qe(),Re(),Fe()])},re=()=>{K.value=!1,g.value={customer_id:null,service_id:null,staff_id:null,notes:""}},We=async()=>{var o;if(!g.value.service_id){k.error(a("queue.serviceRequired")||"Service is required");return}W.value=!0;try{const t={customer_id:g.value.customer_id||null,service_id:g.value.service_id,staff_id:g.value.staff_id||null,notes:g.value.notes||""};(o=(await T.post("/queue",t)).data)!=null&&o.data?(k.success(a("queue.ticketCreated")||"Ticket created successfully"),re(),await C(),await J()):k.error(a("queue.errorCreatingTicket")||"Error creating ticket")}catch(t){console.error("Error creating ticket:",t),k.error(a("queue.errorCreatingTicket")||"Error creating ticket")}finally{W.value=!1}},J=async()=>{var o,t,s;X.value=!0;try{const u=new Date().toISOString().split("T")[0],m=await T.get("/bookings",{params:{booking_date:u,status:"pending,confirmed",per_page:100}}),b=((t=(o=m.data)==null?void 0:o.data)==null?void 0:t.items)||((s=m.data)==null?void 0:s.items)||[];M.value=b.filter($=>{if(!$.booking_date)return!1;const B=new Date($.booking_date),N=new Date;return N.setHours(0,0,0,0),B>=N}).sort(($,B)=>{const N=new Date(`${$.booking_date} ${$.booking_time}`),I=new Date(`${B.booking_date} ${B.booking_time}`);return N-I})}catch(u){console.error("Error loading upcoming bookings:",u),M.value=[]}finally{X.value=!1}};A(()=>{if(!de.value)return M.value;const o=de.value.toLowerCase();return M.value.filter(t=>{const s=(t.customer_name||"").toLowerCase(),u=(t.service_name||"").toLowerCase(),m=(t.staff_name||"").toLowerCase(),b=(t.booking_time||"").toLowerCase();return s.includes(o)||u.includes(o)||m.includes(o)||b.includes(o)})});const He=async o=>{var t;ee.value=o.id;try{const s={customer_id:o.customer_id,service_id:o.service_id,staff_id:o.staff_id||null,booking_id:o.id,notes:`From booking: ${o.booking_date} ${o.booking_time}`};(t=(await T.post("/queue",s)).data)!=null&&t.data?(k.success(a("queue.bookingAddedToQueue")||"Booking added to queue successfully"),await C(),await J()):k.error(a("queue.errorAddingToQueue")||"Error adding booking to queue")}catch(s){console.error("Error adding booking to queue:",s),k.error(a("queue.errorAddingToQueue")||"Error adding booking to queue")}finally{ee.value=null}};return Je(()=>{C(),J(),V.value&&Te(),setInterval(()=>{X.value||J()},3e4)}),Ge(()=>{ne()}),(o,t)=>(v(),p("div",ut,[i(it,{title:e(a)("queue.title"),subtitle:e(a)("queue.subtitle")},{icon:n(()=>[i(e(r),{icon:"cil-list"})]),actions:n(()=>[i(e(q),{color:"secondary",variant:"outline",onClick:Oe,class:L([{active:V.value},"me-2"])},{default:n(()=>[i(e(r),{icon:V.value?"cil-reload":"cil-media-pause",class:"me-2"},null,8,["icon"]),_(" "+c(V.value?e(a)("queue.autoRefresh"):e(a)("common.pause")),1)]),_:1},8,["class"]),i(e(q),{color:"secondary",variant:"outline",onClick:Ne,class:"me-2"},{default:n(()=>[i(e(r),{icon:"cil-cloud-download",class:"me-2"}),_(" "+c(e(a)("common.export")),1)]),_:1}),i(e(q),{color:"secondary",variant:"outline",onClick:C,disabled:S.value},{default:n(()=>[i(e(r),{icon:"cil-reload",class:L(["me-2",{spinning:S.value}])},null,8,["class"]),_(" "+c(e(a)("common.refresh")),1)]),_:1},8,["disabled"]),i(e(q),{color:"secondary",variant:"outline",onClick:Pe,class:"me-2"},{default:n(()=>[i(e(r),{icon:"cil-screen-desktop",class:"me-2"}),_(" "+c(e(a)("queue.displayMode")||"Display Mode"),1)]),_:1}),i(e(q),{color:"primary",size:"lg",onClick:ze,class:"ms-2 btn-primary-custom"},{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-2"}),_(" "+c(e(a)("queue.addQueue")||"Add Queue"),1)]),_:1}),i(e(q),{color:"primary",size:"lg",onClick:Me,disabled:E.value===0||S.value,class:"ms-2 btn-primary-custom"},{default:n(()=>[i(e(r),{icon:"cil-bell",class:"me-2"}),_(" "+c(e(a)("queue.next"))+" ",1),E.value>0?(v(),x(e(P),{key:0,color:"warning",class:"ms-2"},{default:n(()=>[_(c(E.value),1)]),_:1})):f("",!0)]),_:1},8,["disabled"])]),_:1},8,["title","subtitle"]),l("div",dt,[i(Z,{label:e(a)("queue.waiting"),value:E.value,badge:E.value+" "+e(a)("queue.waiting"),"badge-variant":"warning",color:"gold",clickable:!0,onClick:t[0]||(t[0]=s=>H("waiting"))},{icon:n(()=>[i(e(r),{icon:"cil-clock"})]),_:1},8,["label","value","badge"]),i(Z,{label:e(a)("queue.inProgress"),value:le.value,badge:le.value+" "+e(a)("queue.inProgress"),"badge-variant":"info",color:"gold",clickable:!0,onClick:t[1]||(t[1]=s=>H("serving"))},{icon:n(()=>[i(e(r),{icon:"cil-user"})]),_:1},8,["label","value","badge"]),i(Z,{label:e(a)("bookings.completed"),value:ie.value,badge:ie.value+" "+e(a)("bookings.completed"),"badge-variant":"success",color:"gold",clickable:!0,onClick:t[2]||(t[2]=s=>H("completed"))},{icon:n(()=>[i(e(r),{icon:"cil-check-circle"})]),_:1},8,["label","value","badge"]),i(Z,{label:e(a)("queue.totalToday"),value:fe.value,badge:e(a)("queue.totalToday"),"badge-variant":"info",color:"gold",clickable:!0,onClick:t[3]||(t[3]=s=>H(null))},{icon:n(()=>[i(e(r),{icon:"cil-list"})]),_:1},8,["label","value","badge"])]),i(ue,{title:e(a)("common.filter"),icon:"cil-filter",class:"filters-card"},{default:n(()=>[i(e(Ze),{class:"g-3"},{default:n(()=>[i(e(Y),{md:4},{default:n(()=>[i(e(Ke),{class:"search-input-group"},{default:n(()=>[i(e(Xe),{class:"search-icon-wrapper"},{default:n(()=>[i(e(r),{icon:"cil-magnifying-glass"})]),_:1}),i(e(et),{modelValue:y.value.search,"onUpdate:modelValue":t[4]||(t[4]=s=>y.value.search=s),placeholder:e(a)("queue.searchPlaceholder"),onInput:Ae,class:"filter-input search-input"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),i(e(Y),{md:3},{default:n(()=>[i(e(Q),{modelValue:y.value.status,"onUpdate:modelValue":t[5]||(t[5]=s=>y.value.status=s),onChange:C,class:"filter-select"},{default:n(()=>[l("option",vt,c(e(a)("queue.allStatuses")),1),l("option",_t,c(e(a)("queue.waiting")),1),l("option",mt,c(e(a)("queue.called")),1),l("option",pt,c(e(a)("queue.inProgress")),1),l("option",ft,c(e(a)("bookings.completed")),1)]),_:1},8,["modelValue"])]),_:1}),i(e(Y),{md:3},{default:n(()=>[i(e(Q),{modelValue:y.value.date_filter,"onUpdate:modelValue":t[6]||(t[6]=s=>y.value.date_filter=s),onChange:C,class:"filter-select"},{default:n(()=>[l("option",gt,c(e(a)("common.date")||"Date"),1),l("option",ht,c(e(a)("common.today")||"Today"),1),l("option",kt,c(e(a)("common.thisWeek")||"This Week"),1),l("option",bt,c(e(a)("common.thisMonth")||"This Month"),1)]),_:1},8,["modelValue"])]),_:1}),i(e(Y),{md:2},{default:n(()=>[i(e(q),{color:"secondary",variant:"outline",onClick:Le,class:"w-100 reset-btn"},{default:n(()=>[i(e(r),{icon:"cil-reload",class:"me-1"}),_(" "+c(e(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),i(ue,{title:e(a)("queue.title"),icon:"cil-list"},{footer:n(()=>[w.value.total_pages>1?(v(),p("div",Zt,[l("div",Kt,c(e(a)("common.view"))+" "+c((w.value.current_page-1)*w.value.per_page+1)+" "+c(e(a)("common.to"))+" "+c(Math.min(w.value.current_page*w.value.per_page,w.value.total))+" "+c(e(a)("common.of"))+" "+c(w.value.total),1),i(e(st),{pages:w.value.total_pages,"active-page":w.value.current_page,"onUpdate:activePage":Be},null,8,["pages","active-page"])])):f("",!0)]),default:n(()=>[S.value?(v(),x(rt,{key:0,text:e(a)("common.loading")},null,8,["text"])):ge.value.length===0?(v(),x(nt,{key:1,title:e(a)("queue.noTickets"),description:e(a)("queue.noTicketsDesc"),"icon-color":"gray"},{action:n(()=>[i(e(q),{color:"primary",class:"btn-primary-custom",onClick:t[7]||(t[7]=s=>o.showCreateModal=!0)},{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-2"}),_(" "+c(e(a)("queue.addTicket")),1)]),_:1})]),_:1},8,["title","description"])):(v(),p("div",yt,[i(e(tt),{hover:"",responsive:"",class:"table-modern queue-table"},{default:n(()=>[l("thead",null,[l("tr",wt,[t[16]||(t[16]=l("th",{class:"th-id"},"#",-1)),l("th",qt,c(e(a)("queue.ticketNumber")),1),l("th",Ct,c(e(a)("queue.customer")),1),l("th",Tt,c(e(a)("queue.service")),1),l("th",St,c(e(a)("queue.staff")),1),l("th",$t,c(e(a)("queue.status")),1),l("th",xt,c(e(a)("queue.checkInTime")),1),l("th",Dt,c(e(a)("queue.actions")),1)])]),l("tbody",null,[(v(!0),p(R,null,F(ge.value,s=>(v(),p("tr",{key:s.id,class:L(["table-row queue-row",{"highlight-row":s.status==="waiting","serving-row":s.status==="serving","completed-row":s.status==="completed"}])},[l("td",Vt,[l("span",It,"#"+c(s.id),1)]),l("td",Et,[l("strong",Bt,c(s.ticket_number||`T-${String(s.id).padStart(4,"0")}`),1)]),l("td",At,[l("div",Lt,[l("strong",Mt,c(s.customer_name||"-"),1),s.customer_phone?(v(),p("small",Ut,[i(e(r),{icon:"cil-phone",class:"me-1"}),_(" "+c(s.customer_phone),1)])):f("",!0)])]),l("td",Nt,[l("div",Ot,[i(e(r),{icon:"cil-spreadsheet",class:"me-1"}),_(" "+c(s.service_name||"-"),1)])]),l("td",Pt,[i(e(P),{color:"info",variant:"outline",class:"staff-badge"},{default:n(()=>[i(e(r),{icon:"cil-user",class:"me-1"}),_(" "+c(s.staff_name||"-"),1)]),_:2},1024)]),l("td",Qt,[i(e(P),{class:L(["unified-badge status-badge",he(s.status)])},{default:n(()=>[i(e(r),{icon:be(s.status),class:"badge-icon"},null,8,["icon"]),l("span",null,c(ke(s.status)),1)]),_:2},1032,["class"])]),l("td",Rt,[l("div",Ft,[i(e(r),{icon:"cil-clock",class:"me-1"}),_(" "+c(O(s.check_in_at)),1)])]),l("td",jt,[l("div",zt,[s.status==="waiting"?(v(),p("button",{key:0,class:"action-btn",onClick:u=>ce(s),title:e(a)("queue.call"),disabled:S.value},[i(e(r),{icon:"cil-bell"})],8,Wt)):f("",!0),s.status==="called"?(v(),p("button",{key:1,class:"action-btn",onClick:u=>we(s),title:e(a)("queue.startService"),disabled:S.value},[i(e(r),{icon:"cil-play"})],8,Ht)):f("",!0),s.status==="serving"?(v(),p("button",{key:2,class:"action-btn",onClick:u=>qe(s),title:e(a)("queue.complete"),disabled:S.value},[i(e(r),{icon:"cil-check"})],8,Jt)):f("",!0),s.status==="serving"||s.status==="completed"?(v(),p("button",{key:3,class:"action-btn action-btn-checkout",onClick:u=>Ce(s),title:e(a)("queue.checkout")||"Checkout",disabled:S.value},[i(e(r),{icon:"cil-cart"})],8,Gt)):f("",!0),l("button",{class:"action-btn",onClick:u=>Ue(s),title:e(a)("common.view")},[i(e(r),{icon:"cil-info"})],8,Yt)])])],2))),128))])]),_:1})])),V.value&&!S.value?(v(),p("div",Xt,[i(e(r),{icon:"cil-reload",class:"spinning-slow me-2"}),l("small",es,c(e(a)("queue.refreshInterval")),1)])):f("",!0)]),_:1},8,["title"]),i(e(Se),{visible:j.value,onClose:U,size:"lg"},{default:n(()=>[i(e($e),null,{default:n(()=>[i(e(xe),null,{default:n(()=>[i(e(r),{icon:"cil-list",class:"me-2"}),_(" "+c(e(a)("queue.ticketDetails")||"Ticket Details"),1)]),_:1})]),_:1}),d.value?(v(),x(e(De),{key:0},{default:n(()=>[l("div",ts,[l("div",ss,[l("div",as,[i(e(r),{icon:"cil-list"})]),l("div",os,[l("h4",ls,c(d.value.ticket_number||`T-${String(d.value.id).padStart(4,"0")}`),1),i(e(P),{class:L(["unified-badge status-badge-large",he(d.value.status)])},{default:n(()=>[i(e(r),{icon:be(d.value.status),class:"me-1"},null,8,["icon"]),_(" "+c(ke(d.value.status)),1)]),_:1},8,["class"])])]),l("div",is,[l("div",cs,[i(e(r),{icon:"cil-clock",class:"stat-icon"}),l("div",ns,[l("div",rs,c(e(a)("queue.checkInTime")),1),l("div",us,c(O(d.value.check_in_at)),1)])]),d.value.called_at?(v(),p("div",ds,[i(e(r),{icon:"cil-bell",class:"stat-icon"}),l("div",vs,[l("div",_s,c(e(a)("queue.called")),1),l("div",ms,c(O(d.value.called_at)),1)])])):f("",!0),d.value.started_at?(v(),p("div",ps,[i(e(r),{icon:"cil-play",class:"stat-icon"}),l("div",fs,[l("div",gs,c(e(a)("queue.serviceStarted")),1),l("div",hs,c(O(d.value.started_at)),1)])])):f("",!0),d.value.completed_at?(v(),p("div",ks,[i(e(r),{icon:"cil-check-circle",class:"stat-icon"}),l("div",bs,[l("div",ys,c(e(a)("queue.complete")),1),l("div",ws,c(O(d.value.completed_at)),1)])])):f("",!0)]),l("div",qs,[d.value.customer_name?(v(),p("div",Cs,[l("div",Ts,[i(e(r),{icon:"cil-user",class:"me-2"}),_(" "+c(e(a)("queue.customer")),1)]),l("div",Ss,c(d.value.customer_name),1)])):f("",!0),d.value.customer_phone?(v(),p("div",$s,[l("div",xs,[i(e(r),{icon:"cil-phone",class:"me-2"}),_(" "+c(e(a)("customers.phone")),1)]),l("div",Ds,[l("a",{href:`tel:${d.value.customer_phone}`,class:"info-link"},c(d.value.customer_phone),9,Vs)])])):f("",!0),d.value.service_name?(v(),p("div",Is,[l("div",Es,[i(e(r),{icon:"cil-spreadsheet",class:"me-2"}),_(" "+c(e(a)("queue.service")),1)]),l("div",Bs,c(d.value.service_name),1)])):f("",!0),d.value.staff_name?(v(),p("div",As,[l("div",Ls,[i(e(r),{icon:"cil-user",class:"me-2"}),_(" "+c(e(a)("queue.staff")),1)]),l("div",Ms,c(d.value.staff_name),1)])):f("",!0),d.value.notes?(v(),p("div",Us,[l("div",Ns,[i(e(r),{icon:"cil-notes",class:"me-2"}),_(" "+c(e(a)("common.notes")||"Notes"),1)]),l("div",Os,c(d.value.notes),1)])):f("",!0),d.value.created_at?(v(),p("div",Ps,[l("div",Qs,[i(e(r),{icon:"cil-calendar",class:"me-2"}),_(" "+c(e(a)("common.createdAt")||"Created At"),1)]),l("div",Rs,c(d.value.created_at?new Date(d.value.created_at).toLocaleString():"-"),1)])):f("",!0)])])]),_:1})):f("",!0),i(e(Ve),null,{default:n(()=>[i(e(q),{color:"secondary",onClick:U},{default:n(()=>[_(c(e(a)("common.close")||"Close"),1)]),_:1}),d.value&&d.value.status==="waiting"?(v(),x(e(q),{key:0,color:"primary",class:"btn-primary-custom",onClick:t[8]||(t[8]=()=>{U(),ce(d.value)})},{default:n(()=>[i(e(r),{icon:"cil-bell",class:"me-2"}),_(" "+c(e(a)("queue.call")),1)]),_:1})):f("",!0),d.value&&d.value.status==="called"?(v(),x(e(q),{key:1,color:"primary",class:"btn-primary-custom",onClick:t[9]||(t[9]=()=>{U(),we(d.value)})},{default:n(()=>[i(e(r),{icon:"cil-play",class:"me-2"}),_(" "+c(e(a)("queue.startService")),1)]),_:1})):f("",!0),d.value&&d.value.status==="serving"?(v(),x(e(q),{key:2,color:"primary",class:"btn-primary-custom",onClick:t[10]||(t[10]=()=>{U(),qe(d.value)})},{default:n(()=>[i(e(r),{icon:"cil-check",class:"me-2"}),_(" "+c(e(a)("queue.complete")),1)]),_:1})):f("",!0),d.value&&(d.value.status==="serving"||d.value.status==="completed")?(v(),x(e(q),{key:3,color:"success",class:"btn-primary-custom",onClick:t[11]||(t[11]=()=>{U(),Ce(d.value)})},{default:n(()=>[i(e(r),{icon:"cil-cart",class:"me-2"}),_(" "+c(e(a)("queue.checkout")||"Checkout"),1)]),_:1})):f("",!0)]),_:1})]),_:1},8,["visible"]),i(e(Se),{visible:K.value,onClose:re,size:"lg",backdrop:"static"},{default:n(()=>[i(e($e),null,{default:n(()=>[i(e(xe),null,{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-2"}),_(" "+c(e(a)("queue.createTicket")||"Create Queue Ticket"),1)]),_:1})]),_:1}),i(e(De),null,{default:n(()=>[l("div",Fs,[l("p",js,[i(e(r),{icon:"cil-info",class:"me-2"}),_(" "+c(e(a)("queue.createTicketDesc")||"Issue a ticket for a walk-in customer."),1)]),l("div",zs,[l("label",Ws,[_(c(e(a)("bookings.customer"))+" ",1),l("span",Hs,"("+c(e(a)("common.optional")||"optional")+")",1)]),i(e(Q),{modelValue:g.value.customer_id,"onUpdate:modelValue":t[12]||(t[12]=s=>g.value.customer_id=s),class:"form-select-custom"},{default:n(()=>[l("option",Js,c(e(a)("queue.walkIn")||"Walk-in"),1),(v(!0),p(R,null,F(te.value,s=>(v(),p("option",{key:s.id,value:s.id},c(s.name)+c(s.phone?" - "+s.phone:""),9,Gs))),128))]),_:1},8,["modelValue"])]),l("div",Ys,[l("label",Zs,[_(c(e(a)("bookings.service"))+" ",1),t[17]||(t[17]=l("span",{class:"text-danger"},"*",-1))]),i(e(Q),{modelValue:g.value.service_id,"onUpdate:modelValue":t[13]||(t[13]=s=>g.value.service_id=s),class:"form-select-custom",required:"",onChange:je},{default:n(()=>[l("option",Ks,c(e(a)("queue.selectService")||"Select service"),1),(v(!0),p(R,null,F(se.value,s=>(v(),p("option",{key:s.id,value:s.id},c(s.name||s.name_ar||s.title),9,Xs))),128))]),_:1},8,["modelValue"])]),l("div",ea,[l("label",ta,[_(c(e(a)("bookings.staff"))+" ",1),l("span",sa,"("+c(e(a)("common.optional")||"optional")+")",1)]),i(e(Q),{modelValue:g.value.staff_id,"onUpdate:modelValue":t[14]||(t[14]=s=>g.value.staff_id=s),class:"form-select-custom staff-select",disabled:!g.value.service_id},{default:n(()=>[l("option",aa,c(e(a)("queue.anyAvailableStaff")||"Any Available Staff"),1),(v(!0),p(R,null,F(pe.value,s=>(v(),p("option",{key:s.id,value:s.id,class:L(s.isBusy?"staff-busy-option":"staff-available-option")},c(Ee(s)),11,oa))),128))]),_:1},8,["modelValue","disabled"]),g.value.service_id?f("",!0):(v(),p("small",la,c(e(a)("queue.selectServiceFirst")||"Please select a service first"),1)),g.value.service_id&&pe.value.length>0?(v(),p("div",ia,[l("small",ca,[t[18]||(t[18]=l("span",{class:"status-indicator available"},null,-1)),_(" "+c(e(a)("workerCalls.available"))+" ",1),t[19]||(t[19]=l("span",{class:"status-indicator busy ms-3"},null,-1)),_(" "+c(e(a)("workerCalls.busy")),1)])])):f("",!0)]),l("div",na,[l("label",ra,c(e(a)("common.notes")||"Notes"),1),i(e(at),{modelValue:g.value.notes,"onUpdate:modelValue":t[15]||(t[15]=s=>g.value.notes=s),placeholder:e(a)("queue.notesPlaceholder")||"Optional notes for reception...",rows:"3",class:"form-textarea-custom"},null,8,["modelValue","placeholder"])])])]),_:1}),i(e(Ve),null,{default:n(()=>[i(e(q),{color:"secondary",onClick:re},{default:n(()=>[_(c(e(a)("common.cancel")||"Cancel"),1)]),_:1}),i(e(q),{color:"primary",class:"btn-primary-custom",onClick:We,disabled:!g.value.service_id||W.value},{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-2"}),_(" "+c(W.value?e(a)("common.creating")||"Creating...":e(a)("queue.createTicket")||"Create Ticket"),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),M.value.length>0?(v(),x(ue,{key:0,title:e(a)("queue.upcomingBookings")||"Upcoming Bookings",icon:"cil-calendar",class:"upcoming-bookings-card"},{default:n(()=>[l("div",ua,[(v(!0),p(R,null,F(M.value,s=>(v(),p("div",{key:s.id,class:L(["upcoming-booking-item",{"has-queue":s.queue_ticket_id}])},[l("div",da,[i(e(r),{icon:"cil-clock",class:"me-2"}),l("strong",null,c(s.booking_time),1)]),l("div",va,[l("div",_a,[i(e(r),{icon:"cil-user",class:"me-1"}),_(" "+c(s.customer_name),1)]),l("div",ma,[i(e(r),{icon:"cil-spreadsheet",class:"me-1"}),_(" "+c(s.service_name),1)]),s.staff_name?(v(),p("div",pa,[i(e(r),{icon:"cil-user-female",class:"me-1"}),_(" "+c(s.staff_name),1)])):f("",!0)]),l("div",fa,[s.queue_ticket_id?(v(),x(e(P),{key:0,color:"success"},{default:n(()=>[i(e(r),{icon:"cil-check-circle",class:"me-1"}),_(" "+c(e(a)("queue.inQueue")||"In Queue"),1)]),_:1})):(v(),x(e(q),{key:1,color:"primary",size:"sm",onClick:u=>He(s),disabled:ee.value===s.id},{default:n(()=>[i(e(r),{icon:"cil-plus",class:"me-1"}),_(" "+c(e(a)("queue.addToQueue")||"Add to Queue"),1)]),_:1},8,["onClick","disabled"]))])],2))),128))])]),_:1},8,["title"])):f("",!0)]))}},Ea=ct(ga,[["__scopeId","data-v-23f03d55"]]);export{Ea as default};
