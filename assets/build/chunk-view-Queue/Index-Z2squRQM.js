import{f as m,e as x,j as qe,ah as Te,c as r,o as u,b as t,d as s,a as j,t as o,u as e,w as c,Y as H,x as v,C as d,$ as Se,P as _,F as q,g as T,a0 as se,l as Ve,n as Fe,a2 as S,a3 as $e,h as Be,s as ae,a5 as le,a6 as oe,a7 as ie,a8 as ne,a4 as L,a9 as Me}from"../chunk-vendor-vue-BKzcbwC-.js";import{u as De,a as b}from"../chunk-component-NotificationsBell-CyBx4swB.js";import{u as Ie}from"../chunk-view-AppleWallet/Simulator-WLH8OaYC.js";import{H as Qe}from"../chunk-component-HelpSection-B1vxldAY.js";import{_ as Re}from"../chunk-component-Card-D7ddNvJz.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-pinia-CsGkbfJ3.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-PageHeader-CI_3JpQM.js";const Ue={class:"queue-page p-4"},ze={class:"pos-header-top d-flex justify-content-between align-items-center mb-4"},Ae={class:"header-left d-flex align-items-center gap-3"},Ne={class:"mb-0 fw-bold text-primary"},Pe={class:"header-right d-flex gap-2"},We={class:"nano-stats-bar mb-4"},je={class:"stat-icon-bg waiting"},He={class:"stat-info"},Le={class:"stat-value text-warning"},Ee={class:"stat-label"},Oe={class:"stat-icon-bg serving"},Ye={class:"stat-info"},Ge={class:"stat-value text-info"},Je={class:"stat-label"},Ke={class:"stat-icon-bg completed"},Xe={class:"stat-info"},Ze={class:"stat-value text-success"},et={class:"stat-label"},tt={class:"stat-card-nano"},st={class:"stat-icon-bg avg"},at={class:"stat-info"},lt={class:"stat-label"},ot={class:"nano-panel h-100"},it={class:"panel-header d-flex justify-content-between align-items-center mb-4"},nt={class:"fw-bold mb-0"},ct={key:0,class:"text-center p-5"},dt={key:1,class:"text-center p-5 text-muted opacity-50"},ut={key:2,class:"nano-ticket-list d-flex flex-column gap-3"},rt={class:"ticket-number-box"},_t={class:"number"},mt={class:"label"},vt={class:"ticket-info flex-grow-1 ms-3"},ft={class:"customer-name fw-bold fs-5"},pt={class:"service-name small text-muted"},gt={class:"wait-time small text-warning fw-bold mt-1"},ht={class:"ticket-actions d-flex gap-2"},bt={class:"nano-panel h-100 serving-panel"},kt={class:"fw-bold mb-4 text-info"},wt={key:0,class:"text-center p-5 text-muted opacity-50 border-dashed rounded-4"},yt={key:1,class:"d-flex flex-column gap-3"},Ct={class:"d-flex justify-content-between align-items-start mb-3"},xt={class:"fw-bold text-info"},qt={class:"fw-bold mb-1"},Tt={class:"small text-muted mb-3"},St={class:"d-flex gap-2"},Vt={key:0,class:"nano-panel mb-4"},Ft={class:"fw-bold mb-3 d-flex align-items-center"},$t={class:"upcoming-scroll d-flex gap-3 overflow-auto pb-2"},Bt={class:"fw-bold text-primary mb-1"},Mt={class:"fw-bold mb-1 truncate"},Dt={class:"small text-muted truncate mb-2"},It={class:"d-flex align-items-center gap-4 mb-4"},Qt={class:"ticket-number-badge large"},Rt={class:"fw-bold mb-1"},Ut={class:"nano-stats-grid row g-3"},zt={class:"p-3 bg-tertiary rounded-4"},At={class:"fw-bold"},Nt={class:"p-3 bg-tertiary rounded-4"},Pt={class:"fw-bold"},Wt={class:"p-3 bg-tertiary rounded-4"},jt={class:"fw-bold"},Ht={class:"p-3 bg-tertiary rounded-4"},Lt={class:"fw-bold text-warning"},Et={class:"mb-4"},Ot={class:"form-label fw-bold"},Yt={value:null},Gt=["value"],Jt={class:"mb-4"},Kt={class:"form-label fw-bold"},Xt={value:null},Zt=["value"],es={class:"mb-4"},ts={class:"form-label fw-bold"},ss={value:null},as=["value"],ls={class:"mb-2"},os={class:"form-label fw-bold"},is={__name:"Index",setup(ns){const{t:i}=De(),h=Ie(),E=Ve(),y=m([]),O=m([]),Y=m([]),Q=m([]),C=m(!1),B=m(!1);m(!0);const R=m(null),G=m(""),U=x(()=>y.value.filter(l=>l.status==="waiting"||l.status==="called").length),ce=x(()=>y.value.filter(l=>l.status==="serving").length),de=x(()=>y.value.filter(l=>l.status==="completed").length),M=x(()=>y.value.filter(l=>l.status==="waiting"||l.status==="called").sort((l,n)=>new Date(l.check_in_at)-new Date(n.check_in_at))),J=x(()=>y.value.filter(l=>l.status==="serving")),z=m([]),A=m(!1),N=m(!1),f=m(null),p=m({customer_id:null,service_id:null,staff_id:null,notes:""}),k=async()=>{var l,n,a,g,V,F;C.value=!0;try{const[w,$]=await Promise.all([b.get("/queue/tickets",{params:{status_not:"completed,cancelled"}}),b.get("/bookings",{params:{date:new Date().toISOString().split("T")[0],status:"confirmed"}})]);y.value=((n=(l=w.data)==null?void 0:l.data)==null?void 0:n.items)||((a=w.data)==null?void 0:a.items)||[],z.value=(((V=(g=$.data)==null?void 0:g.data)==null?void 0:V.items)||((F=$.data)==null?void 0:F.items)||[]).filter(D=>!D.queue_ticket_id)}catch(w){console.error("Failed to load queue:",w)}finally{C.value=!1}},ue=async()=>{var l,n,a,g,V,F,w,$,D;try{const[I,ee,te]=await Promise.all([b.get("/customers",{params:{per_page:1e3}}),b.get("/services",{params:{per_page:1e3}}),b.get("/staff",{params:{per_page:1e3}})]);O.value=((n=(l=I.data)==null?void 0:l.data)==null?void 0:n.items)||((a=I.data)==null?void 0:a.items)||[],Y.value=((V=(g=ee.data)==null?void 0:g.data)==null?void 0:V.items)||((F=ee.data)==null?void 0:F.items)||[],Q.value=(($=(w=te.data)==null?void 0:w.data)==null?void 0:$.items)||((D=te.data)==null?void 0:D.items)||[]}catch(I){console.error("Failed to load form data:",I)}},re=()=>{p.value={customer_id:null,service_id:null,staff_id:null,notes:""},A.value=!0},P=()=>A.value=!1,_e=async()=>{B.value=!0;try{await b.post("/queue/tickets",p.value),h.success(i("queue.ticketCreated")||"تم إنشاء التذكرة"),P(),k()}catch{h.error("Failed to create ticket")}finally{B.value=!1}},K=async l=>{try{await b.post(`/queue/tickets/${l.id}/call`),h.info(`${i("queue.calling")}: ${l.ticket_number}`),k()}catch{h.error("Failed to call ticket")}},me=()=>{M.value.length>0&&K(M.value[0])},X=async l=>{try{await b.post(`/queue/tickets/${l.id}/serve`),h.success(i("queue.serviceStarted")),k()}catch{h.error("Failed to start service")}},ve=async l=>{try{await b.post(`/queue/tickets/${l.id}/complete`),h.success(i("queue.complete")),k()}catch{h.error("Failed to complete ticket")}},fe=l=>{E.push({path:"/pos",query:{customer_id:l.customer_id,queue_id:l.id,service_id:l.service_id,staff_id:l.staff_id}})},pe=l=>{f.value=l,N.value=!0},W=()=>N.value=!1,ge=async l=>{try{await b.post("/queue/tickets",{customer_id:l.customer_id,service_id:l.service_id,staff_id:l.staff_id,booking_id:l.id,notes:l.notes}),h.success(i("queue.addedFromBooking")),k()}catch{h.error("Failed to add booking to queue")}},he=l=>l?new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--",Z=l=>{if(!l)return"0m";const n=new Date(l);return`${Math.floor((new Date-n)/6e4)}m`},be=l=>{switch(l){case"waiting":return i("queue.waiting");case"called":return i("queue.called");case"serving":return i("queue.serving");case"completed":return i("bookings.completed");default:return l}},ke=l=>{switch(l){case"waiting":return"warning";case"called":return"primary";case"serving":return"info";case"completed":return"success";default:return"secondary"}},we=()=>{const l=E.resolve({name:"QueueDisplay"}).href;window.open(l,"_blank","width=1200,height=800")},ye=x(()=>(p.value.service_id,Q.value)),Ce=()=>{R.value=setInterval(k,3e4)},xe=()=>{R.value&&clearInterval(R.value)};return qe(()=>{k(),ue(),Ce()}),Te(()=>{xe()}),(l,n)=>(u(),r("div",Ue,[t("div",ze,[t("div",Ae,[t("h2",Ne,o(e(i)("queue.title")),1),s(e(H),{color:"gold",shape:"rounded-pill",class:"px-3 py-2 fw-bold text-dark"},{default:c(()=>[s(e(d),{icon:"cil-people",class:"me-1"}),_(" "+o(U.value)+" "+o(e(i)("queue.waiting")),1)]),_:1})]),t("div",Pe,[s(e(v),{color:"primary",class:"nano-btn",onClick:re},{default:c(()=>[s(e(d),{icon:"cil-plus",class:"me-2"}),_(" "+o(e(i)("queue.addQueue")||"إضافة للطابور"),1)]),_:1}),s(e(v),{color:"success",class:"nano-btn-success",onClick:me,disabled:U.value===0||C.value},{default:c(()=>[s(e(d),{icon:"cil-bell",class:"me-2"}),_(" "+o(e(i)("queue.next")),1)]),_:1},8,["disabled"]),s(e(v),{color:"secondary",variant:"ghost",onClick:k,disabled:C.value},{default:c(()=>[s(e(d),{icon:"cil-reload",class:Fe({spinning:C.value})},null,8,["class"])]),_:1},8,["disabled"]),s(e(v),{color:"secondary",variant:"ghost",onClick:we},{default:c(()=>[s(e(d),{icon:"cil-screen-desktop"})]),_:1})])]),t("div",We,[t("div",{class:"stat-card-nano",onClick:n[0]||(n[0]=a=>l.filterByStatus("waiting"))},[t("div",je,[s(e(d),{icon:"cil-clock"})]),t("div",He,[t("div",Le,o(U.value),1),t("div",Ee,o(e(i)("queue.waiting")),1)])]),t("div",{class:"stat-card-nano",onClick:n[1]||(n[1]=a=>l.filterByStatus("serving"))},[t("div",Oe,[s(e(d),{icon:"cil-user"})]),t("div",Ye,[t("div",Ge,o(ce.value),1),t("div",Je,o(e(i)("queue.inProgress")),1)])]),t("div",{class:"stat-card-nano",onClick:n[2]||(n[2]=a=>l.filterByStatus("completed"))},[t("div",Ke,[s(e(d),{icon:"cil-check-circle"})]),t("div",Xe,[t("div",Ze,o(de.value),1),t("div",et,o(e(i)("bookings.completed")),1)])]),t("div",tt,[t("div",st,[s(e(d),{icon:"cil-timer"})]),t("div",at,[n[9]||(n[9]=t("div",{class:"stat-value"},"12m",-1)),t("div",lt,o(e(i)("queue.avgWaitTime")||"متوسط الانتظار"),1)])])]),s(e(Se),{class:"g-4 mb-4"},{default:c(()=>[s(e(S),{lg:"8"},{default:c(()=>[t("div",ot,[t("div",it,[t("h4",nt,o(e(i)("queue.waitingList")||"قائمة الانتظار"),1),s(e($e),{modelValue:G.value,"onUpdate:modelValue":n[3]||(n[3]=a=>G.value=a),placeholder:e(i)("common.search"),class:"nano-search-input"},null,8,["modelValue","placeholder"])]),C.value?(u(),r("div",ct,[s(e(Be),{color:"primary"})])):M.value.length===0?(u(),r("div",dt,[s(e(d),{icon:"cil-coffee",size:"xl",class:"mb-3"}),t("p",null,o(e(i)("queue.noTickets")||"لا يوجد عميلات في الانتظار"),1)])):(u(),r("div",ut,[(u(!0),r(q,null,T(M.value,a=>(u(),r("div",{key:a.id,class:"nano-ticket-card waiting"},[t("div",rt,[t("span",_t,"#"+o(a.ticket_number||a.id),1),t("span",mt,o(e(i)("queue.ticket")),1)]),t("div",vt,[t("div",ft,o(a.customer_name||"Walk-in"),1),t("div",pt,[s(e(d),{icon:"cil-spreadsheet",class:"me-1"}),_(o(a.service_name),1)]),t("div",gt,[s(e(d),{icon:"cil-clock",class:"me-1"}),_(o(Z(a.check_in_at)),1)])]),t("div",ht,[s(e(v),{color:"primary",variant:"ghost",onClick:g=>K(a),title:e(i)("queue.call")},{default:c(()=>[s(e(d),{icon:"cil-bell"})]),_:1},8,["onClick","title"]),s(e(v),{color:"success",variant:"ghost",onClick:g=>X(a),title:e(i)("queue.startService")},{default:c(()=>[s(e(d),{icon:"cil-play"})]),_:1},8,["onClick","title"]),s(e(v),{color:"secondary",variant:"ghost",onClick:g=>pe(a)},{default:c(()=>[s(e(d),{icon:"cil-info"})]),_:1},8,["onClick"])])]))),128))]))])]),_:1}),s(e(S),{lg:"4"},{default:c(()=>[t("div",bt,[t("h4",kt,o(e(i)("queue.inProgress")),1),J.value.length===0?(u(),r("div",wt,[s(e(d),{icon:"cil-smile",size:"xl",class:"mb-3"}),t("p",null,o(e(i)("queue.noActiveServices")||"لا يوجد عميلات قيد الخدمة حالياً"),1)])):(u(),r("div",yt,[(u(!0),r(q,null,T(J.value,a=>(u(),r("div",{key:a.id,class:"nano-ticket-card serving border-info shadow-sm"},[t("div",Ct,[s(e(H),{color:"info",shape:"rounded-pill",class:"px-3 py-2"},{default:c(()=>[s(e(d),{icon:"cil-user",class:"me-1"}),_(o(a.staff_name),1)]),_:2},1024),t("span",xt,"#"+o(a.ticket_number||a.id),1)]),t("h5",qt,o(a.customer_name||"Walk-in"),1),t("div",Tt,o(a.service_name),1),t("div",St,[s(e(v),{color:"success",class:"flex-grow-1 nano-btn-sm",onClick:g=>ve(a)},{default:c(()=>[s(e(d),{icon:"cil-check",class:"me-1"}),_(o(e(i)("queue.complete")),1)]),_:1},8,["onClick"]),s(e(v),{color:"info",variant:"ghost",onClick:g=>fe(a),title:e(i)("queue.checkout")},{default:c(()=>[s(e(d),{icon:"cil-cart"})]),_:1},8,["onClick","title"])])]))),128))]))])]),_:1})]),_:1}),z.value.length>0?(u(),r("div",Vt,[t("h5",Ft,[s(e(d),{icon:"cil-calendar",class:"me-2 text-primary"}),_(" "+o(e(i)("queue.upcomingBookings")),1)]),t("div",$t,[(u(!0),r(q,null,T(z.value,a=>(u(),r("div",{key:a.id,class:"booking-mini-card p-3 rounded-4 border bg-tertiary"},[t("div",Bt,o(a.booking_time),1),t("div",Mt,o(a.customer_name),1),t("div",Dt,o(a.service_name),1),s(e(v),{size:"sm",color:"primary",variant:"ghost",onClick:g=>ge(a),disabled:a.queue_ticket_id},{default:c(()=>[_(o(a.queue_ticket_id?"In Queue":e(i)("queue.addToQueue")),1)]),_:2},1032,["onClick","disabled"])]))),128))])])):j("",!0),s(e(se),{visible:N.value,onClose:W,size:"lg",alignment:"center"},{default:c(()=>[s(e(le),null,{default:c(()=>[s(e(oe),null,{default:c(()=>[s(e(d),{icon:"cil-list",class:"me-2"}),_(o(e(i)("queue.ticketDetails")),1)]),_:1})]),_:1}),f.value?(u(),ae(e(ie),{key:0,class:"p-4"},{default:c(()=>[t("div",It,[t("div",Qt,"#"+o(f.value.ticket_number||f.value.id),1),t("div",null,[t("h3",Rt,o(f.value.customer_name||"Walk-in Customer"),1),s(e(H),{color:ke(f.value.status),shape:"rounded-pill",class:"px-3 py-2"},{default:c(()=>[_(o(be(f.value.status)),1)]),_:1},8,["color"])])]),t("div",Ut,[s(e(S),{md:"6"},{default:c(()=>[t("div",zt,[n[10]||(n[10]=t("label",{class:"small text-muted fw-bold d-block mb-1"},"Service",-1)),t("div",At,o(f.value.service_name),1)])]),_:1}),s(e(S),{md:"6"},{default:c(()=>[t("div",Nt,[n[11]||(n[11]=t("label",{class:"small text-muted fw-bold d-block mb-1"},"Staff",-1)),t("div",Pt,o(f.value.staff_name||"Unassigned"),1)])]),_:1}),s(e(S),{md:"6"},{default:c(()=>[t("div",Wt,[n[12]||(n[12]=t("label",{class:"small text-muted fw-bold d-block mb-1"},"Check-in",-1)),t("div",jt,o(he(f.value.check_in_at)),1)])]),_:1}),s(e(S),{md:"6"},{default:c(()=>[t("div",Ht,[n[13]||(n[13]=t("label",{class:"small text-muted fw-bold d-block mb-1"},"Wait Time",-1)),t("div",Lt,o(Z(f.value.check_in_at)),1)])]),_:1})])]),_:1})):j("",!0),s(e(ne),null,{default:c(()=>[s(e(v),{color:"secondary",variant:"ghost",onClick:W},{default:c(()=>[_(o(e(i)("common.close")),1)]),_:1}),f.value.status==="waiting"?(u(),ae(e(v),{key:0,color:"primary",onClick:n[4]||(n[4]=()=>{W(),X(f.value)})},{default:c(()=>[_(o(e(i)("queue.startService")),1)]),_:1})):j("",!0)]),_:1})]),_:1},8,["visible"]),s(e(se),{visible:A.value,onClose:P,size:"lg",alignment:"center"},{default:c(()=>[s(e(le),null,{default:c(()=>[s(e(oe),null,{default:c(()=>[s(e(d),{icon:"cil-plus",class:"me-2"}),_(o(e(i)("queue.createTicket")),1)]),_:1})]),_:1}),s(e(ie),{class:"p-4"},{default:c(()=>[t("div",Et,[t("label",Ot,o(e(i)("bookings.customer")),1),s(e(L),{modelValue:p.value.customer_id,"onUpdate:modelValue":n[5]||(n[5]=a=>p.value.customer_id=a),class:"rounded-3"},{default:c(()=>[t("option",Yt,o(e(i)("queue.walkIn")),1),(u(!0),r(q,null,T(O.value,a=>(u(),r("option",{key:a.id,value:a.id},o(a.name),9,Gt))),128))]),_:1},8,["modelValue"])]),t("div",Jt,[t("label",Kt,o(e(i)("bookings.service"))+" *",1),s(e(L),{modelValue:p.value.service_id,"onUpdate:modelValue":n[6]||(n[6]=a=>p.value.service_id=a),onChange:l.onServiceChange,class:"rounded-3"},{default:c(()=>[t("option",Xt,o(e(i)("queue.selectService")),1),(u(!0),r(q,null,T(Y.value,a=>(u(),r("option",{key:a.id,value:a.id},o(a.name||a.title),9,Zt))),128))]),_:1},8,["modelValue","onChange"])]),t("div",es,[t("label",ts,o(e(i)("bookings.staff")),1),s(e(L),{modelValue:p.value.staff_id,"onUpdate:modelValue":n[7]||(n[7]=a=>p.value.staff_id=a),class:"rounded-3"},{default:c(()=>[t("option",ss,o(e(i)("queue.anyAvailableStaff")),1),(u(!0),r(q,null,T(ye.value,a=>(u(),r("option",{key:a.id,value:a.id},o(a.name),9,as))),128))]),_:1},8,["modelValue"])]),t("div",ls,[t("label",os,o(e(i)("common.notes")),1),s(e(Me),{modelValue:p.value.notes,"onUpdate:modelValue":n[8]||(n[8]=a=>p.value.notes=a),rows:"3",class:"rounded-3"},null,8,["modelValue"])])]),_:1}),s(e(ne),null,{default:c(()=>[s(e(v),{color:"secondary",variant:"ghost",onClick:P},{default:c(()=>[_(o(e(i)("common.cancel")),1)]),_:1}),s(e(v),{color:"primary",class:"nano-btn",onClick:_e,disabled:!p.value.service_id||B.value},{default:c(()=>[_(o(B.value?e(i)("common.creating"):e(i)("queue.createTicket")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),s(Qe,{"page-key":"queue"})]))}},gs=Re(is,[["__scopeId","data-v-28db0c3e"]]);export{gs as default};
