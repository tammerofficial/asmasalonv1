import{f,D as P,g,i as ae,c as u,o as d,d as o,a as T,q as k,p as c,u as e,af as U,b as l,e as F,t as r,F as R,k as $,a5 as te,v as B,O as m,C as _,ai as W,P as w,Q as z,R as H,n as j,X as C,a6 as se,a7 as le,a8 as oe,a9 as ie}from"../chunk-vendor-vue-DxcSX1Jd.js";import{u as re,a as q}from"../chunk-component-NotificationsBell-eCwis6PW.js";import{P as ne}from"../chunk-component-PageHeader-BsA6C9en.js";import{E as G}from"../chunk-component-EmptyState-B78c8qVh.js";import{S as V}from"../chunk-component-StatsCard-ZPUV1nnJ.js";import{_ as ce}from"../chunk-component-Card-BWbCGpFM.js";import"../chunk-vendor-BwxB3d-x.js";import"../chunk-vendor-charts-CNHMDSF7.js";import"../chunk-vendor-pinia-DRDRCEXO.js";import"../chunk-vendor-axios-B9ygI19o.js";const de={class:"roles-page"},ue={key:0,class:"stats-grid"},pe={class:"filters-row"},me={class:"search-box"},_e=["placeholder"],he={class:"filter-toggle"},fe={class:"toggle-row"},ve={key:2,class:"text-center py-5"},ye={class:"mt-3 text-muted"},ge={key:3,class:"py-5"},Ce={key:4,class:"roles-grid"},be={class:"role-header"},ke={class:"role-info"},we={class:"role-name"},xe={class:"role-meta"},Ae={class:"role-meta-muted"},Oe={key:0,class:"text-center py-4"},Me={key:1},Re={class:"modal-filters"},$e={class:"search-box"},Be=["placeholder"],Ve={class:"toggle-row"},Le={class:"caps-summary"},Se={class:"module-details",open:""},Ee={class:"module-title"},De={class:"module-title-left"},Ie={class:"module-title-right"},Ne={class:"capabilities-list"},Pe=["onClick","title"],Te={class:"capability-icon"},Ue={class:"capability-name"},Fe={class:"capability-key monospace"},We={key:2,class:"py-4"},ze={__name:"Index",setup(He){const{t:i}=re(),v=f(!1),x=f(!1),y=f([]),L=f(null),A=f(null),b=f(!1),h=P({search:"",showAsmaaOnly:!0}),p=P({search:"",grantedOnly:!1}),S=async()=>{v.value=!0;try{const a=await q.get("users/roles");a.data.success&&(y.value=a.data.data)}catch(a){console.error("Error loading roles:",a),alert(i("roles.errorLoading"))}finally{v.value=!1}},Q=()=>{S()},X=async a=>{L.value=a,b.value=!0,x.value=!0,p.search="",p.grantedOnly=!1;try{const s=await q.get(`users/roles/${a.key}`);s.data.success&&(A.value=s.data.data.capabilities)}catch(s){console.error("Error loading capabilities:",s),alert(i("roles.errorLoadingCapabilities"))}finally{x.value=!1}},J=a=>(a==null?void 0:a.asmaa_capabilities_count)??0,E=g(()=>{const a=(h.search||"").trim().toLowerCase();return y.value.filter(s=>{h.showAsmaaOnly&&!String(s.key).startsWith("asmaa_")&&s.key;const t=`${s.name} ${s.key}`.toLowerCase();return!a||t.includes(a)})}),O=g(()=>({totalRoles:y.value.length,totalAsmaaCaps:y.value.reduce((a,s)=>a+(s.asmaa_capabilities_count||0),0),totalWpCaps:y.value.reduce((a,s)=>a+(s.capabilities_count||0),0)})),M=g(()=>A.value?Object.entries(A.value).map(([a,s])=>({key:a,items:s,total:Array.isArray(s)?s.length:0,granted:Array.isArray(s)?s.filter(t=>t.has).length:0})):[]),D=g(()=>{const a=(p.search||"").trim().toLowerCase();return M.value.map(s=>{const t=(s.items||[]).filter(n=>p.grantedOnly&&!n.has?!1:a?`${n.name} ${n.key}`.toLowerCase().includes(a):!0);return{...s,items:t,total:t.length,granted:t.filter(n=>n.has).length}}).filter(s=>s.items.length>0)}),I=g(()=>{const a=M.value.flatMap(n=>n.items||[]),s=p.grantedOnly||(p.search||"").trim()?D.value.flatMap(n=>n.items||[]):a,t=s.filter(n=>n.has).length;return{granted:t,denied:s.length-t}}),Y=async a=>{try{await navigator.clipboard.writeText(a)}catch{const t=document.createElement("textarea");t.value=a,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}},N=a=>a==="administrator"||a==="asmaa_super_admin"?"danger":a==="asmaa_admin"?"warning":a==="asmaa_manager"?"primary":a==="asmaa_accountant"?"success":a==="asmaa_receptionist"?"info":a==="asmaa_cashier"?"secondary":"dark",Z=a=>a==="administrator"||a==="asmaa_super_admin"?"cil-star":a==="asmaa_admin"?"cil-shield-alt":a==="asmaa_manager"?"cil-briefcase":a==="asmaa_accountant"?"cil-calculator":a==="asmaa_receptionist"?"cil-phone":a==="asmaa_cashier"?"cil-dollar":"cil-user",K=a=>a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," ");return ae(()=>{S()}),(a,s)=>(d(),u("div",de,[o(ne,{title:e(i)("roles.title"),subtitle:e(i)("roles.subtitle")},{icon:c(()=>[...s[6]||(s[6]=[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})],-1)])]),actions:c(()=>[o(e(B),{class:"btn-refresh",color:"secondary",variant:"outline",onClick:Q},{default:c(()=>[o(e(_),{icon:"cil-reload",class:"me-1"}),m(" "+r(e(i)("common.refresh")),1)]),_:1})]),_:1},8,["title","subtitle"]),v.value?T("",!0):(d(),u("div",ue,[o(V,{title:e(i)("roles.totalRoles"),value:O.value.totalRoles,icon:"cil-shield-alt",color:"primary"},null,8,["title","value"]),o(V,{title:e(i)("roles.totalAsmaaCaps"),value:O.value.totalAsmaaCaps,icon:"cil-lock-locked",color:"success"},null,8,["title","value"]),o(V,{title:e(i)("roles.totalWpCaps"),value:O.value.totalWpCaps,icon:"cil-list",color:"info"},null,8,["title","value"])])),v.value?T("",!0):(d(),k(e(U),{key:1,class:"mb-4"},{default:c(()=>[o(e(W),null,{default:c(()=>[l("div",pe,[l("div",me,[o(e(_),{icon:"cil-search",class:"search-icon"}),w(l("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>h.search=t),type:"text",class:"search-input",placeholder:e(i)("roles.searchPlaceholder")},null,8,_e),[[z,h.search]])]),l("div",he,[l("label",fe,[w(l("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>h.showAsmaaOnly=t),type:"checkbox"},null,512),[[H,h.showAsmaaOnly]]),l("span",null,r(e(i)("roles.showAsmaaOnly")),1)])])])]),_:1})]),_:1})),v.value?(d(),u("div",ve,[o(e(F),{color:"primary"}),l("p",ye,r(e(i)("common.loading")),1)])):E.value.length===0?(d(),u("div",ge,[o(G,{title:e(i)("roles.noRoles"),description:e(i)("roles.noRolesDescription"),icon:"cil-shield-alt"},null,8,["title","description"])])):(d(),u("div",Ce,[(d(!0),u(R,null,$(E.value,t=>(d(),k(e(U),{key:t.key,class:"role-card"},{default:c(()=>[o(e(W),null,{default:c(()=>[l("div",be,[l("div",{class:j(["role-icon",`role-icon-${N(t.key)}`])},[o(e(_),{icon:Z(t.key)},null,8,["icon"])],2),l("div",ke,[l("h4",we,r(t.name),1),l("div",xe,[o(e(C),{color:N(t.key)},{default:c(()=>[m(r(J(t))+" "+r(e(i)("roles.asmaaCapabilities")),1)]),_:2},1032,["color"]),l("span",Ae,r(t.capabilities_count)+" "+r(e(i)("roles.wpCapabilities")),1)])])]),o(e(B),{class:"btn-view-caps w-100 mt-3",color:"secondary",variant:"outline",onClick:n=>X(t)},{default:c(()=>[o(e(_),{icon:"cil-list",class:"me-1"}),m(" "+r(e(i)("roles.viewCapabilities")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))])),o(e(te),{visible:b.value,size:"xl",scrollable:"",onClose:s[5]||(s[5]=t=>b.value=!1)},{default:c(()=>[o(e(se),null,{default:c(()=>[o(e(le),null,{default:c(()=>{var t;return[m(r((t=L.value)==null?void 0:t.name)+" - "+r(e(i)("roles.capabilities")),1)]}),_:1})]),_:1}),o(e(oe),null,{default:c(()=>[x.value?(d(),u("div",Oe,[o(e(F),{color:"primary"})])):M.value.length?(d(),u("div",Me,[l("div",Re,[l("div",$e,[o(e(_),{icon:"cil-search",class:"search-icon"}),w(l("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>p.search=t),type:"text",class:"search-input",placeholder:e(i)("roles.searchCapabilitiesPlaceholder")},null,8,Be),[[z,p.search]])]),l("label",Ve,[w(l("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>p.grantedOnly=t),type:"checkbox"},null,512),[[H,p.grantedOnly]]),l("span",null,r(e(i)("roles.showGrantedOnly")),1)])]),l("div",Le,[o(e(C),{color:"success"},{default:c(()=>[m(r(I.value.granted)+" "+r(e(i)("roles.granted")),1)]),_:1}),o(e(C),{color:"secondary"},{default:c(()=>[m(r(I.value.denied)+" "+r(e(i)("roles.denied")),1)]),_:1})]),(d(!0),u(R,null,$(D.value,t=>(d(),u("div",{key:t.key,class:"capability-module"},[l("details",Se,[l("summary",Ee,[l("span",De,[o(e(_),{icon:"cil-folder",class:"me-2"}),m(" "+r(K(t.key)),1)]),l("span",Ie,[o(e(C),{color:"success"},{default:c(()=>[m(r(t.granted),1)]),_:2},1024),o(e(C),{color:"secondary"},{default:c(()=>[m(r(t.total-t.granted),1)]),_:2},1024)])]),l("div",Ne,[(d(!0),u(R,null,$(t.items,n=>(d(),u("button",{key:n.key,type:"button",class:j(["capability-item",{"has-capability":n.has}]),onClick:ee=>Y(n.key),title:e(i)("roles.copyCapabilityHint")},[l("div",Te,[n.has?(d(),k(e(_),{key:0,icon:"cil-check-circle",class:"text-success"})):(d(),k(e(_),{key:1,icon:"cil-x-circle",class:"text-muted"}))]),l("div",Ue,r(n.name),1),l("div",Fe,r(n.key),1)],10,Pe))),128))])])]))),128))])):(d(),u("div",We,[o(G,{title:e(i)("roles.noCapabilities"),description:e(i)("roles.noCapabilitiesDescription"),icon:"cil-lock-locked"},null,8,["title","description"])]))]),_:1}),o(e(ie),null,{default:c(()=>[o(e(B),{color:"secondary",onClick:s[4]||(s[4]=t=>b.value=!1)},{default:c(()=>[m(r(e(i)("common.close")),1)]),_:1})]),_:1})]),_:1},8,["visible"])]))}},aa=ce(ze,[["__scopeId","data-v-62b0b677"]]);export{aa as default};
