import{f as m,j as P,c as p,o as h,b as s,d as a,t as e,u as t,w as i,Y as X,x as v,C as d,$ as U,h as Y,F as z,g as E,a0 as J,l as O,P as C,n as $,a2 as b,aa as Q,ab as Z,a3 as M,a4 as H,X as T,a5 as tt,a6 as st,a7 as at,a8 as et}from"../chunk-vendor-vue-VAxhpvd9.js";import{u as ot,a as V}from"../chunk-component-NotificationsBell-CTLJWkW4.js";import{u as lt}from"../chunk-view-AppleWallet/Simulator-BwS6bEkK.js";import{E as it}from"../chunk-component-EmptyState-DXFewvrN.js";import{H as nt}from"../chunk-component-HelpSection-NeetTt3d.js";import{_ as ct}from"../chunk-component-Card-DPM96EeB.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-pinia-CjQxP09R.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-PageHeader-CMYNL4hu.js";const dt={class:"staff-page p-4"},rt={class:"pos-header-top d-flex justify-content-between align-items-center mb-4"},ut={class:"header-left d-flex align-items-center gap-3"},mt={class:"mb-0 fw-bold text-primary"},vt={class:"header-right d-flex gap-2"},_t={class:"nano-stats-bar mb-4"},ft={class:"stat-card-nano"},pt={class:"stat-icon-bg staff"},ht={class:"stat-info"},bt={class:"stat-value"},gt={class:"stat-label"},yt={class:"stat-card-nano"},Ct={class:"stat-icon-bg rating"},wt={class:"stat-info"},xt={class:"stat-value text-warning"},kt={class:"stat-label"},Vt={class:"stat-card-nano"},Ft={class:"stat-icon-bg revenue"},St={class:"stat-info"},It={class:"stat-value text-success"},Mt={class:"stat-label"},Rt={class:"stat-card-nano"},$t={class:"stat-icon-bg calls"},Tt={class:"stat-info"},Nt={class:"stat-value text-info"},Bt={class:"stat-label"},Dt={class:"nano-filters-bar p-3 bg-secondary rounded-4 mb-4 shadow-sm border border-light"},Ut={value:""},zt={value:"1"},Et={value:"0"},Ht={class:"nano-panel"},jt={key:0,class:"text-center p-5"},qt={key:1,class:"text-center p-5"},Gt={key:2,class:"nano-grid"},Kt=["onClick"],Lt={class:"staff-avatar-main"},Wt={class:"staff-main-info mt-3 text-center"},At={class:"fw-bold mb-1"},Pt={class:"text-muted small mb-2"},Xt={class:"rating-stars mb-3"},Yt={class:"small ms-1"},Jt={class:"staff-stats-row d-flex justify-content-between border-top pt-3"},Ot={class:"stat"},Qt={class:"label"},Zt={class:"value text-primary fw-bold"},ts={class:"stat"},ss={class:"label"},as={class:"value text-success fw-bold"},es={class:"staff-actions-hover mt-3"},os={class:"form-label fw-bold"},ls={class:"form-label fw-bold"},is={class:"form-label fw-bold"},ns={class:"form-label fw-bold"},cs={value:1},ds={value:0},rs={__name:"Index",setup(us){const{t:l}=ot(),w=lt(),j=O(),x=m(!1),F=m(!1),S=m([]),_=m({total:0,active:0,averageRating:0,totalRatings:0,totalRevenue:0}),g=m({search:"",is_active:""}),y=m(!1),I=m(!1),R=m(null),r=m({name:"",position:"",commission_rate:10,is_active:1}),f=async()=>{var c,n,o,k;x.value=!0;try{const u=await V.get("/staff",{params:{...g.value}});S.value=((n=(c=u.data)==null?void 0:c.data)==null?void 0:n.items)||((o=u.data)==null?void 0:o.items)||[];const D=await V.get("/staff/stats");_.value=((k=D.data)==null?void 0:k.data)||D.data||_.value}catch(u){console.error("Failed to load staff:",u)}finally{x.value=!1}},q=()=>{clearTimeout(window.searchTimer),window.searchTimer=setTimeout(f,500)},G=()=>{g.value={search:"",is_active:""},f()},K=()=>{I.value=!1,R.value=null,r.value={name:"",position:"",commission_rate:10,is_active:1},y.value=!0},N=c=>{I.value=!0,R.value=c.id,r.value={...c},y.value=!0},L=async()=>{F.value=!0;try{I.value?(await V.put(`/staff/${R.value}`,r.value),w.success("Staff updated")):(await V.post("/staff",r.value),w.success("Staff added")),y.value=!1,f()}catch{w.error("Failed to save staff")}finally{F.value=!1}},W=async c=>{if(confirm(`Delete staff member ${c.name}?`))try{await V.delete(`/staff/${c.id}`),w.success("Staff deleted"),f()}catch{w.error("Failed to delete staff")}},A=c=>{j.push({path:"/reports",query:{staff_id:c.id,type:"commissions"}})},B=c=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",notation:"compact",minimumFractionDigits:1}).format(c||0);return P(()=>{f()}),(c,n)=>(h(),p("div",dt,[s("div",rt,[s("div",ut,[s("h2",mt,e(t(l)("staff.title")),1),a(t(X),{color:"gold",shape:"rounded-pill",class:"px-3 py-2 fw-bold text-dark"},{default:i(()=>[a(t(d),{icon:"cil-user",class:"me-1"}),C(" "+e(_.value.total||S.value.length)+" "+e(t(l)("staff.title")),1)]),_:1})]),s("div",vt,[a(t(v),{color:"primary",class:"nano-btn",onClick:K},{default:i(()=>[a(t(d),{icon:"cil-plus",class:"me-2"}),C(" "+e(t(l)("staff.addNew")),1)]),_:1}),a(t(v),{color:"secondary",variant:"ghost",onClick:f,disabled:x.value},{default:i(()=>[a(t(d),{icon:"cil-reload",class:$({spinning:x.value})},null,8,["class"])]),_:1},8,["disabled"])])]),s("div",_t,[s("div",ft,[s("div",pt,[a(t(d),{icon:"cil-user"})]),s("div",ht,[s("div",bt,e(_.value.active||0),1),s("div",gt,e(t(l)("staff.activeCount",{count:""}).replace("{count}","").trim()||"موظفة نشطة"),1)])]),s("div",yt,[s("div",Ct,[a(t(d),{icon:"cil-star"})]),s("div",wt,[s("div",xt,e(Number(_.value.averageRating||0).toFixed(1)),1),s("div",kt,e(t(l)("staff.averageRating")||"متوسط التقييم"),1)])]),s("div",Vt,[s("div",Ft,[a(t(d),{icon:"cil-money"})]),s("div",St,[s("div",It,e(B(_.value.totalRevenue||0)),1),s("div",Mt,e(t(l)("staff.totalRevenue")||"إجمالي الإيرادات"),1)])]),s("div",Rt,[s("div",$t,[a(t(d),{icon:"cil-bell"})]),s("div",Tt,[s("div",Nt,e(_.value.todayCalls||0),1),s("div",Bt,e(t(l)("workerCalls.todaysBookings")||"نداءات اليوم"),1)])])]),s("div",Dt,[a(t(U),{class:"g-3 align-items-center"},{default:i(()=>[a(t(b),{md:"6"},{default:i(()=>[a(t(Q),null,{default:i(()=>[a(t(Z),{class:"bg-transparent border-0"},{default:i(()=>[a(t(d),{icon:"cil-magnifying-glass"})]),_:1}),a(t(M),{modelValue:g.value.search,"onUpdate:modelValue":n[0]||(n[0]=o=>g.value.search=o),placeholder:t(l)("common.search"),onInput:q,class:"border-0 bg-transparent"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(t(b),{md:"3"},{default:i(()=>[a(t(H),{modelValue:g.value.is_active,"onUpdate:modelValue":n[1]||(n[1]=o=>g.value.is_active=o),onChange:f,class:"rounded-3"},{default:i(()=>[s("option",Ut,e(t(l)("common.status")),1),s("option",zt,e(t(l)("status.active")),1),s("option",Et,e(t(l)("status.inactive")),1)]),_:1},8,["modelValue"])]),_:1}),a(t(b),{md:"3"},{default:i(()=>[a(t(v),{color:"primary",variant:"ghost",class:"w-100",onClick:G},{default:i(()=>[a(t(d),{icon:"cil-filter-x",class:"me-1"}),C(e(t(l)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),s("div",Ht,[x.value?(h(),p("div",jt,[a(t(Y),{color:"primary"})])):S.value.length===0?(h(),p("div",qt,[a(it,{title:t(l)("common.noData"),description:t(l)("staff.title")},null,8,["title","description"])])):(h(),p("div",Gt,[(h(!0),p(z,null,E(S.value,o=>{var k;return h(),p("div",{key:o.id,class:"staff-nano-card",onClick:u=>N(o)},[s("div",{class:$(["staff-status-dot",o.is_active?"active":"inactive"])},null,2),s("div",Lt,e((k=o.name)==null?void 0:k.charAt(0)),1),s("div",Wt,[s("h5",At,e(o.name),1),s("p",Pt,e(o.position||t(l)("staff.role")),1),s("div",Xt,[(h(),p(z,null,E(5,u=>a(t(d),{icon:"cil-star",key:u,class:$(u<=(o.average_rating||0)?"text-warning":"text-muted")},null,8,["class"])),64)),s("span",Yt,"("+e(o.total_ratings||0)+")",1)])]),s("div",Jt,[s("div",Ot,[s("span",Qt,e(t(l)("staff.commission")),1),s("span",Zt,e(o.commission_rate)+"%",1)]),s("div",ts,[s("span",ss,e(t(l)("staff.revenue")),1),s("span",as,e(B(o.total_revenue||0)),1)])]),s("div",es,[a(t(v),{size:"sm",color:"info",variant:"ghost",onClick:T(u=>N(o),["stop"])},{default:i(()=>[a(t(d),{icon:"cil-pencil"})]),_:1},8,["onClick"]),a(t(v),{size:"sm",color:"primary",variant:"ghost",onClick:T(u=>A(o),["stop"])},{default:i(()=>[a(t(d),{icon:"cil-history"})]),_:1},8,["onClick"]),a(t(v),{size:"sm",color:"danger",variant:"ghost",onClick:T(u=>W(o),["stop"])},{default:i(()=>[a(t(d),{icon:"cil-trash"})]),_:1},8,["onClick"])])],8,Kt)}),128))]))]),a(t(J),{visible:y.value,onClose:n[7]||(n[7]=o=>y.value=!1),size:"lg",alignment:"center"},{default:i(()=>[a(t(tt),null,{default:i(()=>[a(t(st),null,{default:i(()=>[C(e(I.value?t(l)("staff.edit"):t(l)("staff.addNew")),1)]),_:1})]),_:1}),a(t(at),{class:"p-4"},{default:i(()=>[a(t(U),{class:"g-3"},{default:i(()=>[a(t(b),{md:"6"},{default:i(()=>[s("label",os,e(t(l)("staff.fullName"))+" *",1),a(t(M),{modelValue:r.value.name,"onUpdate:modelValue":n[2]||(n[2]=o=>r.value.name=o),required:""},null,8,["modelValue"])]),_:1}),a(t(b),{md:"6"},{default:i(()=>[s("label",ls,e(t(l)("staff.role")),1),a(t(M),{modelValue:r.value.position,"onUpdate:modelValue":n[3]||(n[3]=o=>r.value.position=o)},null,8,["modelValue"])]),_:1}),a(t(b),{md:"6"},{default:i(()=>[s("label",is,e(t(l)("staff.commission"))+" (%)",1),a(t(M),{modelValue:r.value.commission_rate,"onUpdate:modelValue":n[4]||(n[4]=o=>r.value.commission_rate=o),modelModifiers:{number:!0},type:"number",min:"0",max:"100"},null,8,["modelValue"])]),_:1}),a(t(b),{md:"6"},{default:i(()=>[s("label",ns,e(t(l)("common.status")),1),a(t(H),{modelValue:r.value.is_active,"onUpdate:modelValue":n[5]||(n[5]=o=>r.value.is_active=o)},{default:i(()=>[s("option",cs,e(t(l)("status.active")),1),s("option",ds,e(t(l)("status.inactive")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(t(et),null,{default:i(()=>[a(t(v),{color:"secondary",variant:"ghost",onClick:n[6]||(n[6]=o=>y.value=!1)},{default:i(()=>[C(e(t(l)("common.cancel")),1)]),_:1}),a(t(v),{color:"primary",class:"nano-btn",onClick:L,disabled:F.value},{default:i(()=>[C(e(F.value?t(l)("common.saving"):t(l)("common.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),a(nt,{"page-key":"staff"})]))}},ws=ct(rs,[["__scopeId","data-v-97b9a203"]]);export{ws as default};
