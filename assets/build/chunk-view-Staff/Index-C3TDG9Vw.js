import{f as m,j as P,c as v,o as _,b as t,d as e,u as s,C as r,t as l,w as n,Y as X,x as f,$ as D,h as Y,F as z,g as L,a0 as J,l as O,P as C,n as T,a2 as p,aa as Q,ab as Z,a3 as R,a4 as E,X as $,a5 as ss,a6 as ts,a7 as es,a9 as as,a8 as os}from"../chunk-vendor-vue-VAxhpvd9.js";import{u as ls,a as V}from"../chunk-component-NotificationsBell-CTLJWkW4.js";import{u as ns}from"../chunk-view-AppleWallet/Simulator-BwS6bEkK.js";import{E as is}from"../chunk-component-EmptyState-DXFewvrN.js";import{H as cs}from"../chunk-component-HelpSection-NeetTt3d.js";import{_ as ds}from"../chunk-component-Card-DPM96EeB.js";import"../chunk-vendor-Ltsl4QyH.js";import"../chunk-vendor-pinia-CjQxP09R.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-PageHeader-CMYNL4hu.js";const rs={class:"staff-page p-4 nano-banana-theme"},us={class:"pos-header-top d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded-4 shadow-sm border border-light"},ms={class:"header-left d-flex align-items-center gap-3"},vs={class:"avatar-circle-nano"},_s={class:"mb-0 fw-bold text-navy"},fs={class:"header-right d-flex gap-2"},ps={class:"nano-stats-bar mb-4"},hs={class:"stat-card-nano"},bs={class:"stat-icon-bg staff"},gs={class:"stat-info"},ys={class:"stat-value text-navy"},ws={class:"stat-label"},Cs={class:"stat-card-nano"},xs={class:"stat-icon-bg rating"},ks={class:"stat-info"},Vs={class:"stat-value text-warning"},Fs={class:"stat-label"},Is={class:"stat-card-nano"},Ms={class:"stat-icon-bg revenue"},Rs={class:"stat-info"},Ss={class:"stat-value text-success"},Ts={class:"stat-label"},$s={class:"stat-card-nano"},Ns={class:"stat-icon-bg calls"},Bs={class:"stat-info"},Us={class:"stat-value text-info"},Ds={class:"stat-label"},zs={class:"nano-filters-bar p-3 bg-white rounded-4 mb-4 shadow-sm border border-light"},Ls={value:""},Es={value:"1"},Hs={value:"0"},js={class:"nano-panel p-4 bg-white rounded-5 shadow-luxury border border-light"},qs={key:0,class:"text-center p-5"},Gs={key:1,class:"text-center p-5"},Ks={key:2,class:"nano-grid"},Ws=["onClick"],As={class:"staff-avatar-main"},Ps={key:0},Xs=["src"],Ys={class:"staff-main-info mt-3 text-center"},Js={class:"fw-bold mb-1 text-navy"},Os={class:"text-muted small mb-2"},Qs={class:"rating-stars mb-3"},Zs={class:"small ms-1 text-muted"},st={class:"staff-stats-row d-flex justify-content-between border-top pt-3"},tt={class:"stat"},et={class:"label"},at={class:"value text-primary fw-bold"},ot={class:"stat"},lt={class:"label"},nt={class:"value text-success fw-bold"},it={class:"staff-actions-hover mt-3"},ct={class:"form-label fw-bold small text-muted"},dt={class:"form-label fw-bold small text-muted"},rt={class:"form-label fw-bold small text-muted"},ut={class:"form-label fw-bold small text-muted"},mt={value:1},vt={value:0},_t={class:"form-label fw-bold small text-muted"},ft={__name:"Index",setup(pt){const{t:a}=ls(),h=ns(),H=O(),x=m(!1),F=m(!1),I=m([]),b=m({total:0,active:0,averageRating:0,totalRatings:0,totalRevenue:0,todayCalls:0}),y=m({search:"",is_active:""}),w=m(!1),M=m(!1),S=m(null),c=m({name:"",position:"",commission_rate:10,is_active:1,notes:""}),g=async()=>{var d,i,o,k;x.value=!0;try{const u=await V.get("/staff",{params:{...y.value},noCache:!0});I.value=((i=(d=u.data)==null?void 0:d.data)==null?void 0:i.items)||((o=u.data)==null?void 0:o.items)||[];const U=await V.get("/staff/stats",{noCache:!0});b.value=((k=U.data)==null?void 0:k.data)||U.data||b.value}catch(u){console.error("Failed to load staff:",u),h.error(a("common.errorLoading"))}finally{x.value=!1}},j=()=>{clearTimeout(window.searchTimer),window.searchTimer=setTimeout(g,500)},q=()=>{y.value={search:"",is_active:""},g()},G=()=>{M.value=!1,S.value=null,c.value={name:"",position:"",commission_rate:10,is_active:1,notes:""},w.value=!0},N=d=>{M.value=!0,S.value=d.id,c.value={...d},w.value=!0},K=async()=>{if(!c.value.name){h.error(a("common.requiredFields")||"الاسم مطلوب");return}F.value=!0;try{M.value?(await V.put(`/staff/${S.value}`,c.value),h.success(a("staff.updated")||"تم تحديث البيانات")):(await V.post("/staff",c.value),h.success(a("staff.added")||"تم إضافة الموظفة")),w.value=!1,g()}catch{h.error(a("common.errorLoading"))}finally{F.value=!1}},W=async d=>{if(confirm(a("common.confirmDelete")||`هل تريد حذف ${d.name}؟`))try{await V.delete(`/staff/${d.id}`),h.success(a("staff.deleted")||"تم الحذف"),g()}catch{h.error(a("common.errorLoading"))}},A=d=>{H.push({path:"/reports",query:{staff_id:d.id,type:"commissions"}})},B=d=>new Intl.NumberFormat("en-KW",{style:"currency",currency:"KWD",notation:"compact",minimumFractionDigits:1}).format(d||0);return P(()=>{g()}),(d,i)=>(_(),v("div",rs,[t("div",us,[t("div",ms,[t("div",vs,[e(s(r),{icon:"cil-people"})]),t("div",null,[t("h2",_s,l(s(a)("staff.title")),1),e(s(X),{color:"primary",shape:"rounded-pill",class:"px-3 py-1 fw-bold"},{default:n(()=>[C(l(b.value.total||I.value.length)+" "+l(s(a)("staff.title")),1)]),_:1})])]),t("div",fs,[e(s(f),{color:"primary",class:"nano-btn",onClick:G},{default:n(()=>[e(s(r),{icon:"cil-plus",class:"me-2"}),C(" "+l(s(a)("staff.addNew")),1)]),_:1}),e(s(f),{color:"secondary",variant:"ghost",class:"nano-btn-icon",onClick:g,disabled:x.value},{default:n(()=>[e(s(r),{icon:"cil-reload",class:T({spinning:x.value})},null,8,["class"])]),_:1},8,["disabled"])])]),t("div",ps,[t("div",hs,[t("div",bs,[e(s(r),{icon:"cil-user"})]),t("div",gs,[t("div",ys,l(b.value.active||0),1),t("div",ws,l(s(a)("staff.activeCount",{count:""}).replace("{count}","").trim()||"موظفة نشطة"),1)])]),t("div",Cs,[t("div",xs,[e(s(r),{icon:"cil-star"})]),t("div",ks,[t("div",Vs,l(Number(b.value.averageRating||0).toFixed(1)),1),t("div",Fs,l(s(a)("staff.averageRating")||"متوسط التقييم"),1)])]),t("div",Is,[t("div",Ms,[e(s(r),{icon:"cil-money"})]),t("div",Rs,[t("div",Ss,l(B(b.value.totalRevenue||0)),1),t("div",Ts,l(s(a)("staff.totalRevenue")||"إجمالي الإيرادات"),1)])]),t("div",$s,[t("div",Ns,[e(s(r),{icon:"cil-bell"})]),t("div",Bs,[t("div",Us,l(b.value.todayCalls||0),1),t("div",Ds,l(s(a)("workerCalls.todaysBookings")||"نداءات اليوم"),1)])])]),t("div",zs,[e(s(D),{class:"g-3 align-items-center"},{default:n(()=>[e(s(p),{md:"6"},{default:n(()=>[e(s(Q),{class:"nano-input-group"},{default:n(()=>[e(s(Z),{class:"bg-transparent border-0"},{default:n(()=>[e(s(r),{icon:"cil-magnifying-glass"})]),_:1}),e(s(R),{modelValue:y.value.search,"onUpdate:modelValue":i[0]||(i[0]=o=>y.value.search=o),placeholder:s(a)("common.search"),onInput:j,class:"border-0 bg-transparent"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),e(s(p),{md:"3"},{default:n(()=>[e(s(E),{modelValue:y.value.is_active,"onUpdate:modelValue":i[1]||(i[1]=o=>y.value.is_active=o),onChange:g,class:"rounded-3 nano-select"},{default:n(()=>[t("option",Ls,l(s(a)("common.status")),1),t("option",Es,l(s(a)("status.active")),1),t("option",Hs,l(s(a)("status.inactive")),1)]),_:1},8,["modelValue"])]),_:1}),e(s(p),{md:"3"},{default:n(()=>[e(s(f),{color:"secondary",variant:"ghost",class:"w-100 rounded-pill",onClick:q},{default:n(()=>[e(s(r),{icon:"cil-filter-x",class:"me-1"}),C(l(s(a)("common.reset")),1)]),_:1})]),_:1})]),_:1})]),t("div",js,[x.value?(_(),v("div",qs,[e(s(Y),{color:"primary"})])):I.value.length===0?(_(),v("div",Gs,[e(is,{title:s(a)("common.noData"),description:s(a)("staff.title")},null,8,["title","description"])])):(_(),v("div",Ks,[(_(!0),v(z,null,L(I.value,o=>{var k;return _(),v("div",{key:o.id,class:"staff-nano-card",onClick:u=>N(o)},[t("div",{class:T(["staff-status-dot",o.is_active?"active":"inactive"])},null,2),t("div",As,[o.photo?(_(),v("img",{key:1,src:o.photo,class:"staff-img"},null,8,Xs)):(_(),v("span",Ps,l((k=o.name)==null?void 0:k.charAt(0)),1))]),t("div",Ys,[t("h5",Js,l(o.name),1),t("p",Os,l(o.position||s(a)("staff.role")),1),t("div",Qs,[(_(),v(z,null,L(5,u=>e(s(r),{icon:"cil-star",key:u,class:T(u<=(o.rating||0)?"text-warning":"text-gray-300")},null,8,["class"])),64)),t("span",Zs,"("+l(o.total_ratings||0)+")",1)])]),t("div",st,[t("div",tt,[t("span",et,l(s(a)("staff.commission")),1),t("span",at,l(o.commission_rate)+"%",1)]),t("div",ot,[t("span",lt,l(s(a)("staff.revenue")),1),t("span",nt,l(B(o.total_revenue||0)),1)])]),t("div",it,[e(s(f),{size:"sm",color:"info",variant:"ghost",class:"action-btn",onClick:$(u=>N(o),["stop"])},{default:n(()=>[e(s(r),{icon:"cil-pencil"})]),_:1},8,["onClick"]),e(s(f),{size:"sm",color:"primary",variant:"ghost",class:"action-btn",onClick:$(u=>A(o),["stop"])},{default:n(()=>[e(s(r),{icon:"cil-history"})]),_:1},8,["onClick"]),e(s(f),{size:"sm",color:"danger",variant:"ghost",class:"action-btn",onClick:$(u=>W(o),["stop"])},{default:n(()=>[e(s(r),{icon:"cil-trash"})]),_:1},8,["onClick"])])],8,Ws)}),128))]))]),e(s(J),{visible:w.value,onClose:i[8]||(i[8]=o=>w.value=!1),size:"lg",alignment:"center",class:"nano-modal"},{default:n(()=>[e(s(ss),{class:"border-0 pb-0"},{default:n(()=>[e(s(ts),{class:"fw-bold text-navy"},{default:n(()=>[C(l(M.value?s(a)("staff.edit"):s(a)("staff.addNew")),1)]),_:1})]),_:1}),e(s(es),{class:"p-4"},{default:n(()=>[e(s(D),{class:"g-3"},{default:n(()=>[e(s(p),{md:"6"},{default:n(()=>[t("label",ct,l(s(a)("staff.fullName"))+" *",1),e(s(R),{modelValue:c.value.name,"onUpdate:modelValue":i[2]||(i[2]=o=>c.value.name=o),required:"",class:"rounded-3"},null,8,["modelValue"])]),_:1}),e(s(p),{md:"6"},{default:n(()=>[t("label",dt,l(s(a)("staff.role")),1),e(s(R),{modelValue:c.value.position,"onUpdate:modelValue":i[3]||(i[3]=o=>c.value.position=o),class:"rounded-3"},null,8,["modelValue"])]),_:1}),e(s(p),{md:"6"},{default:n(()=>[t("label",rt,l(s(a)("staff.commission"))+" (%)",1),e(s(R),{modelValue:c.value.commission_rate,"onUpdate:modelValue":i[4]||(i[4]=o=>c.value.commission_rate=o),modelModifiers:{number:!0},type:"number",min:"0",max:"100",class:"rounded-3"},null,8,["modelValue"])]),_:1}),e(s(p),{md:"6"},{default:n(()=>[t("label",ut,l(s(a)("common.status")),1),e(s(E),{modelValue:c.value.is_active,"onUpdate:modelValue":i[5]||(i[5]=o=>c.value.is_active=o),class:"rounded-3"},{default:n(()=>[t("option",mt,l(s(a)("status.active")),1),t("option",vt,l(s(a)("status.inactive")),1)]),_:1},8,["modelValue"])]),_:1}),e(s(p),{md:"12"},{default:n(()=>[t("label",_t,l(s(a)("common.notes")),1),e(s(as),{modelValue:c.value.notes,"onUpdate:modelValue":i[6]||(i[6]=o=>c.value.notes=o),rows:"3",class:"rounded-3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(s(os),{class:"border-0 pt-0"},{default:n(()=>[e(s(f),{color:"light",class:"rounded-pill px-4",onClick:i[7]||(i[7]=o=>w.value=!1)},{default:n(()=>[C(l(s(a)("common.cancel")),1)]),_:1}),e(s(f),{color:"primary",class:"nano-btn px-4",onClick:K,disabled:F.value},{default:n(()=>[C(l(F.value?s(a)("common.saving"):s(a)("common.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"]),e(cs,{"page-key":"staff"})]))}},It=ds(ft,[["__scopeId","data-v-130225eb"]]);export{It as default};
