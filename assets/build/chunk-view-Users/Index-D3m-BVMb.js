import{f as m,E as I,i as ue,c as f,o as d,d as o,b as t,p as n,u as e,ag as z,Z as de,x as g,P as C,C as v,t as c,aj as H,ao as pe,Q as me,R as fe,a0 as ge,F as j,k as G,s as K,a as O,Y as ve,a6 as _e,a7 as he,a8 as ye,a9 as Ce,aa as ke}from"../chunk-vendor-vue-CVODRAc9.js";import{u as be,a as _}from"../chunk-component-NotificationsBell-BlaTfaiw.js";import{a as we}from"../chunk-view-Bookings/BookingAppearance-Vn9NL_13.js";import{P as Me}from"../chunk-component-PageHeader-DIMefZ9l.js";import{S as A}from"../chunk-component-StatCard-CUh-yMQt.js";import{E as Ue}from"../chunk-component-EmptyState-B8o9iOHP.js";import{L as Se}from"../chunk-component-LoadingSpinner-DYzABkFM.js";import{U as xe}from"./UserModal-B38yJ5U0.js";import{R as Re}from"./RoleModal-CpHGILCc.js";import{_ as Ve}from"../chunk-component-Card-DAbGoLxt.js";import"../chunk-vendor-6xaPOP3o.js";import"../chunk-vendor-charts-C66rl4lP.js";import"../chunk-vendor-pinia-DSPKUyr1.js";import"../chunk-vendor-axios-B9ygI19o.js";import"../chunk-component-Sidebar-ChD_VDDH.js";import"../chunk-view-Bookings/BookingFormPreview-CiRU9DIL.js";const Be={class:"users-page"},De={class:"header-actions"},Ee={class:"stats-grid"},Pe={class:"filters-row"},Te={class:"search-box"},$e=["placeholder"],Ie={class:"filter-select"},Ae={value:""},Le=["value"],Ne={key:1,class:"text-center py-5"},Fe={key:2,class:"table-responsive"},ze={class:"table table-hover"},He={class:"text-end"},je={class:"user-cell"},Ge=["src","alt"],Ke={class:"user-name"},Oe={class:"user-username"},Qe={class:"text-muted"},We={class:"text-muted"},Ye={class:"actions-cell"},Ze={key:3,class:"pagination-wrapper"},qe={class:"mb-0"},Je={key:0},Xe={key:1},es={__name:"Index",setup(ss){var N;const{t:l}=be(),h=we(),D=m(!1),E=m([]),R=m([]),y=m(null),w=m(!1),V=m(!1),Q=m(((N=window.AsmaaSalonConfig)==null?void 0:N.currentUserId)||0),i=I({search:"",role:"",scope:"all"}),p=I({page:1,per_page:20,total:0,total_pages:0}),b=I({total:0,staff:0,customers:0}),M=async()=>{D.value=!0;try{const a={page:p.page,per_page:p.per_page};i.search&&(a.search=i.search),i.scope&&i.scope!=="all"&&(a.scope=i.scope),i.role&&(a.role=i.role);const r=await _.get("users",{params:a});r.data.success&&(E.value=r.data.data,Object.assign(p,r.data.pagination))}catch(a){console.error("Error loading users:",a),h.error(l("users.errorLoading"))}finally{D.value=!1}},W=async()=>{try{const a=await _.get("users/roles",{params:{scope:"all"},noCache:!0});a.data.success&&(R.value=a.data.data)}catch(a){console.error("Error loading roles:",a)}},Y=async()=>{var a,r,s,u,k,B;try{const[F,ce,ie]=await Promise.all([_.get("users",{params:{page:1,per_page:1},noCache:!0}),_.get("users",{params:{page:1,per_page:1,scope:"staff"},noCache:!0}),_.get("users",{params:{page:1,per_page:1,scope:"customers"},noCache:!0})]);b.total=((r=(a=F.data)==null?void 0:a.pagination)==null?void 0:r.total)??0,b.staff=((u=(s=ce.data)==null?void 0:s.pagination)==null?void 0:u.total)??0,b.customers=((B=(k=ie.data)==null?void 0:k.pagination)==null?void 0:B.total)??0}catch{}},U=async()=>{await Promise.all([M(),Y(),W()])};let L;const Z=()=>{clearTimeout(L),L=setTimeout(()=>{p.page=1,M()},500)},P=a=>{i.scope=a,i.role="",p.page=1,M()},q=()=>{i.scope="all",p.page=1,M()},J=()=>{y.value=null,w.value=!0},X=a=>{y.value={...a},w.value=!0},ee=a=>{y.value={...a},V.value=!0},se=async a=>{var r,s,u;try{(r=y.value)!=null&&r.id?(await _.put(`users/${y.value.id}`,a),h.success(l("users.updatedSuccessfully"))):(await _.post("users",a),h.success(l("users.createdSuccessfully"))),w.value=!1,U()}catch(k){console.error("Error saving user:",k);const B=((u=(s=k.response)==null?void 0:s.data)==null?void 0:u.message)||l("users.errorSaving");h.error(B)}},ae=async a=>{var r,s;try{await _.put(`users/${y.value.id}/role`,a),h.success(l("users.roleAssignedSuccessfully")),V.value=!1,U()}catch(u){console.error("Error assigning role:",u);const k=((s=(r=u.response)==null?void 0:r.data)==null?void 0:s.message)||l("users.errorAssigningRole");h.error(k)}},T=m(!1),S=m(null),x=m(!1),oe=a=>{S.value=a,T.value=!0},$=()=>{T.value=!1,S.value=null,x.value=!1},te=async()=>{var a,r;if(S.value){x.value=!0;try{await _.delete(`users/${S.value.id}`),h.success(l("users.deletedSuccessfully")),$(),U()}catch(s){console.error("Error deleting user:",s);const u=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||l("users.errorDeleting");h.error(u)}finally{x.value=!1}}},le=a=>{p.page=a,M()},re=a=>a==="administrator"||a==="asmaa_super_admin"?"danger":a==="asmaa_admin"?"warning":a==="asmaa_manager"?"primary":a==="asmaa_accountant"?"success":"secondary",ne=a=>new Date(a).toLocaleDateString("ar-KW",{year:"numeric",month:"short",day:"numeric"});return ue(()=>{U()}),(a,r)=>(d(),f("div",Be,[o(Me,{title:e(l)("users.title"),subtitle:e(l)("users.subtitle")},{icon:n(()=>[...r[7]||(r[7]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),t("circle",{cx:"9",cy:"7",r:"4"}),t("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),t("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})],-1)])]),actions:n(()=>[t("div",De,[o(e(g),{class:"btn-refresh",color:"secondary",variant:"outline",onClick:U},{default:n(()=>[o(e(v),{icon:"cil-reload",class:"me-1"}),C(" "+c(e(l)("common.refresh")),1)]),_:1}),o(e(g),{class:"btn-add-user",color:"primary",onClick:J},{default:n(()=>[o(e(v),{icon:"cil-plus",class:"me-1"}),C(" "+c(e(l)("users.addNew")),1)]),_:1})])]),_:1},8,["title","subtitle"]),t("div",Ee,[o(A,{label:e(l)("users.totalUsers"),value:b.total,color:"gold"},{icon:n(()=>[o(e(v),{icon:"cil-people"})]),_:1},8,["label","value"]),o(A,{label:e(l)("users.staffUsers"),value:b.staff,color:"gold"},{icon:n(()=>[o(e(v),{icon:"cil-user"})]),_:1},8,["label","value"]),o(A,{label:e(l)("users.customersUsers"),value:b.customers,color:"gold"},{icon:n(()=>[o(e(v),{icon:"cil-user-follow"})]),_:1},8,["label","value"])]),o(e(z),{class:"filters-card mb-4"},{default:n(()=>[o(e(H),null,{default:n(()=>[t("div",Pe,[o(e(pe),{class:"scope-group"},{default:n(()=>[o(e(g),{color:i.scope==="all"?"primary":"light",onClick:r[0]||(r[0]=s=>P("all"))},{default:n(()=>[C(c(e(l)("users.scopeAll")),1)]),_:1},8,["color"]),o(e(g),{color:i.scope==="staff"?"primary":"light",onClick:r[1]||(r[1]=s=>P("staff"))},{default:n(()=>[C(c(e(l)("users.scopeStaff")),1)]),_:1},8,["color"]),o(e(g),{color:i.scope==="customers"?"primary":"light",onClick:r[2]||(r[2]=s=>P("customers"))},{default:n(()=>[C(c(e(l)("users.scopeCustomers")),1)]),_:1},8,["color"])]),_:1}),t("div",Te,[o(e(v),{icon:"cil-search",class:"search-icon"}),me(t("input",{"onUpdate:modelValue":r[3]||(r[3]=s=>i.search=s),type:"text",placeholder:e(l)("users.searchPlaceholder"),class:"search-input",onInput:Z},null,40,$e),[[fe,i.search]])]),t("div",Ie,[o(e(ge),{modelValue:i.role,"onUpdate:modelValue":r[4]||(r[4]=s=>i.role=s),onChange:q},{default:n(()=>[t("option",Ae,c(e(l)("users.allRoles")),1),(d(!0),f(j,null,G(R.value,s=>(d(),f("option",{key:s.key,value:s.key},c(s.name),9,Le))),128))]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),o(e(z),null,{default:n(()=>[o(e(H),null,{default:n(()=>[D.value?(d(),K(Se,{key:0})):E.value.length===0?(d(),f("div",Ne,[o(Ue,{title:e(l)("users.noUsers"),description:e(l)("users.noUsersDescription"),icon:"cil-people"},null,8,["title","description"])])):(d(),f("div",Fe,[t("table",ze,[t("thead",null,[t("tr",null,[t("th",null,c(e(l)("users.user")),1),t("th",null,c(e(l)("users.email")),1),t("th",null,c(e(l)("users.role")),1),t("th",null,c(e(l)("users.registered")),1),t("th",He,c(e(l)("common.actions")),1)])]),t("tbody",null,[(d(!0),f(j,null,G(E.value,s=>(d(),f("tr",{key:s.id},[t("td",null,[t("div",je,[t("img",{src:s.avatar_url,alt:s.display_name,class:"user-avatar"},null,8,Ge),t("div",null,[t("div",Ke,c(s.display_name),1),t("div",Oe,"@"+c(s.username),1)])])]),t("td",null,[t("span",Qe,c(s.email),1)]),t("td",null,[o(e(ve),{color:re(s.role)},{default:n(()=>[C(c(s.role_name),1)]),_:2},1032,["color"])]),t("td",null,[t("span",We,c(ne(s.registered)),1)]),t("td",null,[t("div",Ye,[o(e(g),{color:"primary",variant:"ghost",size:"sm",onClick:u=>X(s)},{default:n(()=>[o(e(v),{icon:"cil-pencil"})]),_:1},8,["onClick"]),o(e(g),{color:"info",variant:"ghost",size:"sm",onClick:u=>ee(s)},{default:n(()=>[o(e(v),{icon:"cil-shield-alt"})]),_:1},8,["onClick"]),s.id!==Q.value?(d(),K(e(g),{key:0,color:"danger",variant:"ghost",size:"sm",onClick:u=>oe(s)},{default:n(()=>[o(e(v),{icon:"cil-trash"})]),_:1},8,["onClick"])):O("",!0)])])]))),128))])])])),p.total_pages>1?(d(),f("div",Ze,[o(e(_e),{pages:p.total_pages,"active-page":p.page,"onUpdate:activePage":le},null,8,["pages","active-page"])])):O("",!0)]),_:1})]),_:1}),o(xe,{modelValue:w.value,"onUpdate:modelValue":r[5]||(r[5]=s=>w.value=s),user:y.value,roles:R.value,onSave:se},null,8,["modelValue","user","roles"]),o(Re,{modelValue:V.value,"onUpdate:modelValue":r[6]||(r[6]=s=>V.value=s),user:y.value,roles:R.value,onSave:ae},null,8,["modelValue","user","roles"]),o(e(de),{visible:T.value,onClose:$},{default:n(()=>[o(e(he),null,{default:n(()=>[o(e(ye),null,{default:n(()=>[C(c(e(l)("users.deleteUserTitle")),1)]),_:1})]),_:1}),o(e(Ce),null,{default:n(()=>{var s;return[t("p",qe,c(e(l)("users.confirmDelete",{name:((s=S.value)==null?void 0:s.display_name)||""})),1)]}),_:1}),o(e(ke),null,{default:n(()=>[o(e(g),{color:"secondary",onClick:$},{default:n(()=>[C(c(e(l)("common.cancel")),1)]),_:1}),o(e(g),{color:"danger",disabled:x.value,onClick:te},{default:n(()=>[x.value?(d(),f("span",Je,c(e(l)("common.deleting")||e(l)("common.loading")),1)):(d(),f("span",Xe,c(e(l)("common.delete")),1))]),_:1},8,["disabled"])]),_:1})]),_:1},8,["visible"])]))}},hs=Ve(es,[["__scopeId","data-v-fa0f994b"]]);export{hs as default};
